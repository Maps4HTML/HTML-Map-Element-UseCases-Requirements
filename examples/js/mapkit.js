/*!
 * v5.x.x
 * https://cdn.apple-mapkit.com/mk/5.x.x/mapkit.js
 */
/* Copyright Â© 2015-2020 Apple Inc. All rights reserved. */
!function(){function t(e,i,n){function o(a,r){if(!i[a]){if(!e[a]){var l="function"==typeof require&&require;if(!r&&l)return l(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[a]={exports:{}};e[a][0].call(c.exports,function(t){return o(e[a][1][t]||t)},c,c.exports,t,e,i,n)}return i[a].exports}for(var s="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}return t}()({1:[function(t,e,i){function n(){this._startTime=Date.now()}function o(){this._tasks=[]}n.prototype={_budget:10,timeRemaining:function(){return Math.max(0,this._budget-(Date.now()-this._startTime))}},o.prototype={start:function(){this._started=!0,this._schedule()},addTask:function(t){return this._tasks.push(t),t},stop:function(){this._started=!1,this._cancelFunction.call(window,this._timerId)},_schedule:function(){this._started&&(this._timerId=this._scheduleFunction.call(window,this._runTask.bind(this)))},_runTask:function(t){for(;this._started&&t.timeRemaining()>0&&this._tasks.length;)this._tasks.shift()();this._tasks.length&&this._schedule()}},"function"==typeof requestIdleCallback?(o.prototype._scheduleFunction=window.requestIdleCallback,o.prototype._cancelFunction=window.cancelIdleCallback):(o.prototype._scheduleFunction=function(t){return setTimeout(function(){var e=new n;t(e)})},o.prototype._cancelFunction=clearTimeout),e.exports=o},{}],2:[function(t,e,i){function n(t,e){var i="[MapKit] Authorization token is invalid.";if("string"==typeof t){var n=t.split(".");if(3===n.length){try{n.pop(),n=n.map(function(t){return JSON.parse(a.atob(t))})}catch(t){return void console.warn(i)}"alg"in n[0]?"ES256"!==n[0].alg&&console.warn('[MapKit] Authorization token has incorrect "alg" value.'):console.warn('[MapKit] Authorization token has no "alg" value.'),"typ"in n[0]?"JWT"!==n[0].typ&&console.warn('[MapKit] Authorization token has incorrect "typ" value.'):console.warn('[MapKit] Authorization token has no "typ" value.'),"kid"in n[0]||console.warn('[MapKit] Authorization token has no "kid" value.'),e.specialLogoSize="4SSR6XST6B"===n[0].kid;var o=Date.now(),s=1e3*parseInt(n[1].iat);if("iat"in n[1]&&!isNaN(s)?s>o+36e5&&console.warn('[MapKit] Authorization token may have an "iat" value that is in the future ('+new Date(s)+")."):console.warn('[MapKit] Authorization token has no "iat" value.'),"exp"in n[1]){var r=1e3*parseInt(n[1].exp);r<o||isNaN(r)?console.warn('[MapKit] Authorization token may be expired according to its "exp" value.'):r>o+31536e6&&console.warn("[MapKit] Authorization token with expiration date greater than 1 year is not recommended in production environments.")}else isNaN(s)||console.warn("[MapKit] Authorization token (created on "+new Date(s)+") without an expiration is not recommended in production environments.");if(!a.isNode())if("origin"in n[1]){var l=n[1].origin;if(window.location.origin&&window.location.origin!==l){var h;h="null"===window.location.origin?"an opaque origin":'"'+window.location.origin+'"',console.warn('[MapKit] Authorization token origin restriction ("'+l+'") may not match the page origin ('+h+").")}}else console.warn("[MapKit] Authorization token without origin restriction is not recommended in production environments.")}else console.warn(i)}else console.warn(i)}function o(){}var s=t("@maps/localizer"),a=t("@maps/js-utils"),r=t("../src/js/unsafe-dom"),l=t("@maps/loaders").XHRLoader,h=t("@maps/loaders").Priority,c=t("../src/js/call-function-safely"),d=a.isIE10()?window.location.protocol:"https:",u={url:d+"//cdn.apple-mapkit.com/ma/bootstrap",apiVersion:"2",accessKeyExpirationBiasMS:3e4},p={OK:200,MULTIPLE_CHOICES:300,UNAUTHORIZED:401,TOO_MANY_REQUESTS:429},m=["l10n","languageSupport","mkjsVersion","messagePrefix","poi"],g=["language","countryCode","origin","madabaBaseUrl","authorizationCallback","_showMapsLogo","bootstrapTimeout","_showsTileInfo"],_={READY:0,PENDING:1,ERROR:2,UNINITIALIZED:3},f={Initialized:"Initialized",Refreshed:"Refreshed"},y={Unauthorized:"Unauthorized",TooManyRequests:"Too Many Requests",Timeout:"Timeout"},v={Apple:"Apple",AutoNavi:"AutoNavi"};o.prototype=a.inheritPrototype(r.EventTarget,o,{HTTP:p,ErrorStatus:y,Events:{Changed:"bootstrap-load",Error:"bootstrap-error"},States:_,state:_.UNINITIALIZED,authorizationCallback:null,tileProvider:v.Apple,_countryCode:null,_showMapsLogo:!0,_madabaBaseUrl:null,_customMadabaUrl:!1,_madabaDomains:null,_accessKey:null,_accessToken:null,apiBaseUrl:null,apiBaseUrlOverride:null,types:{},_acceptLanguage:null,_optionsLanguage:null,_bootstrapRequestParams:null,_showsTileInfo:!1,_messagePrefix:"Bootstrap.init(): ",withParameters:function(t){return m.forEach(function(e){e in t&&(this["_"+e]=t[e])},this),this},init:function(t,e){if(a.required(t,e+"`options` object is required.",{checkNull:!0}).checkType(t,"object",e+"`options` object is invalid."),Object.keys(t).forEach(function(t){-1===g.indexOf(t)&&console.warn(e+"ignoring invalid option: `"+t+"`.")}),null===this.authorizationCallback){this.state=_.PENDING;var i=t.authorizationCallback;a.required(i,e+"`options` is missing `authorizationCallback`.",{checkNull:!0}).checkType(i,"function",e+"`authorizationCallback` in `options` must be a function."),this.authorizationCallback=i,t.language&&(a.checkType(t.language,"string",e+"`language` in `options` must be a string."),this._optionsLanguage=t.language),a.isNode()&&t.origin&&(this.origin=t.origin),this.language?this._l10n.localeId=this.language:this.language=this._optionsLanguage,"countryCode"in t&&(this._countryCode=t.countryCode),"_showMapsLogo"in t&&(this._showMapsLogo=!!t._showMapsLogo),t.bootstrapTimeout&&(this._bootstrapTimeout=t.bootstrapTimeout),t.madabaBaseUrl&&(this._madabaBaseUrl=t.madabaBaseUrl,this._customMadabaUrl=!0),t._showsTileInfo&&(this._showsTileInfo=t._showsTileInfo),this._loadFromServer()}else console.warn(e+"already initialized; ignoring.")},reloadFromServer:function(){this._loadFromServer()},get accessKey(){return this._accessKey},get accessToken(){return this._accessToken},accessKeyHasExpired:function(){this._loadFromServer(h.Highest)},get ready(){return this.state===_.READY},get language(){return this._language},set language(t){t!==this._language&&(t?a.checkType(t,"string","[MapKit] `language` must be a string or `null`."):t=this._acceptLanguage||this._getClientLanguage(),this._language=this._languageSupport.bestMatch(t,"en"),this.state!==_.UNINITIALIZED&&(this._l10n.localeId=t))},get countryCode(){return this._countryCode},set countryCode(t){t!==this._countryCode&&(t&&(a.checkType(t,"string","[MapKit] `countryCode` must be a string or `null`."),t=t.toUpperCase()),this._countryCode=t,this._loadFromServer())},get showMapsLogo(){return this._showMapsLogo},get isAutoNavi(){return this.tileProvider===v.AutoNavi||this.state===_.PENDING&&"CN"===this._countryCode},get showsTileInfo(){return this._showsTileInfo},syrupRequestedFallback:function(){this._syrupRequestedFallback=!0,setTimeout(function(){var t=new r.Event(this.Events.Changed);t.status=f.Refreshed,this.dispatchEvent(t)}.bind(this),0)},get canRunCSR(){return this.ready&&(!this._disableCsr||!!this.previewLoCSR)&&!this._syrupRequestedFallback},get madabaDomains(){return this._customMadabaUrl||!this._madabaDomains&&this._madabaBaseUrl?[this._madabaBaseUrl]:this._madabaDomains?this._madabaDomains:null},appendAuthOptions:function(t,e){return this.origin&&(t.origin=this.origin),this.authorizationCallback&&(t.headers={Authorization:a.fillTemplate("Bearer {{token}}",{token:e||this.accessToken})}),t},appendServiceAuthOptions:function(t){return this.isAutoNavi?t:this.appendAuthOptions(t)},loaderWillStart:function(t){this.state=_.PENDING},loaderDidSucceed:function(t,e){this._requestDidLoad(e)},loaderDidFail:function(t,e){this._parseError(t._xhr)},_loadFromServer:function(t){this._bootstrapRequestParams={apiVersion:u.apiVersion,countryCode:this._countryCode,mkjsVersion:this._mkjsVersion,poi:this._poi};var e=u.url+"?"+a.toQueryString(this._bootstrapRequestParams);this.proxyPrefixes&&(e=this.proxyPrefixes[0]+e);var i={retry:!0,delay:0,priority:t,timeout:this._bootstrapTimeout};c(this.authorizationCallback,null,[function(t){n(t,this),this.appendAuthOptions(i,t),this.accessToken&&(i.headers["X-Maps-Access-Token"]=a.fillTemplate("Bearer {{token}}",{token:this.accessToken})),new l(e,this,i).schedule()}.bind(this)])},_requestDidLoad:function(t){if(!this._parseError(t))try{var e=JSON.parse(t.responseText);this._processLoadedData(e)}catch(t){console.error(this._messagePrefix+"parse error.",t),this._loadFailed()}},_resetReloadTimer:function(t){clearTimeout(this._reloadTimerId),this._reloadTimerId=setTimeout(function(){delete this._reloadTimerId,this.accessKeyHasExpired()}.bind(this),t),a.isNode()&&this._reloadTimerId.unref()},_loadSucceeded:function(t){setTimeout(function(){this.state=_.READY;var e=new r.Event(this.Events.Changed);e.status=t?f.Refreshed:f.Initialized,this.dispatchEvent(e)}.bind(this),0)},_loadFailed:function(t){setTimeout(function(){this.state=_.ERROR;var e=new r.Event(this.Events.Error);e.status=t,this.dispatchEvent(e)}.bind(this),0)},_processLoadedData:function(t){var e=!!this._accessToken;try{this._parseData(t),this.expiresInSeconds&&this._resetReloadTimer(this._adjustedExpirationInSeconds(this.expiresInSeconds))}catch(t){return console.error(this._messagePrefix+"parse error.",t),void this._loadFailed()}this.language||(this.language=this._optionsLanguage),this._loadSucceeded(e)},_parseData:function(t){t.apiBaseUrl||console.warn(this._messagePrefix+"apiBaseUrl not found. Using default."),this._countryCode="unknown"!==t.countryCode?t.countryCode:null,this.environment=t.environment,this.apiBaseUrl=this.apiBaseUrlOverride||t.apiBaseUrl;var e;if(this.proxyPrefixes&&(e=this.proxyPrefixes[this.proxyPrefixes.length-1],this.apiBaseUrl=e+this.apiBaseUrl),t.analytics){var i=t.analytics;this.proxyPrefixes&&(i.analyticsUrl=e+i.analyticsUrl,i.errorUrl=e+i.errorUrl),this.analytics=i}t.authInfo&&t.authInfo.team_id&&(this.teamId=t.authInfo.team_id),t.locationShiftUrl&&(this.locationShiftUrl=t.locationShiftUrl),this.expiresInSeconds=t.expiresInSeconds,this._customMadabaUrl||!t.madabaBaseUrl&&!t.madabaDomains||(this._madabaBaseUrl=t.madabaBaseUrl,this._madabaDomains=t.madabaDomains&&t.madabaDomains.length&&t.madabaDomains.map(function(t){return t.match(/^(https?:)?\/\//)?t:d+"//"+t})),this._disableCsr=!!t.disableCsr,t.accessKey&&(this._accessKey=t.accessKey),t.authInfo&&t.authInfo.access_token&&(this._accessToken=t.authInfo.access_token),this._acceptLanguage=this._parseAcceptLanguage(t.acceptLanguage),this.tileProvider=v.Apple;var n={};t.attributions&&t.attributions.forEach(function(t){n[t.attributionId]=t,this.tileGroup=t.attributionId},this);var o={};t.tileSources.forEach(function(t){var e=t.tileSource;o[e]={name:e,path:t.path,domains:t.domains,proxyPrefixes:this.proxyPrefixes,protocol:t.protocol||"https:",attribution:n[t.attributionId],minZoomLevel:t.minZoomLevel,maxZoomLevel:t.maxZoomLevel,supportedResolutions:t.supportedResolutions,showPrivacyLink:t.showPrivacyLink,showTermsOfUseLink:t.showTermsOfUseLink},t.needsLocationShift&&(this.tileProvider=v.AutoNavi),o[e].attribution&&o[e].attribution.global&&(o[e].attribution.name=o[e].attribution.global[0].name,o[e].attribution.url=o[e].attribution.global[0].url)}.bind(this)),this.types={},this.rasterTilesForSyrup={};for(var s in t.modes){var a=t.modes[s].layers;this.types[s]={name:s,provider:this.tileProvider,lowResolutionTileSource:o[a[0].lowResTileSource],tileSources:a.map(function(t){return o[t.tileSource]})},this.rasterTilesForSyrup[s]={name:s,provider:this.tileProvider,tileSources:a.map(function(t){return o[t.tileSource]})}}},_parseError:function(t){var e,i,n=t.status;return!(n>=p.OK&&n<p.MULTIPLE_CHOICES)&&(t.readyState!==t.DONE?(i=y.Timeout,e="initialization failed because the bootstrap request timed out after "+this._bootstrapTimeout+" ms."):n===p.UNAUTHORIZED?(i=y.Unauthorized,e="initialization failed because the authorization token is invalid."):n===p.TOO_MANY_REQUESTS?(i=y.TooManyRequests,e="initialization failed because the daily usage limit has exceeded."):e="initialization failed because the server returned error "+n+" ("+t.statusText+").",console.error(this._messagePrefix+e),this._loadFailed(i),!0)},_getClientLanguage:function(){return a.isNode()?"en-US":window.navigator.languages?window.navigator.languages[0]:window.navigator.language},_parseAcceptLanguage:function(t){var e=s.LanguageSupport.parseAcceptLanguage(t);return e&&e[0].langTag?e[0].langTag.tag:null},_adjustedExpirationInSeconds:function(t){return 1e3*t-u.accessKeyExpirationBiasMS},_restore:function(){this.authorizationCallback=null,this._acceptLanguage=null,this._optionsLanguage=null,this.apiBaseUrl=null,this.apiBaseUrlOverride=null,this.state=_.UNINITIALIZED,delete this._language,this._listeners={},clearTimeout(this._reloadTimerId),delete this._reloadTimerId},_debugInfo:function(){var t={};return["ready","state","_countryCode","tileProvider","apiBaseUrl","language","_acceptLanguage","_optionsLanguage","_getClientLanguage","types"].forEach(function(e){t[e]="function"==typeof this[e]?this[e]():this[e]},this),t}}),a.isNode()&&(o.prototype.MapsWS=u),e.exports=o},{"../src/js/call-function-safely":161,"../src/js/unsafe-dom":233,"@maps/js-utils":82,"@maps/loaders":83,"@maps/localizer":91}],3:[function(t,e,i){e.exports=function(t,e,i){var n;return function(){var o=arguments;n&&window.clearTimeout(n),n=window.setTimeout(function(){n=null,t.apply(i,o)},e||0)}}},{}],4:[function(t,e,i){function n(t){var e=_.clamp(t,1e-8-90,90-1e-8)*y;return.5+Math.log(Math.tan(v-e/2))/w}function o(t){var e=Math.pow(Math.E,2*Math.PI*(t-.5));return-2*(Math.atan(e)-Math.PI/4)/Math.PI*180}function s(t){return _.mod(t/360+.5,1)}function a(t){return 360*(_.mod(t,1)-.5)}function r(t){return _.mod(180+t,360)-180}function l(t,e){f(this,l)&&(void 0===t&&(t=new c),void 0===e&&(e=new h),_.checkInstance(t,c,"[MapKit] `center` is not a Coordinate."),_.checkInstance(e,h,"[MapKit] `span` is not a CoordinateSpan."),this.center=new c(t.latitude,t.longitude),this.span=new h(e.latitudeDelta,e.longitudeDelta))}function h(t,e){f(this,h)&&(void 0===t&&(t=0),void 0===e&&(e=0),_.checkType(t,"number","[MapKit] `latitudeDelta` is not a number."),_.checkType(e,"number","[MapKit] `longitudeDelta` is not a number."),this.latitudeDelta=Math.max(t,0),this.longitudeDelta=Math.max(e,0))}function c(t,e){f(this,c)&&(void 0===t&&(t=0),void 0===e&&(e=0),_.checkType(t,"number","[MapKit] `latitude` is not a number."),_.checkType(e,"number","[MapKit] `longitude` is not a number."),this.latitude=t,this.longitude=e)}function d(t,e,i,n){f(this,d)&&(arguments.length<4&&(n=0,arguments.length<3&&(i=0,arguments.length<2&&(e=0,arguments.length<1&&(t=0)))),_.checkType(t,"number","[MapKit] Expected a number for `northLatitude` in BoundingRegion constructor but got `"+t+"` instead."),_.checkType(e,"number","[MapKit] Expected a number for `eastLongitude` in BoundingRegion constructor but got `"+e+"` instead."),_.checkType(i,"number","[MapKit] Expected a number for `southLatitude` in BoundingRegion constructor but got `"+i+"` instead."),_.checkType(n,"number","[MapKit] Expected a number for `westLongitude` in BoundingRegion constructor but got `"+n+"` instead."),this.northLatitude=t,this.eastLongitude=e,this.southLatitude=i,this.westLongitude=n)}function u(t,e){f(this,u)&&(arguments.length<2&&(e=0,arguments.length<1&&(t=0)),_.checkType(t,"number","[MapKit] Expected a number for `x` in MapPoint constructor but got `"+t+"` instead."),_.checkType(e,"number","[MapKit] Expected a number for `y` in MapPoint constructor but got `"+e+"` instead."),this.x=t,this.y=e)}function p(t,e){f(this,p)&&(arguments.length<2&&(e=0,arguments.length<1&&(t=0)),_.checkType(t,"number","[MapKit] Expected a number for `width` in MapSize constructor but got `"+t+"` instead."),_.checkType(e,"number","[MapKit] Expected a number for `height` in MapSize constructor but got `"+e+"` instead."),this.width=t,this.height=e)}function m(t,e,i,n){f(this,m)&&(arguments.length<4&&(n=0,arguments.length<3&&(i=0,arguments.length<2&&(e=0,arguments.length<1&&(t=0)))),_.checkType(t,"number","[MapKit] Expected a number for `x` in MapRect constructor but got `"+t+"` instead."),_.checkType(e,"number","[MapKit] Expected a number for `y` in MapRect constructor but got `"+e+"` instead."),_.checkType(i,"number","[MapKit] Expected a number for `width` in MapRect constructor but got `"+i+"` instead."),_.checkType(n,"number","[MapKit] Expected a number for `height` in MapRect constructor but got `"+n+"` instead."),this.origin=new u(t,e),this.size=new p(i,n))}function g(t,e){if(f(this,g)){if(null==e)if("number"==typeof t)e=1/0;else{var i=null==t?{}:t,n=Object.prototype.hasOwnProperty;t=n.call(i,"minCameraDistance")?i.minCameraDistance:0,e=n.call(i,"maxCameraDistance")?i.maxCameraDistance:1/0}if("number"!=typeof t||t<0)throw new Error("[MapKit] The `minCameraDistance` property of CameraZoomRange must be a number >= 0");if("number"!=typeof e||e<0)throw new Error("[MapKit] The `maxCameraDistance` property of CameraZoomRange must be a number >= 0");if(e<t)throw new Error("[MapKit] The `maxCameraDistance` property of CameraZoomRange must be greater than the `minCameraDistance` property.");this._minCameraDistance=t,this._maxCameraDistance=e}}var _=t("@maps/js-utils"),f=t("../../src/js/check-instance-and-warn"),y=Math.PI/180,v=Math.PI/4,w=2*Math.PI,b=256,C=o(0),S=o(1);l.prototype={constructor:l,copy:function(){return new l(this.center.copy(),this.span.copy())},toString:function(){return["CoordinateRegion(","\tlatitude: "+this.center.latitude,"\tlongitude: "+this.center.longitude,"\tlatitudeDelta: "+this.span.latitudeDelta,"\tlongitudeDelta: "+this.span.longitudeDelta,")"].join("\n")},equals:function(t){return this.center.equals(t.center)&&this.span.equals(t.span)},toBoundingRegion:function(){var t=this.span.latitudeDelta/2,e=this.span.longitudeDelta/2;return new d(this.center.latitude+t,r(this.center.longitude+e),this.center.latitude-t,r(this.center.longitude-e))},toMapRect:function(){if(this.span.latitudeDelta<0)this.span.latitudeDelta=0;else{var t=n(Math.abs(this.center.latitude)),e=C-o(2*t);this.span.latitudeDelta>e&&(this.span.latitudeDelta=e)}var i=this.center.longitude-this.span.longitudeDelta/2,s=this.center.longitude+this.span.longitudeDelta/2,a=!1;i<-180&&(i+=360,a=!0);var r=!1;s>180&&(s-=360,r=!0);var l=new c(this.center.latitude,i),h=new c(this.center.latitude,s),d=l.toMapPoint(),p=h.toMapPoint();a&&(d.x-=1),r&&(p.x+=1);var g=new m;if(0===this.center.latitude){var _=new c(this.center.latitude+this.span.latitudeDelta/2,this.center.longitude),f=new c(this.center.latitude-this.span.latitudeDelta/2,this.center.longitude);return g.origin.x=d.x,g.size.width=p.x-g.origin.x,g.origin.y=_.toMapPoint().y,g.size.height=f.toMapPoint().y-g.origin.y,g}var y=this.copy();y.center.latitude=S+this.span.latitudeDelta/2;var v=10,w=new c,b=new u;_=new c,f=new c,_.longitude=this.center.longitude,f.longitude=this.center.longitude;var k=0;do{if(y.center.latitude>C&&y.center.latitude>this.center.latitude||y.center.latitude<S&&y.center.latitude<this.center.latitude)y.center.latitude-=v,v*=.1;else if(y.center.latitude>C||y.center.latitude<S)return new m(0,0,1,1);if(k>500)return new m(0,0,1,1);_.latitude=y.center.latitude+y.span.latitudeDelta/2,f.latitude=y.center.latitude-y.span.latitudeDelta/2,g.origin.x=d.x,g.size.width=p.x-g.origin.x,g.origin.y=_.toMapPoint().y,g.size.height=f.toMapPoint().y-g.origin.y,b.x=g.midX(),b.y=g.midY(),w=b.toCoordinate(),(v>0&&w.latitude>this.center.latitude||v<0&&w.latitude<this.center.latitude)&&(v*=-.1),y.center.latitude+=v,k++}while(Math.abs(w.latitude-this.center.latitude)>=1e-8);return g}},h.prototype={constructor:h,copy:function(){return new h(this.latitudeDelta,this.longitudeDelta)},equals:function(t){return Math.abs(this.latitudeDelta-t.latitudeDelta)<1e-8&&Math.abs(this.longitudeDelta-t.longitudeDelta)<1e-8},toString:function(){return["CoordinateSpan(","\tlatitudeDelta: "+this.latitudeDelta,"\tlongitudeDelta: "+this.longitudeDelta,")"].join("\n")}},c.prototype={constructor:c,copy:function(){return new c(this.latitude,this.longitude)},equals:function(t){return Math.abs(this.latitude-t.latitude)<1e-8&&Math.abs(this.longitude-t.longitude)<1e-8},toMapPoint:function(){return new u(s(this.longitude),n(this.latitude))},toUnwrappedMapPoint:function(){return new u(this.longitude/360+.5,n(this.latitude))},toString:function(){return["Coordinate(","latitude:"+this.latitude.toFixed(12),",longitude:"+this.longitude.toFixed(12),")"].join("")}},d.prototype={constructor:d,copy:function(){return new d(this.northLatitude,this.eastLongitude,this.southLatitude,this.westLongitude)},toString:function(){return["BoundingRegion(","\tnorthLatitude: "+this.northLatitude,"\teastLongitude: "+this.eastLongitude,"\tsouthLatitude: "+this.southLatitude,"\twestLongitude: "+this.westLongitude,")"].join("\n")},toCoordinateRegion:function(){var t=r(this.eastLongitude),e=r(this.westLongitude);t<e&&(t+=360);var i=this.northLatitude-this.southLatitude,n=t-e;return new l(new c(this.southLatitude+i/2,r(e+n/2)),new h(i,n))}},u.prototype={constructor:u,z:0,w:1,toString:function(){return"MapPoint("+this.x+", "+this.y+")"},copy:function(){return new u(this.x,this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},toCoordinate:function(){return new c(o(this.y),r(a(this.x)))}},p.prototype={constructor:p,toString:function(){return"MapSize("+this.width+", "+this.height+")"},copy:function(){return new p(this.width,this.height)},equals:function(t){return this.width===t.width&&this.height===t.height}},m.prototype={constructor:m,toString:function(){return"MapRect("+[this.origin.x.toFixed(12),this.origin.y.toFixed(12),this.size.width.toFixed(12),this.size.height.toFixed(12)].join(", ")+")"},copy:function(){return new m(this.origin.x,this.origin.y,this.size.width,this.size.height)},equals:function(t){return this.origin.equals(t.origin)&&this.size.equals(t.size)},minX:function(){return this.origin.x},minY:function(){return this.origin.y},midX:function(){return this.origin.x+this.size.width/2},midY:function(){return this.origin.y+this.size.height/2},maxX:function(){return this.origin.x+this.size.width},maxY:function(){return this.origin.y+this.size.height},scale:function(t,e){if(_.required(t,"[MapKit] Missing `scaleFactor` parameter in call to `MapRect.scale()`."),"number"!=typeof t||isNaN(t))throw new TypeError("[MapKit] The `scaleFactor` parameter passed to `MapRect.scale()` is not a number.");var i=this.size.width*t,n=this.size.height*t;return e?(_.checkInstance(e,u,"[MapKit] The `scaleCenter` parameter passed to `MapRect.scale()` is not a MapPoint."),new m(e.x-t*(e.x-this.origin.x),e.y-t*(e.y-this.origin.y),i,n)):new m(this.midX()-i/2,this.midY()-n/2,i,n)},toCoordinateRegion:function(){var t=this.origin.toCoordinate(),e=new u(this.maxX(),this.maxY()).toCoordinate(),i=Math.abs(e.latitude-t.latitude),n=e.longitude-t.longitude;return e.longitude<t.longitude&&(n+=360),new l(new u(this.midX(),this.midY()).toCoordinate(),new h(i,n))}},g.prototype={get minCameraDistance(){return this._minCameraDistance},get maxCameraDistance(){return this._maxCameraDistance},copy:function(){return new g(this._minCameraDistance,this._maxCameraDistance)}},e.exports={tileSize:b,convertLatitudeToY:n,convertYToLatitude:o,convertLongitudeToX:s,convertXToLongitude:a,wrapLongitude:r,clampX:function(t,e,i){var n=e-t;if(n>0){if(Math.abs(i-(t+1))<n)return t+1}else if((n=t-i)>0&&Math.abs(e-(t-1))<n)return t-1;return t},zoomLevelForMapRectInViewport:function(t,e,i){var n=e.width/(i*t.size.width),o=e.height/(i*t.size.height);return _.log2(Math.min(n,o))},mapUnitsPerMeterAtLatitude:function(t){var e=t*y,i=111132.92+-559.82*Math.cos(2*e)+1.175*Math.cos(4*e)+-.0023*Math.cos(6*e),o=n(t-.5),s=n(t+.5);return Math.abs(o-s)/i},pointsPerAxis:function(t){return Math.pow(2,t)*b},CameraZoomRange:g,CoordinateRegion:l,CoordinateSpan:h,Coordinate:c,BoundingRegion:d,MapPoint:u,MapRect:m,MapSize:p}},{"../../src/js/check-instance-and-warn":162,"@maps/js-utils":82}],5:[function(t,e,i){"use strict";e.exports={Feature:"Feature",FeatureCollection:"FeatureCollection",GeometryCollection:"GeometryCollection",MultiPoint:"MultiPoint",MultiLineString:"MultiLineString",MultiPolygon:"MultiPolygon",Point:"Point",LineString:"LineString",Polygon:"Polygon",Position:"Position"}},{}],6:[function(t,e,i){"use strict";function n(t){this.message=t}function o(t,e,i){var n=function(){var e=i(n.collection?n.collection.items[n.index]:t.backgroundTaskItem);n.collection?n.collection.items[n.index]=e:t.backgroundTaskItem=e};return e&&(n.collection=e,n.index=e.items.length),t.backgroundTaskQueue.addTask(n)}function s(t){if(!p.isPosition(t))throw new n("[MapKit] Expected a GeoJSON Position type, instead got "+t);return new d(t[1],t[0])}function a(t,e){switch(e){case m.MultiPoint:case m.LineString:return t.map(function(t){return s(t)});case m.Polygon:return t.map(function(t){return t.map(function(t){return s(t)})});default:return s(t)}}function r(t,e,i){function s(){var i=new v(C,{data:t}),n=l?g(l,e.delegate,[w||i,t],i):i;return b&&(n.style=g(b,e.delegate,[i,t],i)),n}var l,h=y.indexOf(t.type)>-1,d="GeometryCollection"===t.type;if(h||d){var u=h?t.coordinates:t.geometries;if(h)switch(t.type){case m.MultiPoint:l=e.delegate.itemForMultiPoint;break;case m.MultiLineString:l=e.delegate.itemForMultiLineString;break;case m.MultiPolygon:l=e.delegate.itemForMultiPolygon}d&&(l=e.delegate.itemForPoint);var p=new c([],t);return u.forEach(function(i){h&&(i={type:f[t.type],coordinates:i}),p.items.push(r(i,e,p))}),e.backgroundTaskQueue&&o(e,i,function(){return p._impl.items=p.items.filter(function(t){return!!t}),l?g(l,e.delegate,[p,t],p):p}),p}var v=_[t.type];if(!v)throw new n("[MapKit] Expected a GeoJSON "+t.type+" type, instead got "+t);var w,b,C=a(t.coordinates,t.type);switch(t.type){case m.Point:l=e.delegate.itemForPoint,w=C;break;case m.LineString:l=e.delegate.itemForLineString,b=e.delegate.styleForOverlay;break;case m.Polygon:l=e.delegate.itemForPolygon,b=e.delegate.styleForOverlay}return e.backgroundTaskQueue?o(e,i,s):s()}function l(t,e,i){if(null===t.geometry)return e.backgroundTaskQueue?o(e,i,function(){return null}):null;if(!p.isValid(t))throw new n("[MapKit] Expected a GeoJSON "+t.type+" type, instead got "+t);var s=r(t.geometry,e,i);if(!s)throw new n("[MapKit] "+t+" is an unknown GeoJSON type");return s}function h(t,e,i){var s;switch(t.type){case m.Feature:return s=l(t,e,i),e.delegate.itemForFeature&&o(e,i,function(i){return g(e.delegate.itemForFeature,e.delegate,[i,t],i)}),s;case m.FeatureCollection:return s=new c([],t),t.features.forEach(function(t){var i=h(t,e,s);i&&s.items.push(i)}),e.backgroundTaskQueue&&o(e,i,function(){return s._impl.items=s.items.filter(function(t){return!!t}),e.delegate.itemForFeatureCollection?g(e.delegate.itemForFeatureCollection,e.delegate,[s,t],s):s}),s;case m.GeometryCollection:case m.MultiPoint:case m.MultiLineString:case m.MultiPolygon:case m.Point:case m.LineString:case m.Polygon:case m.Position:return r(t,e,i);default:throw new n("string"==typeof t.type?'[MapKit] "'+t.type+'" is an unknown GeoJSON type.':"[MapKit] importGeoJSON expects an object with a known GeoJSON `type` property.")}}var c=t("../../src/js/collections/item-collection"),d=t("../geo").Coordinate,u=t("../background-task-queue"),p=t("./validate"),m=t("./constants"),g=t("../../src/js/call-function-safely"),_={Point:t("../../src/js/annotations/marker-annotation"),LineString:t("../../src/js/overlays/polyline-overlay"),Polygon:t("../../src/js/overlays/polygon-overlay")},f={MultiPoint:m.Point,MultiLineString:m.LineString,MultiPolygon:m.Polygon},y=[m.MultiPoint,m.MultiLineString,m.MultiPolygon];n.prototype=Object.create(Error.prototype),e.exports=function(t,e){var i={delegate:{}};e&&(i.delegate=e,i.backgroundTaskQueue=new u);try{var o="[MapKit] importGeoJSON expects an Object and was passed ";if(!t)throw new n(o+"a falsy value");if(!(t instanceof Object))throw new n(o+t);if(Array.isArray(t))throw new n(o+"an array");var s=h(t,i);return i.backgroundTaskQueue?(i.backgroundTaskQueue.addTask(function(){var n=i.backgroundTaskItem||s;n instanceof c||(n=new c(n,t)),"function"==typeof e?g(e,null,[null,n]):i.delegate.geoJSONDidComplete?g(i.delegate.geoJSONDidComplete,i.delegate,[n,t]):console.warn("[MapKit] importGeoJSON was called asynchronously with a delegate object but no `geoJSONDidComplete` method was defined.")}),void i.backgroundTaskQueue.start()):(s instanceof c||(s=new c(s,t)),s)}catch(o){if(!(o instanceof n))throw o;"function"==typeof i.delegate.geoJSONDidError?g(i.delegate.geoJSONDidError,i.delegate,[o,t]):"function"==typeof e?g(e,null,[o]):console.error(o.message)}}},{"../../src/js/annotations/marker-annotation":149,"../../src/js/call-function-safely":161,"../../src/js/collections/item-collection":164,"../../src/js/overlays/polygon-overlay":206,"../../src/js/overlays/polyline-overlay":209,"../background-task-queue":1,"../geo":4,"./constants":5,"./validate":8}],7:[function(t,e,i){"use strict";var n={importGeoJSON:t("./import"),constants:t("./constants"),validate:t("./validate")};e.exports=n},{"./constants":5,"./import":6,"./validate":8}],8:[function(t,e,i){"use strict";function n(t,e){return t instanceof Object&&(t.type===r.Feature&&!!o(t.geometry,e))}function o(t,e){return t instanceof Object&&((!e||t.type===e)&&(!!l(t.type)&&(t.type===r.GeometryCollection?h.GeometryCollection(t):t.type===r.MultiLineString||t.type===r.MultiPolygon||t.type===r.MultiPoint?a(t.coordinates):t.coordinates instanceof Array)))}function s(t){if(!Array.isArray(t)||t.length<2)return!1;for(var e=0;e<2;++e)if("number"!=typeof t[e]||isNaN(t[e]))return!1;return!0}function a(t){for(var e=0;e<t.length;e+=1)if(!(t[e]instanceof Array))return!1;return!0}var r=t("./constants"),l=function(t){return t instanceof String||"string"==typeof t},h={Feature:function(t){return n(t,t.geometry&&t.geometry.type)},FeatureCollection:function(t){if(!(t instanceof Object&&t.features instanceof Array))return!1;for(var e in t.features){var i=t.features[e];if(i.geometry&&!n(i,i.geometry.type))return!1}return!0},Position:function(t){return s(t)},Point:function(t){return o(t,r.Point)},MultiPoint:function(t){return o(t,r.MultiPoint)},LineString:function(t){return o(t,r.LineString)},MultiLineString:function(t){return o(t,r.MultiLineString)},Polygon:function(t){return o(t,r.Polygon)},MultiPolygon:function(t){return o(t,r.MultiPolygon)},GeometryCollection:function(t){if(!(t instanceof Object&&t.geometries instanceof Array))return!1;for(var e in t.features)if(!o(t,t.geometries[e].type))return!1;return!0}};e.exports={isValid:function(t){return!!h[t.type]&&h[t.type](t)},isPosition:function(t){return h.Position(t)}}},{"./constants":5}],9:[function(t,e,i){e.exports={BackgroundGridThemes:t("./src/background-grid-node").Themes,SceneGraphMapNode:t("./src/scene-graph-map-node"),SyrupMapNode:t("./src/syrup-map-node"),TileOverlay:t("./src/tile-overlay")}},{"./src/background-grid-node":10,"./src/scene-graph-map-node":26,"./src/syrup-map-node":29,"./src/tile-overlay":37}],10:[function(t,e,i){function n(){o.BaseNode.call(this),this._renderer=new(t("./render-background-grid"))(this),this._theme=a.light}var o=t("../../scene-graph"),s=t("@maps/js-utils"),a={light:{fillColor:[249,245,237],lineColor:[152,151,147]},dark:{fillColor:[64,64,64],lineColor:[214,214,214]}};n.prototype=s.inheritPrototype(o.BaseNode,n,{get size(){return this.parent.size},get zoom(){return this.parent.zoomLevel},get origin(){return this.parent.visibleMapRect.origin},get theme(){return this._theme},updateThemeFromTint:function(t){var e=a[t];e!==this._theme&&(this._theme=e,this.needsDisplay=!0)},stringInfo:function(){return"BackgroundGridNode"+(this._theme===a.light?"":"<dark>")}}),e.exports=n},{"../../scene-graph":51,"./render-background-grid":21,"@maps/js-utils":82}],11:[function(t,e,i){function n(t){this.node=t,this._configuration=null,this._debug=!1,this._language=null,this.allowWheelToZoom=!1,this._pointOfInterestFilter=null,this._showsDefaultTiles=!0,this._tileOverlays=[],this.camera=new l,this._element=document.createElement("div"),this.currentMinZoomLevel=this.minZoomLevel,this.currentMaxZoomLevel=this.maxZoomLevel}var o=t("../../scene-graph"),s=t("../../geo"),a=t("@maps/device-pixel-ratio"),r=t("@maps/js-utils"),l=t("./camera"),h=t("./camera-animation"),c=t("./initial-interaction-controller"),d=t("./zoom-controller"),u=t("./pan-controller"),p=t("./tile-data"),m=t("./tile-overlay"),g=t("./tile-overlay-internal"),_=1-Math.pow(2,-52),f=Math.PI/3,y=Math.tan(f/2);n.prototype={constructor:n,get element(){return this._element},deactivate:function(){this.delegate=null},destroy:function(t){!t&&this.cameraAnimation&&this.cameraAnimation.cancel(),this._tileOverlays.forEach(function(t){t.removeEventListener(g.RELOAD_EVENT,this)},this),this._initialInteractionController&&(this._initialInteractionController.destroy(),this._initialInteractionController=null),this._panController&&(this._panController.destroy(),this._panController=null),this._zoomController&&(this._zoomController.destroy(),this._zoomController=null),this._rotationController&&(this._rotationController.destroy(),this._rotationController=null),delete this.node.delegate},minZoomLevel:3,maxZoomLevel:20,staysCenteredDuringZoom:!1,cameraAnimation:null,isRotationEnabled:!1,snapsToIntegralZoomLevels:!1,get configuration(){return this._configuration},set configuration(t){this._configuration!==t&&this.updateConfiguration(t)},get tint(){return this._tint},get emphasis(){return this._emphasis},setTintAndEmphasis:function(t,e,i){t===this._tint&&e===this._tileTint&&i===this._emphasis||(this._tint=t,this._tileTint=e,this._emphasis=i,this.updateTintAndEmphasis(t,i))},get language(){return this._language},set language(t){this._language!==t&&(this._language=t,this.refresh())},get pointOfInterestFilter(){return this._pointOfInterestFilter},set pointOfInterestFilter(t){this._pointOfInterestFilter!==t&&(this._pointOfInterestFilter=t,this.updatePointOfInterestFilter())},get size(){return this.camera.viewportSize.copy()},set size(t){this.adjustForSize(t.copy()),t.width>0&&t.height>0&&this._updateZoom(!1)},adjustForSize:function(t){if(this._visibleMapRect&&this._visibleMapRect.size.width>0&&this._visibleMapRect.size.height>0&&t.width>0&&t.height>0){var e=this._visibleMapRect;delete this._visibleMapRect,this.setCameraAnimated(this.camera.withNewMapRect(e,this.snapsToIntegralZoomLevels,t))}else{var i=null;Object.prototype.hasOwnProperty.call(this,"_pendingCameraDistance")&&(i=this._pendingCameraDistance);var n=this.camera;this.setCameraAnimated(new l(n.center,n.zoom,t,n.rotation)),null!==i&&this.setCameraDistanceAnimated(i,!1)}},get cameraIsPanning(){return!!this._panning},get pannable(){return!!this._panController},set pannable(t){!t&&this._panController?(this._panController.destroy(),delete this._panController):t&&!this._panController&&(this._initialInteractionController||(this._initialInteractionController=new c(this)),this._panController=new u(this))},get cameraIsZooming(){return!!this._zooming||!!this._suspendedZoom},get zoomable(){return!!this._zoomController},set zoomable(t){!t&&this._zoomController?(this._zoomController.destroy(),delete this._zoomController):t&&!this._zoomController&&(this._initialInteractionController||(this._initialInteractionController=new c(this)),this._zoomController=new d(this))},get cameraIsRotating(){return!!this._rotating},get visibleMapRect(){return this._visibleMapRect||this.camera.toMapRect()},set visibleMapRect(t){this.setVisibleMapRectAnimated(t)},setVisibleMapRectAnimated:function(t,e){if(this.camera.viewportSize.equals(o.Size.Zero))this._visibleMapRect=t.copy();else{var i=this.camera.withNewMapRect(t,this.snapsToIntegralZoomLevels);i.rotation=0,this.setCameraAnimated(i,!!e)}},setCenterAnimated:function(t,e){var i=t.toMapPoint();if(this._visibleMapRect)this._visibleMapRect=new s.MapRect(i.x-this._visibleMapRect.size.width/2,i.y-this._visibleMapRect.size.height/2,this._visibleMapRect.size.width,this._visibleMapRect.size.height);else{var n=this.camera.copy();n.center=i,this.setCameraAnimated(n,e)}},setCameraBoundaryAnimated:function(t,e){t?(this._cameraBeforeBoundaryChange=this.camera,this._cameraBoundaryRect=new s.MapRect(t.origin.x,t.origin.y,r.clamp(t.size.width,0,1),Math.max(t.size.height,0)),this.setCameraAnimated(this.camera.copy(),e),delete this._cameraBeforeBoundaryChange):delete this._cameraBoundaryRect},constrainCamera:function(t){this._cameraBoundaryRect&&(t.center=this._constrainCenterWithinBounds(t.center)),this._updateMinAndMaxZoomLevelsAtY(t.center.y),t.zoom=r.clamp(t.zoom,this.currentMinZoomLevel,this.currentMaxZoomLevel)},get transformCenter(){var t=this.node.delegate;return t&&"function"==typeof t.mapTransformCenter?t.mapTransformCenter(this.node):this.camera.center},get zoomLevel(){return this.camera.zoom},set zoomLevel(t){this.setZoomLevelAnimated(t)},setZoomLevelAnimated:function(t,e){if(delete this._cameraDistance,this._suspendedZoom)return this._suspendedZoom.animated=this._suspendedZoom.animated||this._suspendedZoom.level!==t,void(this._suspendedZoom.level=t);if(!this.cameraAnimation||e){var i=this.zoomLevel,n=r.clamp(t,this.currentMinZoomLevel,this.currentMaxZoomLevel);if(i!==n){var o=this.transformCenter,s=this.camera;o.equals(s.center)?this.setCameraAnimated(new l(s.center,n,s.viewportSize,s.rotation),e):this.scaleCameraAroundMapPoint(Math.pow(2,n-i),this.transformCenter,e)}}else this.cameraAnimation.additiveZoom=t},setCameraDistanceAnimated:function(t,e){if(0!==this.camera.viewportSize.width){var i=this._zoomLevelForCameraDistance(t);this.snapsToIntegralZoomLevels&&(i=Math.round(i)),this.setZoomLevelAnimated(i,e),this._cameraDistance=t}else this._pendingCameraDistance=t},getCurrentCameraDistance:function(){return this.visibleMapRect.size.width/2/s.mapUnitsPerMeterAtLatitude(this.camera.center.toCoordinate().latitude)/y},get cameraZoomRange(){return this._cameraZoomRange?this._cameraZoomRange.copy():new s.CameraZoomRange},setCameraZoomRangeAnimated:function(t,e){t?this._cameraZoomRange=t.copy():delete this._cameraZoomRange,this._updateZoom(e)},adjustMapItemPoint:function(t){if(this.cameraIsZooming||this._pendingCameraDrawingReadiness)return t;if(!this._pointAdjustmentReference){var e=this.camera.zoom,i=this.visibleMapRect.origin,n=new p(this.camera),r=n.zoom,l=n.mapRect.origin,h=Math.pow(2,e-r),c=s.pointsPerAxis(r)*h;this._pointAdjustmentReference=new o.Point((l.x-i.x)*c,(l.y-i.y)*c)}return t.x=a.roundToDevicePixel(this._pointAdjustmentReference.x)+a.roundToDevicePixel(t.x-this._pointAdjustmentReference.x),t.y=a.roundToDevicePixel(this._pointAdjustmentReference.y)+a.roundToDevicePixel(t.y-this._pointAdjustmentReference.y),t},scaleCameraAroundMapPoint:function(t,e,i){var n=s.pointsPerAxis(this.currentMinZoomLevel),o=this.camera.viewportSize.width/(this.visibleMapRect.size.width*n),a=this.camera.viewportSize.height/(this.visibleMapRect.size.height*n),r=Math.min(1/t,o,a),l=e.x+(e.x<1?1:-1),h=this.visibleMapRect;l>=h.origin.x&&l<=h.maxX()&&(e=new s.MapPoint(l,e.y));var c=this.camera.withNewMapRect(h.scale(r,e),!1);this.setCameraAnimated(c,i)},setCameraAnimated:function(t,e,i,n){if(0===t.viewportSize.width||0===t.viewportSize.height)return this._pendingCameraDrawingReadiness=!0,void(this.camera=t);delete this._pendingCameraDistance;var o=this.camera;t.viewportSize.equals(o.viewportSize)||(this._updateMinAndMaxZoomLevels(t.viewportSize),!e&&this.cameraAnimation&&this.cameraAnimation.updateViewportSize(t.viewportSize)),n||this.constrainCamera(t);var s=t.toMapRect().size,a=s.width/2,l=s.height/2;t.center.x=r.mod(t.center.x-a,1)+a,t.center.y=r.clamp(t.center.y,l,_-l),!this._pendingCameraDrawingReadiness&&t.equals(o)||(delete this._pendingCameraDrawingReadiness,this._cameraWillChange(!!e),e&&!this.cameraAnimation?(this._cameraChangesMayHaveStarted(),this.cameraAnimation=new h(this,this._cameraBeforeBoundaryChange||o,t,i),this._cameraBeforeBoundaryChange&&(this.cameraAnimation.unconstrained=!0),this.cameraAnimation.zooming&&this.cameraZoomWasSet(t)):(delete this._pointAdjustmentReference,this.camera=t,this.cameraZoomWasSet(),this._cameraDidChange()))},cameraWillStartZooming:function(t,e,i){var n=this.node.delegate,o=function(){return!!n&&"function"==typeof n.mapCanStartZooming&&!n.mapCanStartZooming(this.node)}.bind(this);return this.cameraAnimation?!(this._zoomController.active||this.cameraAnimation.zooming||o())&&(this._suspendedZoom={animated:!!e,offCenter:!!i,level:this.zoomLevel,completed:!1},!0):o()?(this._zoomController.interrupt(),!1):(this._cameraWillStartZooming(n,t,e,i),!0)},_cameraWillStartZooming:function(t,e,i,n){t&&"function"==typeof t.mapWillStartZooming&&t.mapWillStartZooming(this.node,e,i,n),this._cameraChangesMayHaveStarted(),this._zooming=!0,this.beforeCameraZoomChange(!0),this._cameraWillChange(!!i)},cameraDidStopZooming:function(){if(this.snapsToIntegralZoomLevels&&(this.camera.zoom=Math.round(this.camera.zoom)),this._suspendedZoom)this._suspendedZoom.complete=!0;else{delete this._zooming,this.beforeCameraZoomChange(!1),this._cameraDidChange(),this._cameraChangesMayHaveEnded();var t=this.node.delegate;t&&"function"==typeof t.mapDidStopZooming&&t.mapDidStopZooming(this.node)}},cameraWillStartRotating:function(){var t=this.node.delegate;!!t&&"function"==typeof t.mapCanStartRotating&&!t.mapCanStartRotating(this.node)||(this._cameraChangesMayHaveStarted(),this._rotating=!0,this._cameraWillChange())},cameraDidStopRotating:function(){if(this._rotating){delete this._rotating,this._cameraDidChange(),this._cameraChangesMayHaveEnded();var t=this.node.delegate;t&&"function"==typeof t.mapDidStopRotating&&t.mapDidStopRotating(this.node)}},migrateStateTo:function(t){t.configuration=this.node.configuration,t.tint=this.node.tint,t.language=this.node.language,t.pannable=this.node.pannable,t.allowWheelToZoom=this.node.allowWheelToZoom,t.pointOfInterestFilter=this.node._impl.pointOfInterestFilter,t.showsDefaultTiles=this.node.showsDefaultTiles,t.tileOverlays=this.node.tileOverlays,t.size=this.node.size,t.staysCenteredDuringZoom=this.node.staysCenteredDuringZoom;var e=this.node.visibleMapRect;e.size.width>0&&e.size.height>0&&(t.visibleMapRect=e),t.zoomable=this.node.zoomable,t.isRotationEnabled=this.isRotationEnabled,t.rotation=this.rotation,this._cameraZoomRange&&t.setCameraZoomRangeAnimated(this._cameraZoomRange,!1),this._cameraDistance>=0&&t.setCameraDistanceAnimated(this._cameraDistance,!1),this._cameraBoundaryRect&&t.setCameraBoundaryAnimated(this._cameraBoundaryRect,!1),t._impl.debug=this.debug,this.cameraAnimation&&(this.cameraAnimation.map=t._impl,t._impl.cameraAnimation=this.cameraAnimation,this.cameraChangesHaveStarted&&(t._impl.cameraChangesHaveStarted=!0))},createLabelRegion:r.noop,updatedLabelRegion:r.noop,unregisterLabelRegion:r.noop,get debug(){return this._debug},set debug(t){this._debug!==!!t&&(this._debug=!!t,this.refresh())},updateConfiguration:function(t){this._configuration=t,this._updateMinAndMaxZoomLevels(this.camera.viewportSize),this.setCameraAnimated(this.camera),this.refresh()},updatePointOfInterestFilter:function(){this.refresh()},refresh:function(){},beforeCameraZoomChange:function(){},cameraZoomWasSet:function(){},get showsDefaultTiles(){return this._showsDefaultTiles},set showsDefaultTiles(t){this._showsDefaultTiles!==t&&(this._showsDefaultTiles=t,this._tileOverlaysDidChange())},get tileOverlays(){return this._tileOverlays},set tileOverlays(t){if(0!==this._tileOverlays.length||0!==t.length){var e="[MapKit] Map.tileOverlays should be an array, got `"+t+"` instead.";r.checkArray(t,e),t.forEach(function(t){r.checkInstance(t,m,"[MapKit] Map.tileOverlays can only contain TileOverlays, but got `"+t+"` instead.")}),this._tileOverlays.forEach(function(t){t.removeEventListener(g.RELOAD_EVENT,this)},this),this._tileOverlays=t,this._tileOverlays.forEach(function(t){t.addEventListener(g.RELOAD_EVENT,this)},this),this._tileOverlaysDidChange()}},addTileOverlay:function(t){return r.checkInstance(t,m,"[MapKit] Map.addTileOverlay expected a TileOverlay, but got `"+t+"` instead."),this.addTileOverlays([t]),t},addTileOverlays:function(t){var e="[MapKit] Map.addTileOverlays expected an array, but got `"+t+"` instead.";return r.checkArray(t,e),t.forEach(function(t){if(r.checkInstance(t,m,"[MapKit] Map.addTileOverlays expected only TileOverlays, but got `"+t+"` instead."),"number"==typeof t.minimumZ&&t.minimumZ<this.currentMinZoomLevel){var e=Math.ceil(100*this.currentMinZoomLevel)/100;console.warn("[MapKit] This TileOverlay has its minimumZ set to "+t.minimumZ+", but this map can only zoom to a minimum value of "+e+". As a result, some zoom levels supported by the TileOverlay cannot be viewed on this map.")}},this),this.tileOverlays=this.tileOverlays.concat(t),t},removeTileOverlay:function(t){return r.checkInstance(t,m,"[MapKit] Map.removeTileOverlay expected a TileOverlay, but got `"+t+"` instead."),this.tileOverlays=this.tileOverlays.filter(function(e){return e!==t}),t},removeTileOverlays:function(t){var e="[MapKit] Map.removeTileOverlays expected an array, but got `"+t+"` instead.";return r.checkArray(t,e),t.forEach(function(t){r.checkInstance(t,m,"[MapKit] Map.removeTileOverlays expected only TileOverlays, but got `"+t+"` instead."),this.removeTileOverlay(t)},this),t},handleEvent:function(){},cameraWillStartPanning:function(){var t=this.node.delegate,e=function(){return!!t&&"function"==typeof t.mapCanStartPanning&&!t.mapCanStartPanning(this.node)}.bind(this);this.cameraAnimation||e()?this._panController.interrupt():(t&&"function"==typeof t.mapWillStartPanning&&t.mapWillStartPanning(this.node),this.refresh(),this._cameraChangesMayHaveStarted(),this._panning=!0,this._cameraWillChange())},cameraWillStopPanning:function(){var t=this.node.delegate;t&&"function"==typeof t.mapWillStopPanning&&t.mapWillStopPanning(this.node)},cameraDidStopPanning:function(){delete this._panning,this._cameraDidChange(),this._cameraChangesMayHaveEnded();var t=this.node.delegate;t&&"function"==typeof t.mapDidStopPanning&&t.mapDidStopPanning(this.node)},cameraAnimationDidProgress:function(t,e){this.setCameraAnimated(t,!1,null,e)},cameraAnimationDidEnd:function(){var t=this.cameraAnimation;this.cameraAnimation=null;var e=!1;if(t.zooming&&!t.zoomIsAdditive&&(this.cameraDidStopZooming(),e=!0),t.rotating&&(this.cameraDidStopRotating(),e=!0),e||this._cameraDidChange(),this._cameraChangesMayHaveEnded(),this._suspendedZoom){var i=this._suspendedZoom;delete this._suspendedZoom,this._cameraWillStartZooming(this.node.delegate,"",i.animated),i.complete&&(this.setZoomLevelAnimated(i.level,i.animated),i.animated||this.cameraDidStopZooming())}this._nextCameraZoomRange&&(this.setCameraZoomRangeAnimated(this._nextCameraZoomRange,!1),delete this._nextCameraZoomRange)},interactionDidStart:function(){this._panController&&this._panController.stopDecelerating(),this._zoomController&&this._zoomController.stopDecelerating(),this._rotationController&&this._rotationController.stopDecelerating()},beganRecognizingRotation:function(){this._zoomController&&(this._zoomController._singleTapWithTwoFingersRecognizer.enabled=!1)},finishedRecognizingRotation:function(){this._zoomController&&(this._zoomController._singleTapWithTwoFingersRecognizer.enabled=!0)},tileGridDidFinishRendering:function(){var t=this.node.delegate;t&&"function"==typeof t.mapDidFinishRendering&&t.mapDidFinishRendering(this.node)},updateMinAndMaxZoomLevelsWhenConfigurationChanges:function(){this.minZoomLevel=0,this.maxZoomLevel=Number.MAX_VALUE,this._configuration.tileSources.forEach(function(t){this.minZoomLevel=Math.max(this.minZoomLevel,t.minZoomLevel),this.maxZoomLevel=Math.min(this.maxZoomLevel,t.maxZoomLevel)},this),this.minAndMaxZoomLevelsWereUpdated(),this.currentMinZoomLevel=this.minZoomLevel,this.currentMaxZoomLevel=this.maxZoomLevel},minAndMaxZoomLevelsWereUpdated:function(){},_updateMinAndMaxZoomLevels:function(t){if(t.width<=0||t.height<=0)return!1;this._configuration&&this.updateMinAndMaxZoomLevelsWhenConfigurationChanges(),this.minZoomLevel=Math.max(this.minZoomLevel,this.minZoomLevelForViewportSize(t,s.tileSize)),this.snapsToIntegralZoomLevels&&(this.minZoomLevel=Math.ceil(this.minZoomLevel)),this.currentMinZoomLevel=Math.max(this.currentMinZoomLevel,this.minZoomLevel),this.adjustForSize(this.size)},_cameraChangesMayHaveStarted:function(t){if(!(this.cameraChangesHaveStarted||this._panning||this._zooming||this._rotating||this.cameraAnimation)){this.cameraChangesHaveStarted=!0;var e=this.node.delegate;e&&"function"==typeof e.mapCameraChangesWillStart&&e.mapCameraChangesWillStart(this.node,t)}},_cameraWillChange:function(t){this._cameraChangesMayHaveStarted(t),this._cameraWillChangeAnimated=!!t;var e=this.node.delegate;e&&"function"==typeof e.mapCameraWillChange&&e.mapCameraWillChange(this.node,!!t)},_cameraDidChange:function(){var t=this.node.delegate;t&&"function"==typeof t.mapCameraDidChange&&t.mapCameraDidChange(this.node,!!this._cameraWillChangeAnimated),delete this._cameraWillChangeAnimated,this._cameraChangesMayHaveEnded()},_cameraChangesMayHaveEnded:function(t){if(this.cameraChangesHaveStarted&&!this._panning&&!this._zooming&&!this._rotating&&!this.cameraAnimation){delete this.cameraChangesHaveStarted;var e=this.node.delegate;return e&&"function"==typeof e.mapCameraChangesDidEnd&&e.mapCameraChangesDidEnd(this.node),!0}},isMapPointWithinBounds:function(t){if(!this._cameraBoundaryRect)return!0;var e=this._constrainCenterWithinBounds(t);return t.x===e.x&&t.y===e.y},_constrainCenterWithinBounds:function(t){var e=this.camera.center,i=this.transformCenter,n=e.x-i.x,o=e.y-i.y,a=r.mod(this._cameraBoundaryRect.origin.x+n,1),l=a+this._cameraBoundaryRect.size.width,h=r.mod(t.x,1);if(h<a&&(h+=1),h>l){var c=h-a;c>.5&&(c=1-c);var d=h-l;d>.5&&(d=1-d),h=c<d?a:l}var u=r.clamp(t.y,this._cameraBoundaryRect.minY()+o,this._cameraBoundaryRect.maxY()+o);return h!==t.x||u!==t.y?new s.MapPoint(h,u):t},_updateMinAndMaxZoomLevelsAtY:function(t){var e=this.minZoomLevel,i=this.maxZoomLevel;if(this._cameraZoomRange){var n=s.convertYToLatitude(t);e=r.clamp(this._zoomLevelForCameraDistanceAtLatitude(this._cameraZoomRange.maxCameraDistance,n),e,i),i=r.clamp(this._zoomLevelForCameraDistanceAtLatitude(this._cameraZoomRange.minCameraDistance,n),e,i),this.snapsToIntegralZoomLevels&&(e=Math.ceil(e),i=Math.floor(i))}this.currentMinZoomLevel=e,this.currentMaxZoomLevel=i},_updateZoom:function(t){this._updateMinAndMaxZoomLevelsAtY(this.camera.center.y);var e=r.clamp(this.camera.zoom,this.currentMinZoomLevel,this.currentMaxZoomLevel);if(e!==this.camera.zoom)t&&(this._nextCameraZoomRange=this._cameraZoomRange,delete this._cameraZoomRange),this.setZoomLevelAnimated(e,t);else{var i=this.node.delegate;i&&"function"==typeof i.mapMinAndMaxZoomLevelsDidChange&&i.mapMinAndMaxZoomLevelsDidChange(this.node)}},_zoomLevelForCameraDistance:function(t){return this._zoomLevelForCameraDistanceAtLatitude(t,s.convertYToLatitude(this.camera.center.y))},_zoomLevelForCameraDistanceAtLatitude:function(t,e){var i=2*(y*t)*s.mapUnitsPerMeterAtLatitude(e);return r.log2(this.camera.viewportSize.width/i/s.tileSize)}},e.exports=n},{"../../geo":4,"../../scene-graph":51,"./camera":14,"./camera-animation":13,"./initial-interaction-controller":18,"./pan-controller":20,"./tile-data":30,"./tile-overlay":37,"./tile-overlay-internal":36,"./zoom-controller":40,"@maps/device-pixel-ratio":63,"@maps/js-utils":82}],12:[function(t,e,i){function n(){o.GroupNode.call(this)}var o=t("../../scene-graph"),s=t("@maps/js-utils"),a=t("../../../src/js/unsafe-dom");n.prototype=s.inheritPrototype(o.GroupNode,n,{delegate:null,deactivate:function(){this._impl.deactivate()},destroy:function(t){this._impl.destroy(t)},get element(){return this._impl.element},get camera(){return this._impl.camera},get minZoomLevel(){return this._impl.currentMinZoomLevel},get maxZoomLevel(){return this._impl.currentMaxZoomLevel},get staysCenteredDuringZoom(){return this._impl.staysCenteredDuringZoom},set staysCenteredDuringZoom(t){this._impl.staysCenteredDuringZoom=t},get configuration(){return this._impl.configuration},set configuration(t){this._impl.configuration=t},get tint(){return this._impl.tint},get emphasis(){return this._impl.emphasis},get language(){return this._impl.language},set language(t){this._impl.language=t},get allowWheelToZoom(){return this._impl.allowWheelToZoom},set allowWheelToZoom(t){this._impl.allowWheelToZoom=t},get pointOfInterestFilter(){return this._impl.pointOfInterestFilter},set pointOfInterestFilter(t){this._impl.pointOfInterestFilter=t},get backgroundGridTheme(){return this._impl.backgroundGridTheme},set backgroundGridTheme(t){this._impl.backgroundGridTheme=t},get size(){return this._impl.size},set size(t){this._impl.size=t},get rotation(){return this._impl.rotation},set rotation(t){this._impl.rotation=t},getRotation:function(){return this._impl.rotation},get isRotationEnabled(){return this._impl.isRotationEnabled},set isRotationEnabled(t){this._impl.isRotationEnabled=t},get cameraIsPanning(){return this._impl.cameraIsPanning},get pannable(){return this._impl.pannable},set pannable(t){this._impl.pannable=t},get cameraIsZooming(){return this._impl.cameraIsZooming},get zoomable(){return this._impl.zoomable},set zoomable(t){this._impl.zoomable=t},get cameraIsRotating(){return this._impl.cameraIsRotating},get cameraIsAnimating(){return!!this._impl.cameraAnimation},get zoomLevel(){return this._impl.zoomLevel},set zoomLevel(t){this._impl.setZoomLevelAnimated(t)},setZoomLevelAnimated:function(t,e){this._impl.setZoomLevelAnimated(t,e)},setCameraDistanceAnimated:function(t,e){this._impl.setCameraDistanceAnimated(t,e)},getCurrentCameraDistance:function(){return this._impl.getCurrentCameraDistance()},get cameraZoomRange(){return this._impl.cameraZoomRange},setCameraZoomRangeAnimated:function(t,e){this._impl.setCameraZoomRangeAnimated(t,e)},get visibleMapRect(){return this._impl.visibleMapRect},set visibleMapRect(t){this._impl.setVisibleMapRectAnimated(t)},setVisibleMapRectAnimated:function(t,e){this._impl.setVisibleMapRectAnimated(t,e)},setCenterAnimated:function(t,e){this._impl.setCenterAnimated(t,e)},setCameraBoundaryAnimated:function(t,e){this._impl.setCameraBoundaryAnimated(t,e)},isMapPointWithinBounds:function(t){return this._impl.isMapPointWithinBounds(t)},get showsDefaultTiles(){return this._impl.showsDefaultTiles},set showsDefaultTiles(t){this._impl.showsDefaultTiles=t},get tileOverlays(){return this._impl.tileOverlays},set tileOverlays(t){this._impl.tileOverlays=t},addTileOverlay:function(t){return this._impl.addTileOverlay(t)},addTileOverlays:function(t){return this._impl.addTileOverlays(t)},removeTileOverlay:function(t){return this._impl.removeTileOverlay(t)},removeTileOverlays:function(t){return this._impl.removeTileOverlays(t)},adjustMapItemPoint:function(t){return this._impl.adjustMapItemPoint(t)},cameraWillStartZooming:function(t,e,i){return this._impl.cameraWillStartZooming(t,e,i)},cameraDidStopZooming:function(){this._impl.cameraDidStopZooming()},get fullyRendered(){return this._impl.fullyRendered},devicePixelRatioDidChange:function(){return this._impl.devicePixelRatioDidChange()},stringInfo:function(){return this._impl.stringInfo()},get snapsToIntegralZoomLevels(){return this._impl.snapsToIntegralZoomLevels},set snapsToIntegralZoomLevels(t){this._impl.snapsToIntegralZoomLevels=t},migrateStateTo:function(t){return this._impl.migrateStateTo(t)},needsReplacing:function(t){return this._impl.needsReplacing(t)},createLabelRegion:function(){return this._impl.createLabelRegion()},updatedLabelRegion:function(){this._impl.updatedLabelRegion()},unregisterLabelRegion:function(t){this._impl.unregisterLabelRegion(t)},setCameraAnimated:function(t,e,i){this._impl.setCameraAnimated(t,e,i)},setTintAndEmphasis:function(t,e,i){this._impl.setTintAndEmphasis(t,e,i)}}),a.EventTarget(n.prototype),e.exports=n},{"../../../src/js/unsafe-dom":233,"../../scene-graph":51,"@maps/js-utils":82}],13:[function(t,e,i){function n(t,e,i,n){this.map=t,this._startCamera=e,this._endCamera=i,this._duration=r,this._rotationCenter=n,t.snapsToIntegralZoomLevels&&(i.zoom=Math.round(i.zoom)),this._updateAnimationRects(),this._startTime=Date.now(),this._schedule()}var o=t("./camera"),s=t("../../geo"),a=t("@maps/scheduler"),r=250;n.prototype={constructor:n,cancel:function(){this._canceled=!0},get zooming(){return this._startCamera.zoom!==this._endCamera.zoom},set additiveZoom(t){this._zoomIsAdditive=!0,this._endCamera.zoom=t,this._updateAnimationRects()},get zoomIsAdditive(){return this._zoomIsAdditive},get rotating(){return this._startCamera.rotation!==this._endCamera.rotation},adjustRotation:function(t,e){this._startCamera.rotateAroundCenter(t,e),this._endCamera.rotateAroundCenter(t,e),this._updateAnimationRects()},unconstrained:!1,updateViewportSize:function(t){this._startCamera=new o(this._startCamera.center,this._startCamera.zoom,t,this._startCamera.rotation),this._endCamera=new o(this._endCamera.center,this._endCamera.zoom,t,this._endCamera.rotation),this._updateAnimationRects()},performScheduledUpdate:function(){this._canceled||this._animationDidProgress(Math.min((Date.now()-this._startTime)/this._duration,1))},_zoomIsAdditive:!1,_updateAnimationRects:function(){if(this._rotationDelta=this._endCamera.rotation-this._startCamera.rotation,Math.abs(this._rotationDelta)>180&&(this._rotationDelta=this._endCamera.rotation+360-this._startCamera.rotation),!this._rotationCenter){this._startRect=this._startCamera.toMapRect(),this._animatedEndRect=this._endCamera.toMapRect();var t=this._startCamera.center.x-this._endCamera.center.x;Math.abs(t)>.5&&(t<0?this._startRect.origin.x+=1:this._animatedEndRect.origin.x+=1)}},_schedule:function(){a.scheduleOnNextFrame(this)},_animationDidProgress:function(t){if(1===t)return this.map.snapsToIntegralZoomLevels&&(this._endCamera.zoom=Math.round(this._endCamera.zoom)),this.map.cameraAnimationDidProgress(this._endCamera),void this.map.cameraAnimationDidEnd();this._rotationCenter?this._animateAroundCenter(t):this._animateRects(t),this._schedule()},_animateAroundCenter:function(t){var e=this._startCamera.copy();e.rotateAroundCenter(this._rotationCenter,t*this._rotationDelta),this.map.cameraAnimationDidProgress(e)},_animateRects:function(t){var e=this._startRect,i=this._animatedEndRect,n=e.origin.x,o=e.origin.y,a=e.size.width,r=e.size.height,l=i.origin.x-e.origin.x,h=i.origin.y-e.origin.y,c=i.size.width-e.size.width,d=i.size.height-e.size.height,u=this._endCamera.rotation-this._startCamera.rotation;Math.abs(u)>180&&(u=this._endCamera.rotation+360-this._startCamera.rotation);var p=new s.MapRect(n+l*t,o+h*t,a+c*t,r+d*t),m=this._startCamera.withNewMapRect(p);this.map.cameraAnimationDidProgress(m,this.unconstrained),this.map.rotation=this._startCamera.rotation+this._rotationDelta*t}},e.exports=n},{"../../geo":4,"./camera":14,"@maps/scheduler":100}],14:[function(t,e,i){function n(t,e,i,n){this.center=t||new o.MapPoint(.5,.5),this.zoom=e||3,this.viewportSize=i||new s,this.rotation=n||0}var o=t("../../geo"),s=t("@maps/geometry/size"),a=t("@maps/js-utils"),r=t("@maps/geometry/point"),l=t("@maps/css-matrix");n.prototype={constructor:n,get zoom(){return this._zoom},set zoom(t){this._zoom!==t&&(this._zoom=t||3,this._pointsPerAxis=o.pointsPerAxis(this._zoom))},get worldSize(){return this._pointsPerAxis},get rotation(){return this._rotation},set rotation(t){var e=a.mod(t,360);this._rotation=e},minX:function(){var t=this.viewportSize.width/this._pointsPerAxis;return this.center.x-t/2},minY:function(){var t=this.viewportSize.height/this._pointsPerAxis;return this.center.y-t/2},maxX:function(){var t=this.viewportSize.width/this._pointsPerAxis;return this.center.x+t/2},maxY:function(){var t=this.viewportSize.height/this._pointsPerAxis;return this.center.y+t/2},equals:function(t){return this.zoom===t.zoom&&this.center.equals(t.center)&&this.viewportSize.equals(t.viewportSize)&&this.rotation===t.rotation},copy:function(){return new n(this.center,this.zoom,this.viewportSize,this.rotation)},toString:function(){return"Camera("+["center: ["+this.center.x+", "+this.center.y+"]","zoom: "+this.zoom,"viewportSize: "+this.viewportSize.toString(),"rotation: "+this.rotation].join(", ")+")"},toMapRect:function(){var t=this.viewportSize.width/this._pointsPerAxis,e=this.viewportSize.height/this._pointsPerAxis,i=Object.create(o.MapPoint.prototype);i.x=this.center.x-t/2,i.y=this.center.y-e/2;var n=Object.create(o.MapSize.prototype);n.width=t,n.height=e;var s=Object.create(o.MapRect.prototype);return s.origin=i,s.size=n,s},toRenderingMapRect:function(){var t=[new r(this.minX(),this.minY()),new r(this.maxX(),this.minY()),new r(this.maxX(),this.maxY()),new r(this.minX(),this.maxY())];if(0!==this.rotation){var e=(new l).rotate(this.rotation);t=t.map(function(t){return e.transformPoint(t)})}for(var i=t[0].x,n=t[0].y,s=t[0].x,a=t[0].y,h=1;h<t.length;++h){var c=t[h];c.x<i&&(i=c.x),c.x>s&&(s=c.x),c.y<n&&(n=c.y),c.y>a&&(a=c.y)}var d=s-i,u=a-n;return new o.MapRect(this.center.x-d/2,this.center.y-u/2,d,u)},translate:function(t){0!==this.rotation&&(t=(new l).rotate(-this.rotation).transformPoint(t));var e=Math.round(t.x)/this._pointsPerAxis,i=Math.round(t.y)/this._pointsPerAxis,s=Object.create(o.MapPoint.prototype);s.x=a.mod(this.center.x-e,1),s.y=a.mod(this.center.y-i,1);var r=Object.create(n.prototype);return r.center=s,r._zoom=this._zoom,r._pointsPerAxis=this._pointsPerAxis,r.viewportSize=this.viewportSize,r._rotation=this._rotation,r},transformMapPoint:function(t){var e=this.viewportSize.width,i=this.viewportSize.height,n=this.toScreenSpace(t);return(new l).translate(e/2,i/2).rotate(this.rotation).translate(e/-2,i/-2).transformPoint(n)},transformGestureCenter:function(t){if(0===this.rotation)return t;var e=this.viewportSize.width,i=this.viewportSize.height;return(new l).translate(e/2,i/2).rotate(-this.rotation).translate(-e/2,-i/2).transformPoint(t)},toScreenSpace:function(t){var e=this._pointsPerAxis;return(new l).translate(-this.minX()*e,-this.minY()*e).scale(e).transformPoint(t)},rotateAroundCenter:function(t,e){var i=(new l).translate(t.x,t.y).rotate(-e).translate(-t.x,-t.y).transformPoint(new r(this.center.x,this.center.y));this.center=new o.MapPoint(i.x,i.y),this.rotation+=e},withNewMapRect:function(t,e,i){i=i||this.viewportSize;var s=o.zoomLevelForMapRectInViewport(t,i,o.tileSize);return new n(new o.MapPoint(t.midX(),t.midY()),e?Math.floor(s):s,i,this.rotation)}},e.exports=n},{"../../geo":4,"@maps/css-matrix":61,"@maps/geometry/point":71,"@maps/geometry/size":73,"@maps/js-utils":82}],15:[function(t,e,i){e.exports={Tints:{Dark:"dark",Light:"light"},WheelEventTimeout:100,WheelZoomFactor:.0075}},{}],16:[function(t,e,i){function n(t){o.BaseNode.call(this),this._tile=t,this._renderer=new a(this)}var o=t("../../scene-graph"),s=t("@maps/js-utils"),a=t("./render-debug");n.prototype=s.inheritPrototype(o.BaseNode,n,{get tile(){return this._tile},stringInfo:function(){return"DebugNode<x:"+this.tile.x+",y:"+this.tile.y+",z:"+this.tile.z+">"}}),e.exports=n},{"../../scene-graph":51,"./render-debug":22,"@maps/js-utils":82}],17:[function(t,e,i){function n(t){this._map=t,this._recognizers=[]}var o=t("../../../src/js/utils");n.prototype={constructor:n,get map(){return this._map},canTrustGestureCenter:function(t){return 1===t.numberOfTouchesRequired||!(o.supportsGestureEvents&&!o.supportsTouches&&o.insideIframe)},addRecognizer:function(t){return this._recognizers.push(t),t.target=this.map.node.element,t.addEventListener("statechange",this),t},interrupt:function(){this._recognizers.forEach(function(t){t.enabled=!1,t.enabled=!0})},centerForGesture:function(t){var e=this.map;return e.staysCenteredDuringZoom||!this.canTrustGestureCenter(t)?e.transformCenter:this._centerWithRecognizer(t)},destroy:function(){for(;this._recognizers.length;){var t=this._recognizers.pop();t.enabled=!1,t.target=null,t.removeEventListener("statechange",this)}}},e.exports=n},{"../../../src/js/utils":237}],18:[function(t,e,i){function n(t,e){this._map=t,o.SupportsPointerEvents?(this._startEventType="pointerdown",this._touchCount=0):o.SupportsTouches?this._startEventType="touchstart":this._startEventType="mousedown",this._map.element.addEventListener(this._startEventType,this),o.SupportsPointerEvents&&(window.addEventListener("pointerup",this),window.addEventListener("pointercancel",this))}var o=t("@maps/gesture-recognizers");n.prototype={constructor:n,handleEvent:function(t){"pointerup"!==t.type&&"pointercancel"!==t.type?("pointerdown"===t.type&&this._touchCount++,("mousedown"===t.type||"touchstart"===t.type&&t.touches.length===t.changedTouches.length||"pointerdown"===t.type&&1===this._touchCount)&&this._map.interactionDidStart()):this._touchCount--},destroy:function(){this._map.element.removeEventListener(this._startEventType,this),window.removeEventListener("pointerup",this),window.removeEventListener("pointercancel",this)}},e.exports=n},{"@maps/gesture-recognizers":74}],19:[function(t,e,i){function n(t){this.map=t,this._previousZoomLevelDelta=[]}var o=t("../../../src/js/constants"),s=t("@maps/scheduler"),a=t("@maps/js-utils"),r=t("./constants"),l=a.log2(1.03)/(1e3/60),h=a.log2(.97)/(1e3/60),c=a.log2(1.06)/(1e3/60),d=a.log2(.94)/(1e3/60),u=a.log2(1+r.WheelZoomFactor),p=a.log2(1-r.WheelZoomFactor);n.prototype={constructor:n,_animating:!1,zoomToScale:function(t,e){var i=Date.now();this._lastUpdateTime=i;var n=a.log2(t);this.zoomsIn=n>0,this._lastScaleCenter=e,this._previousZoomLevelDelta.push({delta:n,timestamp:i}),this._animating?this._accumulatedDesiredZoomLevelDelta+=n:(this._cleanupPreviousZoomLevelDelta(),p<=n&&n<=u&&this._previousZoomLevelDelta.length<=1||(this._animating=!0,this._accumulatedZoomLevelDelta=0,this._accumulatedDesiredZoomLevelDelta=n,this._timeAtLastFrame=i,this._animationEndingTimeoutId?(clearTimeout(this._animationEndingTimeoutId),this._animationEndingTimeoutId=void 0):this.map.cameraWillStartZooming(o.ZoomTypes.Scroll),s.scheduleOnNextFrame(this)))},destroy:function(){this.map=null,this._animationEndingTimeoutId&&clearTimeout(this._animationEndingTimeoutId)},performScheduledUpdate:function(){if(this.map){var t=Date.now(),e=this.zoomsIn?Math.ceil(this._accumulatedDesiredZoomLevelDelta):Math.floor(this._accumulatedDesiredZoomLevelDelta),i=t-this._timeAtLastFrame,n=this._getEstimatedSpeedPerMS()*i;if(this._accumulatedZoomLevelDelta+=n,this._timeAtLastFrame=t,!(this.zoomsIn&&this._accumulatedZoomLevelDelta<e||!this.zoomsIn&&this._accumulatedZoomLevelDelta>e)){var o=this.map.zoomLevel,a=Math.round(this.map.zoomLevel);return this.map.scaleCameraAroundMapPoint(Math.pow(2,a-o),this._lastScaleCenter),this._animating=!1,this._previousEstimatedSpeedPerMS=void 0,void(this._animationEndingTimeoutId=setTimeout(function(){this._animationEndingTimeoutId=void 0,this.map.cameraDidStopZooming()}.bind(this),r.WheelEventTimeout))}this.map.scaleCameraAroundMapPoint(Math.pow(2,n),this._lastScaleCenter),s.scheduleOnNextFrame(this)}},_cleanupPreviousZoomLevelDelta:function(){for(var t=Date.now()-100,e=this.zoomsIn?1:-1,i=0;i<this._previousZoomLevelDelta.length;i++)(this._previousZoomLevelDelta[i].timestamp<t||this._previousZoomLevelDelta[i].delta*e<0)&&this._previousZoomLevelDelta.splice(i,1)},_getEstimatedSpeedPerMS:function(){if(this._cleanupPreviousZoomLevelDelta(),this._previousZoomLevelDelta.length<=1)return this._previousEstimatedSpeedPerMS?this._previousEstimatedSpeedPerMS:this.zoomsIn?c:d;var t=this._previousZoomLevelDelta.reduce(function(t,e){return t+e.delta},0)/100;return h<t&&t<l&&(t=this.zoomsIn?l:h),this._previousEstimatedSpeedPerMS=t,t}},e.exports=n},{"../../../src/js/constants":166,"./constants":15,"@maps/js-utils":82,"@maps/scheduler":100}],20:[function(t,e,i){function n(t){r.call(this,t),this.addRecognizer(new o.Pan).maximumNumberOfTouches=2}var o=t("@maps/gesture-recognizers"),s=t("@maps/geometry/point"),a=t("@maps/scheduler"),r=t("./gesture-controller"),l=t("@maps/js-utils");n.prototype=l.inheritPrototype(r,n,{decelerating:!1,stopDecelerating:function(){this.decelerating&&this._decelerationEnded()},destroy:function(){r.prototype.destroy.call(this),this.stopDecelerating()},handleEvent:function(t){var e=t.target,i=this.map;i.staysCenteredDuringZoom&&i.cameraIsZooming||(e.state===o.States.Began?i.cameraWillStartPanning():e.state!==o.States.Ended&&e.state!==o.States.Changed||(this._panMapCameraBy(e.translation),e.translation=new s),e.state===o.States.Ended&&(this._startDeceleratingWithVelocity(e.velocity),this.decelerating||i.cameraDidStopPanning()))},performScheduledUpdate:function(){if(this.decelerating){var t=Date.now(),e=t-this._timeAtPreviousFrame,i=Math.exp(Math.log(.995)*e),n=(1-i)/(1-.995)*.995;this._panMapCameraBy(new s(this._velocity.x/1e3*n,this._velocity.y/1e3*n)),this._velocity.x*=i,this._velocity.y*=i,Math.abs(this._velocity.x)<=10&&Math.abs(this._velocity.y)<=10?this._decelerationEnded():(this._timeAtPreviousFrame=t,this._schedule())}},_panMapCameraBy:function(t){var e=this.map;e.setCameraAnimated(e.camera.translate(t))},_startDeceleratingWithVelocity:function(t){this._velocity=t,this.map.cameraWillStopPanning(),Math.pow(t.x,2)+Math.pow(t.y,2)<62500||(this.decelerating=!0,this._timeAtPreviousFrame=Date.now(),this._schedule())},_schedule:function(){a.scheduleOnNextFrame(this)},_decelerationEnded:function(){this.decelerating=!1,this.map.cameraDidStopPanning()}}),e.exports=n},{"./gesture-controller":17,"@maps/geometry/point":71,"@maps/gesture-recognizers":74,"@maps/js-utils":82,"@maps/scheduler":100}],21:[function(t,e,i){function n(t){l.RenderItem.call(this,t)}function o(t,e,i,n,o,s){i=c.mod(i,e),n=c.mod(n,e),o=Math.ceil(o),s=Math.ceil(s);for(var a=Math.ceil(o/e),r=Math.ceil(s/e),l=0;l<a;++l)t.fillRect(i+l*e,0,1,s);for(l=0;l<r;++l)t.fillRect(0,n+l*e,o,1)}function s(t){return"rgb("+t.join(",")+")"}function a(t,e,i){return 0===i?t:1===i?e:[r(t[0],e[0],i),r(t[1],e[1],i),r(t[2],e[2],i)]}function r(t,e,i){return Math.round(e*i+t*(1-i))}var l=t("../../scene-graph"),h=t("../../geo"),c=t("@maps/js-utils"),d=Math.log(10)/Math.log(2);n.prototype=c.inheritPrototype(l.RenderItem,n,{draw:function(t,e){var i=this.node,n=i.zoom,r=100*Math.pow(2,n%d),u=r/10,p=Math.min(u,100),m=u<10?0:(p-10)/90,g=i.origin,_=h.pointsPerAxis(n),f=new l.Point(-g.x*_,-g.y*_),y=c.mod(f.x,r)-r,v=c.mod(f.y,r)-r,w=this.node.theme;t.fillStyle=s(w.fillColor),t.fillRect(0,0,i.size.width,i.size.height);var b=1-Math.pow(1-m,2);b>0&&(t.fillStyle=s(a(w.fillColor,w.lineColor,b)),o(t,u,y,v,i.size.width,i.size.height)),t.fillStyle=s(w.lineColor),o(t,r,y,v,i.size.width,i.size.height)}}),e.exports=n},{"../../geo":4,"../../scene-graph":51,"@maps/js-utils":82}],22:[function(t,e,i){function n(t){o.RenderItem.call(this,t)}var o=t("../../scene-graph"),s=t("@maps/js-utils"),a={background:"rgba(0, 0, 0, 0.5)",text:"white"},r={background:"rgba(255, 255, 255, 0.75)",text:"black"};n.prototype=s.inheritPrototype(o.RenderItem,n,{draw:function(t){var e=this._node.size.width,i="standard"===this._node.tile.settings.configuration.name;t.fillStyle=i?a.background:r.background,t.fillRect(0,0,e,1),t.fillRect(0,1,1,e-1);var n=["x","y","z"].map(function(t){return t+" = "+this._node.tile[t]},this);t.font="12px -apple-system-font",t.beginPath(),t.moveTo(1,1);var o=1,s=1;n.forEach(function(e,i){var n=t.measureText(e).width;o=1+n+16,t.lineTo(o,s),s+=20,0===i&&(s+=8),t.lineTo(o,s)}),t.lineTo(1,s),t.closePath(),t.fill(),t.fillStyle=i?a.text:r.text,t.textBaseline="hanging",n.forEach(function(i,n){t.fillText(i,9,9+20*n,e)})}}),e.exports=n},{"../../scene-graph":51,"@maps/js-utils":82}],23:[function(t,e,i){function n(t){this.node=t,this._state=a.Uninitialized,this._unregisteredLabelRegions=[]}function o(t){return t*r*-1}var s=t("@maps/device-pixel-ratio"),a={Uninitialized:0,Initializing:1,Ready:2,Inactive:3,DestroyPending:4,Destroyed:5};n.prototype={constructor:n,init:function(t,e,i,n,o,s){this._state=a.Initializing,this.Camera=i,this._initialDisplayOptions=o,this.initRenderer(e,t,n).then(this.syrupInitHandler.bind(this,s)).catch(this.syrupInitErrorHandler.bind(this,s))},initRenderer:function(t,e,i){var n=this._syrupRenderer=new t({startInLoCSR:i});return n.on("invalid-access-key",function(){e.accessKeyHasExpired()},"mapkit-re-bootstrap-notification"),n.on("fallback",function(){e.syrupRequestedFallback()},"mapkit-csr-fallback-notification"),n.on("zoom-support-did-change",function(){this.node.didReconfigure()}.bind(this),"mapkit-zoom-support-notification"),n.init(e)},syrupInitErrorHandler:function(t){if(this._state===a.DestroyPending)return this._state=a.Uninitialized,void this.destroy();this._state=a.Uninitialized,t(!0)},syrupInitHandler:function(t){if(this._state===a.DestroyPending)return this._state=a.Inactive,void this.destroy();this._state=a.Ready;var e=this._syrupRenderer;e.setDeterministicCollisions(!0),e.setLanguage(this.node.language),e.setDeterministicCollisions(!1),e.setPixelRatio(s()),this._canvas=e.element(),this.updateConfiguration(this.node.configuration,this._initialDisplayOptions),this._initialDisplayOptions=null,this.performScheduledDraw(),this._unregisteredLabelRegions.forEach(function(t){e.registerLabelRegion(t)}),delete this._unregisteredLabelRegions,t()},deactivate:function(){this._state!==a.Initializing?this._state!==a.DestroyPending&&(this._state=a.Inactive):this._state=a.DestroyPending},destroy:function(){this._state!==a.Initializing?this._state!==a.DestroyPending&&this._state!==a.Destroyed&&(this._state=a.Destroyed,this._syrupRenderer&&(this._syrupRenderer.off("invalid-access-key",null,"mapkit-re-bootstrap-notification"),this._syrupRenderer.off("fallback",null,"mapkit-csr-fallback-notification"),this._syrupRenderer.off("zoom-support-did-change",null,"mapkit-zoom-support-notification"),"function"==typeof this._syrupRenderer.destroy&&this._syrupRenderer.destroy(),this._syrupRenderer=null)):this._state=a.DestroyPending},get snapsToIntegralZoomLevels(){return!!this._syrupRenderer&&!this._syrupRenderer.supportsNonIntegralZoomLevels()},performScheduledDraw:function(){if(this._state===a.Ready){var t=[this.node.size.width,this.node.size.height],e=new this.Camera(t[0]/t[1]),i=this.node.zoomLevel,n=[this.node.camera.center.x,1-this.node.camera.center.y,0];e.setTarget(n),e.setZoomLevel(i),e.setRotation(o(this.node.camera.rotation)),this._syrupRenderer.update(e,t),this._state!==a.Destroyed&&(this._syrupRenderer.mapFullyRendered()?this.node._impl.tileGridDidFinishRendering():this.node.needsDisplay=!0)}},forceRerender:function(){this._state===a.Ready&&this._syrupRenderer.forceRerender()},devicePixelRatioDidChange:function(){this._syrupRenderer&&this._syrupRenderer.setPixelRatio(s())},frozen:!1,get element(){return this.canvas},get canvas(){return this._canvas},get fullyRendered(){return this._syrupRenderer&&this._syrupRenderer.mapFullyRendered()},set language(t){this._syrupRenderer&&this._syrupRenderer.setLanguage(t)},updateNetworkConfiguration:function(t){this._syrupRenderer&&this._syrupRenderer.updateNetworkConfiguration(t)},updateConfiguration:function(t,e){this._syrupRenderer&&(e.mode=t.name,this._syrupRenderer.setDisplayOptions(e))},updatePointOfInterestFilter:function(t,e){this.updateConfiguration(t,{poiFilter:e})},createLabelRegion:function(){if(this._syrupRenderer){var t=this._syrupRenderer.createLabelRegion();return this._unregisteredLabelRegions?this._unregisteredLabelRegions.push(t):this._syrupRenderer.registerLabelRegion(t),t}},unregisterLabelRegion:function(t){this._unregisteredLabelRegions?this._unregisteredLabelRegions.splice(this._unregisteredLabelRegions.indexOf(t),1):this._syrupRenderer&&this._syrupRenderer.unregisterLabelRegion(t)}};var r=Math.PI/180;e.exports=n},{"@maps/device-pixel-ratio":63}],24:[function(t,e,i){function n(t){l.call(this,t),this._recognizer=this.addRecognizer(new s.Rotation)}var o=t("../../geo"),s=t("@maps/gesture-recognizers"),a=t("@maps/scheduler"),r=t("@maps/js-utils"),l=t("./gesture-controller"),h=180/Math.PI,c=3*h,d=1e-4*h*1e3;n.prototype=r.inheritPrototype(l,n,{decelerating:!1,stopDecelerating:function(){this.decelerating&&this._decelerationEnded()},destroy:function(){l.prototype.destroy.call(this),this.stopDecelerating(),delete this._recognizer},handleEvent:function(t){var e=t.target;e===this._recognizer&&(e.state===s.States.Began&&(this.map.beganRecognizingRotation(),this.map.cameraWillStartRotating()),e.state===s.States.Ended&&(this.map.finishedRecognizingRotation(),this._startDeceleratingWithVelocity(e.velocity)),this._handleRotationChange(t.target))},_handleRotationChange:function(t){this._lastRotationCenter=this.centerForGesture(t),this.map.cameraIsRotating&&t.state===s.States.Changed&&(this.map.rotateCameraAroundMapPoint(this._lastRotationCenter,t.rotation),t.rotation=0)},_centerWithRecognizer:function(t){var e=this.map,i=t.locationInElement(),n=this.map.node.convertPointFromPage(i);n=e.camera.transformGestureCenter(n);var s=e.visibleMapRect,a=e.camera.viewportSize;return new o.MapPoint(s.minX()+n.x/a.width*s.size.width,s.minY()+n.y/a.height*s.size.height)},performScheduledUpdate:function(){if(this.decelerating){var t=Date.now(),e=t-this._timeAtPreviousFrame,i=this._velocity/1e3,n=Math.pow(.995,e),o=.995*i*(n-1)/(.995-1);i*=n,this.map.cameraAnimation?this.map.cameraAnimation.adjustRotation(this._lastRotationCenter,o):this.map.rotateCameraAroundMapPoint(this._lastRotationCenter,o),this._velocity*=n,Math.abs(this._velocity)<=d?this._decelerationEnded():(this._timeAtPreviousFrame=t,this._schedule())}},_startDeceleratingWithVelocity:function(t){if(Math.abs(t)>1440||isNaN(t))this.map.cameraDidStopRotating();else{if(Math.abs(t)<c)return this.decelerating=!1,void this.map.cameraDidStopRotating();this._velocity=t,this.decelerating=!0,this._timeAtPreviousFrame=Date.now(),this._schedule()}},_schedule:function(){a.scheduleOnNextFrame(this)},_decelerationEnded:function(){this.decelerating=!1,this.map.cameraDidStopRotating()}}),e.exports=n},{"../../geo":4,"./gesture-controller":17,"@maps/gesture-recognizers":74,"@maps/js-utils":82,"@maps/scheduler":100}],25:[function(t,e,i){function n(t){o.call(this,t),this._backgroundGrid=this.node.addChild(new s),this._tileGridsGroup=this.node.addChild(new a(this)),this.rotation=0,this._tileGridsGroup.opacity=0,setTimeout(function(){this._tileGridsGroup.opacity=1}.bind(this),0)}var o=t("./base-map-node-internal"),s=t("./background-grid-node"),a=t("./tile-grids-group-node"),r=t("@maps/js-utils");n.prototype=r.inheritPrototype(o,n,{stringInfo:function(){return"MapNode<camera:"+this.camera.toString()+">"},get tileSettings(){return{configuration:this._configuration,tint:this._tileTint,emphasis:this._emphasis,language:this._language,showsPOI:this._showsPOI(),showsDefaultTiles:this._showsDefaultTiles,showsTileInfo:this._debug,tileOverlays:this._tileOverlays}},get fullyRendered(){return this._tileGridsGroup.fullyRendered},get cssBackgroundProperty(){return this._tileGridsGroup.cssBackgroundProperty},destroy:function(t){o.prototype.destroy.call(this,t),this._tileGridsGroup.destroy()},updateTintAndEmphasis:function(t,e){this._backgroundGrid.updateThemeFromTint(t),this.refresh()},refresh:function(){this._tileGridsGroup.scheduleRefresh()},cameraZoomWasSet:function(t){t?this._tileGridsGroup.cameraWillStartZooming(t):this._tileGridsGroup.invalidate()},tileGridDidFinishRendering:function(){this._tileOverlays.forEach(function(t){t._impl.reloadComplete()},this),o.prototype.tileGridDidFinishRendering.call(this)},handleEvent:function(){this._tileGridsGroup.scheduleRefresh()},beforeCameraZoomChange:function(t){t?this._tileGridsGroup.cameraWillStartZooming():this._tileGridsGroup.cameraDidStopZooming()},devicePixelRatioDidChange:function(){return this._tileGridsGroup.scheduleRefresh(),!0},minZoomLevelForViewportSize:function(t,e){var i=Math.max(t.width,t.height),n=Math.ceil(i/e)+1;return r.log2(n)},minAndMaxZoomLevelsWereUpdated:function(){this.tileOverlays.forEach(function(t){"number"!=typeof t.minimumZ||isNaN(t.minimumZ)||(this.minZoomLevel=Math.min(this.minZoomLevel,t.minimumZ)),"number"!=typeof t.maximumZ||isNaN(t.maximumZ)||(this.maxZoomLevel=Math.max(this.maxZoomLevel,t.maximumZ))},this)},_tileOverlaysDidChange:function(){this._updateMinAndMaxZoomLevels(this.camera.viewportSize),this._tileGridsGroup.scheduleRefresh()},_showsPOI:function(){return null==this._pointOfInterestFilter||null==this._pointOfInterestFilter._includes&&0===this._pointOfInterestFilter._excludes.length},needsReplacing:function(t){return t}}),e.exports=n},{"./background-grid-node":10,"./base-map-node-internal":11,"./tile-grids-group-node":32,"@maps/js-utils":82}],26:[function(t,e,i){function n(){o.call(this),Object.defineProperty(this,"_impl",{value:new s(this)})}var o=t("./base-map-node"),s=t("./scene-graph-map-node-internal"),a=t("@maps/js-utils"),r=t("../../../src/js/point-of-interest-filter");n.prototype=a.inheritPrototype(o,n,{get cssBackgroundProperty(){return this._impl.cssBackgroundProperty},get pointOfInterestFilter(){return null===this._impl._pointOfInterestFilter?null:null===this._impl._pointOfInterestFilter._includes&&0===this._impl._pointOfInterestFilter._excludes.length?this._impl._pointOfInterestFilter:r.filterExcludingAllCategories},set pointOfInterestFilter(t){this._impl.pointOfInterestFilter=t},get rotation(){return 0},set rotation(t){this._impl.rotation=t},rotateCameraAroundMapPoint:function(t,e){this._impl.rotation+=e}}),e.exports=n},{"../../../src/js/point-of-interest-filter":218,"./base-map-node":12,"./scene-graph-map-node-internal":25,"@maps/js-utils":82}],27:[function(t,e,i){function n(t,e){this._element=o(document.createElement("div"),l);var i=o(this._element.appendChild(document.createElement("ul")),h);this._items=[function(t){var e=t.center.toCoordinate();return"Center: "+e.latitude.toFixed(6)+", "+e.longitude.toFixed(6)},function(t){return"Zoom: "+t.zoom.toFixed(6)+", rotation: "+t.rotation.toFixed(6)},function(t){var e=Math.floor(t.zoom),i=Math.pow(2,e);return"Center tile: x="+Math.floor(r.mod(t.center.x,1)*i)+", y="+Math.floor(t.center.y*i)+", z="+e},function(t){return"Viewport: "+t.viewportSize.width+"Ã"+t.viewportSize.height}].map(function(t){var e=i.appendChild(document.createElement("li"));return function(i){e.textContent=t(i)}});var n=s.svgElement("svg",{viewBox:"-16 -16 32 32"},s.svgElement("circle",{r:16,fill:"#ccc"}),s.svgElement("g",{"stroke-width":4,stroke:"#222"},s.svgElement("line",{x1:-8,y1:-8,x2:8,y2:8}),s.svgElement("line",{x1:8,y1:-8,x2:-8,y2:8})));this._element.appendChild(o(n,c)),n.addEventListener("click",t),this.update(e),this.update=a(this.update,d,this)}function o(t,e){for(var i in e)t.style[i]=e[i];return t}var s=t("../../../src/js/utils"),a=t("../../debounce"),r=t("@maps/js-utils"),l={fontFamily:"-apple-system-font, sans-serif",margin:"2em auto",width:"20em",borderRadius:"0.5em",color:"#f8f9f0",backgroundColor:"rgba(0, 0, 0, 0.7)",padding:"1em",textAlign:"center",position:"relative"},h={listStyleType:"none",margin:0,paddingLeft:0},c={width:"1em",height:"1em",position:"absolute",top:"0.5em",left:"0.5em"},d=50;n.prototype={constructor:n,attachTo:function(t){t.appendChild(this._element)},detach:function(){this._element.remove()},update:function(t){this._items.forEach(function(e){e(t)})}},e.exports=n},{"../../../src/js/utils":237,"../../debounce":3,"@maps/js-utils":82}],28:[function(t,e,i){function n(t){o.call(this,t),this._renderer=t._renderer,this._requiresFallback=!1,this._fallback=function(){this._requiresFallback=!0}.bind(this)}var o=t("./base-map-node-internal"),s=t("./syrup-debug-panel"),a=t("@maps/js-utils"),r=t("@maps/device-pixel-ratio"),l=t("./rotation-controller"),h=t("./initial-interaction-controller");n.prototype=a.inheritPrototype(o,n,{init:function(t,e,i,n,o){if(this._requiresFallback)t.syrupRequestedFallback();else{this._fallback=t.syrupRequestedFallback.bind(t);var s={poiFilter:this._convertPointOfInterestFilter(this.pointOfInterestFilter),tint:this.tint,emphasis:this.emphasis};this._renderer.init(this.networkConfigurationFor(t),e,i,n,s,function(t){this._updateMinAndMaxZoomLevels(this.camera.viewportSize),o(t,this._renderer)}.bind(this))}},get isRotationEnabled(){return this._isRotationEnabled},set isRotationEnabled(t){!t&&this._rotationController?(this._rotationController.destroy(),delete this._rotationController):t&&!this._rotationController&&(this._initialInteractionController||(this._initialInteractionController=new h(this)),this._rotationController=new l(this),this.camera._initialRotation=0),this._isRotationEnabled=t},get rotation(){return this.camera.rotation},set rotation(t){if(this._cameraWillChange(),this.camera.rotation=t,this._updateDisplay(),this._cameraDidChange(),!this.cameraAnimation||!this.cameraAnimation.rotating){var e=this.node.delegate;e&&"function"==typeof e.mapRotationDidChange&&e.mapRotationDidChange(this.node)}},updateNetworkConfiguration:function(t){this._renderer.updateNetworkConfiguration(this.networkConfigurationFor(t))},forceRerender:function(){this._renderer.forceRerender()},adjustForSize:function(t){o.prototype.adjustForSize.call(this,t),this.forceRerender()},adjustMapItemPoint:function(t){return this.cameraIsZooming||this.cameraIsPanning||this.cameraIsRotating?t:(t.x=r.roundToDevicePixel(t.x),t.y=r.roundToDevicePixel(t.y),t)},networkConfigurationFor:function(t){if(!t)return{};var e=t.proxyPrefixes?t.proxyPrefixes.slice(0):null;return{madabaDomains:t.madabaDomains.slice(0),rasterTiles:t.rasterTilesForSyrup,proxyPrefixes:e,tileGroup:t.tileGroup,accessKey:t.accessKey,accessKeyHasExpired:t.accessKeyHasExpired.bind(t),syrupRequestedFallback:t.syrupRequestedFallback.bind(t)}},rotateCameraAroundMapPoint:function(t,e){this._cameraWillChange(),this.camera.rotateAroundCenter(t,e),this.constrainCamera(this.camera),this._updateDisplay(),this._cameraDidChange();var i=this.node.delegate;i&&"function"==typeof i.mapRotationDidChange&&i.mapRotationDidChange(this.node)},deactivate:function(){o.prototype.deactivate.call(this),this._renderer.deactivate()},destroy:function(t){o.prototype.destroy.call(this,t),this.customCanvas&&this.customCanvas.parentNode&&this.customCanvas.parentNode.removeChild(this.customCanvas),this._renderer&&(this._renderer.destroy(),this._renderer=null)},stringInfo:function(){return"SyrupNode<camera:"+this.camera.toString()+">"},get backgroundGridTheme(){return this._backgroundGridTheme},set backgroundGridTheme(t){this._backgroundGridTheme=t},get fullyRendered(){return this._renderer.fullyRendered},get customCanvas(){return this._renderer&&this._renderer.canvas},get camera(){return this._camera},set camera(t){this._camera=t,this.node.needsDisplay=!0},get language(){return this._language},set language(t){this._language!==t&&(this._language=t,this._renderer&&(this._renderer.language=t,this.node.needsDisplay=!0))},updateConfiguration:function(t){var e=this._configuration&&(t.name!==this._configuration.name||t.provider!==this._configuration.provider);o.prototype.updateConfiguration.call(this,t),e&&this._renderer&&(this._renderer.updateConfiguration(t,{poiFilter:this._convertPointOfInterestFilter(this._pointOfInterestFilter)}),this.node.needsDisplay=!0)},updateTintAndEmphasis:function(t,e){this._renderer.node.pendingConfigurationUpdates?(this._renderer.node.pendingConfigurationUpdates.tint=t,this._renderer.node.pendingConfigurationUpdates.emphasis=e):this._renderer&&this._configuration&&(this._renderer.updateConfiguration(this._configuration,{poiFilter:this._convertPointOfInterestFilter(this._pointOfInterestFilter),tint:t,emphasis:e}),this.node.needsDisplay=!0)},updatePointOfInterestFilter:function(){if(this._renderer.node.pendingConfigurationUpdates)this._renderer.node.pendingConfigurationUpdates.poiFilterUpdate=!0;else if(this._renderer&&this._configuration){var t=this._convertPointOfInterestFilter(this._pointOfInterestFilter);this._renderer.updatePointOfInterestFilter(this._configuration,t),this.node.needsDisplay=!0}},makePendingConfigurationUpdates:function(){var t=this._renderer.node.pendingConfigurationUpdates;t&&(delete this._renderer.node.pendingConfigurationUpdates,t.tint&&t.emphasis&&this.updateTintAndEmphasis(t.tint,t.emphasis),t.poiFilter&&this.updatePointOfInterestFilter())},devicePixelRatioDidChange:function(){return!this._renderer},get snapsToIntegralZoomLevels(){return this._renderer.snapsToIntegralZoomLevels},set snapsToIntegralZoomLevels(t){},get debug(){return this._debug},set debug(t){this._debug!==!!t&&(this._debug=!!t,this._debug?this._showDebugPanel():this._hideDebugPanel())},minZoomLevelForViewportSize:function(t,e){return this._renderer&&this._renderer.Camera?this._renderer.Camera.getMinZoomLevel([t.width,t.height],e):this.minZoomLevel},needsReplacing:function(t){return!t},createLabelRegion:function(){return this._renderer.createLabelRegion()},updatedLabelRegion:function(){this.forceRerender(),this.node.needsDisplay=!0},unregisterLabelRegion:function(t){this._renderer.unregisterLabelRegion(t),this.node.needsDisplay=!0},_tileOverlaysDidChange:function(){this._fallback()},_showDebugPanel:function(){this._debugPanel=new s(function(){this.debug=!1}.bind(this),this.camera),this._debugPanel.attachTo(this._element),this._cameraDidChange=function(){o.prototype._cameraDidChange.call(this),this._debugPanel&&this._debugPanel.update(this.camera)}},_hideDebugPanel:function(){this._debugPanel.detach(),delete this._debugPanel,delete this._cameraDidChange},_updateDisplay:function(){this.forceRerender(),this.node.needsDisplay=!0},_convertPointOfInterestFilter:function(t){return null===t?null:{includes:t._includes,excludes:t._excludes}}}),e.exports=n},{"./base-map-node-internal":11,"./initial-interaction-controller":18,"./rotation-controller":24,"./syrup-debug-panel":27,"@maps/device-pixel-ratio":63,"@maps/js-utils":82}],29:[function(t,e,i){function n(){o.call(this),this._renderer=new s(this),Object.defineProperty(this,"_impl",{value:new a(this)})}var o=t("./base-map-node"),s=t("./render-syrup-map"),a=t("./syrup-map-node-internal"),r=t("@maps/js-utils"),l=t("@maps/scheduler"),h=t("../../../src/js/unsafe-dom");n.prototype=r.inheritPrototype(o,n,{get isRotationEnabled(){return this._impl.isRotationEnabled},set isRotationEnabled(t){this._impl.isRotationEnabled=t},get customCanvas(){return this._impl.customCanvas},set needsDisplay(t){t&&l.scheduleDraw(this._renderer)},init:function(t,e,i,n,o){this._impl.init(t,e,i,n,o)},updateNetworkConfiguration:function(t){this._impl.updateNetworkConfiguration(t)},forceRerender:function(){this._impl.forceRerender()},rotateCameraAroundMapPoint:function(t,e){this._impl.rotateCameraAroundMapPoint(t,e)},makePendingConfigurationUpdates:function(){this._impl.makePendingConfigurationUpdates()},didReconfigure:function(){this.dispatchEvent(new h.Event("reconfigured"))}}),e.exports=n},{"../../../src/js/unsafe-dom":233,"./base-map-node":12,"./render-syrup-map":23,"./syrup-map-node-internal":28,"@maps/js-utils":82,"@maps/scheduler":100}],30:[function(t,e,i){function n(t,e){var i=Math.pow(2,t.zoom),n=i*o.tileSize,r=t.viewportSize.width/n/2,c=t.viewportSize.height/n/2,d=new o.MapPoint(t.center.x-r,t.center.y-c),u=new o.MapPoint(t.center.x+r,t.center.y+c),p=i-1,m=Math.floor(s.mod(d.x,1)*i),g=Math.floor(s.mod(u.x,1)*i),_=s.clamp(Math.floor(d.y*i),0,p),f=s.clamp(Math.floor(u.y*i),0,p);this.range=new l(new h(m,_,t.zoom),new h(g,f,t.zoom)),this.settings=e,this.resolution=a(),this.zoom=t.zoom,this.mapRect=new o.MapRect(m/i,_/i,(g-m)/i,(f-_)/i),this.mapRect.size.width<0&&this.mapRect.size.width++}var o=t("../../geo"),s=t("@maps/js-utils"),a=t("@maps/device-pixel-ratio"),r=t("./tile-manager"),l=t("./tile-range"),h=t("@maps/geometry/point");n.prototype={constructor:n,equals:function(t){return this.sameSettings(t)&&this.resolution===t.resolution&&this.range.equals(t.range)},sameSettings:function(t){var e=this.settings,i=t.settings;return e.configuration===i.configuration&&e.tint===i.tint&&e.emphasis===i.emphasis&&e.showsPOI===i.showsPOI&&e.language===i.language&&e.showsDefaultTiles===i.showsDefaultTiles&&e.showsTileInfo===i.showsTileInfo&&this.sameTileOverlays(t)},sameTileOverlays:function(t){return this.settings.tileOverlays.length===t.settings.tileOverlays.length&&this.settings.tileOverlays.every(function(e,i){return e===t.settings.tileOverlays[i]&!e._impl.stale},this)},sharesTileSourcesWithTileData:function(t){if(this.settings.tint!==t.settings.tint||this.settings.emphasis!==t.settings.emphasis)return!1;var e=this.settings.configuration.tileSources,i=t.settings.configuration.tileSources;return!("AutoNavi"!==this.settings.configuration.provider||"AutoNavi"!==t.settings.configuration.provider||1!==e.length||1!==i.length||"satellite"!==e[0].name&&"hybrid"!==e[0].name||"satellite"!==i[0].name&&"hybrid"!==i[0].name)||i.some(function(t){return-1!==e.indexOf(t)})},load:function(){this._tiles||(this._tiles=r.tilesForTileData(this))},cancel:function(){if(!this._canceled&&(this._canceled=!0,this._tiles))for(var t=0,e=this._tiles,i=e.length;t<i;++t)e[t].unschedule()},releaseTiles:function(){if(this._tiles)for(var t=0,e=this._tiles,i=e.length;t<i;++t)r.releaseTile(e[t],this)},get tiles(){return this.load(),this._tiles}},e.exports=n},{"../../geo":4,"./tile-manager":35,"./tile-range":38,"@maps/device-pixel-ratio":63,"@maps/geometry/point":71,"@maps/js-utils":82}],31:[function(t,e,i){function n(t){a.GroupNode.call(this),this._scale=1,this._nodesByTileKey={},this._fadingNodes=[],this._debug=!!t}function o(t){var e=new d(t.tileSource);return e.size=m,t.loaderState===u.Succeeded&&(e.image=t.image,e.opacity=t.preferredOpacity),e}var s=t("../../geo"),a=t("../../scene-graph"),r=t("@maps/js-utils"),l=t("@maps/scheduler"),h=t("./debug-node"),c=t("./tile"),d=t("./tile-image-node"),u=t("@maps/loaders").State,p=new a.Matrix,m=new a.Size(s.tileSize,s.tileSize);n.prototype=r.inheritPrototype(a.GroupNode,n,{stale:!1,fullyRendered:!1,_pendingTileCount:0,_tileData:null,get locked(){return this.wantsLayerBacking},set locked(t){t!==this.wantsLayerBacking&&(t&&this._fadingNodes.length>0?this.wantsLayerBacking=!0:!t&&this._wantsLayerBacking?this.wantsLayerBacking=!1:this.frozen=t)},get tileData(){return this._tileData},setTileDataAnimated:function(t,e){this._fadingNodes=[],delete this._failedTileAndImage;var i=t.tiles,n=t.range.min,o=Math.pow(2,n.z);this._tileData&&this._tileData.tiles.forEach(function(t){if(t.removeEventListener(c.Events.LoadSuccess,this),t.removeEventListener(c.Events.LoadFail,this),-1===i.indexOf(t)){var e=t.key,n=this._nodesByTileKey[e];n&&(n.remove(),delete this._nodesByTileKey[e])}},this),this._tileData=t,this.fullyRendered=!1,this._pendingTileCount=i.length;var l=this.childCount;i.forEach(function(t){var i=new a.Point(r.mod(t.x-n.x,o)*s.tileSize,(t.y-n.y)*s.tileSize),h=this._ensureNodeForTile(t);h.position=i,h.opacity=0,this.addChild(h),t.loaded?((l>0||!e)&&(h.opacity=1),this._tileDidLoad(t)):(t.addEventListener(c.Events.LoadSuccess,this),t.addEventListener(c.Events.LoadFail,this))},this)},get pendingTileCount(){return this._pendingTileCount},set scale(t){t!==this._scale&&(this._scale=t,this.transform=1===t?p:(new a.Matrix).scale(t))},get debug(){return this._debug},stringInfo:function(){return"TileGridNode"+(this.tileData?"<range:("+this.tileData.range.toString()+")>":"")},get cssBackgroundProperty(){if(!this.fullyRendered)return"";var t=this.position;return Array.prototype.concat.apply([],this._tileData.tiles.map(function(e){var i=this._nodesByTileKey[e.key];return e.tileImages.reduce(function(e,n,o){return"url("+n.image.src+") "+(t.x+i.position.x)+"px "+(t.y+i.position.y)+"px / "+s.tileSize+"px no-repeat"+(0===o?"":", ")+e},"")},this)).join(", ")},handleEvent:function(t){var e=t.target;switch(t.type){case c.Events.LoadSuccess:e.removeEventListener(c.Events.LoadSuccess,this),this._tileDidLoad(e);break;case c.Events.LoadFail:this._tileLoadFail(e,t.tileImage)}},performScheduledUpdate:function(){this._updateFadingNodes(),0===this._pendingTileCount&&0===this._fadingNodes.length&&this._allTilesDidDraw()},_tileDidLoad:function(t){0===--this._pendingTileCount&&this._failedTileAndImage&&(this._failedTileAndImage.tile._requestTileImageLoadStatus(this._failedTileAndImage.tileImage,this._handleTileImageLoadStatus.bind(this)),delete this._failedTileAndImage);var e=this._nodesByTileKey[t.key];if(0===e.childCount){var i=t.tileImages;if(e.children=i.map(o),this.debug){var n=new h(t);n.size=m,e.addChild(n)}}e.opacity<1?(this._fadingNodes.push(e),l.scheduleASAP(this)):0===this._pendingTileCount&&this._allTilesDidDraw()},_tileLoadFail:function(t,e){this._failedTileAndImage={tile:t,tileImage:e}},_handleTileImageLoadStatus:function(t){if(403===t.target.status){var e=this.parent._map.node.delegate;e&&e.tileAccessForbidden()}},_updateFadingNodes:function(){var t=Date.now();this._fadingNodes=this._fadingNodes.filter(function(e){return e._startTime?e.opacity=Math.min(1,(t-e._startTime)/300):0===e.opacity&&(e._startTime=t),1!==e.opacity||(delete e._startTime,!1)}),this._fadingNodes.length>0?l.scheduleOnNextFrame(this):this._wantsLayerBacking&&(this.wantsLayerBacking=!1,this.frozen=!0)},_allTilesDidDraw:function(){this.fullyRendered=!0,this.parent&&this.parent.tileGridDidFinishRendering(this)},_ensureNodeForTile:function(t){var e=t.key,i=this._nodesByTileKey[e];return i||(i=this._nodesByTileKey[e]=new a.GroupNode),i}}),e.exports=n},{"../../geo":4,"../../scene-graph":51,"./debug-node":16,"./tile":39,"./tile-image-node":33,"@maps/js-utils":82,"@maps/loaders":83,"@maps/scheduler":100}],32:[function(t,e,i){function n(t){a.GroupNode.call(this),this._map=t}var o=t("../../geo"),s=t("@maps/scheduler"),a=t("../../scene-graph"),r=t("@maps/device-pixel-ratio"),l=t("./tile-grid-node"),h=t("./tile-data"),c=t("@maps/js-utils");n.prototype=c.inheritPrototype(a.GroupNode,n,{fullyRendered:!1,scheduleRefresh:function(){this.children.forEach(function(t){t.stale=!0}),this.invalidate()},destroy:function(){this._releaseChildren(!0)},invalidate:function(){this.fullyRendered=!1,s.scheduleASAP(this)},stringInfo:function(){return"TileGridsGroupNode"},get cssBackgroundProperty(){return this.fullyRendered?this.lastChild.cssBackgroundProperty:""},handleEvent:function(t){this.scheduleRefresh()},performScheduledUpdate:function(){if(this._canDraw()){var t=this._map,e=t.camera,i=this.lastChild,n=!!i&&i.debug!==this._map.debug,s=!!i&&i.tileData.settings.showsDefaultTiles!==this._map.showsDefaultTiles;if(!this._tileDataAtZoomCompletion){var l;if(Math.round(e.zoom)===e.zoom)l=new h(e,t.tileSettings);else{if(!i)return;l=i.tileData}if(i){if((i.stale||!i.locked)&&(!l.equals(i.tileData)||n||s)){var c=i.tileData;c.tiles.forEach(function(t){l.tiles.indexOf(t)<0&&t.unschedule()});var d=l.settings.configuration===c.settings.configuration,u=l.sameSettings(c)&&l.resolution===c.resolution&&!n;if(d?!u:l.sharesTileSourcesWithTileData(c))i.locked=!0,this._addNewTileGridAnimated(l,!0);else if(!i.locked){delete i.stale,i.setTileDataAnimated(l,d);var p=this._children[this._children.length-2];p&&!l.sharesTileSourcesWithTileData(p.tileData)&&(this._releaseChildren(!1),this._children=[i])}}}else this._addNewTileGridAnimated(l,!1)}for(var m=e.zoom,g=t.visibleMapRect,_=g.origin,f=g.size,y=0,v=this.children,w=v.length;y<w;++y){var b=v[y],C=b.tileData,S=C.zoom,k=C.mapRect.origin,E=Math.pow(2,m-S),T=Math.pow(2,S)*(o.tileSize*E),L=k.x-_.x;if(L>f.width)L--;else{var M=C.mapRect.size.width;M>0&&L+M<0&&L++}b.scale=E,b.position=new a.Point(r.roundToDevicePixel(L*T),r.roundToDevicePixel((k.y-_.y)*T)),y<w-1&&C.cancel()}this.fullyRendered=w>0&&this.children[w-1].fullyRendered}},cameraWillStartZooming:function(t){if(this._canDraw()){var e=this._map;t&&(this._tileDataAtZoomCompletion=new h(t,e.tileSettings),this._tileDataAtZoomCompletion.load()),this.children.forEach(function(t){t.locked=!0})}},cameraDidStopZooming:function(){if(this._canDraw())if(this._tileDataAtZoomCompletion)this._addNewTileGridAnimated(this._tileDataAtZoomCompletion,!0,!0),delete this._tileDataAtZoomCompletion;else{var t=this._map,e=this.lastChild;if(e&&t.camera.zoom===e.tileData.zoom)e.locked=!1;else{var i=new h(t.camera,t.tileSettings);this._addNewTileGridAnimated(i,!0,!0)}}},tileGridDidFinishRendering:function(t){var e=this.children,i=e.length,n=e[i-1];if(n.fullyRendered&&!n.locked){for(var o=0;o<i-1;++o)e[o].tileData.releaseTiles();i>1&&(this.children=[n]),this.fullyRendered=!0,this._map.tileGridDidFinishRendering()}},_canDraw:function(){var t=this._map;return t&&!!t.configuration&&!!t.language},_addNewTileGridAnimated:function(t,e,i){var n=new l(this._map.debug),o=this.lastChild;o&&!t.sharesTileSourcesWithTileData(o.tileData)?(this._releaseChildren(!0),this.children=[n]):this.addChild(n),n.setTileDataAnimated(t,e),i&&s.scheduleASAP(this)},_releaseChildren:function(t){for(var e=this.childCount-(t?1:2);e>=0;--e){var i=this.children[e].tileData;i.cancel(),i.releaseTiles()}}}),e.exports=n},{"../../geo":4,"../../scene-graph":51,"./tile-data":30,"./tile-grid-node":31,"@maps/device-pixel-ratio":63,"@maps/js-utils":82,"@maps/scheduler":100}],33:[function(t,e,i){function n(t){o.ImageNode.call(this),this._tileSource=t._public,this._tileSource&&"function"==typeof this._tileSource.addEventListener&&this._tileSource.addEventListener(s.OPACITY_EVENT,this)}var o=t("../../scene-graph"),s=t("./tile-overlay-internal"),a=t("@maps/js-utils");n.prototype=a.inheritPrototype(o.ImageNode,n,{handleEvent:function(){this._tileSource&&(this.opacity=this._tileSource.opacity)},wasRemoved:function(){setTimeout(function(){this.parent&&this.parent.scene||this._tileSource&&"function"==typeof this._tileSource.removeEventListener&&this._tileSource.removeEventListener(s.OPACITY_EVENT,this)}.bind(this),0)}}),e.exports=n},{"../../scene-graph":51,"./tile-overlay-internal":36,"@maps/js-utils":82}],34:[function(t,e,i){function n(t,e,i,n,s,a,r,l,h,c){this.x=t,this.y=e,this.z=i,this.tileSource=n,this.tint=s,this.emphasis=a,this.language=r,this.poi=l?1:0,this.resolution=h,this._priority=c,this._loader=o(c,this)}function o(t,e){var i;return l.length>0?(i=l.shift()).reuse(t,e):i=new s.ImageLoader(t,e),i}var s=t("@maps/loaders"),a=t("@maps/js-utils"),r={},l=[];n.prototype={constructor:n,get preferredOpacity(){return"number"==typeof this.tileSource.opacity?this.tileSource.opacity:1},get loaderState(){return this._loader?this._loader.state:s.State.Unscheduled},schedule:function(){this._loader||(this._loader=o(this._priority,this)),this._loader.state>s.State.Unscheduled||this._loader.schedule()},unschedule:function(){this._loader&&this._loader.unschedule()&&(l.push(this._loader),this._loader=null)},whenDoneLoading:function(t){this._loader&&this._loader.state>s.State.Loading?t(this):this._doneLoadingCallback=t},get urlForImageLoader(){var t=this.tileSource;if("function"==typeof t.urlForImageLoader)return t.urlForImageLoader(this.x,this.y,this.z,this.resolution);var e=t.domains,i=t.proxyPrefixes,n=t.protocol,o=t.supportedResolutions[0],s=t.supportedResolutions[t.supportedResolutions.length-1],l=a.clamp(this.resolution,o,s),h=a.fillTemplate(t.path,{tileSizeIndex:1,x:this.x,y:this.y,z:this.z,resolution:l,lang:this.language,poi:this.poi});h+="&emphasis="+this.emphasis+"&tint="+this.tint;var c=r[h];return c||(c=n+"//"+e[(this.x+this.y)%e.length]+h,i&&(c=i[(this.x+this.y)%i.length]+c),r[h]=c,c)},loaderDidSucceed:function(t){this._loaderDidComplete()},loaderDidFail:function(t){this._loaderDidComplete()},_loaderDidComplete:function(){this.image=this._loader.image,"function"==typeof this._doneLoadingCallback&&(this._doneLoadingCallback(this),delete this._doneLoadingCallback)}},e.exports=n},{"@maps/js-utils":82,"@maps/loaders":83}],35:[function(t,e,i){function n(t,e,i,n){return n.settings.configuration.provider+n.settings.configuration.name+t+"-"+e+"-"+i+n.settings.tint+n.settings.emphasis+n.settings.language+n.settings.showsPOI+n.settings.showsDefaultTiles+n.settings.showsTileInfo+n.resolution+n.settings.tileOverlays.map(function(n){return n._impl.keyForTile(t,e,i)}).join("-")}function o(t,e,i,o,r){var l=n(t,e,i,o),h=d[l];return h?h.schedule():((h=new c(l,t,e,i,o.settings,o.resolution,r)).addEventListener(c.Events.LoadSuccess,s),h.addEventListener(c.Events.LoadFail,a),d[l]=h,h._refCount=0,h._loadTileImages()),h._refCount++,h}function s(t){var e=t.target;e.removeEventListener(c.Events.LoadSuccess,s),e.removeEventListener(c.Events.LoadFail,a)}function a(t){var e=t.target;delete d[e.key],e.removeEventListener(c.Events.LoadSuccess,s),e.removeEventListener(c.Events.LoadFail,a)}var r=t("@maps/loaders"),l=t("@maps/geometry/point"),h=t("@maps/js-utils"),c=t("./tile"),d={};e.exports={tilesForTileData:function(t){for(var e=t.range,i=e.min.z,n=Math.pow(2,i),s=e.min,a=e.denormalize().max,c=new l((s.x+a.x)/2,(s.y+a.y)/2),d=[],u=Math.min(a.x,s.x+n-1),p=s.x;p<=u;++p)for(var m=s.y;m<=a.y;++m)d.push(new l(p,m));return d.sort(function(t,e){var i=t.distanceToPoint(c)-e.distanceToPoint(c);return 0===i?t.x-e.x==0?t.y-e.y:t.x-e.x:i}),d.map(function(e){return o(h.mod(e.x,n),e.y,i,t,r.Priority.High)})},releaseTile:function(t,e){if(t._refCount--,0===t._refCount){t.unschedule();var i=n(t.x,t.y,t.z,e);delete d[i]}}}},{"./tile":39,"@maps/geometry/point":71,"@maps/js-utils":82,"@maps/loaders":83}],36:[function(t,e,i){function n(t,e,i){this._public=t,i=s.checkOptions(i),l.forEach(function(t){t in i&&(this[t]=i[t])},this),Object.keys(i).forEach(function(t){l.indexOf(t)<0&&console.warn("[MapKit] Unknown option: "+t+". Use the data property to store custom data.")}),this.urlTemplate=e,void 0===this.opacity&&(this.opacity=h),this.stale=!1}function o(t){return t.replace(/\{/g,"{{").replace(/\}/g,"}}")}var s=t("@maps/js-utils"),a=t("../../../src/js/public-dom"),r=t("../../../src/js/call-function-safely"),l=["minimumZ","maximumZ","opacity","data"],h=1;n.RELOAD_EVENT="tile-overlay-reload",n.OPACITY_EVENT="tile-overlay-opacity-changed",n.ERROR_EVENT="tile-error",n.prototype={constructor:n,_minimumZ:null,_maximumZ:null,get urlTemplate(){return this._urlTemplate},set urlTemplate(t){var e=typeof t;if("function"!==e&&"string"!==e){var i="[MapKit] TileOverlay.urlTemplate expected a function or a string, but got `"+t+"` instead.";throw new TypeError(i)}this._urlTemplate=t},keyForTile:function(t,e,i){return this._minimumZ+"-"+this._maximumZ+"-"+this.urlForImageLoader(t,e,i,1)},get minimumZ(){return this._minimumZ},get minZoomLevel(){return this._minimumZ},set minimumZ(t){var e="[MapKit] TileOverlay.minimumZ expected a number, but got `"+t+"` instead.";s.checkType(t,"number",e),this._minimumZ=Math.floor(t)},get maximumZ(){return this._maximumZ},get maxZoomLevel(){return this._maximumZ},set maximumZ(t){var e="[MapKit] TileOverlay.maximumZ expected a number, but got `"+t+"` instead.";s.checkType(t,"number",e),this._maximumZ=Math.ceil(t)},get opacity(){return this._opacity},set opacity(t){var e="[MapKit] TileOverlay.opacity expected a number, but got `"+t+"` instead.";s.checkType(t,"number",e),this._opacity=s.clamp(t,0,1);var i=new a.Event(n.OPACITY_EVENT);i.tileOverlay=this,i.opacity=this._opacity,this._public.dispatchEvent(i)},get data(){return Object.prototype.hasOwnProperty.call(this,"_data")||(this._data={}),this._data},set data(t){var e="[MapKit] TileOverlay.data expected an Object, but got `"+t+"` instead.";s.checkType(t,"object",e),this._data=t},reload:function(){this.stale=!0;var t=new a.Event(n.RELOAD_EVENT);t.tileOverlay=this,this._public.dispatchEvent(t)},reloadComplete:function(){this.stale=!1},urlForImageLoader:function(t,e,i,n){if(this._urlTemplate){if("function"==typeof this._urlTemplate)return r(this._urlTemplate,null,[t,e,i,n,this._data]);var a=o(this._urlTemplate),l={};return this._data&&Object.keys(this._data).forEach(function(t){l[t]=this._data[t]},this),l.x=t,l.y=e,l.z=i,l.scale=n,s.fillTemplate(a,l)}},dispatchErrorForURL:function(t){var e=new a.Event(n.ERROR_EVENT);e.tileOverlay=this._public,e.tileUrl=t,this._public.dispatchEvent(e)}},e.exports=n},{"../../../src/js/call-function-safely":161,"../../../src/js/public-dom":219,"@maps/js-utils":82}],37:[function(t,e,i){function n(t,e){r(this,n)&&Object.defineProperty(this,"_impl",{value:new o(this,t,e)})}var o=t("./tile-overlay-internal"),s=t("@maps/js-utils"),a=t("../../../src/js/public-dom"),r=t("../../../src/js/check-instance-and-warn");n.prototype=s.inheritPrototype(a.EventTarget,n,{get urlTemplate(){return this._impl.urlTemplate},set urlTemplate(t){this._impl.urlTemplate=t},get minimumZ(){return this._impl.minimumZ},set minimumZ(t){this._impl.minimumZ=t},get maximumZ(){return this._impl.maximumZ},set maximumZ(t){this._impl.maximumZ=t},get opacity(){return this._impl.opacity},set opacity(t){this._impl.opacity=t},get data(){return this._impl.data},set data(t){this._impl.data=t},reload:function(){this._impl.reload()}}),e.exports=n},{"../../../src/js/check-instance-and-warn":162,"../../../src/js/public-dom":219,"./tile-overlay-internal":36,"@maps/js-utils":82}],38:[function(t,e,i){function n(t,e){this.min=t,this.max=e}n.prototype={constructor:n,denormalize:function(){var t=this.min.copy(),e=this.max.copy();return e.x<t.x&&(e.x+=Math.pow(2,t.z)),new n(t,e)},toString:function(){return this.min.toString()+" -> "+this.max.toString()},equals:function(t){var e=this.denormalize(),i=t.denormalize();return i.min.x===e.min.x&&i.min.y===e.min.y&&i.max.x===e.max.x&&i.max.y===e.max.y&&i.min.z===e.min.z&&i.max.z===e.max.z}},e.exports=n},{}],39:[function(t,e,i){function n(t,e,i,n,o,s,a){this.key=t,this.x=e,this.y=i,this.z=n,this.settings=o,this.resolution=s,this.priority=a,this.tileImages=[]}var o=t("@maps/loaders"),s=t("@maps/js-utils"),a=t("../../../src/js/unsafe-dom"),r=t("./tile-image");n.Events={LoadSuccess:"tile-load-success",LoadFail:"tile-load-fail"},n.prototype=s.inheritPrototype(a.EventTarget,n,{loading:!1,loaded:!1,get tileSources(){return(this.settings.showsDefaultTiles?this.settings.configuration.tileSources:[]).concat(this.settings.tileOverlays.map(function(t){return t._impl}).filter(function(t){return!!t.urlForImageLoader(this.x,this.y,this.z,this.resolution)},this)).filter(function(t){return(this.z>=t.minZoomLevel||"number"!=typeof t.minZoomLevel)&&(this.z<=t.maxZoomLevel||"number"!=typeof t.maxZoomLevel)},this)},schedule:function(){this.loaded||(this.tileImages.forEach(function(t){t.schedule()}),this.loading=!0)},unschedule:function(){this.tileImages.forEach(function(t){t.unschedule()}),this.loading=!1},_loadTileImages:function(){if(!this.loading){if(this.loaded){if(!this._containsCanceledTileImages())return;this.tileImages=[],this.loaded=!1}this.loading=!0;var t=this.tileSources;0!==t.length?(this._pendingTileImageLoads=t.length,t.forEach(this._loadTileImage,this)):this._allTileImagesDoneLoading()}},_loadTileImage:function(t){var e=this.settings,i=new r(this.x,this.y,this.z,t,e.tint,e.emphasis,e.language,e.showsPOI,this.resolution,this.priority);i.schedule(),this.tileImages.push(i),i.whenDoneLoading(this._tileImageDoneLoading.bind(this,t))},_requestTileImageLoadStatus:function(t,e){var i=s.xhr(e,t.image.src);i.open("GET",t.image.src,!0),i.send()},_tileImageDoneLoading:function(t,e){if(e._loader.state===o.State.Failed)if("function"==typeof t.dispatchErrorForURL)t.dispatchErrorForURL(e._loader.url);else{var i=new a.Event(n.Events.LoadFail);i.tileImage=e,this.dispatchEvent(i)}0===--this._pendingTileImageLoads&&this._allTileImagesDoneLoading()},_allTileImagesDoneLoading:function(){delete this._pendingTileImageLoads,this.loading=!1,this.loaded=!0,this._containsCanceledTileImages()||this.dispatchEvent(new a.Event(n.Events.LoadSuccess))},_containsCanceledTileImages:function(){return this.tileImages.some(function(t){return t.loaderState===o.State.Canceled})}}),e.exports=n},{"../../../src/js/unsafe-dom":233,"./tile-image":34,"@maps/js-utils":82,"@maps/loaders":83}],40:[function(t,e,i){function n(t){d.call(this,t),this._pinchRecognizer=this.addRecognizer(new r.Pinch),this._pinchRecognizer.scaleThreshold=.1,this._doubleTapWithOneFingerRecognizer=this.addRecognizer(new r.Tap),this._doubleTapWithOneFingerRecognizer.numberOfTouchesRequired=1,this._doubleTapWithOneFingerRecognizer.numberOfTapsRequired=2,this._singleTapWithTwoFingersRecognizer=this.addRecognizer(new r.Tap),this._singleTapWithTwoFingersRecognizer.numberOfTouchesRequired=2,this._singleTapWithTwoFingersRecognizer.numberOfTapsRequired=1,this.map.node.element.addEventListener("wheel",this)}function o(t){return t.state===r.States.Began||t.state===r.States.Changed}var s=t("@maps/device-pixel-ratio"),a=t("../../geo"),r=t("@maps/gesture-recognizers"),l=t("@maps/js-utils"),h=t("@maps/scheduler"),c=t("@maps/geometry/point"),d=t("./gesture-controller"),u=t("./camera"),p=t("../../../src/js/constants"),m=t("./constants"),g=t("./integral-wheel-zoom-controller"),_=Math.pow(1e-4,2.5);n.prototype=l.inheritPrototype(d,n,{decelerating:!1,stopDecelerating:function(){this.decelerating&&this._decelerationEnded()},destroy:function(){d.prototype.destroy.call(this),this._integralZoomController&&(this._integralZoomController.destroy(),delete this._integralZoomController),clearTimeout(this._wheelEndTimeoutId),delete this._pinchRecognizer,delete this._doubleTapWithOneFingerRecognizer,delete this._singleTapWithTwoFingersRecognizer,this.map.node.element.removeEventListener("wheel",this),this.stopDecelerating()},get active(){return o(this._pinchRecognizer)||o(this._doubleTapWithOneFingerRecognizer)||o(this._singleTapWithTwoFingersRecognizer)},handleEvent:function(t){if("wheel"!==t.type){var e=t.target;switch(e){case this._pinchRecognizer:this._handlePinchChange(e);break;case this._doubleTapWithOneFingerRecognizer:this._handleDoubleTapWithOneFingerChange(e);break;case this._singleTapWithTwoFingersRecognizer:this._handleSingleTapWithTwoFingersChange(e)}}else this._handleWheelEvent(t)},performScheduledUpdate:function(){if(this.decelerating){var t=this.map,e=Date.now()-this._startTime;if(e>=this._decelerationDuration)return t.scaleCameraAroundMapPoint(this._adjustedScaleAtDecelerationEnd/this._scale,this._lastScaleCenter),void this._decelerationEnded();var i=this._scaleAtTime(e),n=(i-this._initialScale)/(this._scaleAtDecelerationEnd-this._initialScale);i+=this._scaleAdjustment*n,t.scaleCameraAroundMapPoint(i/this._scale,this._lastScaleCenter);var o=t.camera.zoom;o===t.currentMinZoomLevel||o===this.currentMaxZoomLevel?this.stopDecelerating():(this._scale=i,this._schedule())}},_centerWithRecognizer:function(t){return this._mapPointFromCentroid(t.locationInElement())},_mapPointFromCentroid:function(t){var e=this.map,i=e.node.convertPointFromPage(t);i=e.camera.transformGestureCenter(i);var n=e.visibleMapRect,o=e.camera.viewportSize;return new a.MapPoint(n.minX()+i.x/o.width*n.size.width,n.minY()+i.y/o.height*n.size.height)},_handlePinchChange:function(t){var e=this.map,i=e.camera,n=i.zoom;if(t.state===r.States.Began)this._singleTapWithTwoFingersRecognizer.enabled=!1,e.cameraWillStartZooming(p.ZoomTypes.Pinch);else if(t.state===r.States.Ended||t.state===r.States.Changed){var o=t.scale;this._lastScaleCenter=this.centerForGesture(t),(o>1&&n!==e.currentMaxZoomLevel||o<1&&n!==e.currentMinZoomLevel)&&(e.scaleCameraAroundMapPoint(o,this._lastScaleCenter),t.scale=1)}if((t.state===r.States.Ended||t.state===r.States.Failed)&&(this._singleTapWithTwoFingersRecognizer.enabled=!0,this._startDeceleratingWithVelocity(t.velocity),!this.decelerating)){var s=e.snapsToIntegralZoomLevels?Math.round(n):n,a=l.clamp(s,e.currentMinZoomLevel,e.currentMaxZoomLevel);n===a?e.cameraDidStopZooming():this._lastScaleCenter?e.scaleCameraAroundMapPoint(Math.pow(2,a-n),this._lastScaleCenter,!0):e.setCameraAnimated(new u(i.center,a,i.viewportSize,i.rotation),!0)}},_handleDoubleTapWithOneFingerChange:function(t){t.state===r.States.Recognized&&this._zoomWithTapRecognizer(t,t.modifierKeys.alt)},_handleSingleTapWithTwoFingersChange:function(t){t.state===r.States.Recognized&&this._zoomWithTapRecognizer(t,!0)},_handleWheelEvent:function(t){if(t.ctrlKey||t.shiftKey||this.map.allowWheelToZoom){t.preventDefault();var e=t.shiftKey&&!!t.deltaX&&!t.deltaY,i=e?t.deltaX:t.deltaY;switch(t.deltaMode){case t.DOM_DELTA_LINE:i*=100/3*s();break;case t.DOM_DELTA_PAGE:i*=100*s()}(t.ctrlKey||this.map.allowWheelToZoom&&!t.shiftKey||e)&&(i*=-1),t.ctrlKey&&t.deltaMode===t.DOM_DELTA_PIXEL&&(i*=10);var n=0,o=1+(n=i>0?Math.sqrt(i):-Math.sqrt(-i))*m.WheelZoomFactor,a=this.map;if(!(o>1&&a.camera.zoom===a.currentMaxZoomLevel||o<1&&a.camera.zoom===a.currentMinZoomLevel)){var r=new c(t.pageX,t.pageY);this._lastScaleCenter=a.staysCenteredDuringZoom?a.transformCenter:this._mapPointFromCentroid(r),a.snapsToIntegralZoomLevels?this._wheelZoomToScaleAndIntegralZoomLevel(o):this._wheelZoomToScale(o)}}},_wheelZoomToScale:function(t){var e=this.map;this._wheelZooming||(e.cameraWillStartZooming(p.ZoomTypes.Scroll),this._wheelZooming=!0),e.scaleCameraAroundMapPoint(t,this._lastScaleCenter),this._wheelEndTimeoutId&&(clearTimeout(this._wheelEndTimeoutId),this._wheelEndTimeoutId=null),this._wheelEndTimeoutId=setTimeout(function(){this._wheelEndTimeoutId=null,this._wheelZooming=!1,e.cameraDidStopZooming()}.bind(this),m.WheelEventTimeout)},_wheelZoomToScaleAndIntegralZoomLevel:function(t){this._integralZoomController||(this._integralZoomController=new g(this.map)),this._integralZoomController.zoomToScale(t,this._lastScaleCenter)},_zoomWithTapRecognizer:function(t,e){var i=this.map,n=i.camera.zoom,o=e?-1:1,s=(e?Math.floor(n+.5):Math.ceil(n-.5))+o,a=n-l.clamp(s,i.currentMinZoomLevel,i.currentMaxZoomLevel);Math.abs(a)<.5||!i.cameraWillStartZooming(p.ZoomTypes.DoubleTap,!0,!0)||i.setCameraAnimated(i.camera.withNewMapRect(i.visibleMapRect.scale(Math.pow(2,a),this.centerForGesture(t))),!0)},_startDeceleratingWithVelocity:function(t){Math.abs(t)<1||(this.decelerating=!0,this._startTime=Date.now(),this._initialScale=this._scale=1,this._initialVelocity=t/1e3,this._decelerationFactor=.98875,this._decelerationDuration=Math.log(_/Math.pow(this._initialVelocity,2))/(2*Math.log(this._decelerationFactor)),this._scaleAtDecelerationEnd=this._scaleAtTime(this._decelerationDuration),this._adjustedScaleAtDecelerationEnd=this._adjustScaleAtDecelerationEnd(this._scaleAtDecelerationEnd/this._scale),this._scaleAdjustment=this._adjustedScaleAtDecelerationEnd-this._scaleAtDecelerationEnd,this._schedule())},_adjustScaleAtDecelerationEnd:function(t){var e=this.map,i=e.camera.zoom,n=i+l.log2(t);if(e.snapsToIntegralZoomLevels){var o=Math.round(n);n>i&&o<=i?o=Math.ceil(n):n<i&&o>=i&&(o=Math.floor(n)),n=o}var s=l.clamp(n,e.currentMinZoomLevel,e.currentMaxZoomLevel);return Math.pow(2,s-i)},_schedule:function(){h.scheduleOnNextFrame(this)},_scaleAtTime:function(t){return Math.max(this._initialScale+this._decelerationFactor*this._initialVelocity*(Math.pow(this._decelerationFactor,t)-1)/(this._decelerationFactor-1),0)},_decelerationEnded:function(){this.decelerating=!1;var t=this.map;if(t.snapsToIntegralZoomLevels){var e=t.camera,i=t.snapsToIntegralZoomLevels?Math.round(e.zoom):e.zoom;t.setCameraAnimated(new u(e.center,i,e.viewportSize,e.rotation))}t.cameraDidStopZooming()}}),e.exports=n},{"../../../src/js/constants":166,"../../geo":4,"./camera":14,"./constants":15,"./gesture-controller":17,"./integral-wheel-zoom-controller":19,"@maps/device-pixel-ratio":63,"@maps/geometry/point":71,"@maps/gesture-recognizers":74,"@maps/js-utils":82,"@maps/scheduler":100}],41:[function(t,e,i){e.exports=t("./src/scale-node")},{"./src/scale-node":49}],42:[function(t,e,i){"use strict";function n(t,e){if(!e)return this._targetOpacity=t,void(this.opacity=t);t!==this._targetOpacity&&(t!==this.opacity?(this._targetOpacity=t,this._startTime=Date.now(),this._startOpacity=this._opacity,s.scheduleOnNextFrame(this)):this._targetOpacity=t)}function o(){if("function"==typeof this.constructor.prototype.performScheduledUpdate&&this.constructor.prototype.performScheduledUpdate.call(this),null!==this._targetOpacity){if(this._targetOpacity===this.opacity)return this._startTime=null,this._startOpacity=null,void(this._targetOpacity=null);var t=Date.now()-this._startTime,e=this._targetOpacity-this._startOpacity,i=Math.abs(e*this._totalDurationMs),n=Math.min(t/i,1),o=a.easeInOut(n)*e+this._startOpacity;this.opacity=r.clamp(o,0,1),s.scheduleOnNextFrame(this)}}var s=t("@maps/scheduler"),a=t("../../../src/js/utils"),r=t("@maps/js-utils");e.exports=function(t,e){return t._targetOpacity=null,t._startOpacity=null,t._startTime=null,t._totalDurationMs=e||300,t.setOpacityAnimated=n,t.performScheduledUpdate=o,t}},{"../../../src/js/utils":237,"@maps/js-utils":82,"@maps/scheduler":100}],43:[function(t,e,i){"use strict";function n(){s.BaseNode.call(this),this._legend=null,this._segmentWidth=0,this._segmentStart=0,this._numberOfSegments=0,this._fillColor=null,this._strokeColor=null,this._renderer=new o(this)}var o=t("./render-legend"),s=t("../../scene-graph"),a=t("@maps/js-utils");n.prototype=a.inheritPrototype(s.BaseNode,n,{get legend(){return this._legend},set legend(t){this._legend=t,this.needsDisplay=!0},get segmentStart(){return this._segmentStart},set segmentStart(t){this._segmentStart=t,this.needsDisplay=!0},get segmentWidth(){return this._segmentWidth},set segmentWidth(t){this._segmentWidth=t,this.needsDisplay=!0},get numberOfSegments(){return this._numberOfSegments},set numberOfSegments(t){this._numberOfSegments=t,this.needsDisplay=!0},get fillColor(){return this._fillColor},set fillColor(t){this._fillColor=t,this.needsDisplay=!0},get strokeColor(){return this._strokeColor},set strokeColor(t){this._strokeColor=t,this.needsDisplay=!0},stringInfo:function(){var t="~"+this.fillColor+"/"+this.strokeColor+"~ ";return this._legend?"LegendNode<labels:["+this._legend.labels.slice(0,this.numberOfSegments+1).join(", ")+"], unit:"+this._legend.unit+")> "+t:"LegendNode "+t},measureTextOverflow:function(t,e){return this._renderer.measureTextOverflow(t,e)}}),e.exports=n},{"../../scene-graph":51,"./render-legend":46,"@maps/js-utils":82}],44:[function(t,e,i){"use strict";function n(){a.call(this),o(this,s.InnerTransitionDuration),this.lineWidth=s.OutlineWidth}var o=t("./animatable-opacity-mixin"),s=t("./scale-constants"),a=t("./rect-node"),r=t("@maps/js-utils");n.prototype=r.inheritPrototype(a,n,{stringInfo:function(){return"OutlineNode "+("~"+this.strokeColor+"~ ")}}),e.exports=n},{"./animatable-opacity-mixin":42,"./rect-node":45,"./scale-constants":48,"@maps/js-utils":82}],45:[function(t,e,i){"use strict";function n(){s.BaseNode.call(this),this._fillColor=null,this._strokeColor=null,this._lineWidth=null,this._innerStroke=!1,this._renderer=new o(this)}var o=t("./render-rect"),s=t("../../scene-graph"),a=t("@maps/js-utils");n.prototype=a.inheritPrototype(s.BaseNode,n,{get fillColor(){return this._fillColor},set fillColor(t){this._fillColor=t,this.needsDisplay=!0},get strokeColor(){return this._strokeColor},set strokeColor(t){this._strokeColor=t,this.needsDisplay=!0},get innerStroke(){return this._innerStroke},set innerStroke(t){this._innerStroke=t,this.needsDisplay=!0},get lineWidth(){return this._lineWidth},set lineWidth(t){this._lineWidth=t,this.needsDisplay=!0}}),e.exports=n},{"../../scene-graph":51,"./render-rect":47,"@maps/js-utils":82}],46:[function(t,e,i){"use strict";function n(t){s.RenderItem.call(this,t)}var o=t("./scale-constants"),s=t("../../scene-graph"),a=t("@maps/js-utils");n.prototype=a.inheritPrototype(s.RenderItem,n,{measureTextOverflow:function(t,e){var i=this._node;if(!i.legend)return 0;t.font=o.LegendFont;var n;n=e?i.legend.labels[0]:i.legend.labels[i.numberOfSegments];var s,a=t.measureText(n).width/2;return s=e?0:t.measureText(" "+i.legend.unit).width,a+s},draw:function(t){var e=this._node;if(e.legend){t.font=o.LegendFont,t.textAlign="center",t.textBaseline="bottom",t.lineWidth=o.LegendOuterStrokeWidth,t.fillStyle=e.fillColor,t.strokeStyle=e.strokeColor;for(var i=e.size.height-o.LegendMarginBottom-o.LegendSpacing,n=e.segmentStart,s=0;s<=e.numberOfSegments;s++){var a=e.legend.labels[s];t.strokeText(a,n,i),t.fillText(a,n,i),s===e.numberOfSegments?n+=t.measureText(a).width/2:n+=e.segmentWidth}var r=" "+e.legend.unit;t.textAlign="left",t.strokeText(r,n,i),t.fillText(r,n,i)}}}),e.exports=n},{"../../scene-graph":51,"./scale-constants":48,"@maps/js-utils":82}],47:[function(t,e,i){"use strict";function n(t){s.RenderItem.call(this,t)}var o=t("@maps/device-pixel-ratio"),s=t("../../scene-graph"),a=t("@maps/js-utils");n.prototype=a.inheritPrototype(s.RenderItem,n,{draw:function(t){var e=this._node,i=e.fillColor,n=e.strokeColor,s=e.lineWidth;i&&(t.fillStyle=i,t.fillRect(0,0,e.size.width,e.size.height)),n&&s&&(s>=1||o()>1)&&(t.lineWidth=s,t.strokeStyle=n,e.innerStroke?t.strokeRect(s/2,s/2,e.size.width-s,e.size.height-s):t.strokeRect(-s/2,-s/2,e.size.width+s,e.size.height+s))}}),e.exports=n},{"../../scene-graph":51,"@maps/device-pixel-ratio":63,"@maps/js-utils":82}],48:[function(t,e,i){"use strict";e.exports={GlobalFadeDuration:700,InnerTransitionDuration:200,MinimumNumberOfSegments:2,MaximumNumberOfSegments:5,MagicNumbers:[1.25,2.5,5],FirstMagicExponent:-3,LastMagicExponent:7,MaximumNumberOfDisplayedSegments:3,SegmentThickness:3,LegendHorizontalMargin:6,LegendMarginBottom:8,LegendSpacing:1,OutlineWidth:1,LightSegmentColorRegular:"rgba(255, 255, 255, 0.7)",DarkSegmentColorRegular:"rgba(0, 0, 0, 0.73)",OutlineColorRegular:"rgba(255, 255, 255, 0.5)",LightSegmentColorSatellite:"rgba(255, 255, 255, 0.8)",DarkSegmentColorSatellite:"rgba(178, 178, 178, 0.8)",OutlineColorSatellite:"rgba(0, 0, 0, 1)",SegmentInnerStrokeColor:"rgba(0, 0, 0, 0.2)",SegmentInnerStrokeWidth:.5,LegendFont:"9px '-apple-system-font', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'",LegendColorRegular:"rgba(72, 69, 65, 1)",LegendOuterStrokeColorRegular:"rgba(255, 255, 255, 0.5)",LegendColorSatellite:"rgba(255, 255, 255, 1)",LegentOuterStrokeColorSatellite:"rgba(0, 0, 0, 1)",LegendOuterStrokeWidth:1,MetersThreshold:500,FeetThreshold:.25,MilesToMeters:1609.344,MetersToMiles:1/1609.344,MilesToFeet:5280}},{}],49:[function(t,e,i){"use strict";function n(){c.GroupNode.call(this),this._needsLayout=!1,this._layoutCanvas=document.createElement("canvas"),this._layoutContext=this._layoutCanvas.getContext("2d"),this._distance=0,this._mapWidth=0,this._theme=n.Themes.light,this._leftAligned=!1,this._l10n=null,this._segmentWidth=0,this._oldNumberOfSegments=0,this._legend={labels:[],unit:""},this._legendNode=this.addChild(new a),this._outlineNodes=[0,1].map(function(){return this.addChild(new r)},this),this._activeOutlineNode=this._outlineNodes[0],this._outlineNodes[1].opacity=0,this._segmentNodes=[0,1,2].map(function(t){return this.addChild(new d)},this),this._updateColors(),o(this,s.GlobalFadeDuration)}var o=t("./animatable-opacity-mixin"),s=t("./scale-constants"),a=t("./legend-node"),r=t("./outline-node"),l=t("@maps/geometry/rect"),h=t("@maps/scheduler"),c=t("../../scene-graph"),d=t("./segment-node"),u=t("@maps/js-utils"),p=.01;n.Themes={light:"Light",dark:"Dark"},n.prototype=u.inheritPrototype(c.GroupNode,n,{get layerBounds(){return new l(0,0,this.size.width,Math.max(this.size.height,48))},get distance(){return this._distance},set distance(t){Math.abs(t-this._distance)/this._distance<p||(this._distance=t,this._computeSegments())},get mapWidth(){return this._mapWidth},set mapWidth(t){t!==this._mapWidth&&(this._mapWidth=t,this._computeSegments())},get theme(){return this._theme},set theme(t){this._theme=t,this._updateColors()},get l10n(){return this._l10n},set l10n(t){this._l10n&&this._l10n.removeEventListener(this._l10n.Events.LocaleChanged,this),this._l10n=t,t&&t.addEventListener(t.Events.LocaleChanged,this)},get useMetric(){return this._useMetric},set useMetric(t){this._useMetric!==t&&(this._useMetric=t,this._computeSegments())},get leftAligned(){return this._leftAligned},set leftAligned(t){this._leftAligned=t,this.needsLayout=!0},stringInfo:function(){return"ScaleNode<distance:"+Math.round(100*this.distance)/100+"m>"},get needsLayout(){return this._needsLayout},set needsLayout(t){this._needsLayout!==t&&(this._needsLayout=t,t&&h.scheduleASAP(this))},performScheduledUpdate:function(){this.needsLayout&&(this.layoutSubNodes(),this.needsLayout=!1)},layoutSubNodes:function(){for(var t=this._computeSegmentsRects(),e=0;e<s.MaximumNumberOfDisplayedSegments;e++){var i=t[this.leftAligned?e:t.length-1-e],n=this._segmentNodes[e];i?(n.position=i.origin,n.size=i.size,n.setOpacityAnimated(1,!0)):n.setOpacityAnimated(0,!0)}var o=l.unionOfRects(t).round();if(t.length!==this._oldNumberOfSegments){this._activeOutlineNode.setOpacityAnimated(0,!0);var a=0===this._outlineNodes.indexOf(this._activeOutlineNode)?1:0;this._activeOutlineNode=this._outlineNodes[a],this._activeOutlineNode.setOpacityAnimated(1,!0)}this._activeOutlineNode.position=o.origin,this._activeOutlineNode.size=o.size;var r=t[0];this._legendNode.segmentStart=r.origin.x,this._legendNode.segmentWidth=r.size.width,this._legendNode.size.width=this.size.width,this._legendNode.size.height=this.size.height,this._oldNumberOfSegments=t.length},handleEvent:function(t){this._computeSegments()},_updateColors:function(t){var e=this.theme===n.Themes.dark;this._legendNode.fillColor=e?s.LegendColorSatellite:s.LegendColorRegular,this._legendNode.strokeColor=e?s.LegentOuterStrokeColorSatellite:s.LegendOuterStrokeColorRegular;var i=e?[s.LightSegmentColorSatellite,s.DarkSegmentColorSatellite]:[s.DarkSegmentColorRegular,s.LightSegmentColorRegular];this._segmentNodes.forEach(function(t,n){t.fillColor=i[n%2],t.strokeColor=e?null:s.SegmentInnerStrokeColor},this);var o=e?s.OutlineColorSatellite:s.OutlineColorRegular;this._outlineNodes.forEach(function(t){t.strokeColor=o})},_computeSegments:function(){if(0!==this.size.width&&0!==this.mapWidth&&this._l10n){var t,e=this.size.width,i=this.mapWidth,n=this.distance*e/i,o=!this._useMetric,a=!1,r=1;o&&(n*=s.MetersToMiles)<s.FeetThreshold&&(a=!0,n*=s.MilesToFeet);for(var l=s.FirstMagicExponent,h=!1;!h&&l<s.LastMagicExponent;l++)h=s.MagicNumbers.some(function(e){return t=e*Math.pow(10,l),(r=n/t)>=s.MinimumNumberOfSegments&&r<s.MaximumNumberOfSegments});this._segmentWidth=r?e/r:0;var c=t;o&&(a&&(t/=s.MilesToFeet),t*=s.MilesToMeters),this._computeLegend(t,c,a)}},_computeLegend:function(t,e,i){var n=0;this._useMetric?t>s.MetersThreshold?(this._legend.unit=this._l10n.get("Scale.Kilometer.Short"),n=t/1e3):(this._legend.unit=this._l10n.get("Scale.Meter.Short"),n=t):(this._legend.unit=i?this._l10n.get("Scale.Feet.Short"):this._l10n.get("Scale.Mile.Short"),n=e);for(var o=[],a=0;a<s.MaximumNumberOfSegments;a++){var r=a*n;o.push(r.toString())}this._legend.labels=o,this._legendNode.legend=this._legend,this.needsLayout=!0},_computeSegmentsRects:function(){for(var t=this._layoutContext,e=0,i=s.LegendHorizontalMargin+this._legendNode.measureTextOverflow(t,!0),n=this.size.height-s.LegendMarginBottom+s.LegendSpacing,o=this._segmentWidth,a=[],r=0;r<s.MaximumNumberOfDisplayedSegments;r++){var h=new l(i,n,o,s.SegmentThickness).round();if(a.push(h),i=h.origin.x+h.size.width,this._legendNode.numberOfSegments=a.length,e=this._legendNode.measureTextOverflow(t),i+o+e+s.LegendHorizontalMargin>this.size.width)break}0===this._oldNumberOfSegments&&(this._oldNumberOfSegments=a.length);var c=0;return this.leftAligned||(c=Math.round(this.size.width-i-e-s.LegendHorizontalMargin),a.forEach(function(t){t.origin.x+=c})),a}}),e.exports=n},{"../../scene-graph":51,"./animatable-opacity-mixin":42,"./legend-node":43,"./outline-node":44,"./scale-constants":48,"./segment-node":50,"@maps/geometry/rect":72,"@maps/js-utils":82,"@maps/scheduler":100}],50:[function(t,e,i){"use strict";function n(){a.call(this),o(this,s.InnerTransitionDuration),this.lineWidth=s.SegmentInnerStrokeWidth,this.innerStroke=!0}var o=t("./animatable-opacity-mixin"),s=t("./scale-constants"),a=t("./rect-node"),r=t("@maps/js-utils");n.prototype=r.inheritPrototype(a,n,{stringInfo:function(){return"SegmentNode "+("~"+this.fillColor+"~ ")}}),e.exports=n},{"./animatable-opacity-mixin":42,"./rect-node":45,"./scale-constants":48,"@maps/js-utils":82}],51:[function(t,e,i){e.exports={Scene:t("./src/model/scene"),BaseNode:t("./src/model/base-node"),GroupNode:t("./src/model/group-node"),ImageNode:t("./src/model/image-node"),RenderItem:t("./src/render/c2d/render-item"),NodeAnimator:t("./src/node-animator"),Size:t("@maps/geometry/size"),Point:t("@maps/geometry/point"),Matrix:t("@maps/css-matrix")}},{"./src/model/base-node":53,"./src/model/group-node":54,"./src/model/image-node":55,"./src/model/scene":56,"./src/node-animator":57,"./src/render/c2d/render-item":59,"@maps/css-matrix":61,"@maps/geometry/point":71,"@maps/geometry/size":73}],52:[function(t,e,i){function n(){var t=a;a=[];for(var e=[],i=0,n=t.length;i<n;++i){var s=t[i].scene;s&&o(e,s)&&s.renderer.update()}}function o(t,e){return-1===t.indexOf(e)&&(t.push(e),!0)}var s=t("@maps/scheduler"),a=[];e.exports={scheduleNode:function(t){o(a,t)&&1===a.length&&s.scheduleDraw(n)}}},{"@maps/scheduler":100}],53:[function(t,e,i){function n(){this._parent=null,this._children=[],this._renderer=null,this._opacity=1,this._size=new h,this._position=new c,this._transform=new u,this._frozen=!1,this._keyForFrozenLayer="",this._wantsLayerBacking=!1}function o(t){t._parent=null;for(var e=[t];e.length>0;){var i=e.pop();i.wasRemoved(),i._renderer&&"function"==typeof i._renderer.nodeWasRemoved&&i._renderer.nodeWasRemoved(),Array.prototype.push.apply(e,i.children)}}function s(t){for(var e=null,i=0,n=0;t&&!e;){var o=t.transform.transformPoint(t.position);i-=o.x,n-=o.y,e=(t=t.parent).element}return{element:e,offsetX:i,offsetY:n}}function a(t){return t<0?"":t+":"}function r(t){return t.childCount<1?"":" â¤µï¸ "+t.childCount}function l(t,e,i,n,o){var s="";if(s+=e,o&&(s+=a(i)),s+=t.toString(),s+=r(t),t.extraInfo&&"function"==typeof t.extraInfo&&t.extraInfo().forEach(function(t){s+="\n"+e+"| "+t}),0===n)return s;for(var h=t.children,c=0,d=h.length;c<d;++c){var u=t.childCount<1?-1:c;s+="\n",s+=l(h[c],e+"    ",u,n-1,o)}return s}var h=t("@maps/geometry/size"),c=t("@maps/geometry/point"),d=t("@maps/geometry/rect"),u=t("@maps/css-matrix"),p=t("@maps/web-point-converter"),m=t("../display-scheduler"),g=(new u).toString();n.prototype={constructor:n,get scene(){for(var e=t("./scene"),i=this;i;i=i._parent)if(i instanceof e)return i},get renderer(){return this._renderer},get wantsLayerBacking(){return!!this.keyForFrozenLayer||this._frozen||this._wantsLayerBacking||this._needsLayerBacking()},set wantsLayerBacking(t){t!==this._wantsLayerBacking&&(this._wantsLayerBacking=t,this.needsDisplay=!0)},get frozen(){return!!this.keyForFrozenLayer||this._frozen},set frozen(t){t!==this._frozen&&(this._frozen=t,this.needsDisplay=!0)},get keyForFrozenLayer(){return this._keyForFrozenLayer},set keyForFrozenLayer(t){t!==this._keyForFrozenLayer&&(this._keyForFrozenLayer=t,this.needsDisplay=!0)},get opacity(){return this._opacity},set opacity(t){(t=Math.min(Math.max(0,t),1))!==this._opacity&&(this._opacity=t,this.needsDisplay=!0)},get position(){return this._position},set position(t){t.equals(this._position)||(this._position=t.copy(),this.needsDisplay=!0)},get transform(){return this._transform},set transform(t){this._transform=t,this.needsDisplay=!0},get size(){return this._size},set size(t){this._size=t||new h,this.needsDisplay=!0},get bounds(){return new d(this._position.x,this._position.y,this.size.width,this.size.height)},get layerBounds(){for(var t=new d(0,0,this.size.width,this.size.height),e=this._children,i=0,n=e.length;i<n;++i){var o=e[i],s=o.layerBounds;s.origin.x+=o._position.x,s.origin.y+=o._position.y;for(var a=o.transform,r=[a.transformPoint(new c(s.minX(),s.minY())),a.transformPoint(new c(s.maxX(),s.minY())),a.transformPoint(new c(s.maxX(),s.maxY())),a.transformPoint(new c(s.minX(),s.maxY()))],l=r[0].x,h=r[0].y,u=r[0].x,p=r[0].y,m=1;m<r.length;++m){var g=r[m];g.x<l&&(l=g.x),g.x>u&&(u=g.x),g.y<h&&(h=g.y),g.y>p&&(p=g.y)}t=t.unionWithRect(new d(l,h,u-l,p-h))}return t},set needsDisplay(t){t&&m.scheduleNode(this)},get parent(){return this._parent},get children(){return this._children},set children(t){for(var e=0,i=0,n=[].concat(this._children);e<t.length;)n[i]!==t[e]?n[i]&&-1===t.indexOf(n[i])?(this.removeChild(n[i]),i++):(t[e]._parent===this&&n.splice(n.indexOf(t[e]),1),this.addChild(t[e],e),e++):(e++,i++);for(;i<n.length;)this.removeChild(n[i]),i++},get childCount(){return this._children.length},get firstChild(){return this._children[0]||null},get lastChild(){return this._children[this._children.length-1]||null},get previousSibling(){if(!this._parent)return null;var t=this._parent._children,e=t.indexOf(this);return e>0?t[e-1]:null},get nextSibling(){if(!this._parent)return null;var t=this._parent._children,e=t.indexOf(this);return-1!==e&&e<t.length-1?t[e+1]:null},toString:function(){var t="";return this.element&&(t+="ð· "),this.wantsLayerBacking&&(t+="ð "),this.frozen&&(t+="âï¸ ",this.keyForFrozenLayer&&(t+="<"+this.keyForFrozenLayer+">")),this.stringInfo&&"function"==typeof this.stringInfo?t+=this.stringInfo():t+="UnknownNode",0===this.position.x&&0===this.position.y||(t+=" ("+this.position.x+", "+this.position.y+")"),0===this.size.width&&0===this.size.height||(t+=" "+this.size.width+"x"+this.size.height),1!==this.opacity&&(t+=" [opacity:"+this.opacity+"]"),this.transform.toString()!==g&&(t+=" ["+this.transform.toString()+"]"),this.animators&&this.animators.forEach(function(e){t+=" "+e.stringInfo()}),t},dump:function(t,e){return void 0===t&&(t=1/0),l(this,"",-1,t,!!e)},addChild:function(t,e){return t.remove(),(void 0===e||e<0||e>this._children.length)&&(e=this._children.length),this._children.splice(e,0,t),t._parent=this,this.needsDisplay=!0,t},insertBefore:function(t,e){return this.addChild(t,this._children.indexOf(e))},insertAfter:function(t,e){return this.addChild(t,this._children.indexOf(e)+1)},removeChild:function(t){if(t._parent===this){var e=this._children.indexOf(t);if(-1!==e)return this._children.splice(e,1),o(t),this.needsDisplay=!0,t}},replaceChild:function(t,e){if(e&&e._parent===this){var i=this._children.indexOf(e);return t.remove(),this._children.splice(i,1,t),o(e),t._parent=this,this.needsDisplay=!0,e}},remove:function(){if(this._parent instanceof n)return this._parent.removeChild(this)},wasRemoved:function(){},convertPointFromPage:function(t){if(this.element)return p.fromPageToElement(this.element,t);var e=s(this),i=p.fromPageToElement(e.element,t);return new c(i.x+e.offsetX,i.y+e.offsetY)},convertPointToPage:function(t){if(this.element)return p.fromElementToPage(this.element,t);var e=s(this),i=p.fromElementToPage(e.element,t);return new c(i.x-e.offsetX,i.y-e.offsetY)},_needsLayerBacking:function(){return this.opacity<1&&(this._children.length>1||1===this._children.length&&this._children[0]._children.length>0)}},e.exports=n},{"../display-scheduler":52,"./scene":56,"@maps/css-matrix":61,"@maps/geometry/point":71,"@maps/geometry/rect":72,"@maps/geometry/size":73,"@maps/web-point-converter":101}],54:[function(t,e,i){function n(){o.call(this),this._renderer=new s(this)}var o=t("./base-node"),s=t("../render/c2d/render-item"),a=t("@maps/js-utils");n.prototype=a.inheritPrototype(o,n,{stringInfo:function(){return"GroupNode"}}),e.exports=n},{"../render/c2d/render-item":59,"./base-node":53,"@maps/js-utils":82}],55:[function(t,e,i){function n(){a.call(this),this._image=null,this._renderer=new r(this)}var o=t("@maps/geometry/size"),s=t("@maps/js-utils"),a=t("./base-node"),r=t("../render/c2d/render-image");n.prototype=s.inheritPrototype(a,n,{get image(){return this._image},set image(t){this._image!==t&&(this._image&&this._image.removeEventListener("load",this),this._image=t,this._imageDidLoad(),!t||t.src&&t.complete||t.addEventListener("load",this))},stringInfo:function(){var t=this._image?this._image.src:null;if(s.isNode()){var e=t.split("src/images/");2===e.length&&(t=e[1])}return"ImageNode"+(t?"<src:"+t+">":"")},handleEvent:function(t){t.target===this._image&&this._image.complete&&(this._image.removeEventListener("load",this),this._imageDidLoad(),this.needsDisplay=!0)},_imageDidLoad:function(){this.size.equals(o.Zero)&&(this.size=new o(this._image.width,this._image.height)),this.needsDisplay=!0}}),e.exports=n},{"../render/c2d/render-image":58,"./base-node":53,"@maps/geometry/size":73,"@maps/js-utils":82}],56:[function(t,e,i){function n(){o.call(this),this._renderer=new s(this),r.addEventListener("device-pixel-ratio-change",this)}var o=t("./base-node"),s=t("../render/c2d/render-scene"),a=t("@maps/js-utils"),r=t("@maps/device-pixel-ratio");n.prototype=a.inheritPrototype(o,n,{get element(){return this._renderer.element},destroy:function(){this.children=[],this._renderer._ctx=null,this._renderer._canvas.width=this._renderer._canvas.height=0,r.removeEventListener("device-pixel-ratio-change",this)},stringInfo:function(){return"Scene"},handleEvent:function(t){this.needsDisplay=!0}}),e.exports=n},{"../render/c2d/render-scene":60,"./base-node":53,"@maps/device-pixel-ratio":63,"@maps/js-utils":82}],57:[function(t,e,i){function n(t){this.node=t.node,this.node.animators||(this.node.animators=[]),this.node.animators.push(this),this.duration=t.duration,["from","to","done"].forEach(function(e){e in t&&null!=t[e]&&(this[e]=t[e])},this)}function o(t){n.call(this,t)}function s(t){n.call(this,t)}function a(t){n.call(this,t),["center","mass","stiffness","damping","initialVelocity"].forEach(function(e){e in t&&(this[e]=t[e])},this),this.mass>0&&(this.springSolver=new r(this.mass,this.stiffness,this.damping,this.initialVelocity))}function r(t,e,i,n){this.w0=Math.sqrt(e/t),this.zeta=i/(2*Math.sqrt(e*t)),this.zeta<1?(this.wd=this.w0*Math.sqrt(1-this.zeta*this.zeta),this.A=1,this.B=(this.zeta*this.w0-n)/this.wd):(this.wd=0,this.A=1,this.B=-n+this.w0)}var l=t("@maps/geometry/point"),h=t("@maps/css-matrix"),c=t("@maps/scheduler"),d=t("@maps/js-utils");n.prototype={from:0,to:1,done:d.noop,begin:function(){return this.beginDate=Date.now(),c.scheduleASAP(this),this},end:function(){this.node.animators.splice(this.node.animators.indexOf(this),1),0===this.node.animators.length&&delete this.node.animators,delete this.beginDate},performScheduledUpdate:function(){this.beginDate&&(this._p=Math.min((Date.now()-this.beginDate)/this.duration,1),this.update(this._p),this._p<1?c.scheduleOnNextFrame(this):this.ended())},ended:function(){this.end(),this.done(this)},valueAt:function(t){return this.from+t*(this.to-this.from)},stringInfo:function(t,e){var i="ð"+t+"<"+this.duration+"ms; "+this.from+"â"+this.to;return this._p>=0&&(i+="/"+Math.round(100*this._p)+"%"),Object.prototype.hasOwnProperty.call(this,"done")&&(i+="*"),i+(e||"")+">"}},o.prototype=d.inheritPrototype(n,o,{update:function(t){this.node.opacity=this.valueAt(t)},stringInfo:function(){return n.prototype.stringInfo.call(this,"opacity")}}),s.prototype=d.inheritPrototype(n,s,{from:new l(0,0),to:new l(0,0),update:function(t){this.node.transform=(new h).translate(this.from.x+t*(this.to.x-this.from.x),this.from.y+t*(this.to.y-this.from.y))},stringInfo:function(){return n.prototype.stringInfo.call(this,"translation")}}),a.prototype=d.inheritPrototype(n,a,{center:new l(0,0),scale:function(t){var e=this.center.x,i=this.center.y;this.node.transform=(new h).translate(e,i).scale(t).translate(-e,-i)},update:function(t){this.scale(this.valueAt(this.springSolver?this.springSolver.solve(t):t))},ended:function(){this.mass>0&&this.scale(this.to),n.prototype.ended.call(this)},stringInfo:function(){var t="";return 0===this.center.x&&0===this.center.y||(t+=" ("+this.center.x+", "+this.center.y+")"),this.mass>0&&(t+="ð"),n.prototype.stringInfo.call(this,"scale",t)}}),r.prototype.solve=function(t){return 1-(t=this.zeta<1?Math.exp(-t*this.zeta*this.w0)*(this.A*Math.cos(this.wd*t)+this.B*Math.sin(this.wd*t)):(this.A+this.B*t)*Math.exp(-t*this.w0))},e.exports={Basic:n,Opacity:o,Translation:s,Scale:a}},{"@maps/css-matrix":61,"@maps/geometry/point":71,"@maps/js-utils":82,"@maps/scheduler":100}],58:[function(t,e,i){function n(t){o.call(this,t)}var o=t("./render-item"),s=t("@maps/js-utils");n.prototype=s.inheritPrototype(o,n,{_lastDrawnImage:null,draw:function(t){this._node.image&&(this._node.image.complete&&this._node.image.naturalWidth?(this._lastDrawnImage=this._node.image,t.drawImage(this._node.image,0,0,this._node.size.width,this._node.size.height)):this._node.image===this._lastDrawnImage&&(this._node.needsDisplay=!0))}}),e.exports=n},{"./render-item":59,"@maps/js-utils":82}],59:[function(t,e,i){function n(t){this._node=t,this._layer=null}function o(t){0===l.length&&setTimeout(function(){l.forEach(function(t){t._node.scene||t.releaseLayer()}),l=[]},0),l.push(t)}var s=t("@maps/device-pixel-ratio"),a=t("@maps/js-utils"),r={};n.prototype={constructor:n,get node(){return this._node},get shouldDraw(){var t=this._node.keyForFrozenLayer;return!(this._frozenLayer&&(!this._sharedLayer||this._sharedLayer.key===t)||t&&r[t])},get layer(){var t=this._node,e=t.frozen,i=t.keyForFrozenLayer;if(e){if(this._frozenLayer){if(!i||!this._sharedLayer||this._sharedLayer.key===i)return this._frozenLayer;this.releaseLayer()}if(i){var n=r[i];if(n&&n.key===i)return this._sharedLayer=n,this._layer=this._frozenLayer=n.canvas,++n.count,n.canvas}}delete this._frozenLayer,this._layer||(this._layer=this.createCanvas(),i&&(this._sharedLayer=r[i]={canvas:this._layer,count:1,key:i}));var o=s(),a=t.layerBounds;this._layer.width=Math.ceil(a.size.width*o),this._layer.height=Math.ceil(a.size.height*o);var l=this._layer.getContext("2d");return l&&l.scale(o,o),e&&(this._frozenLayer=this._layer),this._layer},releaseLayer:function(t){this._layer&&(this._sharedLayer?t||0===--this._sharedLayer.count&&(delete r[this._sharedLayer.key],this._layer.width=0):this._layer.width=0,delete this._sharedLayer,delete this._frozenLayer,delete this._layer)},nodeWasRemoved:function(){this._layer&&o(this)},createCanvas:function(){return a.createCanvas()},draw:function(t){}};var l=[];n.releaseSharedLayers=function(){Object.keys(r).forEach(function(t){var e=r[t];e.canvas.width=0,delete e.key,delete e.canvas}),r={}},e.exports=n},{"@maps/device-pixel-ratio":63,"@maps/js-utils":82}],60:[function(t,e,i){function n(t){l.call(this,t),this._canvas=this.createCanvas(),this._ctx=this._canvas.getContext("2d")}function o(t,e,i,n,s,a){if(e&&0!==t.opacity){var r=t.renderer;s&&r.releaseLayer(!0);var l=r.shouldDraw,h=t.wantsLayerBacking?r.layer:null;if(h||t.frozen||r.releaseLayer(),!t.wantsLayerBacking||h){e.save(),e.translate(t.position.x,t.position.y);var c=t.transform;if(e.transform(c.a,c.b,c.c,c.d,c.e,c.f),a*=t.opacity,e.globalAlpha=a,l||!t.frozen){var d=h?h.getContext("2d"):e;t.renderer.draw(d);for(var u=t.children,p=0,m=u.length;p<m;++p)o(u[p],d,i,n,s,h?1:a)}h&&0!==h.width&&0!==h.height&&e.drawImage(h,0,0,h.width/n,h.height/n),e.restore()}}}var s=t("@maps/device-pixel-ratio"),a=t("@maps/geometry/rect"),r=t("@maps/js-utils"),l=t("./render-item");n.prototype=r.inheritPrototype(l,n,{get element(){return this._canvas},update:function(){if(this._ctx){var t=this._node,e=t.size,i=s(),n=!this._previousScale||this._previousScale!==i;n&&l.releaseSharedLayers(),!n&&this._previousSize&&this._previousSize.equals(e)?this._ctx.clearRect(0,0,e.width*i,e.height*i):(this._canvas.style.width=e.width+"px",this._canvas.style.height=e.height+"px",this._canvas.width=e.width*i,this._canvas.height=e.height*i,this._previousSize=e.copy(),this._previousScale=i),this._ctx.scale(i,i),o(this.node,this._ctx,new a(-t.position.x,-t.position.y,e.width,e.height),i,n,1),this._ctx.scale(1/i,1/i)}}}),e.exports=n},{"./render-item":59,"@maps/device-pixel-ratio":63,"@maps/geometry/rect":72,"@maps/js-utils":82}],61:[function(t,e,i){function n(){if(this._=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],6===arguments.length)this._setValues(["a","b","c","d","e","f"],arguments);else if(16===arguments.length)this._setValues(["m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44"],arguments);else if(1==arguments.length){var t=arguments[0];if("string"==typeof t){if("none"===t)return;t=t.match(/\bmatrix(?:3d)?\(([^)]+)\)/)[1].split(",").map(parseFloat)}6===t.length?this._setValues(["a","b","c","d","e","f"],t):16===t.length&&this._setValues(["m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44"],t)}}function o(t){return t/180*Math.PI}function s(t,e,i,n){return t*n-e*i}function a(t,e,i,n,o,a,r,l,h){return t*s(o,a,l,h)-n*s(e,i,l,h)+r*s(e,i,o,a)}function r(t,e){l(t,e);var i=t._determinant();if(Math.abs(i)<c)return!1;for(var n=0;n<4;n++)for(var o=0;o<4;o++)e._[n][o]=e._[n][o]/i;return!0}function l(t,e){var i=t._[0][0],n=t._[0][1],o=t._[0][2],s=t._[0][3],r=t._[1][0],l=t._[1][1],h=t._[1][2],c=t._[1][3],d=t._[2][0],u=t._[2][1],p=t._[2][2],m=t._[2][3],g=t._[3][0],_=t._[3][1],f=t._[3][2],y=t._[3][3];e._[0][0]=a(l,u,_,h,p,f,c,m,y),e._[1][0]=-a(r,d,g,h,p,f,c,m,y),e._[2][0]=a(r,d,g,l,u,_,c,m,y),e._[3][0]=-a(r,d,g,l,u,_,h,p,f),e._[0][1]=-a(n,u,_,o,p,f,s,m,y),e._[1][1]=a(i,d,g,o,p,f,s,m,y),e._[2][1]=-a(i,d,g,n,u,_,s,m,y),e._[3][1]=a(i,d,g,n,u,_,o,p,f),e._[0][2]=a(n,l,_,o,h,f,s,c,y),e._[1][2]=-a(i,r,g,o,h,f,s,c,y),e._[2][2]=a(i,r,g,n,l,_,s,c,y),e._[3][2]=-a(i,r,g,n,l,_,o,h,f),e._[0][3]=-a(n,l,u,o,h,p,s,c,m),e._[1][3]=a(i,r,d,o,h,p,s,c,m),e._[2][3]=-a(i,r,d,n,l,u,s,c,m),e._[3][3]=a(i,r,d,n,l,u,o,h,p)}var h=t("@maps/geometry/point"),c=1e-8;n.prototype={constructor:n,get a(){return this._[0][0]},get b(){return this._[0][1]},get c(){return this._[1][0]},get d(){return this._[1][1]},get e(){return this._[3][0]},get f(){return this._[3][1]},get m11(){return this._[0][0]},get m12(){return this._[0][1]},get m13(){return this._[0][2]},get m14(){return this._[0][3]},get m21(){return this._[1][0]},get m22(){return this._[1][1]},get m23(){return this._[1][2]},get m24(){return this._[1][3]},get m31(){return this._[2][0]},get m32(){return this._[2][1]},get m33(){return this._[2][2]},get m34(){return this._[2][3]},get m41(){return this._[3][0]},get m42(){return this._[3][1]},get m43(){return this._[3][2]},get m44(){return this._[3][3]},set a(t){this._[0][0]=t},set b(t){this._[0][1]=t},set c(t){this._[1][0]=t},set d(t){this._[1][1]=t},set e(t){this._[3][0]=t},set f(t){this._[3][1]=t},set m11(t){this._[0][0]=t},set m12(t){this._[0][1]=t},set m13(t){this._[0][2]=t},set m14(t){this._[0][3]=t},set m21(t){this._[1][0]=t},set m22(t){this._[1][1]=t},set m23(t){this._[1][2]=t},set m24(t){this._[1][3]=t},set m31(t){this._[2][0]=t},set m32(t){this._[2][1]=t},set m33(t){this._[2][2]=t},set m34(t){this._[2][3]=t},set m41(t){this._[3][0]=t},set m42(t){this._[3][1]=t},set m43(t){this._[3][2]=t},set m44(t){this._[3][3]=t},translate:function(t,e,i){return t=t||0,e=e||0,i=i||0,this._[3][0]+=t*this._[0][0]+e*this._[1][0]+i*this._[2][0],this._[3][1]+=t*this._[0][1]+e*this._[1][1]+i*this._[2][1],this._[3][2]+=t*this._[0][2]+e*this._[1][2]+i*this._[2][2],this._[3][3]+=t*this._[0][3]+e*this._[1][3]+i*this._[2][3],this},scale:function(t,e,i){return t=t||1,e=e||t,i=i||1,this._[0][0]*=t,this._[0][1]*=t,this._[0][2]*=t,this._[0][3]*=t,this._[1][0]*=e,this._[1][1]*=e,this._[1][2]*=e,this._[1][3]*=e,this._[2][0]*=i,this._[2][1]*=i,this._[2][2]*=i,this._[2][3]*=i,this},rotate:function(t){return this.rotateAxisAngle(0,0,1,t)},rotateAxisAngle:function(t,e,i,s){0===t&&0===e&&0===i&&(i=1);var a=Math.sqrt(t*t+e*e+i*i);1!=a&&(t/=a,e/=a,i/=a),s=o(s);var r=Math.sin(s),l=Math.cos(s),h=new n;if(1===t&&0===e&&0===i)h._[0][0]=1,h._[0][1]=0,h._[0][2]=0,h._[1][0]=0,h._[1][1]=l,h._[1][2]=r,h._[2][0]=0,h._[2][1]=-r,h._[2][2]=l,h._[0][3]=h._[1][3]=h._[2][3]=0,h._[3][0]=h._[3][1]=h._[3][2]=0,h._[3][3]=1;else if(0===t&&1===e&&0===i)h._[0][0]=l,h._[0][1]=0,h._[0][2]=-r,h._[1][0]=0,h._[1][1]=1,h._[1][2]=0,h._[2][0]=r,h._[2][1]=0,h._[2][2]=l,h._[0][3]=h._[1][3]=h._[2][3]=0,h._[3][0]=h._[3][1]=h._[3][2]=0,h._[3][3]=1;else if(0===t&&0===e&&1===i)h._[0][0]=l,h._[0][1]=r,h._[0][2]=0,h._[1][0]=-r,h._[1][1]=l,h._[1][2]=0,h._[2][0]=0,h._[2][1]=0,h._[2][2]=1,h._[0][3]=h._[1][3]=h._[2][3]=0,h._[3][0]=h._[3][1]=h._[3][2]=0,h._[3][3]=1;else{var c=1-l;h._[0][0]=l+t*t*c,h._[0][1]=e*t*c+i*r,h._[0][2]=i*t*c-e*r,h._[1][0]=t*e*c-i*r,h._[1][1]=l+e*e*c,h._[1][2]=i*e*c+t*r,h._[2][0]=t*i*c+e*r,h._[2][1]=e*i*c-t*r,h._[2][2]=l+i*i*c,h._[0][3]=h._[1][3]=h._[2][3]=0,h._[3][0]=h._[3][1]=h._[3][2]=0,h._[3][3]=1}return this.multiply(h)},multiply:function(t){var e=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];return e[0][0]=t._[0][0]*this._[0][0]+t._[0][1]*this._[1][0]+t._[0][2]*this._[2][0]+t._[0][3]*this._[3][0],e[0][1]=t._[0][0]*this._[0][1]+t._[0][1]*this._[1][1]+t._[0][2]*this._[2][1]+t._[0][3]*this._[3][1],e[0][2]=t._[0][0]*this._[0][2]+t._[0][1]*this._[1][2]+t._[0][2]*this._[2][2]+t._[0][3]*this._[3][2],e[0][3]=t._[0][0]*this._[0][3]+t._[0][1]*this._[1][3]+t._[0][2]*this._[2][3]+t._[0][3]*this._[3][3],e[1][0]=t._[1][0]*this._[0][0]+t._[1][1]*this._[1][0]+t._[1][2]*this._[2][0]+t._[1][3]*this._[3][0],e[1][1]=t._[1][0]*this._[0][1]+t._[1][1]*this._[1][1]+t._[1][2]*this._[2][1]+t._[1][3]*this._[3][1],e[1][2]=t._[1][0]*this._[0][2]+t._[1][1]*this._[1][2]+t._[1][2]*this._[2][2]+t._[1][3]*this._[3][2],e[1][3]=t._[1][0]*this._[0][3]+t._[1][1]*this._[1][3]+t._[1][2]*this._[2][3]+t._[1][3]*this._[3][3],e[2][0]=t._[2][0]*this._[0][0]+t._[2][1]*this._[1][0]+t._[2][2]*this._[2][0]+t._[2][3]*this._[3][0],e[2][1]=t._[2][0]*this._[0][1]+t._[2][1]*this._[1][1]+t._[2][2]*this._[2][1]+t._[2][3]*this._[3][1],e[2][2]=t._[2][0]*this._[0][2]+t._[2][1]*this._[1][2]+t._[2][2]*this._[2][2]+t._[2][3]*this._[3][2],e[2][3]=t._[2][0]*this._[0][3]+t._[2][1]*this._[1][3]+t._[2][2]*this._[2][3]+t._[2][3]*this._[3][3],e[3][0]=t._[3][0]*this._[0][0]+t._[3][1]*this._[1][0]+t._[3][2]*this._[2][0]+t._[3][3]*this._[3][0],e[3][1]=t._[3][0]*this._[0][1]+t._[3][1]*this._[1][1]+t._[3][2]*this._[2][1]+t._[3][3]*this._[3][1],e[3][2]=t._[3][0]*this._[0][2]+t._[3][1]*this._[1][2]+t._[3][2]*this._[2][2]+t._[3][3]*this._[3][2],e[3][3]=t._[3][0]*this._[0][3]+t._[3][1]*this._[1][3]+t._[3][2]*this._[2][3]+t._[3][3]*this._[3][3],this._=e,this},skewX:function(t){return this._skew(t,0)},skewY:function(t){return this._skew(0,t)},isAffine:function(){return 0==this._[0][2]&&0==this._[0][3]&&0==this._[1][2]&&0==this._[1][3]&&0==this._[2][0]&&0==this._[2][1]&&1==this._[2][2]&&0==this._[2][3]&&0==this._[3][2]&&1==this._[3][3]},inverse:function(){if(this._isIdentityOrTranslation())return 0==this._[3][0]&&0==this._[3][1]&&0==this._[3][2]?this:(this._[3][0]*=-1,this._[3][1]*=-1,this._[3][2]*=-1,this);var t=new n;return r(this,t)?t:new n},transformPoint:function(t){return new h(this._[0][0]*t.x+this._[1][0]*t.y+this._[2][0]*t.z+this._[3][0],this._[0][1]*t.x+this._[1][1]*t.y+this._[2][1]*t.z+this._[3][1],this._[0][2]*t.x+this._[1][2]*t.y+this._[2][2]*t.z+this._[3][2])},toString:function(){return this.isAffine()?"matrix("+[this._[0][0],this._[0][1],this._[1][0],this._[1][1],this._[3][0],this._[3][1]].join(", ")+")":"matrix3d("+this._.map(function(t){return t.join(", ")}).join(", ")+")"},_setValues:function(t,e){t.forEach(function(t,i){this[t]=e[i]},this)},_isIdentityOrTranslation:function(){return 1==this._[0][0]&&0==this._[0][1]&&0==this._[0][2]&&0==this._[0][3]&&0==this._[1][0]&&1==this._[1][1]&&0==this._[1][2]&&0==this._[1][3]&&0==this._[2][0]&&0==this._[2][1]&&1==this._[2][2]&&0==this._[2][3]&&1==this._[3][3]},_skew:function(t,e){var i=new n;return i._[0][1]=Math.tan(o(e)),i._[1][0]=Math.tan(o(t)),this.multiply(i)},_determinant:function(){var t=this._[0][0],e=this._[0][1],i=this._[0][2],n=this._[0][3],o=this._[1][0],s=this._[1][1],r=this._[1][2],l=this._[1][3],h=this._[2][0],c=this._[2][1],d=this._[2][2],u=this._[2][3],p=this._[3][0],m=this._[3][1],g=this._[3][2],_=this._[3][3];return t*a(s,c,m,r,d,g,l,u,_)-e*a(o,h,p,r,d,g,l,u,_)+i*a(o,h,p,s,c,m,l,u,_)-n*a(o,h,p,s,c,m,r,d,g)}},e.exports=n},{"@maps/geometry/point":71}],62:[function(t,e,i){function n(){this._operations=[]}function o(t,e,i){this.x=c(t),this.y=c(e),this.z=c(i)}function s(t,e,i){this.x=c(t,1),this.y=c(e,this.x),this.z=c(i,1)}function a(t){this.angle=c(t)}function r(t,e){this.x=c(t),this.y=c(e)}function l(t,e,i,n){this.x=c(t),this.y=c(e),this.z=c(i),this.angle=c(n)}function h(){if(1===arguments.length)return arguments[0]+"px";for(var t=0,e=arguments.length,i=[];t<e;++t)i.push(h(arguments[t]));return i.join(", ")}function c(t,e){return null==t?e||0:t}function d(t,e){return t+"("+e+")"}n.prototype={constructor:n,translate:function(t,e,i){return this._operations.push(new o(t,e,i)),this},scale:function(t,e,i){return this._operations.push(new s(t,e,i)),this},rotate:function(t){return this._operations.push(new a(t)),this},rotate3d:function(t,e,i,n){return this._operations.push(new l(t,e,i,n)),this},skew:function(t,e){return this._operations.push(new r(t,e)),this},transform:function(t){return this._operations=this._operations.concat(t),this},toString:function(){return this._operations.map(function(t){return t.toString()}).join(" ")}},e.exports=n,o.prototype={constructor:o,toString:function(){return!this.x||this.y||this.z?!this.y||this.x||this.z?!this.z||this.x||this.y?this.z?d("translate3d",h(this.x,this.y,this.z)):d("translate",h(this.x,this.y)):d("translateZ",h(this.z)):d("translateY",h(this.y)):d("translateX",h(this.x))}},s.prototype={constructor:s,toString:function(){return 1!==this.x&&1===this.y&&1===this.z?d("scaleX",this.x):1!==this.y&&1===this.x&&1===this.z?d("scaleY",this.y):1!==this.z&&1===this.x&&1===this.y?d("scaleZ",this.z):1===this.z?this.x===this.y?d("scale",this.x):d("scale",[this.x,this.y].join(", ")):d("scale3d",[this.x,this.y,this.z].join(", "))}},a.prototype={constructor:a,toString:function(){return d("rotate",angle+"deg")}},r.prototype={constructor:r,toString:function(){return 0!==this.x&&0===this.y?d("skewX",this.x+"deg"):0!==this.y&&0===this.x?d("skewY",this.y+"deg"):d("skew",[this.x+"deg",this.y+"deg"].join(", "))}},l.prototype={constructor:a,toString:function(){return d("rotate3d",[this.x,this.y,this.z,this.angle].join(", ")+"deg")}}},{}],63:[function(t,e,i){function n(t,e){window.matchMedia&&(h=!0,window.matchMedia(t).addListener(e))}function o(){return h?c:s()}function s(){return null!=r?r:"devicePixelRatio"in window?Math.max(Math.round(window.devicePixelRatio),1):"screen"in window&&"deviceXDPI"in window.screen&&"logicalXDPI"in window.screen?Math.max(Math.round(window.screen.deviceXDPI/window.screen.logicalXDPI),1):1}function a(){c=s();var t=new l.Event("device-pixel-ratio-change");t.value=o(),o.dispatchEvent(t)}var r,l=t("@maps/dom-events"),h=!1,c=s();n("(-webkit-device-pixel-ratio: 1)",a),n("(-moz-device-pixel-ratio: 1)",a),l.EventTarget(o),e.exports=o,e.exports.roundToDevicePixel=function(t,e){var i=e||o();return Math.round(t*i)/i},e.exports.simulateDevicePixelRatio=function(t){r=t,c=null==t?s():r,a()}},{"@maps/dom-events":64}],64:[function(t,e,i){function n(t){if(t)return t.addEventListener=n.prototype.addEventListener,t.removeEventListener=n.prototype.removeEventListener,t.dispatchEvent=n.prototype.dispatchEvent,t}function o(t){this.type=t,this.target=null,this.defaultPrevented=!1,this._stoppedPropagation=!1}n.prototype={constructor:n,addEventListener:function(t,e,i){if(i=i||null,!t)return!1;if(!e)return!1;this._listeners||(this._listeners={});var n=this._listeners[t];n||(n=this._listeners[t]=[]);for(var o=0;o<n.length;++o)if(n[o].listener===e&&n[o].thisObject===i)return!1;return n.push({thisObject:i,listener:e}),!0},removeEventListener:function(t,e,i){if(t=t||null,e=e||null,i=i||null,!this._listeners)return!1;if(!t){for(t in this._listeners)this.removeEventListener(t,e,i);return!1}var n=this._listeners[t];if(!n)return!1;for(var o=!1,s=n.length-1;s>=0;--s)if(e&&n[s].listener===e&&n[s].thisObject===i||!e&&i&&n[s].thisObject===i){n.splice(s,1),o=!0;break}return n.length||delete this._listeners[t],Object.keys(this._listeners).length||delete this._listeners,o},dispatchEvent:function(t){if(t.target=this,!this._listeners||!this._listeners[t.type]||t._stoppedPropagation)return!0;for(var e=this._listeners[t.type].slice(0),i=0;i<e.length;++i){var n=e[i].thisObject,o=e[i].listener;if(n||"function"==typeof o||"function"!=typeof o.handleEvent?o.call(n,t):o.handleEvent.call(o,t),t._stoppedPropagation)break}return!t.defaultPrevented}},o.prototype={constructor:o,stopPropagation:function(){this._stoppedPropagation=!0},preventDefault:function(){this.defaultPrevented=!0}},e.exports={EventTarget:n,Event:o}},{}],65:[function(t,e,i){var n=t("./src/types"),o=t("./src/functions"),s=t("./src/webgl");e.exports=function(t,e){t=t||0,e=e||0;var i={};return i.shouldTryCSR=[n,o,s].every(function(n){var o=n.fn(t,e);return i[n.name]=o,"object"==typeof o?o.capable:o}),i}},{"./src/functions":66,"./src/types":67,"./src/webgl":68}],66:[function(t,e,i){e.exports={name:"functions",fn:function(){return!!(Array.prototype.fill&&Uint8Array.from&&window.btoa)}}},{}],67:[function(t,e,i){e.exports={name:"types",fn:function(){return!!(Float32Array&&Float64Array&&Uint8Array&&Int32Array)}}},{}],68:[function(t,e,i){function n(t,e,i){return t.getParameter(t.MAX_TEXTURE_SIZE)>=4096&&t.getParameter(t.MAX_RENDERBUFFER_SIZE)>=2*e&&t.getParameter(t.MAX_RENDERBUFFER_SIZE)>=2*i&&t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>=8&&t.getParameter(t.MAX_VARYING_VECTORS)>=8&&t.getParameter(t.STENCIL_BITS)>=8}function o(t){return{VERSION:t.getParameter(t.VERSION),MAX_RENDERBUFFER_SIZE:t.getParameter(t.MAX_RENDERBUFFER_SIZE)}}e.exports={name:"webGL",fn:function(t,e){var i=document.createElement("canvas");i.width=i.height=0;var s=i.getContext("webgl",{antialias:!1,stencil:!0,failIfMajorPerformanceCaveat:!0});return!!s&&{capable:n(s,t,e),gpuInfo:o(s)}}}},{}],69:[function(t,e,i){"use strict";function n(t,e,i,n){1===arguments.length&&t&&"object"==typeof t?("x"in t&&(this.x=t.x),"y"in e&&(this.y=t.y),"z"in t&&(this.z=t.z),"w"in t&&(this.w=t.w)):arguments.length>0&&(this.x=t,arguments.length>1&&(this.y=e,arguments.length>2&&(this.z=i,arguments.length>3&&(this.w=n))))}n.prototype={_x:0,_y:0,_z:0,_w:1,get x(){return this._x},set x(t){if(null===t||isNaN(t))throw new Error("[DOMPoint] `"+t+"` set for x is not a number");this._x=t},get y(){return this._y},set y(t){if(null===t||isNaN(t))throw new Error("[DOMPoint] `"+t+"` set for y is not a number");this._y=t},get z(){return this._z},set z(t){if(null===t||isNaN(t))throw new Error("[DOMPoint] `"+t+"` set for z is not a number");this._z=t},get w(){return this._w},set w(t){if(null===t||isNaN(t))throw new Error("[DOMPoint] `"+t+"` set for w is not a number");this._w=t},matrixTransform:function(t){return console.warn("DOMPoint.matrixTransform is not implemented yet."),this}},e.exports=n},{}],70:[function(t,e,i){e.exports={Point:t("./point"),Size:t("./size"),Rect:t("./rect")}},{"./point":71,"./rect":72,"./size":73}],71:[function(t,e,i){function n(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}e.exports=n,n.Zero=new n,n.fromEvent=function(t){var e="undefined"!=typeof TouchEvent&&t instanceof TouchEvent?t.targetTouches[0]:t;return new n(e.pageX,e.pageY)},n.fromEventInElement=function(t,e){var i="undefined"!=typeof TouchEvent&&t instanceof TouchEvent?t.targetTouches[0]:t,o=window.webkitConvertPointFromPageToNode(e,new WebKitPoint(i.pageX,i.pageY));return new n(o.x,o.y)},n.prototype={constructor:n,toString:function(){return"Point["+[this.x,this.y,this.z].join(", ")+"]"},copy:function(){return new n(this.x,this.y,this.z)},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},distanceToPoint:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2))}}},{}],72:[function(t,e,i){function n(t,e,i,n){this.origin=new o(t||0,e||0),this.size=new s(i||0,n||0)}e.exports=n;var o=t("./point"),s=t("./size");n.Zero=new n,n.rectFromClientRect=function(t){return new n(t.left,t.top,t.width,t.height)},n.unionOfRects=function(t){for(var e=t[0],i=1;i<t.length;++i)e=e.unionWithRect(t[i]);return e},n.prototype={constructor:n,toString:function(){return"Rect["+[this.origin.x,this.origin.y,this.size.width,this.size.height].join(", ")+"]"},copy:function(){return new n(this.origin.x,this.origin.y,this.size.width,this.size.height)},equals:function(t){return this.origin.equals(t.origin)&&this.size.equals(t.size)},inset:function(t,e,i,o){return new n(this.origin.x+t,this.origin.y+e,this.size.width-t-i,this.size.height-e-o)},pad:function(t){return new n(this.origin.x-t,this.origin.y-t,this.size.width+2*t,this.size.height+2*t)},minX:function(){return this.origin.x},minY:function(){return this.origin.y},midX:function(){return this.origin.x+this.size.width/2},midY:function(){return this.origin.y+this.size.height/2},maxX:function(){return this.origin.x+this.size.width},maxY:function(){return this.origin.y+this.size.height},intersectionWithRect:function(t){var e=new n,i=Math.max(this.minX(),t.minX()),o=Math.min(this.maxX(),t.maxX());if(i>o)return e;var s=Math.max(this.minY(),t.minY()),a=Math.min(this.maxY(),t.maxY());return s>a?e:(e.origin.x=i,e.origin.y=s,e.size.width=o-i,e.size.height=a-s,e)},unionWithRect:function(t){var e=Math.min(this.minX(),t.minX()),i=Math.min(this.minY(),t.minY());return new n(e,i,Math.max(this.maxX(),t.maxX())-e,Math.max(this.maxY(),t.maxY())-i)},round:function(){return new n(Math.floor(this.origin.x),Math.floor(this.origin.y),Math.ceil(this.size.width),Math.ceil(this.size.height))}}},{"./point":71,"./size":73}],73:[function(t,e,i){function n(t,e){this.width=t||0,this.height=e||0}e.exports=n,n.Zero=new n,n.prototype={constructor:n,toString:function(){return"Size["+this.width+", "+this.height+"]"},copy:function(){return new n(this.width,this.height)},equals:function(t){return this.width===t.width&&this.height===t.height}}},{}],74:[function(t,e,i){var n=t("./js/gesture-recognizer");e.exports={GestureRecognizer:n,SupportsTouches:n.SupportsTouches,SupportsPointerEvents:n.SupportsPointerEvents,States:n.States,LongPress:t("./js/long-press"),Pan:t("./js/pan"),Pinch:t("./js/pinch"),Rotation:t("./js/rotation"),Swipe:t("./js/swipe"),Tap:t("./js/tap")}},{"./js/gesture-recognizer":75,"./js/long-press":76,"./js/pan":77,"./js/pinch":78,"./js/rotation":79,"./js/swipe":80,"./js/tap":81}],75:[function(t,e,i){function n(){o.EventTarget.call(this),this._targetTouches=[],this._lastKnownEventLocation=null,this._shouldHandleTrackingEvents=!1,this._domEvents=[],this.mode=n.Modes.Adaptive,this._enabled=!0,this._target=null,this.state=n.States.Possible,this.delegate=null}var o=t("@maps/dom-events"),s=t("@maps/geometry/point"),a=t("@maps/web-point-converter");n.Modes={Adaptive:"adaptive",Pointer:"pointer",Touch:"touch",Mouse:"mouse"},n.SupportsPointerEvents="PointerEvent"in window,n.SupportsTouches="createTouch"in document||"ontouchmove"in document,n.SupportsGestures=!!window.GestureEvent,n.SupportsGestures?n.SupportsPointerEvents?n.UseGesturesForRotation=n.UseGesturesForPinch=!n.SupportsTouches:(n.UseGesturesForRotation=!n.SupportsTouches,n.UseGesturesForPinch=!0):(n.UseGesturesForRotation=!1,n.UseGesturesForPinch=!1),n.States={Possible:"possible",Began:"began",Changed:"changed",Ended:"ended",Cancelled:"cancelled",Failed:"failed",Recognized:"ended"};var r={Pointer:{Start:"pointerdown",Move:"pointermove",End:"pointerup",Cancel:"pointercancel",GestureStart:"gesturestart",GestureChange:"gesturechange",GestureEnd:"gestureend",StateChange:"statechange"},Touch:{Start:"touchstart",Move:"touchmove",End:"touchend",Cancel:"touchcancel",GestureStart:"gesturestart",GestureChange:"gesturechange",GestureEnd:"gestureend",StateChange:"statechange"},Mouse:{Start:"mousedown",Move:"mousemove",End:"mouseup",Cancel:void 0,GestureStart:"gesturestart",GestureChange:"gesturechange",GestureEnd:"gestureend",StateChange:"statechange"}};n.prototype=Object.create(o.EventTarget.prototype,{mode:{get:function(){return this._mode},set:function(t){if(this._mode!==t){if(this._targetTouches.length)throw new Error("Cannot switch between modes in the middle of gesture.");switch(this._removeBaseListeners(),t){case n.Modes.Adaptive:n.SupportsPointerEvents?this.events=r.Pointer:n.SupportsTouches?this.events=r.Touch:this.events=r.Mouse;break;case n.Modes.Pointer:this.events=r.Pointer;break;case n.Modes.Touch:this.events=r.Touch;break;case n.Modes.Mouse:this.events=r.Mouse}this._mode=t,this._updateBaseListeners()}}},currentMode:{get:function(){if(this._mode===n.Modes.Adaptive)switch(this.events){case r.Pointer:return n.Modes.Pointer;case r.Touch:return n.Modes.Touch;case r.Mouse:return n.Modes.Mouse}return this._mode}},target:{get:function(){return this._target},set:function(t){this._target!==t&&(this._removeBaseListeners(),t&&(this._target=t,this._initRecognizer()))}},numberOfTouches:{get:function(){return this._targetTouches.length}},enabled:{get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,t||(0===this.numberOfTouches?(this._removeTrackingListeners(),this.reset()):this.enterCancelledState()),this._updateBaseListeners())}},domEvents:{get:function(){return this._domEvents}}}),n.prototype.constructor=n,n.prototype.modifierKeys={alt:!1,ctrl:!1,meta:!1,shift:!1},n.prototype.reset=function(){},n.prototype.preventDefault=function(t){"touchmove"!==t.type&&"pointer"!==t.type.substr(0,7)&&t.preventDefault()},n.prototype.locationInElement=function(t){var e=new s,i=this._targetTouches;if(this._lastKnownEventLocation)e.x=this._lastKnownEventLocation.pageX,e.y=this._lastKnownEventLocation.pageY;else{for(var n=0,o=i.length;n<o;++n){var r=i[n];e.x+=r.pageX,e.y+=r.pageY}e.x/=o,e.y/=o}return t?a.fromPageToElement(t,e):e},n.prototype.locationInClient=function(){var t=new s,e=this._targetTouches;if(this._lastKnownEventLocation)t.x=this._lastKnownEventLocation.clientX,t.y=this._lastKnownEventLocation.clientY;else{for(var i=0,n=e.length;i<n;++i){var o=e[i];t.x+=o.clientX,t.y+=o.clientY}t.x/=n,t.y/=n}return t},n.prototype.locationOfTouchInElement=function(t,e){var i=this._targetTouches[t];if(!i)return new s;var n=new s(i.pageX,i.pageY);return e?a.fromPageToElement(e,n):n},n.prototype.useGestures=!1,n.prototype.touchesBegan=function(t){t.currentTarget===this._target&&(this._shouldHandleTrackingEvents=!0,window.addEventListener(this.events.Move,this,!0),window.addEventListener(this.events.End,this,!0),this.events.Cancel&&window.addEventListener(this.events.Cancel,this,!0),this.enterPossibleState())},n.prototype.touchesMoved=function(t){},n.prototype.touchesEnded=function(t){},n.prototype.touchesCancelled=function(t){},n.prototype.gestureBegan=function(t){t.currentTarget===this._target&&(window.addEventListener(this.events.GestureChange,this,!0),window.addEventListener(this.events.GestureEnd,this,!0),this.enterPossibleState())},n.prototype.gestureChanged=function(t){},n.prototype.gestureEnded=function(t){},n.prototype.enterPossibleState=function(){this._setStateAndNotifyOfChange(n.States.Possible)},n.prototype.enterBeganState=function(){!this.delegate||"function"!=typeof this.delegate.gestureRecognizerShouldBegin||this.delegate.gestureRecognizerShouldBegin(this)?this._setStateAndNotifyOfChange(n.States.Began):this.enterFailedState()},n.prototype.enterEndedState=function(){this._setStateAndNotifyOfChange(n.States.Ended),this._removeTrackingListeners(),this.reset()},n.prototype.enterCancelledState=function(){this._setStateAndNotifyOfChange(n.States.Cancelled),this._removeTrackingListeners(),this.reset()},n.prototype.enterFailedState=function(){this._setStateAndNotifyOfChange(n.States.Failed),this._removeTrackingListeners(),this.reset()},n.prototype.enterChangedState=function(){this._setStateAndNotifyOfChange(n.States.Changed)},n.prototype.enterRecognizedState=function(){this._setStateAndNotifyOfChange(n.States.Recognized)},n.prototype.handleEvent=function(t){this._shouldCountAndHandleTouch(t)&&(this._updateTargetTouches(t),this._updateKeyboardModifiers(t),this._handleTouches(t))},n.prototype._handleTouches=function(t){if(this._shouldHandleTouch(t))switch(t.type){case this.events.Start:this.touchesBegan(t);break;case this.events.Move:this.touchesMoved(t);break;case this.events.End:this.touchesEnded(t);break;case this.events.Cancel:this.touchesCancelled(t);break;case this.events.GestureStart:this.gestureBegan(t);break;case this.events.GestureChange:this.gestureChanged(t);break;case this.events.GestureEnd:this.gestureEnded(t)}},n.prototype._shouldCountAndHandleTouch=function(t){if(this.events!==r.Pointer||!(t instanceof PointerEvent))return!0;var e=this._targetTouches[0];return!e||t.pointerType===e.pointerType||e.pointerId===t.pointerId},n.prototype._shouldHandleTouch=function(t){return this.events!==r.Pointer||(t.type===this.events.Start||t.type===this.events.GestureStart||t.type===this.events.GestureChange||t.type===this.events.GestureEnd||this._shouldHandleTrackingEvents)},n.prototype._initRecognizer=function(){this.reset(),this.state=n.States.Possible,this._updateBaseListeners()},n.prototype._removeBaseListeners=function(){this._target&&(this._target.removeEventListener(this.events.Start,this),this.useGestures&&this._target.removeEventListener(this.events.GestureStart,this),this.events===r.Pointer&&(this._targetTouches=[],window.removeEventListener(this.events.End,this,!0),window.removeEventListener(this.events.Cancel,this,!0)))},n.prototype._updateBaseListeners=function(){this._target&&(this._enabled?(this._target.addEventListener(this.events.Start,this),this.useGestures&&this._target.addEventListener(this.events.GestureStart,this),this.events===r.Pointer&&(window.addEventListener(this.events.End,this,!0),window.addEventListener(this.events.Cancel,this,!0))):this._removeBaseListeners())},n.prototype._removeTrackingListeners=function(){this._shouldHandleTrackingEvents=!1,window.removeEventListener(this.events.Move,this,!0),this.events!==r.Pointer&&(window.removeEventListener(this.events.End,this,!0),window.removeEventListener(this.events.Cancel,this,!0)),window.removeEventListener(this.events.GestureChange,this,!0),window.removeEventListener(this.events.GestureEnd,this,!0)},n.prototype._setStateAndNotifyOfChange=function(t){this.state=t,this.dispatchEvent(new o.Event(this.events.StateChange))},n.prototype._setLastKnownSinglePointLocation=function(t){this._lastKnownEventLocation={clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY}},n.prototype._updateTargetTouches=function(t){if(t.type!==this.events.GestureStart&&t.type!==this.events.GestureChange&&t.type!==this.events.GestureEnd)if(this.events!==r.Mouse){var e,i,n;if(this.events===r.Touch){if(t.type===this.events.Start){for(this._targetTouches=[],i=0,n=(e=t.targetTouches).length;i<n;++i)this._targetTouches.push(e[i]);return void(this._lastKnownEventLocation=null)}if(t.type===this.events.Move){var o=this._targetTouches.map(function(t){return t.identifier});for(this._targetTouches=[],i=0,n=(e=t.touches).length;i<n;++i){var s=e[i];-1!==o.indexOf(s.identifier)&&this._targetTouches.push(s)}return void(this._lastKnownEventLocation=null)}var a=t.touches,l=[];for(i=0,n=a.length;i<n;++i)l.push(a[i].identifier);return this._targetTouches=this._targetTouches.filter(function(t){return-1!==l.indexOf(t.identifier)}),void(0===this._targetTouches.length?this._setLastKnownSinglePointLocation(t):this._lastKnownEventLocation=null)}if(t.type===this.events.Start)return this._targetTouches.push(t),void(this._lastKnownEventLocation=null);if(t.type===this.events.Move)return this._targetTouches=this._targetTouches.map(function(e){return e.pointerId!==t.pointerId?e:t}),void(this._lastKnownEventLocation=null);this._targetTouches=this._targetTouches.filter(function(e){return e.pointerId!==t.pointerId}),0===this._targetTouches.length?this._setLastKnownSinglePointLocation(t):this._lastKnownEventLocation=null}else t.type===this.events.End?(this._targetTouches=[],this._setLastKnownSinglePointLocation(t)):(this._targetTouches=[t],this._lastKnownEventLocation=null);else this._setLastKnownSinglePointLocation(t)},n.prototype._updateKeyboardModifiers=function(t){this.modifierKeys.alt=t.altKey,this.modifierKeys.ctrl=t.ctrlKey,this.modifierKeys.meta=t.metaKey,this.modifierKeys.shift=t.shiftKey},n.prototype._distance=function(){var t=this._targetTouches[0],e=new s(t.pageX,t.pageY),i=this._targetTouches[1],n=new s(i.pageX,i.pageY);return e.distanceToPoint(n)},e.exports=n},{"@maps/dom-events":64,"@maps/geometry/point":71,"@maps/web-point-converter":101}],76:[function(t,e,i){function n(){this.allowableMovement=10,this.minimumPressDuration=500,this.numberOfTouchesRequired=1,this.allowsRightMouseButton=!1,o.call(this)}var o=t("./gesture-recognizer");(n.prototype=Object.create(o.prototype)).constructor=n,n.prototype.touchesBegan=function(t){t.currentTarget===this.target&&(2!==t.button||this.allowsRightMouseButton)&&(o.prototype.touchesBegan.call(this,t),this.numberOfTouches===this.numberOfTouchesRequired?(this._startPoint=this.locationInElement(),this._timerId=window.setTimeout(this.enterRecognizedState.bind(this),this.minimumPressDuration)):this.enterFailedState())},n.prototype.touchesMoved=function(t){this.preventDefault(t),this._startPoint.distanceToPoint(this.locationInElement())>this.allowableMovement&&this.enterFailedState()},n.prototype.touchesCancelled=n.prototype.touchesEnded=function(t){this.state===o.States.Recognized?(this.preventDefault(t),this.numberOfTouches!==this.numberOfTouchesRequired&&this.enterFailedState()):this.enterFailedState()},n.prototype.reset=function(){window.clearTimeout(this._timerId),delete this._timerId},e.exports=n},{"./gesture-recognizer":75}],77:[function(t,e,i){function n(){return{start:new r,end:new r,dt:0}}function o(t){return t.dt<1?new r:new r((t.end.x-t.start.x)/t.dt*1e3,(t.end.y-t.start.y)/t.dt*1e3)}function s(){a.call(this)}var a=t("./gesture-recognizer"),r=t("@maps/geometry/point");(s.prototype=Object.create(a.prototype,{velocity:{get:function(){if(Date.now()-this._lastTouchTime>100)return new r;var t=o(this._velocitySample);if(a.SupportsTouches&&this._previousVelocitySample.dt>0){var e=o(this._previousVelocitySample);t.x=.25*t.x+.75*e.x,t.y=.25*t.y+.75*e.y}return t}}})).constructor=s,s.prototype.minimumNumberOfTouches=1,s.prototype.maximumNumberOfTouches=1e5,s.prototype.translationThreshold=10,s.prototype.touchesBegan=function(t){t.currentTarget===this.target&&(t instanceof MouseEvent&&0!==t.button||(a.prototype.touchesBegan.call(this,t),this._numberOfTouchesIsAllowed()?(this._lastTouchTime=Date.now(),this._resetTrackedLocations(),1===this.numberOfTouches&&(this._travelledMinimumDistance=!1)):this.enterFailedState()))},s.prototype.touchesMoved=function(t){this.preventDefault(t);var e=Date.now(),i=this.locationInElement(),n=e-this._lastTouchTime;n>8&&(this._previousVelocitySample.start=this._velocitySample.start.copy(),this._previousVelocitySample.end=this._velocitySample.end.copy(),this._previousVelocitySample.dt=this._velocitySample.dt,this._velocitySample.start=this._lastTouchLocation.copy(),this._velocitySample.end=i,this._velocitySample.dt=n),this._travelledMinimumDistance?(this.translation.x+=i.x-this._lastTouchLocation.x,this.translation.y+=i.y-this._lastTouchLocation.y,this.enterChangedState()):this._canBeginWithTravelledDistance(new r(i.x-this._translationOrigin.x,i.y-this._translationOrigin.y))&&(this._travelledMinimumDistance=!0,this.enterBeganState()),this._lastTouchTime=e,this._lastTouchLocation=i},s.prototype.touchesEnded=function(t){this._numberOfTouchesIsAllowed()?this._resetTrackedLocations():this._travelledMinimumDistance?this.enterEndedState():this.enterFailedState()},s.prototype.reset=function(){this._velocitySample=n(),this._previousVelocitySample=n(),this._gestures=[],this.translation=new r,delete this._travelledMinimumDistance},s.prototype._travelledMinimumDistance=!1,s.prototype._previousVelocitySample=n(),s.prototype._velocitySample=n(),s.prototype._canBeginWithTravelledDistance=function(t){return Math.abs(t.x)>=this.translationThreshold||Math.abs(t.y)>=this.translationThreshold},s.prototype._numberOfTouchesIsAllowed=function(){return this.numberOfTouches>=this.minimumNumberOfTouches&&this.numberOfTouches<=this.maximumNumberOfTouches},s.prototype._resetTrackedLocations=function(){var t=this.locationInElement();this._lastTouchLocation=t,this._translationOrigin=t},e.exports=s},{"./gesture-recognizer":75,"@maps/geometry/point":71}],78:[function(t,e,i){function n(){o.call(this)}var o=t("./gesture-recognizer");(n.prototype=Object.create(o.prototype,{velocity:{get:function(){var t=this._gestures[this._gestures.length-1];if(!t)return this._velocity;var e=Date.now()-(t.timeStamp+100);if(e<=0)return this._velocity;var i=Math.max((500-e)/500,0);return this._velocity*i}}})).constructor=n,n.prototype.scaleThreshold=0,n.prototype.useGestures=o.UseGesturesForPinch,n.prototype.touchesBegan=function(t){if(t.currentTarget===this.target){if(this.useGestures){if(2!==this.numberOfTouches)return}else{if(this.numberOfTouches>2)return void this.enterFailedState();if(2!==this.numberOfTouches)return;this._startDistance=this._distance(),this._recordGesture(1),this._scaledMinimumAmount=!1,this._updateStateWithEvent(t)}o.prototype.touchesBegan.call(this,t)}},n.prototype.touchesMoved=function(t){this.useGestures||2===this.numberOfTouches&&this._updateStateWithEvent(t)},n.prototype.touchesEnded=function(t){this.useGestures||this.numberOfTouches>=2||!this._startDistance||(this._scaledMinimumAmount?this.enterEndedState():this.enterFailedState())},n.prototype.gestureBegan=function(t){o.prototype.gestureBegan.call(this,t),this._recordGesture(t.scale),this._scaledMinimumAmount=!1,this._updateStateWithEvent(t),this.preventDefault(t)},n.prototype.gestureChanged=function(t){this.preventDefault(t),this._updateStateWithEvent(t)},n.prototype.gestureEnded=function(t){this._scaledMinimumAmount?this.enterEndedState():this.enterFailedState()},n.prototype.reset=function(){this.scale=1,this._velocity=0,this._gestures=[],delete this._startDistance},n.prototype._scaledMinimumAmount=!1,n.prototype._recordGesture=function(t){var e=Date.now(),i=this._gestures.push({scale:t,timeStamp:e});if(!(i<=2)){for(var n=this._gestures[i-1].scale>=this._gestures[i-2].scale,o=i-3;o>=0;--o){var s=this._gestures[o];if(e-s.timeStamp>100||this._gestures[o+1].scale>=s.scale!==n)break}o>0&&(this._gestures=this._gestures.slice(o+1))}},n.prototype._updateStateWithEvent=function(t){var e=this.useGestures?t.scale:this._distance()/this._startDistance;if(this._scaledMinimumAmount){this._recordGesture(e);var i=this._gestures[0],n=e-i.scale,o=Date.now()-i.timeStamp;this._velocity=0===o?0:n/o*1e3,this.scale*=e/this._gestures[this._gestures.length-2].scale,this.enterChangedState()}else Math.abs(1-e)>=this.scaleThreshold&&(this._scaledMinimumAmount=!0,this.scale=1,this.enterBeganState())},e.exports=n},{"./gesture-recognizer":75}],79:[function(t,e,i){function n(t){for(;t>180;)t-=360;for(;t<-180;)t+=360;return t}function o(){s.call(this),this.rotation=0}var s=t("./gesture-recognizer"),a=t("@maps/geometry/point");(o.prototype=Object.create(s.prototype,{velocity:{get:function(){return this._velocity}},rotation:{get:function(){return this._rotation},set:function(t){this._rotation=n(t)}}})).constructor=o,o.prototype.useGestures=s.UseGesturesForRotation,o.prototype.touchesBegan=function(t){this.useGestures||t.currentTarget===this.target&&2===this.numberOfTouches&&(s.prototype.touchesBegan.call(this,t),this.numberOfTouches>2?this.enterFailedState():(this._startAngle=this._angle(),this._startDistance=this._distance(),this.rotation=0,t.rotation=0,t.scale=1,this._lastEvent=t))},o.prototype.touchesMoved=function(t){this.useGestures||2===this.numberOfTouches&&(t.rotation=this._angle()-this._startAngle,t.scale=this._distance()/this._startDistance,this._handleEvent(t))},o.prototype.touchesEnded=function(t){this.useGestures||this.numberOfTouches>=2||null===this._startAngle||(this.state===s.States.Changed?this.enterEndedState():this.enterFailedState())},o.prototype.gestureBegan=function(t){this.useGestures&&(s.prototype.gestureBegan.call(this,t),this.preventDefault(t),this.rotation=0,t.rotation=0,t.scale=1,this._lastEvent=t)},o.prototype.gestureChanged=function(t){this.useGestures&&(this.preventDefault(t),this._handleEvent(t))},o.prototype.gestureEnded=function(t){this.useGestures&&this.enterEndedState()},o.prototype.reset=function(){this.rotation=0,this._velocity=0,this._lastEvent=null,this._startAngle=null},o.prototype._handleEvent=function(t){var e=this._lastEvent,i=t.rotation-e.rotation,n=t.scale-e.scale,o=t.timeStamp-e.timeStamp;if(this._lastEvent=t,this.state!==s.States.Possible)o>0&&(this._velocity=i/o*1e3),this.rotation+=i,this.enterChangedState();else{var a=Math.abs(t.rotation)<8,r=Math.abs(i/90)<Math.abs(n),l=Math.abs(i)>=135;if(a||r||l)return;this.enterBeganState()}},o.prototype._angle=function(){var t=this._targetTouches[0],e=new a(t.pageX,t.pageY),i=this._targetTouches[1],n=new a(i.pageX,i.pageY);return 180*Math.atan2(e.y-n.y,e.x-n.x)/Math.PI},e.exports=o},{"./gesture-recognizer":75,"@maps/geometry/point":71}],80:[function(t,e,i){function n(){this.numberOfTouchesRequired=1,this.direction=n.Directions.Right,o.call(this)}var o=t("./gesture-recognizer"),s=t("@maps/geometry/point");n.Directions={Right:1,Left:2,Up:4,Down:8},n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype.touchesBegan=function(t){t.currentTarget===this.target&&(this.numberOfTouchesRequired===this.numberOfTouches?(o.prototype.touchesBegan.call(this,t),this._translationOrigin=this.locationInElement()):this.enterFailedState())},n.prototype.touchesMoved=function(t){if(this.numberOfTouchesRequired===this.numberOfTouches){this.preventDefault(t);var e=this.locationInElement(),i=new s(e.x-this._translationOrigin.x,e.y-this._translationOrigin.y);this.state!==o.States.Recognized&&this.direction===n.Directions.Right&&i.x>100&&Math.abs(i.x)>Math.abs(i.y)&&this.enterRecognizedState(),this.state!==o.States.Recognized&&this.direction===n.Directions.Left&&i.x<-100&&Math.abs(i.x)>Math.abs(i.y)&&this.enterRecognizedState(),this.state!==o.States.Recognized&&this.direction===n.Directions.Up&&i.y<-100&&Math.abs(i.y)>Math.abs(i.x)&&this.enterRecognizedState(),this.state!==o.States.Recognized&&this.direction===n.Directions.Down&&i.y>100&&Math.abs(i.y)>Math.abs(i.x)&&this.enterRecognizedState()}else this.enterFailedState()},n.prototype.touchesEnded=function(t){this.enterFailedState()},e.exports=n},{"./gesture-recognizer":75,"@maps/geometry/point":71}],81:[function(t,e,i){function n(){this.numberOfTapsRequired=1,this.numberOfTouchesRequired=1,this.allowsRightMouseButton=!1,o.call(this)}var o=t("./gesture-recognizer"),s=t("@maps/web-point-converter"),a=t("@maps/geometry/point");(n.prototype=Object.create(o.prototype)).constructor=n,n.prototype.touchesBegan=function(t){t.currentTarget===this.target&&(2!==t.button||this.allowsRightMouseButton)&&(o.prototype.touchesBegan.call(this,t),this.numberOfTouches===this.numberOfTouchesRequired?(this._domEvents.push(t),this._startPoint=o.prototype.locationInElement.call(this),this._startClientPoint=o.prototype.locationInClient.call(this),this._rewindTimer(750)):this.enterFailedState())},n.prototype.touchesMoved=function(t){this.preventDefault(t);var e;switch(this.currentMode){case o.Modes.Pointer:e="touch"===t.pointerType?40:2;break;case o.Modes.Touch:e=40;break;case o.Modes.Mouse:e=2}this._startPoint.distanceToPoint(o.prototype.locationInElement.call(this))>e&&this.enterFailedState()},n.prototype.touchesEnded=function(t){this._taps++,this._domEvents.push(t),this._taps===this.numberOfTapsRequired&&(this.preventDefault(t),this.enterRecognizedState(),this.reset()),this._rewindTimer(350)},n.prototype.reset=function(){this._taps=0,this._clearTimer(),this._domEvents=[]},n.prototype.locationInElement=function(t){var e=this._startPoint||new a;return t?s.fromPageToElement(t,e):e},n.prototype.locationInClient=function(){return this._startClientPoint||new a},n.prototype._clearTimer=function(){window.clearTimeout(this._timerId),delete this._timerId},n.prototype._rewindTimer=function(t){this._clearTimer(),this._timerId=window.setTimeout(this._timerFired.bind(this),t)},n.prototype._timerFired=function(){this.enterFailedState()},e.exports=n},{"./gesture-recognizer":75,"@maps/geometry/point":71,"@maps/web-point-converter":101}],82:[function(t,e,i){var n=Math.log(2),o=[/MSIE [5-9]\./,/Firefox\/[1-9]\./,/Firefox\/[1-2][0-9]\./,/Firefox\/3[0-1]\./,/Firefox\/[0-9]\./,/Firefox\/[1-2][0-9]\./,/Firefox\/3[0-6]\./,/Android [0-3]\./,/Android 4\.[0-3]\./],s=[/\(Macintosh; Intel Mac OS X 10.9*\)*/,/\(Macintosh; Intel Mac OS X 10_9*\)*/,/\(Macintosh; Intel Mac OS X 10_??;*\)*/,/\(Macintosh; Intel Mac OS X 10.??;*\)*/,/\(Macintosh; Intel Mac OS X 10_??_*\)*/,/\(Macintosh; Intel Mac OS X 10.??.*\)*/,/\(Macintosh; Intel Mac OS X 10_??\)*/,/\(Macintosh; Intel Mac OS X 10.??\)*/,/iP(hone|od|ad)/],a={KeyCodes:{Tab:9,Enter:13,Escape:27,SpaceBar:32,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40},get iOSVersion(){if(/iP(hone|od|ad)/.test(navigator.platform)){var t=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3]||0,10)]}return null},noop:function(){},isIE10:function(){return/MSIE 10/i.test(navigator.userAgent)},isEdge:function(){return/Edge\//i.test(navigator.userAgent)},isIEAndNotEdge:function(){return/MSIE|Trident\//i.test(navigator.userAgent)},isNode:function(){return!1},isUnsupportedBrowser:function(t){return o.some(function(e){return e.test(t)})},hasMapsApp:function(t){return s.some(function(e){return e.test(t)})},mod:function(t,e){return t-e*Math.floor(t/e)},log2:function(t){return Math.log(t)/n},clamp:function(t,e,i){return Math.max(e,Math.min(t,i))},inheritPrototype:function(t,e,i){var n={constructor:{enumerable:!0,value:e}};return Object.keys(i).forEach(function(t){var e=Object.getOwnPropertyDescriptor(i,t);e&&(n[t]=e)}),Object.create(t.prototype,n)},checkValueIsInEnum:function(t,e){return Object.keys(e).some(function(i){return e[i]===t})},required:function(t,e,i){if("checkNull"in(i=i||{})||(i.checkNull=!0),void 0===t||i.checkNull&&null===t)throw new Error(e||"Missing parameter");return this},checkType:function(t,e,i){if(typeof t!==e)throw new TypeError(i||"Expected `"+e+"` but got `"+typeof t+"`");if("number"===e&&isNaN(t))throw new TypeError(i||"Expected `"+e+"` but got `NaN`");if("object"===e&&t instanceof Array)throw new TypeError(i||"Expected a non-array object but got an array");return this},checkInstance:function(t,e,i){if(!(t instanceof e))throw new Error(i||"Unexpected object instance");return this},checkElement:function(t,e){if(!this.isElement(t))throw new Error(e||"Expected an Element");return this},checkArray:function(t,e){if(!Array.isArray(t))throw new Error(e||"Expected an array");return this},checkOptions:function(t,e){return null!==t&&void 0!==t?this.checkType(t,"object",e||"[MapKit] The `options` parameter is not a valid object."):t={},t},isElement:function(t){return t instanceof window.Node&&t.nodeType===window.Node.ELEMENT_NODE},get supportsLocalStorage(){if("_supportsLocalStorage"in this)return this._supportsLocalStorage;if(this._supportsLocalStorage=!1,a.isNode())return!1;try{if(!window.localStorage)return!1;if("function"!=typeof window.localStorage.setItem||"function"!=typeof window.localStorage.getItem||"function"!=typeof window.localStorage.removeItem)return!1;var t="storageTest";if(window.localStorage.setItem(t,t),window.localStorage.getItem(t)!==t)return!1;window.localStorage.removeItem(t),this._supportsLocalStorage=!0}catch(t){return!1}return this._supportsLocalStorage},fillTemplate:function(t,e,i){return t.replace(/{{(.*?)}}/g,function(t,n){var o=e[n];if(i&&null==o)throw new Error("fillTemplate: Missing value for parameter: "+n);return o})},xhr:function(t){var e;return(e=new XMLHttpRequest).addEventListener("load",t),e.addEventListener("error",t),e.addEventListener("timeout",t),e},parseURL:function(t){var e=document.createElement("a");return e.href=t,e.protocol||(e.protocol=location.protocol),["href","protocol","hostname","port","pathname","search","hash"].reduce(function(t,i){return t[i]=e[i],t},{})},toQueryString:function(t,e){return null===t||"object"!=typeof t?"":(e||Object.keys(t)).reduce(function(e,i){var n=t[i];return n&&e.push(encodeURIComponent(i)+"="+encodeURIComponent(n)),e},[]).join("&")},splitStringAtSubStringAndReplace:function(t){var e=[],i=t.text.toLowerCase().indexOf(t.subString.toLowerCase());if(t.text&&!(i<0)&&t.replaceSubString){var n=t.text.substr(0,i);n&&e.push(t.replacePre?t.replacePre(n):n);var o=t.text.substr(i,t.subString.length);e.push(t.replaceSubString(t.subString,o));var s=t.text.substr(i+t.subString.length);return s&&e.push(t.replacePost?t.replacePost(s):s),e}},isSameOrigin:function(t,e){return t=this.parseURL(t),e=this.parseURL(e),t.hostname===e.hostname&&t.protocol===e.protocol},capitalize:function(t){return t?t[0].toUpperCase()+t.substr(1).toLowerCase():t},generateSessionIdValue:function(){return Math.floor(1e15*(9*Math.random()+1))},doNotTrack:function(){var t=window&&(window.navigator&&(navigator.doNotTrack||navigator.msDoNotTrack)||window.doNotTrack);return"1"===t||"yes"===t},supportsTouches:function(){return"createTouch"in document},isSpaceKey:function(t){return t.keyCode===this.KeyCodes.SpaceBar},isEnterKey:function(t){return t.keyCode===this.KeyCodes.Enter},isTabKey:function(t){return t.keyCode===this.KeyCodes.Tab},createCanvas:function(){return document.createElement("canvas")},atob:function(t){return window.atob(t)}};e.exports=a},{}],83:[function(t,e,i){e.exports={Priority:t("./lib/priority"),State:t("./lib/state"),Loader:t("./lib/loader"),ImageLoader:t("./lib/image-loader"),XHRLoader:t("./lib/xhr-loader")}},{"./lib/image-loader":84,"./lib/loader":85,"./lib/priority":87,"./lib/state":88,"./lib/xhr-loader":89}],84:[function(t,e,i){function n(t,e){s.call(this,t,e),this._image=null}var o=t("@maps/js-utils"),s=t("./loader");n.prototype=o.inheritPrototype(s,n,{get image(){return this._image},get url(){return this._image.src},reuse:function(t,e){this.init(t,e)},loaderWillStart:function(){s.prototype.loaderWillStart.call(this),this._image||(this._image=document.createElement("img")),this._image.src=this._delegate.urlForImageLoader,this._image.complete?this.loaderDidSucceed():(this._image.addEventListener("load",this),this._image.addEventListener("error",this))},handleEvent:function(t){switch(t.type){case"error":this.loaderDidFail(t.target);break;case"load":this.loaderDidSucceed()}},_reset:function(){this._image&&(this._image.removeEventListener("load",this),this._image.removeEventListener("error",this)),s.prototype._reset.call(this)}}),e.exports=n},{"./loader":85,"@maps/js-utils":82}],85:[function(t,e,i){function n(t,e){this.init(t,e)}var o=t("./manager"),s=t("./state");n.prototype={constructor:n,get state(){return this._state},schedule:function(){this._state||(this._state=s.Waiting,o.schedule(this))},unschedule:function(){var t=!1;if(this._state===s.Waiting)t=o.unschedule(this);else{if(this._state!==s.Loading)return!1;o.loaderDidComplete(this),t=!0}return this._unscheduled=t,this._state=s.Canceled,"function"==typeof this._delegate.loaderDidCancel&&this._delegate.loaderDidCancel(this),this._reset(),t},loaderWillStart:function(){this._state=s.Loading,"function"==typeof this._delegate.loaderWillStart&&this._delegate.loaderWillStart(this)},loaderDidSucceed:function(t){this._state=s.Succeeded,o.loaderDidComplete(this),"function"==typeof this._delegate.loaderDidSucceed&&this._delegate.loaderDidSucceed(this,t),this._reset()},loaderDidFail:function(t){this._state=s.Failed,o.loaderDidComplete(this),"function"==typeof this._delegate.loaderDidFail&&this._delegate.loaderDidFail(this,t),this._reset()},init:function(t,e){this._delegate=e,this._state=s.Unscheduled,this._retries=0,this._timeoutID=-1,this.priority=t,this._unscheduled=!1},_reset:function(){clearTimeout(this._timeoutID)},_reload:function(){if(++this._retries<3){var t="number"==typeof this._delay?this._delay:1e4;this._timeoutID=setTimeout(this.loaderWillStart.bind(this),t)}else this.loaderDidFail()}},e.exports=n},{"./manager":86,"./state":88}],86:[function(t,e,i){function n(){for(var t in r){if(h[r[t]].length>0){if(c[r[t]]===l[r[t]])break;return h[r[t]][0]}if(c[r[t]]>0)break}return null}function o(){for(var t in r)if(h[r[t]].length>0)return h[r[t]].shift(),!0;return!1}function s(t){for(var e in r){var i=h[r[e]].indexOf(t);if(-1!==i)return h[r[e]].splice(i,1),!0}return!1}function a(){for(var t=n();t;)c[t.priority]++,o(),t.loaderWillStart(),t=n()}var r=t("./priority"),l=[];l[r.Highest]=12,l[r.High]=12,l[r.Medium]=4,l[r.Low]=1;var h=[],c=[];for(var d in r)h[r[d]]=[],c[r[d]]=0;e.exports={schedule:function(t){h[t.priority].push(t),a()},unschedule:function(t){return s(t)},loaderDidComplete:function(t){c[t.priority]--,a()}}},{"./priority":87}],87:[function(t,e,i){e.exports={Highest:0,High:1,Medium:2,Low:3}},{}],88:[function(t,e,i){e.exports={Unscheduled:0,Waiting:1,Loading:2,Canceled:3,Succeeded:4,Failed:5}},{}],89:[function(t,e,i){function n(t,e,i){var n=(i=i||{}).priority||a.Highest;s.call(this,n,e),this._url=t,this._method=i.method||"GET",this._retry=!0===i.retry,this._delay=i.delay,this._headers=i.headers,this._timeout=i.timeout,o.isNode()&&(this._origin=i.origin)}var o=t("@maps/js-utils"),s=t("./loader"),a=t("./priority");n.prototype=o.inheritPrototype(s,n,{get xhrData(){return this._xhrData},unschedule:function(){return this._xhr&&this._xhr.abort(),s.prototype.unschedule.call(this)},loaderWillStart:function(){s.prototype.loaderWillStart.call(this),this._xhr=o.xhr(this),this._xhr.open(this._method,this._url,!0),this._xhr.timeout=this._timeout,this._origin&&(this._xhr.setDisableHeaderCheck(!0),this._xhr.setRequestHeader("Origin",this._origin)),this._headers&&Object.keys(this._headers).forEach(function(t){this._xhr.setRequestHeader(t,this._headers[t])},this),("POST"!==this._method||this._xhrData||(this._xhrData=this._delegate.getDataToSend(this._xhr),this._xhrData))&&this._xhr.send(this._xhrData)},handleEvent:function(t){"error"===t.type||"timeout"===t.type||200!==t.target.status?this._retry?s.prototype._reload.call(this):this.loaderDidFail(t.target):"load"===t.type?this.loaderDidSucceed(t.target):console.log("Unhandled XHR event type:",t.type," status:",t.target.status)}}),e.exports=n},{"./loader":85,"./priority":87,"@maps/js-utils":82}],90:[function(t,e,i){e.exports={"ar-SA":6,"ca-ES":1,"cs-CZ":1,"da-DK":1,"de-DE":1,"el-GR":1,"en-GB":1,"en-US":0,"en-ZA":0,"es-ES":1,"es-MX":1,"fi-FI":1,"fr-CA":0,"fr-FR":1,"hi-IN":0,"hr-HR":1,"hu-HU":1,"id-ID":1,"it-IT":1,"iw-IL":0,"ja-JP":0,"ko-KR":0,"ms-MY":1,"nb-NO":1,"nl-NL":1,"pl-PL":1,"pt-BR":0,"pt-PT":1,"ro-RO":1,"ru-RU":1,"sk-SK":1,"sv-SE":1,"th-TH":0,"tr-TR":1,"uk-UA":1,"vi-VN":1,"zh-CN":1,"zh-HK":0,"zh-TW":0}},{}],91:[function(t,e,i){"use strict";e.exports={LangTag:t("./lib/lang-tag"),Locale:t("./lib/locale"),LanguageSupport:t("./lib/language-support"),L10n:t("./lib/l10n"),UseMetric:t("./lib/use-metric"),localizeDigits:t("./lib/localize-digits")}},{"./lib/l10n":92,"./lib/lang-tag":93,"./lib/language-support":94,"./lib/locale":95,"./lib/localize-digits":96,"./lib/use-metric":97}],92:[function(t,e,i){"use strict";function n(t){t.delegate.supportedLocales.forEach(function(e){var i=m.parse(e);s(t,i)})}function o(t){Object.keys(t.delegate.regionToScriptMap).forEach(function(e){t.scriptMap[e]=Object.create(null),Object.keys(t.delegate.regionToScriptMap[e]).forEach(function(i){var n=t.delegate.regionToScriptMap[e][i].toLowerCase();t.scriptMap[e][n]=i})})}function s(t,e){var i=e.language,n=e.region;t.supportMap[i]||(t.supportMap[i]=[]),-1!==t.delegate.primaryLocales.indexOf(e.tag)?t.supportMap[i].splice(0,0,n):t.supportMap[i].push(n)}function a(t,e){var i,n=e.language,o=e.region,s=e.script;"he"===n&&(n="iw");var a=t.supportMap[n];if(!a)return null;if(o&&(i=a.filter(function(t){return t.toUpperCase()===e.region.toUpperCase()})[0]),!i&&s){var r=t.scriptMap[n];r&&(i=r[s.toLowerCase()])}return i||(i=a[0]),new m(n,i)}function r(t,e,i){return new p(e,i,t.delegate,t.dowForBestMatch(e))}function l(t,e){if(t._requestedLocaleId=e,c(t,e)||(e=t.bestMatch(e,f)),!t.activeLocale||t.activeLocale.localeId!==e){var i=t.locales[e];i||(i=r(t,e)).ready?h(t,i):i.load(function(e,i){if(e)return console.error(e.toString()),void h(t,t.locales[f]);h(t,i)})}}function h(t,e){t.locales[e.localeId]||(t.locales[e.localeId]=e),t.activeLocale=e;var i=new u.Event(d.Events.LocaleChanged);i.locale=e,t.dispatchEvent(i)}function c(t,e){return-1!==t.delegate.supportedLocales.indexOf(e)}function d(t){this.delegate=t,this.locales=t.localesCache||Object.create(null),this.supportMap=t.supportCache||Object.create(null),this.scriptMap=t.scriptCache||Object.create(null),h(this,this.locales[f]||r(this,f,this.delegate.enUSDictionary)),n(this),o(this)}var u=t("@maps/dom-events"),p=t("./locale"),m=t("./lang-tag"),g=t("../data/locale-to-dow.json"),_=t("./localize-digits"),f="en-US";d.Events={LocaleChanged:"locale-changed"},d.Days={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},d.prototype={constructor:d,Events:d.Events,get:function(t,e){return this.activeLocale.get(t,e)},get localeId(){return this.activeLocale.localeId},set localeId(t){this._requestedLocaleId!==t&&l(this,t)},get loaded(){return this._requestedLocaleId&&this.bestMatch(this._requestedLocaleId,f)===this.localeId},get requestedLocaleId(){return this._requestedLocaleId},set requestedLocaleId(t){console.warn("l10n: requestedLocaleId can't be set, use localeId.")},get localeIds(){return Object.keys(this.locales)},get supportedLocaleIds(){return this.delegate.supportedLocales},bestMatch:function(t,e){var i=m.parse(t),n=null,o=i&&this.delegate.localesMap&&this.delegate.localesMap[i.tag];return o&&(i=m.parse(o)),e=e||null,i&&(n=a(this,i)),n?n.tag:e},dowForBestMatch:function(t,e){return g[this.bestMatch(t,e)]},digits:function(t){return _(t,this.localeId)}},u.EventTarget(d.prototype),e.exports=d},{"../data/locale-to-dow.json":90,"./lang-tag":93,"./locale":95,"./localize-digits":96,"@maps/dom-events":64}],93:[function(t,e,i){"use strict";function n(t,e,i){this.language=t.toLowerCase(),e&&(this.region=e.toUpperCase()),i&&(this.script=o.capitalize(i))}var o=t("@maps/js-utils");n.prototype={constructor:n,get tag(){var t=this.language;return this.region?t+"-"+this.region:this.script?t+"-"+this.script:t},toString:function(){var t="{ language: "+this.language;return this.region&&(t+=", region: "+this.region),this.script&&(t+=", script: "+this.script),t+" }"}},n.parse=function(t){var e,i,o;if(t&&"string"==typeof t){if(-1!==t.indexOf("_"))return console.warn("Invalid character: '_'"),null;var s=t.split("-");if((e=s[0]).length<2||e.length>4)return console.warn("Invalid language:",t),null;if(!(s.length<4))return console.warn("Don't know how to parse language tags with more than 3 parts:",t),null;for(var a=1;a<s.length;a++){var r=s[a];if(4===r.length)o=r;else{if(!(r.length>1&&r.length<4))return console.warn("Don't know how to parse:",t),null;i=r}}return new n(e,i,o)}return null},e.exports=n},{"@maps/js-utils":82}],94:[function(t,e,i){"use strict";function n(t,e){var i=t.language,n=t.region,o=t.script;e[i]||(e[i]={regions:[],scripts:[]}),n&&e[i].regions.push(n),o&&e[i].scripts.push(o)}function o(t,e,i){var n=t.language,o=t.region,s=t.script;"iw"===n&&(n="he");var r=i[n];if(!r)return null;if(o){var l=r.regions.filter(function(e){return e.toUpperCase()===t.region.toUpperCase()})[0];if(l)return new a(n,l);var h=e[n];h&&h[o.toUpperCase()]&&(t.script=s=h[o.toUpperCase()])}if(s){var c=r.scripts.filter(function(e){return e.toUpperCase()===t.script.toUpperCase()})[0];return new a(n,null,c)}return new a(n)}function s(t){this.supportMap=Object.create(null),this.delegate=t,this.delegate.supportedLocales.forEach(function(t){n(a.parse(t),this.supportMap)},this)}var a=t("./lang-tag");s.prototype={constructor:s,bestMatch:function(t,e){var i=a.parse(t),n=null,s=i&&this.delegate.localesMap&&this.delegate.localesMap[i.tag];return s&&(i=a.parse(s)),e=e||null,i&&(n=o(i,this.delegate.regionToScriptMap,this.supportMap)),n?n.tag:e}},s.parseAcceptLanguage=function(t){return t?t.split(",").map(function(t){if(!t)return null;var e=t.split(";");return{langTag:a.parse(e[0]),quality:e[1]?parseFloat(e[1].split("=")[1]):1}}).filter(function(t){return!!t}).sort(function(t,e){return e.quality-t.quality}):null},e.exports=s},{"./lang-tag":93}],95:[function(t,e,i){"use strict";function n(t,e,i,n){this.localeId=t,this._dict=e||{},this.ready=!!e,this.delegate=i,this.rtl=i.rtlLocales.indexOf(t)>-1,this.dow=n}var o=t("@maps/js-utils"),s=t("@maps/loaders").XHRLoader;n.prototype={constructor:n,get:function(t,e){var i=this._dict[t];return i?(e=e||{},o.fillTemplate(i,e,!0)):"["+t+"]"},load:function(t){var e=this,i=this.delegate.localeUrl.replace(/{{(.*?)}}/,this.localeId);new s(i,{loaderDidSucceed:function(i,n){var o;if(n.status<200||n.status>=300)return o="HTTP error "+n.status+" loading strings for locale: "+e.localeId,void t(new Error(o));try{e._dict=JSON.parse(n.responseText)}catch(i){return o="Failed to parse response for locale: "+e.localeId,void t(new Error(o))}e.ready=!0,t(null,e)},loaderDidFail:function(i,n){var o="Network error loading strings for locale: "+e.localeId;t(new Error(o))}}).schedule()}},e.exports=n},{"@maps/js-utils":82,"@maps/loaders":83}],96:[function(t,e,i){var n=["0","1","2","3","4","5","6","7","8","9"],o={"ar-SA":["Ù ","Ù¡","Ù¢","Ù£","Ù¤","Ù¥","Ù¦","Ù§","Ù¨","Ù©"],"hi-IN":["à¥¦","à¥§","à¥¨","à¥©","à¥ª","à¥«","à¥¬","à¥­","à¥®","à¥¯"]},s=".",a={"ca-ES":",","ca-CZ":",","da-DK":",","da-DE":",","el-GR":",","en-ZA":",","es-ES":",","fi-FI":",","fr-CA":",","fr-FR":",","hr-HR":",","hu-HU":",","it-IT":",","nb-NO":",","nl-NL":",","pl-PL":",","pt-BR":",","pt-PT":",","ro-RO":",","ru-RU":",","sk-SK":",","sv-SE":",","tr-TR":",","uk-UA":","};e.exports=function(t,e){for(var i=o[e]||n,r=a[e]||s,l="",h=t.toString(),c=0,d=h.length;c<d;++c){var u=h.charAt(c);l+=u===s?r:i[parseInt(u,10)]||u}return l}},{}],97:[function(t,e,i){"use strict";var n=["AS","BS","BZ","DM","FK","GB","GD","GU","KN","KY","LC","LR","MM","MP","SH","TC","US","VC","VG","VI","WS"];e.exports={forRegion:function(t){return!!t&&n.indexOf(t)<0},forLanguageTag:function(t){var e=t.region;return e?n.indexOf(e)<0:"en"!==t.language&&"my"!==t.language}}},{}],98:[function(t,e,i){function n(){this._parent=null,this._children=[]}function o(t){n.call(this),this.shadowRootMode=t}function s(t){t?_(t)?this.domNode=t:"string"==typeof t||t instanceof String?this.domNode=u(t):"object"==typeof t&&(this.domNode=p(t)):this.domNode=document.createElement("div"),n.call(this),this._opacity=1,this._color="",this._size=new C,this._position=new S,this._transform=new k,this._backgroundImages=[],this._classList=new w(this),this._wantsHardwareCompositing=!1,this._dirtyAttributes={},this._dirtyProperties=[],this._pendingDOMManipulation=I.None}function a(t,e){e?(m(x,t),T.scheduleDraw(r)):g(x,t)}function r(){x.forEach(l),x=[],A.forEach(h),A=[],s.updates++,P.dispatchEvent(new b.Event(O))}function l(t){if(t._pendingDOMManipulation===I.Removal){var e=t.domNode.parentNode;e&&e.removeChild(t.domNode)}t._dirtyProperties&&(t._dirtyProperties.forEach(function(e){c(t,e)}),t._dirtyProperties=[]),t._dirtyAttributes&&(Object.getOwnPropertyNames(t._dirtyAttributes).forEach(function(e){t.domNode.setAttribute(e,t._dirtyAttributes[e])}),t._dirtyAttributes={}),t._pendingDOMManipulation!==I.Addition&&t._pendingDOMManipulation!==I.AttachAsShadowRoot||m(A,t.parent)}function h(t){for(var e=null,i=t.domNode,n=t.children.length-1;n>=0;--n){var o=t.children[n],s=o.domNode;switch(o._pendingDOMManipulation){case I.Addition:i.insertBefore(s,e),o._pendingDOMManipulation=I.None;break;case I.AttachAsShadowRoot:var a=i.attachShadow({mode:o.shadowRootMode});o.domNode=a,o._pendingDOMManipulation=I.None}e=s}}function c(t,e){var i=t.domNode,n=i.style;switch(e){case"opacity":n.opacity=t._opacity;break;case"color":n.color=t._color;break;case"size":n.width=t._size.width+"px",n.height=t._size.height+"px";break;case"position":case"transform":var o=(new k).translate(M.roundToDevicePixel(t._position.x),M.roundToDevicePixel(t._position.y)).transform(t._transform);R&&t._wantsHardwareCompositing&&o.rotate3d(0,0,0,0),n.transform=n.webkitTransform=n.msTransform=o;break;case"backgroundImages":d(t);break;case"classList":i.className=t._classList,t._classList.reset();break;default:return}}function d(t){var e=t.domNode.style;if(!t._backgroundImages.length)return e.removeProperty("background-image"),e.removeProperty("background-position"),void e.removeProperty("background-size");for(var i=[],n=[],o=[],s=t._backgroundImages,a=s.length-1;a>=0;--a){var r=s[a];i.push("url("+r.url+")"),n.push(r.position.x+"px "+r.position.y+"px"),o.push(r.size.width+"px "+r.size.height+"px")}e.backgroundImage=i.join(","),e.backgroundPosition=n.join(","),e.backgroundSize=o.join(",")}function u(t){var e=document.createElement("div");return e.innerHTML=t,e.firstElementChild}function p(t){var e=t.name;if("#text"===e)return document.createTextNode(t.value);var i=document.createElement(e),n=t.attributes;for(var o in n)i.setAttribute(o,n[o]);return t.children instanceof Array&&t.children.forEach(function(t){i.appendChild(p(t))}),i}function m(t,e){return-1===t.indexOf(e)&&(t.push(e),!0)}function g(t,e){var i=t.indexOf(e);return-1!==i&&(t.splice(i,1),!0)}function _(t){return t instanceof window.Node&&t.nodeType===window.Node.ELEMENT_NODE}function f(t){return t<0?"":t+":"}function y(t){return t.childCount<1?"":" â¤µï¸ "+t.childCount}function v(t,e,i,n){var o="";o+=e,n&&(o+=f(i)),o+=t.toString(),o+=y(t);for(var s=t.children,a=0,r=s.length;a<r;++a){var l=t.childCount<1?-1:a;o+="\n",o+=v(s[a],e+"    ",l,n)}return o}function w(t){this._node=t,this.reset()}var b=t("@maps/dom-events"),C=t("@maps/geometry/size"),S=t("@maps/geometry/point"),k=t("@maps/css-transform"),E=t("@maps/js-utils"),T=t("@maps/scheduler"),L=t("@maps/web-point-converter"),M=t("@maps/device-pixel-ratio"),x=[],A=[],I={None:0,Removal:1,Addition:2,AttachAsShadowRoot:3},O="update",R=function(){var t=document.createElement("div");return t.style.msTransform="translate3d(2px, 2px, 2px)","none"!==window.getComputedStyle(t).msTransform}();n.prototype={constructor:s,domNode:null,nodeIsShadowRoot:!1,get parent(){return this._parent},get children(){return this._children},set children(t){for(var e=this._children;e.length;)this.removeChild(e[0]);t.forEach(function(t){this.addChild(t)},this)},get childCount(){return this._children.length},get firstChild(){return this._children[0]||null},get lastChild(){return this._children[this._children.length-1]||null},get previousSibling(){if(!this._parent)return null;var t=this._parent._children,e=t.indexOf(this);return e>0?t[e-1]:null},get nextSibling(){if(!this._parent)return null;var t=this._parent._children,e=t.indexOf(this);return-1!==e&&e<t.length-1?t[e+1]:null},addChild:function(t,e){if(0===e&&this._children[0]&&this._children[0].nodeIsShadowRoot)throw new TypeError("RenderTree.RenderNode.addChild: Node cannot insert before shadow root node.");return t.willMoveToParent(this),t._doNotNotifyParentChange=!0,t.remove(),delete t._doNotNotifyParentChange,(void 0===e||e<0||e>this._children.length)&&(e=this._children.length),this._children.splice(e,0,t),t._parent=this,t.didMoveToParent(this),this.didAddChild(t),t._markNodeManipulation(I.Addition),t},insertBefore:function(t,e){return this.addChild(t,this._children.indexOf(e))},insertAfter:function(t,e){var i=this._children.indexOf(e);return this.addChild(t,-1!==i?i+1:0)},removeChild:function(t){if(t._parent===this){var e=this._children.indexOf(t);if(-1!==e){if(t.nodeIsShadowRoot)throw new TypeError("RenderTree.RenderNode: Not supported in ShadowRoot-backed RenderNode.");return this.willRemoveChild(t),t._doNotNotifyParentChange||t.willMoveToParent(null),this._children.splice(e,1),t._parent=null,t._doNotNotifyParentChange||t.didMoveToParent(null),t._markNodeManipulation(I.Removal),t}}},remove:function(){if(this._parent instanceof n)return this._parent.removeChild(this)},findNode:function(t,e){if("function"!=typeof t)throw new TypeError("RenderTree.RenderNode.findNode: callback must be a function");var i,n=this;return function o(s){s!==n&&t.call(e,s)?i=s:s.children.some(function(t){return o(t),i})}(n),i},dump:function(t){return v(this,"",-1,t)},willRemoveChild:function(t){},didAddChild:function(t){},willMoveToParent:function(t){},didMoveToParent:function(t){},_markDirtyProperty:function(t,e){(void 0===e||e?m(this._dirtyProperties,t):g(this._dirtyProperties,t))&&this._updateNodeDirtiness()},_markNodeManipulation:function(t){this._pendingDOMManipulation=t,this._updateNodeDirtiness()},_updateNodeDirtiness:function(){a(this,this._pendingDOMManipulation!==I.None||this._dirtyProperties.length>0||Object.getOwnPropertyNames(this._dirtyAttributes).length>0)}},o.prototype=E.inheritPrototype(n,o,{nodeIsShadowRoot:!0,shadowRootMode:void 0,toString:function(){return this.stringInfo()+" ["+this.shadowRootMode+"]"},stringInfo:function(){return"#shadow-root"}}),s.prototype=E.inheritPrototype(n,s,{get element(){return this.domNode},set element(t){this.domNode=t},get classList(){return this._classList},get wantsHardwareCompositing(){return this._wantsHardwareCompositing},set wantsHardwareCompositing(t){t!==this._wantsHardwareCompositing&&(this._wantsHardwareCompositing=t,this._markDirtyProperty("transform"))},get opacity(){return this._opacity},set opacity(t){(t=Math.min(Math.max(0,t),1))!==this._opacity&&(this._opacity=t,this._markDirtyProperty("opacity"))},get color(){return this._color},set color(t){t!==this._color&&(this._color=t,this._markDirtyProperty("color"))},get position(){return this._position},set position(t){this._position=t,this._markDirtyProperty("position")},get transform(){return this._transform},set transform(t){this._transform=t,this._markDirtyProperty("transform")},get backgroundImages(){return this._backgroundImages},set backgroundImages(t){this._backgroundImages=t||[],this._markDirtyProperty("backgroundImages")},get size(){return this._size},set size(t){this._size=t||new C,this._markDirtyProperty("size")},setAttribute:function(t,e){this._dirtyAttributes[t]=e,this._updateNodeDirtiness()},createAndAddShadowRootChild:function(t){if(this._children[0]&&this._children[0].nodeIsShadowRoot)throw new Error("RenderTree.RenderNode.createAndAddShadowRootChild: Cannot add more than one shadow root.");var e=new o(t||"closed");return this._children.unshift(e),e._parent=this,this.didAddChild(e),e._markNodeManipulation(I.AttachAsShadowRoot),e},convertPointFromPage:function(t){return L.fromPageToElement(this.domNode,t)},convertPointToPage:function(t){return L.fromElementToPage(this.domNode,t)},toString:function(){var t="";return this._wantsHardwareCompositing&&(t+="ð "),t+=this.stringInfo(),this.classList.toString()&&(t+=this.classList._classes().map(function(t){return"."+t}).join(", ")),0===this.position.x&&0===this.position.y||(t+=" ("+this.position.x+", "+this.position.y+")"),0===this.size.width&&0===this.size.height||(t+=" "+this.size.width+"x"+this.size.height),1!==this.opacity&&(t+=" [opacity:"+this.opacity+"]"),this.transform.toString()&&(t+=" ["+this.transform.toString()+"]"),t},stringInfo:function(){return"<"+this.domNode.tagName.toLowerCase()+">"}}),s.updates=0,w.prototype={constructor:w,add:function(t){this._add(t)},remove:function(t){this._remove(t)},contains:function(t){return-1!==this._classes().indexOf(t)},toggle:function(t,e){if(arguments.length>1)return e?this._add(t):this._remove(t),!!e;this._add(t)||this._remove(t)},toString:function(){return this._classes().join(" ")},_classes:function(){return this._populateClasses&&(this.__classes=this._node.domNode.className.split(/[ ]+/).filter(Boolean),delete this._populateClasses),this.__classes},reset:function(){this._additions=[],this._removals=[],this.__classes=[],this._populateClasses=!0},_add:function(t){if(!t)return!1;var e=m(this._classes(),t);return e&&(g(this._removals,t)||m(this._additions,t),this._updateNodeDirtiness()),e},_remove:function(t){if(!t)return!1;var e=g(this._classes(),t);return e&&(g(this._additions,t)||m(this._removals,t),this._updateNodeDirtiness()),e},_updateNodeDirtiness:function(){this._node._markDirtyProperty("classList",this._additions.length>0||this._removals.length>0)}};var P=new b.EventTarget;P.Node=s,P.Point=S,P.Transform=k,e.exports=P},{"@maps/css-transform":62,"@maps/device-pixel-ratio":63,"@maps/dom-events":64,"@maps/geometry/point":71,"@maps/geometry/size":73,"@maps/js-utils":82,"@maps/scheduler":100,"@maps/web-point-converter":101}],99:[function(t,e,i){function n(){if(0!==a.length){var t=a.concat();a=[],o={},t.forEach(function(t){t()})}}var o={},s=0,a=[],r=1e3/60;"undefined"!=typeof window&&window.requestAnimationFrame?(e.exports.request=window.requestAnimationFrame.bind(window),e.exports.cancel=window.cancelAnimationFrame.bind(window)):"undefined"!=typeof window&&window.webkitRequestAnimationFrame?(e.exports.request=window.webkitRequestAnimationFrame.bind(window),e.exports.cancel=window.webkitCancelAnimationFrame.bind(window)):(e.exports.request=function(t){0===a.length&&setTimeout(n,r),a.push(t);var e=++s;return o[e]=t,e},e.exports.cancel=function(t){if(t in o){var e=o[t],i=a.indexOf(e);-1!==i&&(a.splice(i,1),delete o[t])}})},{}],100:[function(t,e,i){function n(){-1===h&&(c.length>0||u.length>0)&&(h=l.request(o))}function o(){m===p.Flushing&&-1!==h&&l.cancel(h),s(),a(),m=p.Idle,h=-1,n()}function s(){for(m=p.Updating;c.length>0;){var t=c;c=[];for(var e=0,i=t.length;e<i;++e){var n=t[e];"function"==typeof n?n():n&&"object"==typeof n&&"function"==typeof n.performScheduledUpdate&&n.performScheduledUpdate()}}c=d,d=[]}function a(){m=p.Drawing;var t=u;u=[];for(var e=0,i=t.length;e<i;++e){var n=t[e];"function"==typeof n?n():n&&"object"==typeof n&&"function"==typeof n.performScheduledDraw&&n.performScheduledDraw()}}function r(t,e){return-1===t.indexOf(e)&&(t.push(e),!0)}var l=t("@maps/request-animation-frame"),h=-1,c=[],d=[],u=[],p={Idle:0,Updating:1,Drawing:2,Flushing:3},m=p.Idle;e.exports={scheduleASAP:function(t){r(c,t)&&n()},scheduleOnNextFrame:function(t){r(m===p.Updating?d:c,t)&&n()},scheduleDraw:function(t){r(u,t)&&n()},flush:function(){m>p.Idle||(m=p.Flushing,o())}}},{"@maps/request-animation-frame":99}],101:[function(t,e,i){function n(t){for(var e,i=t.getBoundingClientRect(),n=t.offsetWidth,a=t.offsetHeight,r=[new s(0,0),new s(n,0),new s(n,a),new s(0,a)],l=new o,h=t.ownerDocument.defaultView;t.nodeType===Node.ELEMENT_NODE;)e=h.getComputedStyle(t),l=new o(e.transform||e.MozTransform||e.msTransform||e.WebkitTransform).multiply(l),t=t.parentNode;var c=1/0,d=1/0;r.forEach(function(t){var e=l.transformPoint(t);c=Math.min(c,e.x),d=Math.min(d,e.y)});var u=window.pageXOffset+i.left-c,p=window.pageYOffset+i.top-d;return(new o).translate(u,p).multiply(l)}var o=t("@maps/css-matrix"),s=t("@maps/geometry/point");e.exports={fromPageToElement:function(t,e){if(window.webkitConvertPointFromPageToNode){var i=window.webkitConvertPointFromPageToNode(t,new WebKitPoint(e.x,e.y));return new s(i.x,i.y)}return n(t).inverse().transformPoint(e)},fromElementToPage:function(t,e){if(window.webkitConvertPointFromNodeToPage){var i=window.webkitConvertPointFromNodeToPage(t,new WebKitPoint(e.x,e.y));return new s(i.x,i.y)}return n(t).transformPoint(e)}}},{"@maps/css-matrix":61,"@maps/geometry/point":71}],102:[function(t,e,i){e.exports={version:"5.44.0",build:"20.16-97",cdnBase:"//cdn.apple-mapkit.com",cdnVersion:"5.44.0"}},{}],103:[function(t,e,i){function n(){this._doNotTrack=l.doNotTrack(),l.isNode()||(this._isInternalClient=o(),this._isAppHostingSite=s(),r.addEventListener(r.Events.Changed,this),this.uaParserInfo=u.parseUserAgent(navigator.userAgent),this._backgroundTaskQueue=new p,this._debouncedQueueAsBackgroundTask=m(this._queueAsBackgroundTask,v,this),this._cleanupEventType=a(),window.addEventListener(this._cleanupEventType,this))}function o(){return/\.apple\.com$/.test(window.origin)||/\.icloud\.com$/.test(window.origin)||/\.filemaker\.com$/.test(window.origin)||/\.apple-mapkit\.com$/.test(window.origin)||/\.tryrating\.com$/.test(window.origin)}function s(){return/\.appspot.com$/.test(window.origin)||/\.herokuapp.com$/.test(window.origin)}function a(){return"onpagehide"in window?"pagehide":"beforeunload"}var r=t("../configuration"),l=t("@maps/js-utils"),h=t("./transforms"),c=t("@maps/loaders").XHRLoader,d=t("@maps/loaders").Priority,u=t("./ua-parser"),p=t("../../../lib/background-task-queue"),m=t("../../../lib/debounce"),g={ScreenSize:"SCREEN_SIZE",DeviceIdentifier:"DEVICE_IDENTIFIER",BrowserInfo:"BROWSER_INFO",ApplicationIdentifier:"APPLICATION_IDENTIFIER",BrowserWindowSize:"BROWSER_WINDOW_SIZE",Url:"URL",MapView:"MAP_VIEW",UserSession:"USER_SESSION",Tiles:"TILES"},_={UserActionEvents:[g.ScreenSize,g.DeviceIdentifier,g.BrowserInfo,g.ApplicationIdentifier,g.BrowserWindowSize,g.Url,g.MapView,g.UserSession,g.Tiles],NetworkEvents:[g.DeviceIdentifier,g.BrowserInfo,g.ApplicationIdentifier,g.UserSession]},f={UserAction:"USER_ACTION",Network:"NETWORK"},y={Zoom:{name:"ZOOM",states:_.UserActionEvents,type:f.UserAction},MapsLoad:{name:"MAPS_LOAD",states:_.UserActionEvents,type:f.UserAction},AnnotationClick:{name:"ANNOTATION_CLICK",states:_.UserActionEvents,type:f.UserAction},MapTypeChange:{name:"MAP_TYPE_CHANGE",states:_.UserActionEvents,type:f.UserAction},MapNodeReady:{name:"MAP_NODE_READY",states:_.UserActionEvents,type:f.UserAction},Search:{name:"SEARCH",states:_.NetworkEvents,type:f.Network},SearchAC:{name:"SEARCH_AC",states:_.NetworkEvents,type:f.Network},ForwardGeocoder:{name:"FORWARD_GEOCODER",states:_.NetworkEvents,type:f.Network},ReverseGeocoder:{name:"REVERSE_GEOCODER",states:_.NetworkEvents,type:f.Network},Directions:{name:"DIRECTIONS",states:_.NetworkEvents,type:f.Network}},v=1e4;n.prototype={_queuedMessages:[],_loader:null,_analyticsUrl:null,_errorUrl:null,_sessionId:null,_sessionTimerStart:null,_sessionTimeToExpire:null,_sequenceNumber:null,_doNotTrack:null,Events:y,EventTarget:"UI_TARGET_UNKNOWN",log:function(t,e){this._doNotTrack||l.isNode()||((!this._sessionId||(new Date).getTime()>this._sessionTimeToExpire)&&this._initSession(),(e=e||{}).uaParserInfo=this.uaParserInfo,this._queuedMessages.push(this._createMessage(t,e)),this._sequenceNumber++,r.analytics&&this._debouncedQueueAsBackgroundTask())},getDataToSend:function(t){return 0===this._queuedMessages.length?(this._loader.unschedule(),!1):(t.setRequestHeader("Content-Type","text/plain"),t.responseType="text",this._createJSON())},loaderDidSucceed:function(t){delete this._loader},loaderDidFail:function(t){this._queuedMessages=this._queuedMessages.concat(JSON.parse(t.xhrData).analytics_event),delete this._loader},handleEvent:function(t){switch(t.type){case r.Events.Changed:this._configurationBecameAvailable();break;case this._cleanupEventType:this._sendPendingData()}},reduceHost:function(t){var e=t.match(/([^.]+\.[^.]+)$/);return e&&e.length>0?e[0]:t},_createMessage:function(t,e){var i;switch(t.type){case f.UserAction:i=this._createUserActionMessage(t,e);break;case f.Network:i=this._createNetworkMessage(t,e);break;default:i={}}if(e.states){var n=_.UserActionEvents.concat(Object.keys(e.states));i.analytics_state=this._createStateMessages(n,e)}else i.analytics_state=this._createStateMessages(t.states,e);return i},_createUserActionMessage:function(t,e){var i={event_type:f.UserAction,user_action_event:{user_action_event_key:t.name}};return(e.eventValue||0===e.eventValue)&&(i.user_action_event.user_action_event_value=e.eventValue),e.eventTarget&&(i.user_action_event.user_action_event_target=e.eventTarget),i},_createNetworkMessage:function(t,e){var i={event_type:f.Network,network_event:{network_service:t.name}},n=parseInt(e.responseCode);return e.responseCode&&!isNaN(n)&&(i.network_event.http_response_code=n),i},_initSession:function(){this._sessionId={high:l.generateSessionIdValue(),low:l.generateSessionIdValue()},this._sessionTimerStart=(new Date).getTime(),this._sessionTimeToExpire=this._sessionTimerStart+9e5,this._sequenceNumber=0},_createStateMessages:function(t,e){return t.map(function(t){var i={state_type:t};return h[t]?i[t.toLowerCase()]=h[t](this,e):i[t.toLowerCase()]=e.states[t](e),i},this)},_createJSON:function(){var t=JSON.stringify({analytics_message_type:"SHORT_SESSION_USAGE",analytics_event:this._queuedMessages});return this._queuedMessages=[],t},_configurationBecameAvailable:function(){r.analytics&&(this._analyticsUrl=r.analytics.analyticsUrl),r.teamId&&(this._teamId=r.teamId)},_scheduleLoader:function(){this._loader||(this._loader=new c(this._analyticsUrl,this,{method:"POST",priority:d.Low,retry:!0}),this._loader.schedule())},_queueAsBackgroundTask:function(){this._backgroundTaskQueue.addTask(this._scheduleLoader.bind(this)),this._backgroundTaskQueue.start()},_sendPendingData:function(){if(0!==this._queuedMessages.length)if("function"==typeof navigator.sendBeacon)navigator.sendBeacon(this._analyticsUrl,this._createJSON());else{var t=new XMLHttpRequest;t.open("POST",this._analyticsUrl,!1),t.send(this._createJSON())}}},e.exports=new n},{"../../../lib/background-task-queue":1,"../../../lib/debounce":3,"../configuration":165,"./transforms":108,"./ua-parser":114,"@maps/js-utils":82,"@maps/loaders":83}],104:[function(t,e,i){var n=t("../../../build.json");e.exports=function(t){var e={host:location.host,mkjs_version:n.version};return t._isInternalClient&&window.placecard&&window.placecard.version&&(e.placecard_version=window.placecard.version),t._teamId&&(e.team_id=t._teamId),t._isInternalClient||t._isAppHostingSite||(e.host=t.reduceHost(location.host)),e}},{"../../../build.json":102}],105:[function(t,e,i){e.exports=function(t,e){var i={browser_language:navigator.language,prefers_color_scheme:window.matchMedia("(prefers-color-scheme: dark)").matches?"DARK":"LIGHT"};return location.host.match(/duckduckgo.com$/)||location.host.match(/apple-mapkit.com$/)||(i.browser_name=e.uaParserInfo.browserInfo.name,i.browser_version=e.uaParserInfo.browserInfo.version),i.browser_origin=location.protocol+"//"+location.host,t._isInternalClient?i.browser_referer=document.referrer:t._isAppHostingSite||(i.browser_origin=t.reduceHost(location.host)),i}},{}],106:[function(t,e,i){e.exports=function(t){if(t._isInternalClient)return{width:window.innerWidth,height:window.innerHeight}}},{}],107:[function(t,e,i){e.exports=function(t,e){return{device_platform:e.uaParserInfo.deviceInfo.platform,device_os_version:e.uaParserInfo.deviceInfo.os}}},{}],108:[function(t,e,i){e.exports={SCREEN_SIZE:t("./screen-size-state"),DEVICE_IDENTIFIER:t("./device-identifier-state"),BROWSER_INFO:t("./browser-info-state"),APPLICATION_IDENTIFIER:t("./application-identifier"),BROWSER_WINDOW_SIZE:t("./browser-window-size-state"),URL:t("./url-state"),MAP_VIEW:t("./map-view-state"),USER_SESSION:t("./user-session-state"),TILES:t("./tiles-state")}},{"./application-identifier":104,"./browser-info-state":105,"./browser-window-size-state":106,"./device-identifier-state":107,"./map-view-state":109,"./screen-size-state":110,"./tiles-state":111,"./url-state":112,"./user-session-state":113}],109:[function(t,e,i){e.exports=function(t,e){var i=e.map.region.toBoundingRegion(),n=e.map.ensureRenderingFrame().size;return{display_map_region:{eastLng:i.eastLongitude,northLat:i.northLatitude,southLat:i.southLatitude,westLng:i.westLongitude},zoom_level:e.map.zoomLevel,map_type:"MAP_TYPE_"+e.map.mapType.toUpperCase(),size:{width:n.width,height:n.height},color_scheme:e.map.colorScheme.toUpperCase()}}},{}],110:[function(t,e,i){e.exports=function(e){var i={device_pixel_ratio:t("@maps/device-pixel-ratio")()};return e._isInternalClient?(i.width=screen.width,i.height=screen.height,i):i}},{"@maps/device-pixel-ratio":63}],111:[function(t,e,i){e.exports=function(t,e){return{rendering:e.map._mapNodeController&&e.map._mapNodeController.renderingMode}}},{}],112:[function(t,e,i){e.exports=function(t){var e={};return t._isInternalClient&&(e.query_string=location.search,e.path=location.pathname),e}},{}],113:[function(t,e,i){e.exports=function(t){var e=((new Date).getTime()-t._sessionTimerStart)/1e3;return{session_id:t._sessionId,sequence_number:t._sequenceNumber,relative_timestamp:e}}},{}],114:[function(t,e,i){function n(t){t=t.toLowerCase();var e,i;try{return!t.includes("safari")||t.includes("chrome")||t.includes("crios")||t.includes("gsa")||t.includes("fxios")?!t.includes("chrome")&&!t.includes("crios")||t.includes("chromium")||t.includes("edge")||t.includes("samsungbrowser")?!t.includes("firefox")&&!t.includes("fxios")||t.includes("seamonkey")?t.includes("msie")||t.includes("trident")&&t.includes("rv")?(e="Internet Explorer",i=t.includes("msie")?/msie\s(\d*\.?\d*)/gi.exec(t)[1]:/rv:(\d*\.?\d*)/gi.exec(t)[1]):t.includes("edge")?(e="Edge",i=/edge\/(\d*\.?\d*)/gi.exec(t)[1]):t.includes("gsa")?(e="Google Search App",i=/gsa\/(.*?)\s[^._\d]/i.exec(t)[1]):(e="other",i="other"):(e="Firefox",i=t.includes("firefox")?/firefox\/(\d*\.?\d*)/gi.exec(t)[1]:/fxios\/(\d*\.?\d*)/gi.exec(t)[1]):(e="Chrome",i=t.includes("chrome")?/chrome\/(.*?)\s/gi.exec(t)[1]:/crios\/(.*?)\s/gi.exec(t)[1]):(e="Safari",i=/version\/(\d+\.?\d*)/gi.exec(t)[1]),{name:e,version:i}}catch(t){return{name:"other",version:"other"}}}function o(t){t=t.toLowerCase();var e,i;try{return t.includes("ipad")?(e="iPad",i="iOS "+/os\s+(.*?)[^_.\d]/i.exec(t)[1]):t.includes("iphone")&&!t.includes("ipad")?(e="iPhone",i="iOS "+/os\s+(.*?)[^_.\d]+/i.exec(t)[1]):t.includes("macintosh")?(e="Macintosh",i="Mac OS X "+/mac os x (.*?)[^_.\d]/.exec(t)[1]):t.includes("windows")?(e="Windows",i="Windows NT "+/windows nt (.*?)[^._\d]/.exec(t)[1]):t.includes("android")?(e="Android",i="Android "+/android (.*?)[^._\d]/.exec(t)[1]):t.includes("linux")&&!t.includes("android")?(e="Linux",i="Linux"):t.includes("cros")?(e="Chrome OS",i="Chrome OS"):(e="other",i="other"),{platform:e,os:i}}catch(t){return{platform:"other",os:"other"}}}e.exports={parseUserAgent:function(t){return{browserInfo:n(t),deviceInfo:o(t)}}}},{}],115:[function(t,e,i){e.exports=':host(.mk-annotation-container.mk-dragging) ::selection,div.mk-annotations ::selection{background:0 0}.mk-invisible{opacity:0;pointer-events:none}.mk-hidden{display:none}div.mk-annotations,div.mk-annotations>*,div.mk-callouts,div.mk-callouts>*,div.mk-style-helper{position:absolute;top:0;left:0}.mk-selected{z-index:1}.mk-lifted{z-index:2}.mk-callout{position:absolute;top:0;left:0;pointer-events:auto;-webkit-user-select:auto;-moz-user-select:text;-ms-user-select:text}:host(.mk-dark-mode) .mk-callout{color:#fff}.mk-callout>*{position:absolute;top:0;left:0}svg.mk-bubble{display:block;width:100%;height:100%}div.mk-callout-accessory{position:absolute;top:50%;transform:translateY(-50%);overflow:hidden}div.mk-callout-accessory-content{white-space:nowrap;position:relative;text-align:center;font-size:12px}div.mk-callout-accessory:first-child{left:0}div.mk-callout-accessory:last-child{right:0}div.mk-callout-accessory:first-child .mk-callout-accessory-content{padding-right:8px}div.mk-callout-accessory:last-child .mk-callout-accessory-content{padding-left:8px}div.mk-callout-accessory:first-child+.mk-callout-content{padding-left:8px}div.mk-standard .mk-callout-content:nth-last-child(2){padding-right:8px}div.mk-standard{font-family:"-apple-system",BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,sans-serif;box-sizing:border-box;position:relative}div.mk-custom-content,div.mk-standard{transform:translateY(-50%)}div.mk-standard .mk-callout-content>div{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}div.mk-standard .mk-callout-content{padding:0 4px}div.mk-standard .mk-title{font-size:17px;font-weight:500;color:#000;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;letter-spacing:.025em}:host(.mk-dark-mode) div.mk-standard .mk-title{color:#fff}div.mk-standard.mk-no-subtitle.mk-no-accessories .mk-title{text-align:center}div.mk-standard .mk-subtitle{font-size:13px;color:rgba(0,0,0,.7);letter-spacing:.025em}:host(.mk-dark-mode) div.mk-standard .mk-subtitle{color:rgba(255,255,255,.7)}svg.mk-bubble path{fill:#fff;stroke:rgba(0,0,0,.2)}:host(.mk-dark-mode) svg.mk-bubble path{fill:#3e3e3e;stroke:rgba(0,0,0,.5)}.mk-rtl *{text-align:right!important;direction:rtl}div.mk-standard.mk-no-subtitle.mk-no-accessories .mk-rtl .mk-title{text-align:center!important}'},{}],116:[function(t,e,i){function n(t){this._annotation=t}var o=t("@maps/geometry").Point,s=t("@maps/scheduler");n.prototype={liftDurationMs:200,liftOpacity:.5,animateLift:function(){var t=Math.min((Date.now()-this._liftAnimationStartDate)/this.liftDurationMs,1);this._annotation.translate(this.translation.x,this.translation.y-this.liftAmount*t),this._annotation.opacity=1-(1-this.liftOpacity)*t,t<1?(s.scheduleOnNextFrame(this),this._liftAnimationProgress=t):(delete this._liftAnimationStartDate,delete this._liftAnimationProgress)},animateDropAfterLift:function(){var t=Math.max(this._dropAnimationStartP-Math.min((Date.now()-this._dropAfterLiftAnimationStartDate)/this.liftDurationMs,1),0);this._dropAnimationRevert&&this._annotation.translate(0,-this.liftAmount*t),this._annotation.opacity=1-(1-this.liftOpacity)*t,t>0?s.scheduleOnNextFrame(this):this._annotation.droppedAfterLift()},dropAnnotationAfterDraggingAndRevertPosition:function(t){this._liftAnimationStartDate?(this._dropAnimationStartP=this._liftAnimationProgress,delete this._liftAnimationStartDate,delete this._liftAnimationProgress):this._dropAnimationStartP=1,t?this._annotation.resetNodeTransform():this._annotation.draggingDidEnd(),this._dropAfterLiftAnimationStartDate=Date.now(),this._dropAnimationRevert=t,s.scheduleOnNextFrame(this)},lift:function(t){this.liftAmount=t,this.translation=new o,this._liftAnimationStartDate=Date.now(),this._liftAnimationProgress=0,s.scheduleOnNextFrame(this)},getTranslation:function(){return new o(this.translation.x,this.translation.y-this.liftAmount)},setTranslation:function(t){this.translation=t,this._liftAnimationStartDate||this._annotation.translate(this.translation.x+this._annotation.dragOffset.x,this.translation.y-this.liftAmount+this._annotation.dragOffset.y)},performScheduledUpdate:function(){this._liftAnimationStartDate?this.animateLift():this._dropAfterLiftAnimationStartDate&&this.animateDropAfterLift()}},e.exports=n},{"@maps/geometry":70,"@maps/scheduler":100}],117:[function(t,e,i){function n(t){this._map=t,this.panning=!1}var o=t("@maps/geometry/point"),s=t("@maps/scheduler");n.prototype={constructor:n,update:function(t,e){if(this._map.isScrollEnabled){var i=t._impl.translatedPosition(),n=i.x,a=n+e.size.width,r=i.y,l=r+e.size.height,h=this._map.ensureVisibleFrame();this._direction=new o,n<=h.minX()?this._direction.x=1:a>=h.maxX()&&(this._direction.x=-1),r<=h.minY()+5?this._direction.y=1:l>=h.maxY()-5&&(this._direction.y=-1);var c=0!==this._direction.x||0!==this._direction.y;!this.panning&&c?(this.panning=!0,this._startTime=Date.now(),this._initialSpeed=Math.floor(1/104.1*(h.size.width+h.size.height)/2),s.scheduleOnNextFrame(this)):this.panning&&!c&&this.stop()}},stop:function(){this.panning&&(this.panning=!1,delete this._direction,delete this._startTime,delete this._initialSpeed)},performScheduledUpdate:function(){if(this.panning){var t=this._initialSpeed,e=Date.now()-this._startTime;e>4e3?t*=3:e>1e3&&(t*=1.5),this._map.translateCameraAnimated(new o(this._direction.x*t,this._direction.y*t),!1),this._map.panningDuringAnnotationDrag(),s.scheduleOnNextFrame(this)}},mapWasDestroyed:function(){delete this._map}},e.exports=n},{"@maps/geometry/point":71,"@maps/scheduler":100}],118:[function(t,e,i){function n(t){function e(e,i,n,o){t.call(this,e),d.checkOptions(o),this._setCoordinate(i),this._unsized=!0,this._public=e,this.occluded=!1,this._setNode(i,n,o),o&&(_.forEach(function(t){t in o&&(this[t]=o[t])},this),f.forEach(function(t){t in o&&this["_set"+t.replace(/^\w/,function(t){return t.toUpperCase()})](o[t])},this),Object.keys(o).forEach(function(t){"map"===t||"element"===t?console.warn("[MapKit] `"+t+"` is read-only and can't be set on an Annotation."):this.isAKnownOption(t)||console.warn("[MapKit] Unknown option for annotation: "+t+" (use the `data` property instead)")},this)),p.addEventListener(p.Events.LocaleChanged,this),this.updateLocalizedText()}return e.Events=y,e.DisplayPriority=v,e.CollisionMode=w,e.prototype=d.inheritPrototype(t,e,{_calloutOffset:new window.DOMPoint(0,1),_enabled:!0,_selected:!1,_calloutEnabled:!0,_draggable:!1,_title:"",_subtitle:"",_accessibilityLabel:null,_displayPriority:v.Required,_collisionMode:w.Rectangle,_clusteringIdentifier:null,_sceneGraphNode:null,_padding:new m,shouldHideLabels:!1,alwaysSelected:!1,_callout:null,get map(){return this.delegate&&this.delegate.mapForAnnotation(this._public)},set map(t){console.warn("[MapKit] The `map` property is read-only.")},get coordinate(){return this._coordinate},set coordinate(t){this.memberAnnotations||this._setCoordinate(t)},get title(){return this._title},set title(t){null!=t?(d.checkType(t,"string","[MapKit] Expected a string value for Annotation.title, but got `"+t+"` instead"),this._title=t):delete this._title,this.updateLocalizedText(),this._updatedProperty("title")},get subtitle(){return this._subtitle},set subtitle(t){null!=t?(d.checkType(t,"string","[MapKit] Expected a string value for Annotation.subtitle, but got `"+t+"` instead"),this._subtitle=t):delete this._subtitle,this.updateLocalizedText(),this._updatedProperty("subtitle")},get accessibilityLabel(){return this._accessibilityLabel},set accessibilityLabel(t){null!=t?(d.checkType(t,"string","[MapKit] Expected a string value for Annotation.accessibilityLabel, but got `"+t+"` instead"),this._accessibilityLabel=t):delete this._accessibilityLabel,this.updateLocalizedText()},get data(){return Object.prototype.hasOwnProperty.call(this,"_data")||(this._data={}),this._data},set data(t){this._data=t},get enabled(){return this._enabled},set enabled(t){this._enabled=!!t},get calloutEnabled(){return this._calloutEnabled},set calloutEnabled(t){this._calloutEnabled=!!t},get selected(){return this._selected},set selected(t){var e=!!t;if(e!==this._selected){if(this.delegate&&!this.delegate.selectionMayChange)return void console.warn("[MapKit] Selection may not change in select/deselect event handler.");this._selected=e,this._updatedProperty("selected")}},get animates(){return this._animates},set animates(t){this._animates=!!t},get calloutOffset(){return this._calloutOffset},set calloutOffset(t){d.checkInstance(t,window.DOMPoint,"[MapKit] Annotation.calloutOffset expected a DOMPoint, but got `"+t+"` instead."),this._calloutOffset=new window.DOMPoint(t.x,t.y),this._updatedProperty("calloutOffset")},get callout(){return this._callout},set callout(t){d.checkType(t,"object","[MapKit] Annotation.callout expected an object, but got `"+t+"` instead."),this._callout=t},get draggable(){return this._draggable},set draggable(t){this.memberAnnotations||this._setDraggable(t)},get size(){if(this._updateSize(),!this._unsized)return this._node.size.copy()},set size(t){var e="[MapKit] Annotation size expects a size object with width and height properties";d.checkType(t,"object",e).checkType(t.width,"number",e).checkType(t.height,"number",e),this.setSize(new r(t.width,t.height)),this._userSetSize=!0,this.updateSize()},get opacity(){return this.sceneGraphNode?this.sceneGraphNode.opacity:this.node.opacity},set opacity(t){this.sceneGraphNode?this.sceneGraphNode.opacity=t:this.node.opacity=t},get displayPriority(){return this._displayPriority},set displayPriority(t){this.memberAnnotations||this._setDisplayPriority(t)},isRequired:function(){return this.selected||this.displayPriority===v.Required},get collisionMode(){return this._collisionMode},set collisionMode(t){if(!d.checkValueIsInEnum(t,w))throw new Error("[MapKit] Unknown value for `collisionMode`. Choose from Annotation.CollisionMode.");t!==this._collisionMode&&(this._collisionMode=t,this._updatedProperty("collisionMode"))},get clusteringIdentifier(){return this._clusteringIdentifier},set clusteringIdentifier(t){this.memberAnnotations||this._setClusteringIdentifier(t)},get padding(){return this._padding.copy()},set padding(t){d.checkInstance(t,m,"[MapKit] The `padding` parameter passed to `Annotation.padding` is not a Padding."),this._padding.equals(t)||(this._padding=t.copy(),this._updatedProperty("padding"))},get needsLayout(){return this._sceneGraphNode&&this._sceneGraphNode.needsLayout},get elementInAnnotationDOM(){return this._node.element.firstChild},removedFromMap:function(){this._removedFromMap=!0,p.removeEventListener(p.Events.LocaleChanged,this),this._occludedAnimation&&this._occludedAnimation.end(),this._clusteringAnimation&&this._clusteringAnimation.end()},addedToMap:function(){this._removedFromMap&&(this._removedFromMap=!1,p.addEventListener(p.Events.LocaleChanged,this),this.updateLocalizedText())},delegate:null,setDelegate:function(t){this.delegate=t},updateLayout:function(){},doesAnimate:function(){return this._animates&&!!this._appearanceAnimationName},willMoveToMap:function(){this._isMoving=this.doesAnimate(),this._updateSize()},didMoveToMap:function(){this._isMoving&&this._appearanceAnimationName&&this._visible&&(this.element.style.animation=this.element.style.webkitAnimation=this._appearanceAnimation,(this.element.style.animationName||this.element.style.webkitAnimationName)&&(this._animating=!0,this.element.addEventListener("animationend",this),this.element.addEventListener("webkitAnimationEnd",this))),delete this._isMoving},isStable:function(){return!(this.isWaiting||this._isMoving||this._isAnimating||this._isLifted)},canShowCallout:function(){return this._calloutEnabled&&this.isStable()},calloutWillAppear:function(){},calloutWillDisappear:function(){},canBePicked:function(){return this._shown&&this._visible&&!this._isMoving&&!this._isAnimating&&!this._isLifted&&!this.occluded},draggingDidStart:function(){this._public.dispatchEvent(new g.Event(y.DragStart))},isDraggable:function(){return this.draggable&&!this._isLifted},isLifted:function(){return this._isLifted},dispatchDraggingEvent:function(){var t=new g.Event(e.Events.Dragging);return t.coordinate=this._coordinateDuringDrag(),this._public.dispatchEvent(t),t},positionForCallout:function(){var t=this._calloutAnchorPoint;if(!t){var e=this._userSetSize?this._node.size:this.delegate.sizeForElement(this.elementInAnnotationDOM);t=new window.DOMPoint(-e.width/2,0)}var i=this.nodePosition();return new c(i.x-t.x-this._calloutOffset.x,i.y-t.y-this._calloutOffset.y)},setDraggingTranslationForMapFrameSize:function(t,e){this._dragController.setTranslation(this.clampDraggingTranslationForMapFrameSize(t,e))},dropAfterDraggingAndRevertPosition:function(t){this._dragController.dropAnnotationAfterDraggingAndRevertPosition(t)},distanceToPoint:function(t){var e=this._node.position.x,i=e+this._node.size.width,n=e-t.x,o=i-t.x,s=n<=0&&o>=0?0:Math.min(Math.abs(n),Math.abs(o)),a=this._node.position.y,r=a+this._node.size.height,l=a-t.y,h=r-t.y,c=l<=0&&h>=0?0:Math.min(Math.abs(l),Math.abs(h));return s*s+c*c},lift:function(t){this._isLifted=!0,this._dragController.lift(t),this._updatedProperty("")},translate:function(t,e){this.sceneGraphNode?this.sceneGraphNode.transform=(new l).translate(t,e):this._node.transform=(new h).translate(t,e)},translatedPosition:function(){var t=this._dragController.getTranslation();return new c(this._position.x-this._anchorPoint.x-this._anchorOffset.x+t.x,this._position.y-this._anchorPoint.y-this._anchorOffset.y+t.y)},updatedPosition:function(){return this.coordinate?(this.x=s.convertLongitudeToX(s.wrapLongitude(this.coordinate.longitude)),this.y=s.convertLatitudeToY(this.coordinate.latitude),!0):(this.setShown(!1),this.sceneGraphNode&&this.sceneGraphNode.remove(),!1)},get sceneGraphNode(){return this._sceneGraphNode},mayBeDrawn:function(){return!!this.sceneGraphNode&&this._shown&&this.visible&&!this.isWaiting},isDrawn:function(){return(!this.occluded||this._occludedAnimation)&&this.mayBeDrawn()},animateOcclusion:function(){var t=this.occluded?0:1;this._sceneGraphNode&&(this._occludedAnimation&&this._occludedAnimation.end(),this._occludedAnimation=new u.NodeAnimator.Opacity({node:this._sceneGraphNode,from:1-t,to:t,duration:b,done:function(){delete this._occludedAnimation}.bind(this)}).begin());var e=this.occluded&&this.cluster&&this.cluster._impl&&!this.cluster._impl.occluded,i=!this.occluded&&this.previousCluster&&!this.previousCluster._impl.wasOccluded;(e||i)&&this._animateClustering()},positionWasUpdated:function(t){this._sceneGraphNode&&(this._sceneGraphNode.needsDisplay=!0)},dragOffset:c.Zero,handleEvent:function(t){switch(t.type){case p.Events.LocaleChanged:this.updateLocalizedText();break;case"animationend":case"webkitAnimationEnd":if(t.animationName!==this._appearanceAnimationName)return;this.element.style.animation=this.element.style.webkitAnimation="",this.element.removeEventListener("animationend",this),this.element.removeEventListener("webkitAnimationEnd",this),this.finishedAnimating()}},updateLocalizedText:function(){this._element&&this._element.setAttribute("aria-label",this.altText())},altText:function(){return this._accessibilityLabel||(this.title&&this.subtitle?p.get("Annotation.Generic.AccessibilityLabel",{title:this.title,subtitle:this.subtitle}):this.title||this.subtitle||"")},updateSize:function(){delete this._unsized,this._selected&&this.delegate&&this.delegate.selectedAnnotationDidMoveToMap(this._public)},clampDraggingTranslationForMapFrameSize:function(t,e){var i=this._anchorPoint.x+this._anchorOffset.x-this._position.x,n=e.width-this._node.size.width+i,o=this._anchorPoint.y+this._anchorOffset.y+this._dragController.liftAmount-this._position.y,s=e.height-this._node.size.height+o;return new c(d.clamp(t.x,i,n),d.clamp(t.y,o,s))},droppedAfterLift:function(){delete this._isLifted,this.selected&&this.delegate.selectedAnnotationDidMoveToMap(this._public),this._updatedProperty("")},draggingDidEnd:function(){this.coordinate=this._coordinateDuringDrag(),this.resetNodeTransform(),this._public.dispatchEvent(new g.Event(e.Events.DragEnd))},resetNodeTransform:function(){this.node.transform=new h},finishedAnimating:function(){delete this._isAnimating,this._selected&&this.delegate&&this.delegate.selectedAnnotationDidMoveToMap(this._public),this._visible||this._updateVisibility(),this.delegate&&this.delegate.annotationFinishedAnimating(this._public)},isAKnownOption:function(t){return _.indexOf(t)>=0||f.indexOf(t)>=0},_animateClustering:function(){if(this._sceneGraphNode){var t={annotation:this,node:this._sceneGraphNode,duration:b,done:function(){delete this._clusteringAnimation}.bind(this)};this.cluster?(t.from=this.coordinate.toMapPoint(),t.to=this.cluster.coordinate.toMapPoint()):(t.from=this.previousCluster.coordinate.toMapPoint(),t.to=this.coordinate.toMapPoint());var e=t.to.x-t.from.x;e<-.5?t.to.x+=1:e>.5&&(t.from.x+=1),this._clusteringAnimation&&this._clusteringAnimation.end(),this._clusteringAnimation=new o(t).begin()}},_setCoordinate:function(t){d.checkInstance(t,a,"[MapKit] Annotation.coordinate expected a Coordinate value."),delete this._translation,this._coordinate=t.copy(),this._updatedProperty("coordinate")},_setDraggable:function(t){var e=!!t;e!==this._draggable&&(this._draggable=e,this._updatedProperty("draggable"))},_setDisplayPriority:function(t){var e="[MapKit] Annotation displayPriority expects a number between 0 and "+v.Required;d.checkType(t,"number",e);var i=d.clamp(t,0,v.Required);if(i!==t)console.warn(e+", value was normalized");else if(i===this._displayPriority)return;this._displayPriority=i,this._updatedProperty("displayPriority")},_setClusteringIdentifier:function(t){null!==t&&d.checkType(t,"string","[MapKit] Annotation clusteringIdentifier expects a string"),this._clusteringIdentifier!==t&&(this._clusteringIdentifier=t,this._updatedProperty("clusteringIdentifier"))},_coordinateDuringDrag:function(){var t=this.sceneGraphNode?this._dragController.translation.x:0,e=this.sceneGraphNode?this._dragController.translation.y-this._dragController.liftAmount:0,i=this.node.convertPointToPage(new c(t+this.dragOffset.x+this._anchorPoint.x+this.anchorOffset.x,e+this.dragOffset.y+this._anchorPoint.y+this.anchorOffset.y));return this.delegate._map.convertPointOnPageToCoordinate(new window.DOMPoint(i.x,i.y))},_updateSize:function(){if(this._unsized&&!this._userSetSize&&this.delegate){var t=this.delegate.sizeForElement(this.elementInAnnotationDOM);t&&(delete this._unsized,this.setSize(t))}},_updatedProperty:function(t){this.delegate&&this.delegate.annotationPropertyDidChange(this._public,t)}}),e}function o(t){u.NodeAnimator.Basic.call(this,t),this.annotation=t.annotation}var s=t("../../../lib/geo"),a=s.Coordinate,r=t("@maps/geometry/size"),l=t("@maps/css-matrix"),h=t("@maps/css-transform"),c=t("@maps/geometry/point"),d=t("@maps/js-utils"),u=t("../../../lib/scene-graph"),p=t("../localizer").l10n,m=t("../padding"),g=t("../public-dom"),_=["title","subtitle","data","accessibilityLabel","anchorOffset","calloutOffset","size","callout","visible","enabled","selected","calloutEnabled","animates","appearanceAnimation","collisionMode","padding"],f=["draggable","displayPriority","clusteringIdentifier"],y={DragStart:"drag-start",Dragging:"dragging",DragEnd:"drag-end"},v={Low:250,High:750,Required:1e3},w={Rectangle:"rectangle",Circle:"circle"},b=200;o.prototype=d.inheritPrototype(u.NodeAnimator.Basic,o,{update:function(t){var e=this.annotation,i=e.delegate._map,n=i.camera.toRenderingMapRect(),o=s.clampX((1-t)*this.from.x+t*this.to.x,n.minX(),n.maxX()),a=(1-t)*this.from.y+t*this.to.y,r=i.adjustMapItemPoint(i.camera.transformMapPoint(new c(o,a)));this.node.transform=(new l).translate(r.x-e._position.x,r.y-e._position.y)},stringInfo:function(){return u.NodeAnimator.Basic.prototype.stringInfo.call(this,"translation*")}}),n.Events=y,n.DisplayPriority=v,n.CollisionMode=w,e.exports=n},{"../../../lib/geo":4,"../../../lib/scene-graph":51,"../localizer":187,"../padding":216,"../public-dom":219,"@maps/css-matrix":61,"@maps/css-transform":62,"@maps/geometry/point":71,"@maps/geometry/size":73,"@maps/js-utils":82}],119:[function(t,e,i){var n=t("./annotation-drag-controller"),o=t("./annotation-layer-item-internal"),s=t("../call-function-safely"),a=t("./annotation-internal-mixin"),r=t("@maps/js-utils"),l=t("../utils"),h=t("@maps/render-tree"),c=a(o);c.prototype._animates=!0,c.prototype._setNode=function(t,e,i){r.checkType(e,"function");var o=s(e,window,[t,i]);r.checkElement(o,"[MapKit] Annotation element factory must return a DOM element, got `"+o+"` instead."),this._element=o;var a=o;if(l.supportsShadowDOM){var c="mk-slot-"+Math.random().toString(32).substr(2,8);o.slot=c,(a=l.htmlElement("slot")).name=c}this._node=new h.Node(l.htmlElement("div",a)),this._node.wantsHardwareCompositing=!0,this._dragController||(this._dragController=new n(this))},c.div=function(){return document.createElement("div")},e.exports=c},{"../call-function-safely":161,"../utils":237,"./annotation-drag-controller":116,"./annotation-internal-mixin":118,"./annotation-layer-item-internal":120,"@maps/js-utils":82,"@maps/render-tree":98}],120:[function(t,e,i){function n(t){t&&(this._public=t)}var o=t("@maps/js-utils"),s=t("@maps/geometry/point"),a={HIDDEN:"mk-hidden",INVISIBLE:"mk-invisible"};n.CalloutTailSide={Left:"left",Right:"right",Bottom:"bottom"},n.prototype={_shown:!0,_visible:!0,_position:new s,_anchorPoint:new s,_anchorOffset:new window.DOMPoint,_appearanceAnimation:"",skipRTNodePositionUpdateWhenCameraIsMoving:!1,needsInitialSizeMeasuredFromDOMElement:!0,delegate:null,get node(){return this._node},get element(){return this._element},set element(t){console.warn("[MapKit] The `element` property is read-only.")},get anchorOffset(){return this._anchorOffset},set anchorOffset(t){o.checkInstance(t,window.DOMPoint,"[MapKit] Annotation.anchorOffset expected a DOMPoint, but got `"+t+"` instead."),this._anchorOffset=new window.DOMPoint(t.x,t.y),this.updatePosition()},get visible(){return this._visible},set visible(t){t=!!t,this._visible!==t&&(this._visible=t,this._updateVisibility())},get appearanceAnimation(){return this._appearanceAnimation},set appearanceAnimation(t){if(o.checkType(t,"string","[MapKit] Annotation.appearanceAnimation expected a string, but got `"+t+"` instead."),""!==t){var e=document.createElement("div");e.style.animation=e.style.webkitAnimation=t,this._appearanceAnimationName=e.style.animationName||e.style.webkitAnimationName,this._appearanceAnimationName?this._appearanceAnimation=t:console.warn("[MapKit] Annotation.appearanceAnimation expects an animation style value with an animation name, but got `"+t+"` instead.")}else this._appearanceAnimation=this._appearanceAnimationName=""},nodePosition:function(){return this._nodePosition||this._node.position},calculateNodePosition:function(){return new s(this._position.x-this._anchorPoint.x-this._anchorOffset.x,this._position.y-this._anchorPoint.y-this._anchorOffset.y)},updatePosition:function(){var t=this.calculateNodePosition();this.skipRTNodePositionUpdateWhenCameraIsMoving&&this.map&&this.map._impl.cameraIsMoving?this._nodePosition=t:(delete this._nodePosition,this._node.position=t),this.positionWasUpdated(t)},setShown:function(t){t=!!t,this._shown!==t&&(this._shown=t,this._node.element&&this._node.classList.toggle(a.HIDDEN,!t),this.shownPropertyWasUpdated(t))},shownPropertyWasUpdated:function(){},positionWasUpdated:function(t){},isShown:function(){return this._shown},position:function(){return this._position},setPosition:function(t){this._position=t,this.updatePosition()},updateVisibility:function(t){this._node.classList.toggle(a.INVISIBLE,t)},setSize:function(t,e){this._node.size=t,this._anchorPoint=e===n.CalloutTailSide.Left?new s(0,t.height/2):e===n.CalloutTailSide.Right?new s(t.width,t.height/2):new s(t.width/2,t.height),this.updatePosition()},_updateVisibility:function(){!this._visible&&this._animating||(this.updateVisibility(!this._visible),this.delegate&&this.delegate.annotationPropertyDidChange(this._public||this,"visible"))}},e.exports=n},{"@maps/geometry/point":71,"@maps/js-utils":82}],121:[function(t,e,i){function n(){Object.defineProperty(this,"_impl",{value:new a(this)})}var o=t("@maps/js-utils"),s=t("../public-dom"),a=t("./annotation-layer-item-internal");n.CalloutTailSide={Left:"left",Right:"right",Bottom:"bottom"},n.prototype=o.inheritPrototype(s.EventTarget,n,{get element(){return this._impl.element},set element(t){this._impl.element=t},get anchorOffset(){return this._impl.anchorOffset},set anchorOffset(t){this._impl.anchorOffset=t},get animates(){return this._impl.animates},set animates(t){this._impl.animates=t},get visible(){return this._impl.visible},set visible(t){this._impl.visible=t},get appearanceAnimation(){return this._impl.appearanceAnimation},set appearanceAnimation(t){this._impl.appearanceAnimation=t}}),e.exports=n},{"../public-dom":219,"./annotation-layer-item-internal":120,"@maps/js-utils":82}],122:[function(t,e,i){function n(e,i,o){if(a(this,n)){var s=t("./annotation-internal");Object.defineProperty(this,"_impl",{value:new s(this,e,i,o)})}}var o=t("./annotation-layer-item"),s=t("./annotation-internal-mixin"),a=t("../check-instance-and-warn"),r=t("@maps/js-utils");n.EVENTS=s.EVENTS,n.DisplayPriority=s.DisplayPriority,n.CollisionMode=s.CollisionMode,n.prototype=r.inheritPrototype(o,n,{get map(){return this._impl.map},set map(t){this._impl.map=t},get coordinate(){return this._impl.coordinate},set coordinate(t){this._impl.coordinate=t},get title(){return this._impl.title},set title(t){this._impl.title=t},get subtitle(){return this._impl.subtitle},set subtitle(t){this._impl.subtitle=t},get accessibilityLabel(){return this._impl.accessibilityLabel},set accessibilityLabel(t){this._impl.accessibilityLabel=t},get data(){return this._impl.data},set data(t){this._impl.data=t},get enabled(){return this._impl.enabled},set enabled(t){this._impl.enabled=t},get calloutEnabled(){return this._impl.calloutEnabled},set calloutEnabled(t){this._impl.calloutEnabled=t},get selected(){return this._impl.selected},set selected(t){this._impl.selected=t},get animates(){return this._impl.animates},set animates(t){this._impl.animates=t},get calloutOffset(){return this._impl.calloutOffset},set calloutOffset(t){this._impl.calloutOffset=t},get callout(){return this._impl.callout},set callout(t){this._impl.callout=t},get draggable(){return this._impl.draggable},set draggable(t){this._impl.draggable=t},get size(){return this._impl.size},set size(t){this._impl.size=t},get displayPriority(){return this._impl.displayPriority},set displayPriority(t){this._impl.displayPriority=t},get collisionMode(){return this._impl.collisionMode},set collisionMode(t){this._impl.collisionMode=t},get clusteringIdentifier(){return this._impl.clusteringIdentifier},set clusteringIdentifier(t){this._impl.clusteringIdentifier=t},get padding(){return this._impl.padding},set padding(t){this._impl.padding=t}}),e.exports=n},{"../check-instance-and-warn":162,"./annotation-internal":119,"./annotation-internal-mixin":118,"./annotation-layer-item":121,"@maps/js-utils":82}],123:[function(t,e,i){function n(t){o.GroupNode.call(this),this._element=t}var o=t("../../../lib/scene-graph"),s=t("@maps/js-utils");n.prototype=s.inheritPrototype(o.GroupNode,n,{get element(){return this._element},stringInfo:function(){return"AnnotationsControllerNode"}}),e.exports=n},{"../../../lib/scene-graph":51,"@maps/js-utils":82}],124:[function(t,e,i){function n(t){var e=y.htmlElement("div",{class:M.ANNOTATIONS});if(!y.supportsShadowDOM)return e;var i=e.insertBefore;return e.insertBefore=function(e,n){i.call(this,e,n);var o=e.firstChild,s=t.getAssignedElement(o);if(s&&s.parentNode&&0===o.assignedNodes().length){var a=s.nextSibling;t.hostNode.element.removeChild(s),t.hostNode.element.insertBefore(s,a)}return e},e}function o(e){if(c.call(this,e),this._pendingAnnotations=[],this._clustersController=new h(this),window.document){this._node=new E.Node(y.htmlElement("div",{class:M.CONTAINER})),this._shadowDOMSlotController=new v(this._node);var i=n(this._shadowDOMSlotController);this._sceneGraphNode=new d(i),this._shadowRootNode=y.addShadowRootChild(this._node,t("../annotations-css")),this._annotationsNode=this._shadowRootNode.addChild(new E.Node(i)),this._calloutsNode=this._shadowRootNode.addChild(new E.Node(y.htmlElement("div"))),this._calloutsNode.classList.add(M.CALLOUTS),this._styleHelper=new g(this),this._shadowRootNode.addChild(new E.Node(this._styleHelper.element)),this._annotationDraggingMapPanningController=new l(e)}else this._sceneGraphNode=new d}function s(t,e,i){return new S(t.origin.x-e,t.origin.y-i,t.size.width,t.size.height)}function a(){if(this._draggedAnnotation&&!this._mapWasDestroyed){var t=this._draggedAnnotation._impl.dispatchDraggingEvent();this._map.dispatchEventWithAnnotation(t.type,this._draggedAnnotation,{coordinate:t.coordinate})}}var r=t("../../../lib/geo"),l=t("./annotation-dragging-map-panning-controller"),h=t("./clusters-controller"),c=t("../layer-items-controller"),d=t("./annotations-controller-node"),u=t("./annotation"),p=t("./annotation-internal-mixin"),m=t("../services/geocoder"),g=t("../style-helper"),_=r.MapRect,f=t("./user-location-annotation"),y=t("../utils"),v=t("../shadow-dom-slot-controller"),w=t("../call-function-safely"),b=t("@maps/js-utils"),C=t("@maps/geometry/point"),S=t("@maps/geometry/rect");if(window.document)var k=t("./callout"),E=t("@maps/render-tree");var T=t("@maps/scheduler"),L=t("../../../lib/debounce"),M={CONTAINER:"mk-annotation-container",ANNOTATIONS:"mk-annotations",CALLOUTS:"mk-callouts",DRAGGING:"mk-dragging",SELECTED:"mk-selected",LIFTED:"mk-lifted"},x=null;o.prototype=b.inheritPrototype(c,o,{itemConstructor:u,itemName:"annotation",capitalizedItemName:"Annotation",_rtl:!1,_selectionDistance:Math.pow(c.prototype._selectionDistance,2),get sceneGraphNode(){return this._sceneGraphNode},isItemExposed:function(t){return t!==this._userLocationAnnotation&&!t.memberAnnotations},_userLocationAnnotation:null,get userLocationAnnotation(){return this._userLocationAnnotation},get dragging(){return!!this._draggedAnnotation},set rtl(t){this._rtl!==t&&(this._rtl=t,this._selectedItem&&this._callout&&this._showCalloutForAnnotation(this._selectedItem,!0))},preAddedAnnotation:function(t){if(!t._impl.updatedPosition())return!1;var e=!t.map,i=y.supportsShadowDOM&&this._annotationsNode&&t._impl.needsInitialSizeMeasuredFromDOMElement&&!t.element.parentNode;return i&&this._shadowDOMSlotController.appendAssignedElement(t.element,!1),e&&t._impl.setDelegate(this),e||i},resetAnnotation:function(t){y.supportsShadowDOM&&this._annotationsNode&&t._impl.needsInitialSizeMeasuredFromDOMElement&&t.element.parentNode&&this._shadowDOMSlotController.removeAssignedElement(t._impl.elementInAnnotationDOM,!1),-1===this._items.indexOf(t)&&delete t._impl.delegate},addItems:function(t){if(t=c.prototype.addItems.call(this,t),this._shouldAnnotationBePending())return t;t.sort(function(t,e){return e.coordinate.latitude-t.coordinate.latitude});var e=this._map.camera.toMapRect(),i=e.size.width,n=e.size.height,o=e.origin.x-i,s=o+3*i,a=e.origin.y-n,r=a+3*n,l=0;t.forEach(function(t){t._impl.doesAnimate()&&t.visible&&t._impl.x+(t._impl.x<o?1:0)<=s&&t._impl.y>=a&&t._impl.y<=r&&(t._impl.delayRank=l,++l)});var h=Math.min(50*l,3e3),d=0===l?0:h/l;return t.forEach(function(t){t._impl.delayMs=t._impl.delayRank*d,delete t._impl.delayRank},this),t},addWaitingAnnotations:function(t){var e="function"==typeof t;this._waitingAnnotations?(e&&(this._completionCallback=t),window.clearTimeout(this._tileLoadingTimeout),delete this._tileLoadingTimeout,this._waitingAnnotations.forEach(function(t){t.map&&this._addAnnotationWaitingForTiles(t,!1,!e)},this),this._updateSceneGraph(),delete this._waitingAnnotations,T.scheduleOnNextFrame(this._checkCompletion.bind(this))):e&&t()},annotationsInMapRect:function(t){b.checkInstance(t,_,"[MapKit] Map.annotationsInMapRect expects a MapRect as its argument, got `"+t+"` instead.");var e=b.mod(t.origin.x,1),i=e+t.size.width,n=t.origin.y,o=n+t.size.height;return this._items.filter(function(t){if(!this.isItemExposed(t))return!1;var s=t._impl.x+(t._impl.x<e?1:0),a=t._impl.y;return s>=e&&s<=i&&a>=n&&a<=o},this)},removeItem:function(t){return t===this._userLocationAnnotation?(console.warn("[MapKit] Map.removeAnnotation: the user location annotation cannot be removed. Set showsUserLocation to false instead."),t):c.prototype.removeItem.call(this,t)},removeUserLocationAnnotation:function(){this._userLocationAnnotation&&(this._userLocationAnnotation._impl.removedFromMap(),c.prototype.removeAnyItem.call(this,this._userLocationAnnotation),delete this._userLocationAnnotation)},updateUserLocationAnnotation:function(t,e){if(t.coordinate){var i=this._userLocationAnnotation||new f(t);if(this._userLocationAnnotation||(this._userLocationAnnotation=i,this.addItem(i,0)),t.stale)return delete this._lastGeocoderRequestCoordinate,delete this._lastUserLocationAnnotationSubtitle,void(i._impl.stale=!0);if(i._impl.stale=!1,i._impl.setCoordinate(t.coordinate),x){if(!e&&this._lastGeocoderRequestCoordinate&&this._lastGeocoderRequestCoordinate.latitude===i._impl.coordinate.latitude&&this._lastGeocoderRequestCoordinate.longitude===i._impl.coordinate.longitude)return void(this._userLocationAnnotation.subtitle=this._lastUserLocationAnnotationSubtitle)}else x=new m;this._lastGeocoderRequestCoordinate=i._impl.coordinate.copy(),A(x,i,this)}},mapSizeDidUpdate:function(){if(0!==this._pendingAnnotations.length){var t=this._map.shouldWaitForTilesAndControls();this._pendingAnnotations.forEach(function(e){e._impl.isPending&&this._addAnnotationWaitingForTiles(e,t)},this),this._updateSceneGraph(),this._pendingAnnotations=[]}},updateVisibleAnnotations:function(){0!==this._items.length&&(this._updateVisibleAnnotations(this._items),this._updateSceneGraph())},startDraggingAnnotation:function(t,e){this._map.annotationDraggingWillStart(),this._draggedAnnotation=t,this._pendingDragStart=!0,t.selected&&this._hideCallout(t),this._node.classList.add(M.DRAGGING),this._draggedAnnotation._impl.node.classList.add(M.LIFTED),this._draggedAnnotation._impl.lift(40),this._updateSceneGraph()},mapNodeTintWasSet:function(t){this._items.forEach(function(t){t._impl.updateLayout()})},devicePixelRatioDidChange:function(){this._items.forEach(function(t){"function"==typeof t._impl.updateGlyphImages&&t._impl.updateGlyphImages()})},styleHelperNodeDidMoveToParent:function(t){if(y.supportsShadowDOM){var e=t.assignedNodes?t:t.querySelector("slot"),i=e&&this._shadowDOMSlotController.getAssignedElement(e);e&&i&&i.parentNode&&0===e.assignedNodes().length&&(this._node.element.removeChild(i),this._node.element.appendChild(i))}},getShadowDOMTargetFromEvent:function(t){if(this._shadowRootNode.domNode)return y.getShadowDOMTargetFromEvent(this._shadowRootNode.domNode,t)},handleEvent:function(t){switch(t.type){case"region-change-start":this._nudgeStarted=!0,this._map.public.addEventListener("region-change-end",this);break;case"region-change-end":!this._nudgeStarted&&this._nudgeMapToShowCallout()||(delete this._nudgeStarted,this._callout&&this._callout.animateIn(),this._map.public.removeEventListener(t.type,this))}},performScheduledUpdate:a,addedItem:function(t,e){c.prototype.addedItem.call(this,t,e),t._impl.isWaiting=!0,e&&(t._impl.delayRank=0);var i=this._shouldAnnotationBePending(t);i&&(t._impl.isPending=!0,this._pendingAnnotations.push(t)),this._updateAnnotation(t),t._impl.selected&&this._didSelectAnnotation(t),i||this._addAnnotationWaitingForTiles(t,this._map.shouldWaitForTilesAndControls())},manyItemsAdded:function(t){this._updateSceneGraph()},removedItem:function(t){delete t._impl.wasCollided,"function"==typeof t._impl.node.remove&&(y.supportsShadowDOM&&t._impl.node.parent&&this._shadowDOMSlotController.removeAssignedElement(t._impl.elementInAnnotationDOM,!t._impl.needsInitialSizeMeasuredFromDOMElement),t._impl.node.remove()),c.prototype.removedItem.call(this,t),t._impl.labelRegion&&this._removeLabelRegionForAnnotation(t),this._updateVisibleAnnotations([t]),this._clustersController.removedAnnotation(t),t.memberAnnotations||this._updateCollisions(this._items)},manyItemsRemoved:function(t){this._updateSceneGraph()},manyItemsChanged:function(t){this._updateSceneGraph()},removedReferenceToMap:function(){this._userLocationAnnotation&&this._userLocationAnnotation._impl.removedFromMap()},pickableItemsCloseToPoint:function(t,e){var i=t.filter(function(t,i){var n=t._impl.distanceToPoint(e);return n<=this._selectionDistance&&(t._impl.distance=n,t._impl.index=i,!0)},this).sort(function(t,e){return t._impl.distance-e._impl.distance||e._impl.index-t._impl.index});return i.forEach(function(t){delete t._impl.distance,delete t._impl.index}),i},annotationDraggingDidChange:function(t){this._draggedAnnotation&&!this._draggedAnnotation._impl.shouldPreventDrag&&(this._pendingDragStart&&(delete this._pendingDragStart,this._draggedAnnotation._impl.draggingDidStart(),this._map.dispatchEventWithAnnotation(p.Events.DragStart,this._draggedAnnotation)),T.scheduleASAP(this),this._draggedAnnotation._impl.setDraggingTranslationForMapFrameSize(t,this._map.ensureRenderingFrame().size),this._annotationDraggingMapPanningController.update(this._draggedAnnotation,this._draggedAnnotation._impl.node))},annotationDraggingDidEnd:function(t){this._draggedAnnotation&&(this._annotationDraggingMapPanningController.stop(),this._draggedAnnotation._impl.dropAfterDraggingAndRevertPosition(!t),this._draggedAnnotation._impl.node.classList.remove(M.LIFTED),this._node.classList.remove(M.DRAGGING),this._map.annotationDraggingDidEnd(),this._map.dispatchEventWithAnnotation(p.Events.DragEnd,this._draggedAnnotation),delete this._draggedAnnotation,this._updateSceneGraph())},annotationPropertyDidChange:function(t,e){if(!(k&&t instanceof k)){switch(e){case"selected":t.selected?this._didSelectAnnotation(t):this._didDeselectAnnotation(t);break;case"coordinate":if(!t._impl.updatedPosition())return;break;case"":case"displayPriority":case"collisionMode":case"padding":break;case"calloutOffset":this._updateCalloutPositionWithTailShift(t,!0);break;case"visible":this._selectedItem===t&&(this._callout?this._callout.visible=t.visible:t.visible&&this._showCalloutForAnnotation(t,!0)),t._impl.needsColliding=!0;break;case"draggable":this._draggedAnnotation!==t||t.draggable||this._map.stopDraggingAnnotation();break;default:this._selectedItem===t&&(this._updateCalloutInfo(t),this._updateCalloutTailShift())}this._annotationsDidChangeSinceLastCollision=!0,this._updateVisibleAnnotations([t]),this._updateSceneGraph(),this._updateLabelRegionForAnnotation(t)}},mapForAnnotation:function(t){return this._map?this._map.public:null},sizeForElement:function(t){if(this._map.isRooted())return this._styleHelper.sizeForElement(t)},backgroundColorForElement:function(t,e){return this._styleHelper.backgroundColorForElement(t,e)},setAnimationForElement:function(t,e,i){return this._styleHelper.setAnimationForElement(t,e,i)},selectedAnnotationDidMoveToMap:function(t){this._updateSceneGraph(),this._showCalloutForAnnotation(t)},supportsLabelRegions:function(){return this._map.supportsLabelRegions()},annotationFinishedAnimating:function(t){this._checkCompletion()},isElementInCallout:function(t){return!!this._callout&&this._callout.containsElement(t)},isElementInCustomCallout:function(t){return!!this._callout&&this._callout.isCustomCallout()&&this._callout.node.element.contains(t)},mapPanningDuringAnnotationDrag:a,mapSupportForLabelRegionsChanged:function(){this._items.forEach(function(t){var e=t._impl;e.updateLayout(),delete e.labelRegion,this._updateLabelRegionForAnnotation(t)},this)},containsMarkerAnnotation:function(){return this._items.some(function(t){return"string"==typeof t.glyphText})},paddingForAnnotation:function(t){var e={top:t._impl._anchorPoint.y,right:t.size.width-t._impl._anchorPoint.x,bottom:t.size.height-t._impl._anchorPoint.y,left:t._impl._anchorPoint.x};if(t===this.selectedItem&&this._callout){var i=this._callout.boundingRect,n=t._impl.position();e.top=Math.max(e.top,n.y-i.minY()),e.right=Math.max(e.right,i.maxX()-n.x),e.bottom=Math.max(e.bottom,i.maxY()-n.y),e.left=Math.max(e.left,n.x-i.minX())}return e},calloutNodeDidRemove:function(t){y.supportsShadowDOM&&(t.isCustomCallout()&&"slot"===t.customOrContentElement.localName&&this._shadowDOMSlotController.removeAssignedElement(t.customOrContentElement),t.customLeftAccessory&&"slot"===t.customLeftAccessory.localName&&this._shadowDOMSlotController.removeAssignedElement(t.customLeftAccessory),t.customRightAccessory&&"slot"===t.customRightAccessory.localName&&this._shadowDOMSlotController.removeAssignedElement(t.customRightAccessory))},_addAnnotationToMapAsync:function(t){this._addAnnotationToMap(t,!1),this._updateSceneGraph()},_addAnnotationToMap:function(t,e){if(this._shouldAnnotationBePending())t._impl.isPending=!0;else{y.supportsShadowDOM&&this._annotationsNode&&this._shadowDOMSlotController.appendAssignedElement(t.element,!t._impl.needsInitialSizeMeasuredFromDOMElement),t._impl.willMoveToMap(t._impl.canAnimate&&!e),delete t._impl.timeout,delete t._impl.isWaiting,delete t._impl.canAnimate,delete t._impl.delayMs;var i=this._items.indexOf(t);this._annotationsNode&&this._annotationsNode.addChild(t._impl.node,i),t._impl.sceneGraphNode&&this._sceneGraphNode.addChild(t._impl.sceneGraphNode,i),this._updateAnnotation(t),t.selected&&this._showCalloutForAnnotation(t),this._updateLabelRegionForAnnotation(t),t._impl.didMoveToMap()}},_addAnnotationWaitingForTiles:function(t,e,i){Object.prototype.hasOwnProperty.call(t._impl,"canAnimate")||(t._impl.canAnimate=!t._impl.isPending),delete t._impl.isPending,!e||t===this._userLocationAnnotation||this._items.some(function(t){return t!==this._userLocationAnnotation&&t._impl.mayBeDrawn()})?!i&&t._impl.doesAnimate()&&t._impl.delayMs>0?t._impl.timeout=window.setTimeout(this._addAnnotationToMapAsync.bind(this,t),t._impl.delayMs):this._addAnnotationToMap(t,i):this._waitingAnnotations?this._waitingAnnotations.push(t):(this._waitingAnnotations=[t],this._tileLoadingTimeout=window.setTimeout(this.addWaitingAnnotations.bind(this,b.noop),3e3))},_didDeselectAnnotation:function(t){t._impl.node.classList.remove(M.SELECTED),this.selectedItem=null,this._map.annotationSelectionDidChange(t),this._hideCallout(t)},_didSelectAnnotation:function(t){t._impl.node.classList.add(M.SELECTED),this.selectedItem=t,this._map.annotationSelectionDidChange(t),t._impl.visible&&this._showCalloutForAnnotation(t)},_boundingRectForSelectedAnnotationAndCallout:function(){var t=this._callout.boundingRect,e=this._selectedItem._impl.position(),i=Math.min(t.minX(),e.x),n=Math.min(t.minY(),e.y),o=Math.max(t.maxX(),e.x)-i,s=Math.max(t.maxY(),e.y)-n;return new S(i,n,o,s)},_updateCalloutTailShift:function(t){if(!this._callout)return!1;var e=t?this._callout.boundingRect.pad(12):this._boundingRectForSelectedAnnotationAndCallout().pad(12),i=this._totalMapNudgingTranslation(e,this._map.ensureVisibleFrame(),t),n=i.x,o=i.y,s=this._callout.shiftTailBy(n);return 0!==n||0!==o?new C(-(n+s),-o):void 0},_nudgeMapToShowCallout:function(){if(this._map.cameraIsPanning||this._map.cameraIsZooming)return this._map.public.addEventListener("region-change-end",this),!0;if(!this._selectedItem._impl.isShown())return!1;var t=this._updateCalloutTailShift();return!!t&&(this._map.public.addEventListener("region-change-start",this),this._map.translateCameraAnimated(t,!0),this._map.public.removeEventListener("region-change-start",this),!!this._nudgeStarted)},_translationToFitInFrame:function(t,e){var i={x:0,y:0};return(t.maxX()>e.maxX()||t.minX()<e.minX()||t.maxY()>e.maxY()||t.minY()<e.minY())&&(i.x=t.minX()<e.minX()?t.minX()-e.minX():t.maxX()>e.maxX()?t.maxX()-e.maxX():0,i.y=t.minY()<e.minY()?t.minY()-e.minY():t.maxY()>e.maxY()?t.maxY()-e.maxY():0),i},_totalMapNudgingTranslation:function(t,e,i){var n=this._translationToFitInFrame(t,e),o=this._map.controlsLayer.controlBounds(),a=e.midX(),r=e.midY(),l=0,h=0;return t=s(t,n.x,n.y),o.forEach(function(e){if(t.minX()<e.maxX()&&t.maxX()>e.minX()&&t.minY()<e.maxY()&&t.maxY()>e.minY()){if(l+=e.maxX()<a?t.minX()-e.maxX():t.maxX()-e.minX(),h+=e.maxY()<r?t.minY()-e.maxY():t.maxY()-e.minY(),i)return;0!==h&&Math.abs(l)>Math.abs(h)?l=0:h=0,t=s(t,l,h)}},this),n.x+=l,n.y+=h,n},_hideCallout:function(t){t._impl.calloutWillDisappear(),this._callout&&(this._callout.node.classList.remove(M.SELECTED),this._callout.animateOut(),delete this._callout)},_shouldAnnotationBePending:function(){return!this._map.isRooted()},_showCalloutForAnnotation:function(t,e){if(this._hideCallout(t),!t._impl.canShowCallout())return t._impl.calloutWillAppear(!1);var i=t._impl.callout;if(i&&"function"==typeof i.calloutShouldAppearForAnnotation&&!w(i.calloutShouldAppearForAnnotation,i,[t],!0))return t._impl.calloutWillAppear(!1);var n,o=i&&"function"==typeof i.calloutElementForAnnotation;o&&(n=w(i.calloutElementForAnnotation,i,[t]),b.checkElement(n,"[MapKit] calloutElementForAnnotation() must return a DOM element, but returned `"+n+"` instead."));var s,a=!1;if(!n&&((a=i&&"function"==typeof i.calloutContentForAnnotation)&&(s=w(i.calloutContentForAnnotation,i,[t]),b.checkElement(s,"[MapKit] contentElementForAnnotation() must return a DOM element, but returned `"+s+"` instead.")),!a&&!t.title))return t._impl.calloutWillAppear(!1);t._impl.calloutWillAppear(!0);var r,l=i&&"function"==typeof i.calloutLeftAccessoryForAnnotation;l&&(r=w(i.calloutLeftAccessoryForAnnotation,i,[t]),b.checkElement(r,"[MapKit] calloutLeftAccessoryForAnnotation() must return a DOM element, but returned `"+r+"` instead."));var h,c=i&&"function"==typeof i.calloutRightAccessoryForAnnotation;c&&(h=w(i.calloutRightAccessoryForAnnotation,i,[t]),b.checkElement(h,"[MapKit] calloutRightAccessoryForAnnotation() must return a DOM element, but returned `"+h+"` instead."));var d=t._impl.ignoreCalloutCornerRadiusForLeftAccessory&&!l&&!c;!l&&t._impl.canvasForCalloutAccessory&&(r=t._impl.canvasForCalloutAccessory());var u,p;y.supportsShadowDOM&&(o&&(u="mk-slot-"+Math.random().toString(32).substr(2,8),n.slot=u,(p=y.htmlElement("slot")).name=u,this._shadowDOMSlotController.appendAssignedElement(n),n=p),a&&(u="mk-slot-"+Math.random().toString(32).substr(2,8),s.slot=u,(p=y.htmlElement("slot")).name=u,this._shadowDOMSlotController.appendAssignedElement(s),s=p),l&&(u="mk-slot-"+Math.random().toString(32).substr(2,8),r.slot=u,(p=y.htmlElement("slot")).name=u,this._shadowDOMSlotController.appendAssignedElement(r),r=p),c&&(u="mk-slot-"+Math.random().toString(32).substr(2,8),h.slot=u,(p=y.htmlElement("slot")).name=u,this._shadowDOMSlotController.appendAssignedElement(h),h=p)),this._callout=new k(this,{customElement:n,contentElement:s,ignoreCalloutCornerRadiusForLeftAccessory:d,leftAccessory:this._rtl?h:r,rightAccessory:this._rtl?r:h,rtl:this._rtl}),this._callout.animates=!e&&(!i||"function"!=typeof i.calloutShouldAnimateForAnnotation||!!w(i.calloutShouldAnimateForAnnotation,i,[t],!0));var m=o&&this._callout.animates&&i&&"function"==typeof i.calloutAppearanceAnimationForAnnotation?w(i.calloutAppearanceAnimationForAnnotation,i,[t],""):"";if(b.checkType(m,"string","[MapKit] calloutAppearanceAnimationForAnnotation() must return a string, but returned `"+m+"` instead."),this._callout.appearanceAnimation=m,n){var g;i&&"function"==typeof i.calloutAnchorOffsetForAnnotation&&(g=w(i.calloutAnchorOffsetForAnnotation,i,[t,this._callout.node.size]),b.checkInstance(g,window.DOMPoint,"[MapKit] calloutAnchorOffsetForAnnotation() must return a DOMPoint, but returned `"+g+"` instead.")),this._callout.setAnchorOffset(g)}this._updateCalloutInfo(t),this._updateCalloutPositionWithTailShift(t,!1);var _=!e&&this._nudgeMapToShowCallout();this._callout.willMoveToMap(),this._callout.node.classList.add(M.SELECTED),this._calloutsNode.addChild(this._callout.node),this._callout.appearanceAnimation&&this._calloutsNode.element.appendChild(this._callout.node.element),_||this._callout.animateIn()},mapWasDestroyed:function(){c.prototype.mapWasDestroyed.call(this),this._annotationDraggingMapPanningController&&this._annotationDraggingMapPanningController.mapWasDestroyed(),this._clustersController.mapWasDestroyed(),this._mapWasDestroyed=!0},_updateCalloutInfo:function(t){this._callout?this._callout.updateInfo(t,12)||this._hideCallout(t):this._showCalloutForAnnotation(t)},_updateCalloutPositionWithTailShift:function(t,e){this._selectedItem===t&&this._callout&&(this._callout.setShown(t._impl.isShown()),this._callout.setPosition(t._impl.positionForCallout()),e&&this._updateCalloutTailShift(e))},_updateLabelRegionForAnnotation:function(t){var e=t._impl;if(e.shouldHideLabels){e.labelRegion||(e.labelRegion=this._map.createLabelRegion());var i=e.labelRegion;if(i){var n=e.node.size,o=n.width,s=n.height;i.x=e.x,i.y=1-e.y,i.width=o,i.height=s,i.xOffset=o/2-e._anchorPoint.x-e._anchorOffset.x,i.yOffset=e._anchorPoint.y+e._anchorOffset.y-s/2,this._map.updatedLabelRegion()}}},_removeLabelRegionForAnnotation:function(t){this._map.unregisterLabelRegion(t._impl.labelRegion),delete t._impl.labelRegion},_updateVisibleAnnotations:function(t,e){e||this._deletePreviousPointForPickingItem();var i=this._map,n=i.camera.toRenderingMapRect(),o=n.size.width,s=n.size.height,a=n.minX(),l=n.maxX(),h=a-o,c=l+o,d=n.minY()-s,u=d+3*s;t.forEach(function(t){if(t!==this._draggedAnnotation||!this._annotationDraggingMapPanningController.panning){var e=t._impl.x+(t._impl.x<h?1:t._impl.x>c?-1:0);e>=h&&e<=c&&t._impl.y>=d&&t._impl.y<=u?(t._impl.isShown()||t!==this._selectedItem||this._showCalloutForAnnotation(t,!0),t._impl.setShown(!0),t._impl.setPosition(i.adjustMapItemPoint(i.camera.transformMapPoint(new C(r.clampX(e,a,l),t._impl.y))))):t._impl.setShown(!1)}},this),this._updateCalloutPositionWithTailShift(this._selectedItem,!0),e||this._updateCollisions(t)},_updateCollisions:function(t){var e=!1,i=this._items.filter(function(t){var i=t.visible&&t._impl.isShown(),n=(i||t._impl.needsColliding)&&t!==this._userLocationAnnotation;return delete t._impl.needsColliding,n&&(t.displayPriority<u.DisplayPriority.Required||t.clusteringIdentifier)&&(e=!0),n&&i&&!t.memberAnnotations},this);if(e){var n=this._map;this._clustersController.collideAnnotations(i,n.zoomLevel,n.rotation,this._annotationsDidChangeSinceLastCollision)}this._annotationsDidChangeSinceLastCollision=!1},addCluster:function(t){try{var e="function"==typeof this._map.annotationForCluster?w(this._map._annotationForCluster,this._map.public,[t],t):t;e=this._clustersController.setRequiredClusterAnnotationProperties(e,t),this.addItem(e)}catch(i){console.warn("[MapKit] annotationForCluster: the following error occurred; reverting to default annotation: "+i),e=this.addItem(t)}return e._impl.customCluster=e!==t,e._impl.updateLayout(!0),e},willUpdateCollisions:function(){this._items.forEach(function(t){t._impl.wasOccluded=t._impl.occluded,t._impl.previousCluster=t._impl.cluster})},didUpdateCollisions:function(){this._items.forEach(function(t){var e=t._impl;e.wasCollided||e.occluded||(e.wasCollided=!0),t.memberAnnotations&&t.memberAnnotations[0]._impl.cluster!==t&&(e.cluster=e.memberAnnotations[0]._impl.cluster),e.updateVisibility(e.occluded),e.occluded!==e.wasOccluded&&e.animateOcclusion(),delete e.previousCluster,e.shouldHideLabels&&(e.occluded||e.labelRegion?e.occluded&&e.labelRegion&&this._removeLabelRegionForAnnotation(t):this._updateLabelRegionForAnnotation(t))},this),this._items.forEach(function(t){delete t._impl.wasOccluded}),this._updateVisibleAnnotations(this._items,!0),this._updateSceneGraph()},deselectClusterAnnotation:function(){this._selectedItem&&this._selectedItem.memberAnnotations&&(this._selectedItem.selected=!1)},_updateAnnotation:function(t){t._impl.updatedPosition()&&this._updateVisibleAnnotations([t])},_updateSceneGraph:function(){var t=this._selectedItem,e=this._draggedAnnotation,i=this._items.filter(function(i){return i._impl.isDrawn()&&i!==t&&i!==e}).map(function(t){return t._impl.sceneGraphNode});t&&t._impl.isDrawn()&&i.push(t._impl.sceneGraphNode),e&&e._impl.isDrawn()&&i.push(e._impl.sceneGraphNode),this._sceneGraphNode.children=i},_checkCompletion:function(){this._mapWasDestroyed||(this._annotationsDidChangeSinceLastCollision=!0,this._updateVisibleAnnotations(this._items),this._updateSceneGraph(),this._completionCallback&&(this._items.some(function(t){return!t._impl.isStable()})||"function"!=typeof this._completionCallback||(this._completionCallback(),delete this._completionCallback)))}});var A=L(function(t,e,i){i._geocoderRequestId&&t.cancel(i._geocoderRequestId);var n=i._geocoderRequestId=t.reverseLookup(e._impl.coordinate,function(t,o){n===i._geocoderRequestId&&(delete i._geocoderRequestId,t?(console.error("[MapKit] Error getting address for user location: "+t.message),e.subtitle=null):o.results.length>0?i._lastUserLocationAnnotationSubtitle=e.subtitle=o.results[0].formattedAddress:e.subtitle=null)})},1e3);e.exports=o},{"../../../lib/debounce":3,"../../../lib/geo":4,"../annotations-css":115,"../call-function-safely":161,"../layer-items-controller":185,"../services/geocoder":223,"../shadow-dom-slot-controller":229,"../style-helper":231,"../utils":237,"./annotation":122,"./annotation-dragging-map-panning-controller":117,"./annotation-internal-mixin":118,"./annotations-controller-node":123,"./callout":125,"./clusters-controller":128,"./user-location-annotation":160,"@maps/geometry/point":71,"@maps/geometry/rect":72,"@maps/js-utils":82,"@maps/render-tree":98,"@maps/scheduler":100}],125:[function(t,e,i){function n(t){u.Node.call(this,m.htmlElement("div",{class:R.CALLOUT,style:"direction: ltr"})),this._callout=t}function o(t,e){function i(e){return t.backgroundColorForElement(e,!0)}function o(t,e){var i=m.htmlElement("div",{class:R.CALLOUT_ACCESSORY_CONTENT},t);return i.style.maxWidth=L/2+"px",e&&(i.style.padding="0"),m.htmlElement("div",{class:R.CALLOUT_ACCESSORY},i)}l.call(this),this.delegate=t,this._rtl=e.rtl,this._node=new n(this);var s=this._node.element;e.customElement?(this._containerElement=this._customElement=e.customElement,this.setSize(this.delegate.sizeForElement(this._customElement)),s.appendChild(e.customElement)):(this._ignoreCalloutCornerRadiusForLeftAccessory=e.ignoreCalloutCornerRadiusForLeftAccessory,this._tailSide=e.tailSide||f.Bottom,this._tailScale=e.tailScale||1,this._bubbleElement=m.svgElement("path"),this._svgElement=s.appendChild(m.svgElement("svg",{class:R.CALLOUT_BUBBLE},this._bubbleElement)),this._containerElement=m.htmlElement("div"),this._containerElementNode=new u.Node(this._containerElement),e.leftAccessory&&(this._leftAccessoryBackgroundColor=i(e.leftAccessory),this._leftAccessory=o(e.leftAccessory,!this._rtl&&this._ignoreCalloutCornerRadiusForLeftAccessory),this._containerElement.appendChild(this._leftAccessory)),this._containerContentElement=this._containerElement.appendChild(m.htmlElement("div")),this._containerContentElement.className=R.CALLOUT_CONTENT,e.rightAccessory&&(this._rightAccessoryBackgroundColor=i(e.rightAccessory),this._rightAccessory=o(e.rightAccessory,this._rtl&&this._ignoreCalloutCornerRadiusForLeftAccessory),this._containerElement.appendChild(this._rightAccessory)),(this._leftAccessoryBackgroundColor||this._rightAccessoryBackgroundColor)&&(this._calloutId=r(),this._linearGradientElement=m.svgElement("linearGradient",{id:this._calloutId}),this._svgElement.appendChild(m.svgElement("defs",this._linearGradientElement))),e.contentElement?this._setContentElement(e.contentElement):(this._containerElementNode.classList.add(R.STANDARD_CONTENT),e.rtl&&(this._containerContentElement.className+=" "+R.RTL)),s.appendChild(this._containerElement)),e.position&&this.setPosition(e.position),this._node.wantsHardwareCompositing=!0}function s(t){return(t-T)/(2*C)}function a(t,e){e||(e={});var i=e.tailShift||0,n=e.side||f.Bottom,o=e.scale||1,s=C*o,a=v*o,r=t.height/2-s,l=t.width/2-s,h=S*o,c=k*o;return"M"+(n===f.Left?a:0)+","+y+"c0,"+(b-y)+" "+w+","+-y+" "+y+","+-y+"h"+t.width+"c"+(y-w)+",0 "+y+","+b+" "+y+","+y+(n===f.Right?"v"+(r+i)+"c0,"+h+" "+a+","+c+" "+a+","+s+"c0,"+(s-c)+" "+-a+","+(s-h)+" "+-a+","+s+"v"+(r-i):"v"+t.height)+"c0,"+(y-b)+" "+-w+","+y+" "+-y+","+y+(n===f.Bottom?"h"+(-i-l)+"c"+-h+",0 "+-c+","+a+" "+-s+","+a+"c"+(c-s)+",0 "+(h-s)+","+-a+" "+-s+","+-a+"h"+(i-l):"h"+-t.width)+"c"+(w-y)+",0 "+-y+","+-b+" "+-y+","+-y+(n===f.Left?"v"+(i-r)+"c0,"+-h+" "+-a+","+-c+" "+-a+","+-s+"c0,"+(c-s)+" "+a+","+(h-s)+" "+a+","+-s+"v"+(-i-r):"z")}function r(){var t=Math.random().toString(36).substr(2);return document.getElementById(t)?r():t}var l=t("./annotation-layer-item-internal"),h=t("@maps/geometry/point"),c=t("@maps/geometry/rect"),d=t("@maps/geometry/size"),u=t("@maps/render-tree"),p=t("@maps/css-transform"),m=t("../utils"),g=t("@maps/js-utils"),_=t("@maps/scheduler"),f=l.CalloutTailSide,y=10.5,v=13,w=3.5826363,b=3.58028186,C=17,S=10,k=12,E=91-C,T=3,L=373,M=50+v,x=55+v,A=1+2*y,I={default:{left:10,right:10,content:{left:4,right:4}},withIcon:{left:7.5,right:10},withAccessories:{left:7.5,right:7.5}},O={default:5.5,withCustomContent:0},R={CALLOUT:"mk-callout",CALLOUT_BUBBLE:"mk-bubble",TITLE:"mk-title",SUBTITLE:"mk-subtitle",NO_SUBTITLE:"mk-no-subtitle",NO_ACESSORIES:"mk-no-accessories",STANDARD_CONTENT:"mk-standard",CALLOUT_ACCESSORY:"mk-callout-accessory",CALLOUT_CONTENT:"mk-callout-content",CUSTOM_CONTENT:"mk-custom-content",CALLOUT_ACCESSORY_CONTENT:"mk-callout-accessory-content",RTL:"mk-rtl"};n.prototype=g.inheritPrototype(u.Node,n,{constructor:n,didMoveToParent:function(t){null===t&&this._callout.didRemoveFromParent()}}),o.prototype=g.inheritPrototype(l,o,{_tailShift:0,get node(){return this._node},get boundingRect(){var t=this._node.position;return new c(t.x,t.y,this._node.size.width,this._node.size.height)},delegate:null,willMoveToMap:function(){this._node.transform=(new p).scale(0)},setAnchorOffset:function(t){this._anchorOffset=t?new window.DOMPoint(t.x,t.y):new window.DOMPoint},containsElement:function(t){if(t===this._svgElement)return!1;if(this._containerElement.contains(t))return!0;if(!m.supportsShadowDOM||!this.isCustomCallout())return!1;var e=this.customOrContentElement.assignedNodes()[0];return!!e&&e.contains(t)},isCustomCallout:function(){return!!this.customOrContentElement},get customOrContentElement(){return this._customElement||this._contentElement},get customLeftAccessory(){if(this._leftAccessory)return this._leftAccessory.firstChild.firstChild},get customRightAccessory(){if(this._rightAccessory)return this._rightAccessory.firstChild.firstChild},updateInfo:function(t,e){if(this.isCustomCallout())return!0;if(!t||!t.title)return!1;this._containerContentElement.innerHTML="",this._containerElement.style.width="",this._containerContentElement.appendChild(m.htmlElement("div",{class:R.TITLE},t.title)),t.subtitle?(this._containerContentElement.appendChild(m.htmlElement("div",{class:R.SUBTITLE},t.subtitle)),this._containerElementNode.classList.remove(R.NO_SUBTITLE)):(this._containerElementNode.classList.add(R.NO_SUBTITLE),this._containerElementNode.classList.toggle(R.NO_ACESSORIES,!this._leftAccessory&&!this._rightAccessory)),this._updateAccessoryViews(),this._containerElement.className=this._containerElementNode.classList.toString();var i=this.delegate.sizeForElement(this._containerElement),n=t.map._impl.ensureVisibleFrame().size.width-2*e-this._extraWidth(this._ignoreCalloutCornerRadiusForLeftAccessory);return i.width=g.clamp(i.width,E,g.clamp(n,E,L)),0!==this._accessoryHeight&&(i.height=Math.max(this._accessoryHeight,i.height)),this._updateSize(i),this.updatePosition(),!0},shiftTailBy:function(t){if(this._customElement)return 0;var e=this._tailSide===f.Bottom?new d(this._node.size.width-A,this._node.size.height-this._extraHeight):new d(this._node.size.width-this._extraHeight,this._node.size.height-A),i=this._tailSide===f.Bottom?e.width:e.height,n=Math.max(0,(i-E-y)/2);return this._tailShift=t<0?Math.min(n,-t):-Math.min(n,t),this._bubbleElement.setAttribute("d",a(e,{side:this._tailSide,scale:this._tailScale,tailShift:this._tailShift})),this._node.position=this._tailSide===f.Bottom?new h(this._node.position.x+this._tailShift,this._node.position.y):new h(this._node.position.x,this._node.position.y-this._tailShift),this._tailShift},animateIn:function(){if(!this.animates||this.animates&&this._customElement&&!this.appearanceAnimation)this._node.transform=new p;else{if(this._appearanceAnimationName)return this._node.transform=new p,void this.delegate.setAnimationForElement(this._containerElement,this._appearanceAnimation,this._appearanceAnimationName);this._scaleXOffset=this._tailSide===f.Bottom?-this._tailShift:this._tailSide===f.Left?-this._node.size.width/2:this._node.size.width/2,this._scaleYOffset=this._tailSide===f.Bottom?this._node.size.height/2:0,this._scaleAnimationParameterIndex=0,this._scaleAnimationStartDate=Date.now(),_.scheduleOnNextFrame(this)}},animateOut:function(){this.visible?(this._scaleAnimationStartDate&&this._finishAnimatingScale(),this._fadeoutAnimationStartDate=Date.now(),_.scheduleOnNextFrame(this)):this._node.remove()},performScheduledUpdate:function(){this._scaleAnimationStartDate&&this._animateScale(),this._fadeoutAnimationStartDate&&this._animateFadeout()},didRemoveFromParent:function(){this.delegate.calloutNodeDidRemove(this)},_updateSize:function(t,e){e=e||{};var i=this._ignoreCalloutCornerRadiusForLeftAccessory,n=this._tailSide===f.Left||this._tailSide===f.Right?Math.min(s(t.height),this._tailScale):this._tailScale,o=(this._tailSide===f.Bottom?t.width-this.node.size.width:t.height-this.node.size.height)-A;this._tailShift=Math.max(0,this._tailShift+Math.min(0,o)),this._bubbleElement.setAttribute("d",a(t,{side:this._tailSide,scale:n,tailShift:this._tailShift})),this._containerElement.style.width=t.width+"px";var r=t.height;this._extraHeight=A+v*n;var l=this._extraWidth(i);t.width+=this._tailSide===f.Bottom?l:this._extraHeight;var h=i?x:M;t.height+=this._tailSide===f.Bottom?this._extraHeight:A,t.height-=y,t.height=e.hasCustomContent?t.height:Math.max(t.height,h);var c=e.hasCustomContent?O.withCustomContent:O.default,d=(t.height-r-v)/2;this._containerElement.style.top=r/2+Math.max(c,d)+"px",this._svgElement.style.width=t.width+"px",this._svgElement.style.height=t.height+"px",this._svgElement.setAttribute("viewBox","-0.5 -0.5 "+t.width+" "+t.height);var u=I.withAccessories.left+(this._tailSide===f.Left?v*n:0),p=I.withAccessories.right+(this._tailSide===f.Right?v*n:0);this._containerElement.style.left=u+"px",this.setSize(t,this._tailSide);var m;this._leftAccessoryBackgroundColor&&(m=100*(this._leftAccessoryWidth+u)/t.width,this._updateAccessoryViewBackground(m,this._leftAccessoryBackgroundColor,"white")),this._rightAccessoryBackgroundColor&&(m=100-100*(this._rightAccessoryWidth+p)/t.width,this._updateAccessoryViewBackground(m,"white",this._rightAccessoryBackgroundColor))},_extraWidth:function(t){return t?I.withIcon.left+I.withIcon.right:I.default.left+I.default.right-I.default.content.left},_updateAccessoryViews:function(){if(this._accessoryHeight=0,this._leftAccessory){var t=this.delegate.sizeForElement(this._leftAccessory.children[0]);this._leftAccessoryWidth=(!this._rtl&&this._ignoreCalloutCornerRadiusForLeftAccessory?0:y)+t.width,this._accessoryHeight=t.height,this._leftAccessory.style.width=this._leftAccessoryWidth+"px",this._ignoreCalloutCornerRadiusForLeftAccessory&&!this._rtl&&(this._leftAccessory.style.height=this._leftAccessoryWidth+"px",this._leftAccessory.style.overflow="visible"),this._containerContentElement.style.marginLeft=this._leftAccessoryWidth+"px"}if(this._rightAccessory){var e=this.delegate.sizeForElement(this._rightAccessory.children[0]);this._rightAccessoryWidth=(this._rtl&&this._ignoreCalloutCornerRadiusForLeftAccessory?0:y)+e.width,this._accessoryHeight=Math.max(this._accessoryHeight,e.height),this._rightAccessory.style.width=this._rightAccessoryWidth+"px",this._ignoreCalloutCornerRadiusForLeftAccessory&&this._rtl&&(this._rightAccessory.style.height=this._rightAccessoryWidth+"px",this._rightAccessory.style.overflow="visible"),this._containerContentElement.style.marginRight=this._rightAccessoryWidth+"px"}},_updateAccessoryViewBackground:function(t,e,i){this._linearGradientElement.appendChild(m.svgElement("stop",{offset:t+"%","stop-color":""+e})),this._linearGradientElement.appendChild(m.svgElement("stop",{offset:t+"%","stop-color":""+i})),this._bubbleElement.style.fill="url(#"+this._calloutId+")"},_setContentElement:function(t){this._updateAccessoryViews(),this._contentElement=t,this._containerContentElement.appendChild(m.htmlElement("div",t)),this._containerElementNode.classList.add(R.CUSTOM_CONTENT),this._containerElement.className=this._containerElementNode.classList.toString();var e=this.delegate.sizeForElement(this._containerElement);e.height=Math.max(e.height,this._accessoryHeight),this._updateSize(e,{hasCustomContent:!0})},_scaleAnimationParameters:[[8e3/60,30/249,277/249],[5e3/60,277/249,237/249],[5e3/60,237/249,1]],_animateScale:function(){var t=this._scaleAnimationParameters[this._scaleAnimationParameterIndex],e=t[0],i=t[1],n=t[2],o=Date.now(),s=Math.min((o-this._scaleAnimationStartDate)/e,1),a=i+(n-i)*s;if(this._node.transform=(new p).translate(this._scaleXOffset,this._scaleYOffset).scale(a).translate(-this._scaleXOffset,-this._scaleYOffset),1===s){if(!(++this._scaleAnimationParameterIndex<this._scaleAnimationParameters.length))return void this._finishAnimatingScale();this._scaleAnimationStartDate=o}_.scheduleOnNextFrame(this)},_finishAnimatingScale:function(){delete this._scaleXOffset,delete this._scaleYOffset,delete this._scaleAnimationStartDate,delete this._scaleAnimationParameterIndex},_animateFadeout:function(){var t=(Date.now()-this._fadeoutAnimationStartDate)/100,e=Math.max(0,1-t);0!==e?(this._node.opacity=e,_.scheduleOnNextFrame(this)):this._node.remove()}}),e.exports=o},{"../utils":237,"./annotation-layer-item-internal":120,"@maps/css-transform":62,"@maps/geometry/point":71,"@maps/geometry/rect":72,"@maps/geometry/size":73,"@maps/js-utils":82,"@maps/render-tree":98,"@maps/scheduler":100}],126:[function(t,e,i){function n(t,e,i,n){this._memberAnnotations=i,s.call(this,t,e,n)}var o=t("./annotation-internal"),s=t("./marker-annotation-internal"),a=t("@maps/js-utils"),r=t("../localizer").l10n,l=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty);n.prototype=a.inheritPrototype(s,n,{get memberAnnotations(){return this._memberAnnotations},get n(){return this._memberAnnotations.length},get title(){return l(this,"_title")?this._title:this._topAnnotation.title},set title(t){Object.getOwnPropertyDescriptor(o.prototype,"title").set.call(this,t)},get subtitle(){var t=this.n-1;return l(this,"_subtitle")?this._subtitle:r.get("Annotation.Clustering.More"+(t>1?".Plural":""),{n:r.digits(t)})},set subtitle(t){Object.getOwnPropertyDescriptor(o.prototype,"subtitle").set.call(this,t)},get glyphText(){return l(this,"_glyphText")?this._glyphText:l(this,"_glyphImage")?"":l(this,"_selectedGlyphImage")?"":r.digits(this.n)},set glyphText(t){Object.getOwnPropertyDescriptor(s.prototype,"glyphText").set.call(this,t)},get draggable(){return!1},get displayPriority(){return this._topAnnotation.displayPriority},get clusteringIdentifier(){return this._topAnnotation.clusteringIdentifier},get _topAnnotation(){return this._memberAnnotations[0]},get _showDefaultAltText(){return l(this,"_glyphText")||l(this,"_glyphImage")||l(this,"_selectedGlyphImage")},updateLocalizedText:function(){o.prototype.updateLocalizedText.call(this),this.updateGlyph(),this._sceneGraphNode.updateAppearance(!0)},altText:function(){return this._showDefaultAltText?o.prototype.altText.call(this):this.title?r.get("Annotation.Clustering.AccessibilityLabel",{n:this.glyphText,title:this.title,subtitle:this.subtitle}):r.get("Annotation.Clustering.NoTitle.AccessibilityLabel",{n:this.glyphText,subtitle:this.subtitle})}}),e.exports=n},{"../localizer":187,"./annotation-internal":119,"./marker-annotation-internal":143,"@maps/js-utils":82}],127:[function(t,e,i){function n(e,i,n){var o=t("./cluster-annotation-internal");Object.defineProperty(this,"_impl",{value:new o(this,e,i,n)})}var o=t("./marker-annotation"),s=t("@maps/js-utils"),a=function(){throw new TypeError("[MapKit] ClusterAnnotation may not be constructed.")};n.prototype=a.prototype=s.inheritPrototype(o,a,{get memberAnnotations(){return this._impl.memberAnnotations}}),e.exports=n},{"./cluster-annotation-internal":126,"./marker-annotation":149,"@maps/js-utils":82}],128:[function(t,e,i){function n(t){this._annotationsController=t,this._clusters=[],this._previousClusters=[],this._previousOverlaps=[],this._previousAnnotations=[],this._frameCounter=0}function o(t){var e=0,i=0,n=0;t.forEach(function(t){e+=t.coordinate.latitude;var o=f.wrapLongitude(t.coordinate.longitude)/180*Math.PI;i+=Math.cos(o),n+=Math.sin(o)});var o=t.length,s=e/o,a=0===i?n<0?-90:90:180*Math.atan(n/i)/Math.PI+(i<0?180:0);return new f.Coordinate(s,a)}function s(t,e){for(var i=0,n=t.length;i<n;++i){var o=t[i],s=e.length;if(o.memberAnnotations.length===s){for(var a=0;a<s&&e[a]===o.memberAnnotations[a];)a+=1;if(a===s)return i}}return-1}function a(t,e){var i=g.DisplayPriority.Required,n=t.selected?i:t.displayPriority;return(e.selected?i:e.displayPriority)-n||e._impl.boundingBox.y2-t._impl.boundingBox.y2}function r(t,e){return e.displayPriority-t.displayPriority||t._impl.index-e._impl.index}function l(t,e){return t._impl.boundingBox.x1-e._impl.boundingBox.x1}function h(t){var e=t._impl.node,i=t._impl.nodePosition(),n=t.padding,o=e.size,s=o.width,a=o.height,r={x1:i.x+n.left,x2:i.x+s-n.right,y1:i.y+n.top,y2:i.y+a-n.bottom};return t.collisionMode===g.CollisionMode.Circle&&(r.cx=(r.x1+r.x2)/2,r.cy=(r.y1+r.y2)/2,r.r=Math.min(s,a)/2),r}function c(t,e){var i={x1:t.x1-e,x2:t.x2+e,y1:t.y1-e,y2:t.y2+e};return Object.prototype.hasOwnProperty.call(t,"r")&&(i.r=t.r+e,i.cx=t.cx,i.cy=t.cy),i}function d(t,e){var i=t.cx-y.clamp(t.cx,e.x1,e.x2),n=t.cy-y.clamp(t.cy,e.y1,e.y2);return i*i+n*n<=t.r*t.r}function u(t,e,i){var n=t._impl.boundingBox,o=e._impl.boundingBox;return i&&(n=c(n,w),o=c(o,w)),p(n,o)}function p(t,e){if(!(e.x2>=t.x1&&e.x1<=t.x2&&e.y2>=t.y1&&e.y1<=t.y2))return!1;if(Object.prototype.hasOwnProperty.call(t,"r")){if(Object.prototype.hasOwnProperty.call(e,"r")){var i=t.cx-e.cx,n=t.cy-e.cy,o=Math.sqrt(i*i+n*n);return t.r+e.r>=o}return d(t,e)}return!Object.prototype.hasOwnProperty.call(e,"r")||d(e,t)}function m(t,e){t._impl.occluded=e,t._impl.updateVisibility(e)}var g=t("./annotation"),_=t("./cluster-annotation"),f=t("../../../lib/geo"),y=t("@maps/js-utils"),v=t("@maps/scheduler"),w=5;n.prototype={collideAnnotations:function(t,e,i,n){this._locked||(this._annotations=t,this._zoomLevel=e,this._rotation=i,this._changesSinceLastCollision=n,v.scheduleOnNextFrame(this))},setRequiredClusterAnnotationProperties:function(t,e){return t!==e&&(t||(t=e),t.coordinate=e.coordinate,t.draggable=!1,t.displayPriority=e.memberAnnotations[0].displayPriority,t.clusteringIdentifier=e.memberAnnotations[0].clusteringIdentifier,t.selected=!1,Object.defineProperty(t,"memberAnnotations",{enumerable:!0,get:function(){return this._impl.memberAnnotations}}),Object.defineProperty(t._impl,"memberAnnotations",{enumerable:!0,value:e.memberAnnotations})),t.animates=e.memberAnnotations.some(function(t){return!t._impl.wasCollided}),t},removedAnnotation:function(t){t.memberAnnotations||(this._previousClusters=this._previousClusters.filter(function(e){if(e.memberAnnotations.indexOf(t)<0)return!0;this._annotationsController.removeAnyItem(e)},this))},mapWasDestroyed:function(){this._annotationsController=null},performScheduledUpdate:function(){if(this._annotationsController)if(this._frameCounter=(this._frameCounter+1)%10,1===this._frameCounter){var t=this._needsUpdate();if(t){this._changesSinceLastCollision=!1,this._previousZoomLevel=this._zoomLevel,this._previousRotation=this._rotation,this._previousAnnotations=this._annotations.slice(),this._locked=!0,this._annotationsController.willUpdateCollisions(),"region"===t&&this._annotationsController.deselectClusterAnnotation(),this._overlaps=[];for(var e=0,i=0,n=this._annotations.length;i<n;++i){var o=this._annotations[i];if(o._impl.needsLayout)return this._frameCounter=0,this._locked=!1,void v.scheduleOnNextFrame(this);o._impl.index=i,o._impl.occluded=!1,o._impl.previousCluster=o._impl.cluster,delete o._impl.cluster,o._impl.boundingBox=h(o),e=Math.max(e,o._impl.boundingBox.x2-o._impl.boundingBox.x1)}var s=this._annotations.sort(l),a={};s.forEach(function(t){if(!t.selected){var e=t.clusteringIdentifier;e&&(a[e]?a[e].push(t):a[e]=[t])}});var r=this._clusters;this._clusters=[];for(var c in a)a[c].length>1&&(e=this._clusterAnnotationsWithMaxWidth(a[c],e));r.forEach(function(t){this._clusters.indexOf(t)<0&&(m(t,!0),t.selected&&(t.selected=!1))},this),this._collideAnnotationsAndClusters(s,e),this._previousOverlaps=this._overlaps,this._annotationsController.didUpdateCollisions(),this._locked=!1}}else v.scheduleOnNextFrame(this)},_clusterAnnotationsWithMaxWidth:function(t,e){for(var i=0;i<t.length;){var n=t[i];if(n._impl.cluster)++i;else{var o=n._impl.boundingBox.x2,s=[n],a=i+1;if(n.memberAnnotations&&i>0){var l=n._impl.boundingBox.x1-e;for(a=i-1;a>0&&t[a]._impl.boundingBox.x1>=l;)a-=1}for(;a<t.length&&t[a]._impl.boundingBox.x1<=o;++a){var c=t[a];!c._impl.cluster&&a!==i&&this._annotationsOverlapExcludingSelected(n,c)&&s.push(c)}if(s.length>1){s=s.reduce(function(t,e){return e.memberAnnotations?(t=t.concat(e.memberAnnotations),e._impl.cluster=!0,m(e,!0)):t.push(e),t},[]).sort(r);var d=this._clusterAnnotationForMemberAnnotations(s);for(d._impl.occluded=!1,d._impl.boundingBox=h(d),e=Math.max(e,d._impl.boundingBox.x2-d._impl.boundingBox.x1),delete d._impl.cluster,a=0;a<s.length;++a)s[a]._impl.occluded=!0,s[a]._impl.cluster=d;for(a=0;a<t.length&&t[a]._impl.boundingBox.x1<d._impl.boundingBox.x1;)a+=1;t.splice(a,0,d),i=Math.min(i+1,a)}else++i}}return t.forEach(function(t){t.memberAnnotations&&!t._impl.cluster&&(this._clusters.push(t),t.map||this._annotationsController.addItem(t))},this),e},_collideAnnotationsAndClusters:function(t,e){for(var i=!1,n=[],o=0,s=0,a=t.length,r=this._clusters.length;o<a||s<r;){var l=t[o],h=this._clusters[s];l?l._impl.cluster?++o:h&&h._impl.boundingBox.x1<l._impl.boundingBox.x1?(h._impl.isRequired()||(i=!0),n.push(h),++s):(l._impl.isRequired()||(i=!0),n.push(l),++o):(h._impl.isRequired()||(i=!0),n.push(h),++s)}i&&this._collideAnnotationsWithMaxWidth(n,e)},_collideAnnotationsWithMaxWidth:function(t,e){for(var i=[],n=0,o=t.length;n<o;++n)for(var s=t[n],r=s._impl.boundingBox.x2,l=n+1;l<o;++l){var h=t[l];if(h._impl.boundingBox.x1>r)break;s._impl.isRequired()&&h._impl.isRequired()||this._annotationsOverlap(s,h)&&i.push(a(s,h)<=0?[s,h]:[h,s])}i.sort(function(t,e){return a(t[0],e[0])}).forEach(function(t){t[0]._impl.occluded||(t[1]._impl.occluded=!0)})},_annotationsOverlapExcludingSelected:function(t,e){return!t.selected&&!e.selected&&this._annotationsOverlap(t,e)},_annotationsOverlap:function(t,e){if(t._impl.isLifted()||e._impl.isLifted())return!1;for(var i,n=r(t,e)<=0?[t,e]:[e,t],o=0,s=this._previousOverlaps.length;o<s&&!i;++o){var a=this._previousOverlaps[o];a[0]===n[0]&&a[1]===n[1]&&(i=a)}var l=u(t,e,i);return l&&this._overlaps.push(n),l},_clusterAnnotationForMemberAnnotations:function(t){var e,i=s(this._previousClusters,t);if(i>=0)(e=this._previousClusters[i])._impl.resetNodeTransform();else{var n=o(t);e=this._annotationsController.addCluster(new _(n,t)),this._previousClusters.push(e)}return e},_needsUpdate:function(){if(this._zoomLevel!==this._previousZoomLevel||this._rotation!==this._previousRotation)return"region";if(this._changesSinceLastCollision)return"annotations";var t=this._annotations.length;if(this._previousAnnotations.length!==t)return"annotations";for(var e=0;e<t;++e)if(this._annotations[e]!==this._previousAnnotations[e])return"annotations";return""}},e.exports=n},{"../../../lib/geo":4,"./annotation":122,"./cluster-annotation":127,"@maps/js-utils":82,"@maps/scheduler":100}],129:[function(t,e,i){function n(t){this._realAnnotation=t}function o(t){s.BaseNode.call(this),this._realAnnotation=t,this.annotation=new n(t),this._renderer=new c(this);var e=2*this.params.balloonRadius;this.size=new a(e,e+this.params.tailLength+this.params.offset),this.layerBounds=new r(0,0,this.size.width,this.size.height)}var s=t("../../../lib/scene-graph"),a=t("@maps/geometry/size"),r=t("@maps/geometry/rect"),l=t("@maps/js-utils"),h=t("./marker-annotation-node"),c=t("./marker-annotation-balloon-renderer"),d=t("./marker-annotation-internal-mixin");n.prototype={constructor:n,glyphText:"",get glyphColor(){var t=this._realAnnotation.map;return t?d.DefaultGlyphColor[t.colorScheme]:d.DefaultGlyphColor.light},isGlyphImagePOIIcon:!1,get color(){var t=this._realAnnotation.map;return t?d.DefaultColor[t.colorScheme]:d.DefaultColor.light},useSquareBalloon:!1},o.prototype=l.inheritPrototype(s.BaseNode,o,{get position(){return this._realAnnotation.nodePosition()},frozen:!0,state:"default",params:h.prototype.params.default,bubble:!1,stringInfo:function(){return"ImageAnnotationFallbackNode"}}),e.exports=o},{"../../../lib/scene-graph":51,"./marker-annotation-balloon-renderer":135,"./marker-annotation-internal-mixin":142,"./marker-annotation-node":146,"@maps/geometry/rect":72,"@maps/geometry/size":73,"@maps/js-utils":82}],130:[function(t,e,i){function n(t){if(t&&"object"==typeof t){for(var e,i=Object.keys(t).filter(function(e){return!!t[e]}).map(parseFloat).filter(function(t){return!isNaN(t)}).sort(),n=r.devicePixelRatio,o=i.length-1;o>=0&&((!e||i[o]>=n)&&(e=i[o]),!(i[o]<=n));--o);return e}}function o(e){function i(t,i,n){if(this._sceneGraphNode=new a(this),e.call(this,t,i,e.div,n),!(n&&"url"in n))throw new Error("[MapKit] No URL for image of ImageAnnotation");this._waitingForImageSize=!this._userSetSize,this.url=n.url}return i.prototype=l.inheritPrototype(e,i,{skipRTNodePositionUpdateWhenCameraIsMoving:!0,needsInitialSizeMeasuredFromDOMElement:!1,get url(){return this._url},set url(t){if(this._ratio=n(t),!this._ratio)throw new Error("[MapKit] No URL for image of ImageAnnotation");this._url=t,this._setSceneGraphNode();var e=this._sceneGraphNode.image=r.htmlElement("img",{src:this._url[this._ratio]});e.complete?this.updateSize():(this._userSetSize||(this._waitingForImageSize=!0),e.addEventListener("load",this),e.addEventListener("error",this))},positionForCallout:function(){if(this._sceneGraphNode instanceof a)return e.prototype.positionForCallout.call(this);var t=this._node.size,i=new c(-t.width/2,0),n=this.nodePosition(),o=new c(0,1);return new c(n.x-i.x-o.x,n.y-i.y-o.y)},calculateNodePosition:function(){return this._sceneGraphNode instanceof a?e.prototype.calculateNodePosition.call(this):new c(this._position.x-this._anchorPoint.x,this._position.y-this._anchorPoint.y)},handleEvent:function(t){switch(t.type){case"load":this._sceneGraphNode.image.removeEventListener("load",this),this._sceneGraphNode.image.removeEventListener("error",this),this._handleImageLoaded();break;case"error":this._sceneGraphNode.image.removeEventListener("load",this),this._sceneGraphNode.image.removeEventListener("error",this),this._handleImageError();break;default:return void e.prototype.handleEvent.call(this,t)}},resetNodeTransform:function(){this.sceneGraphNode.transform=new d},updateSize:function(){if(this._waitingForImageSize=!1,this._sceneGraphNode instanceof a){var t;if(this._userSetSize)t=this._node.size;else{var i=this._sceneGraphNode.image;t=new h(i.naturalWidth/this._ratio,i.naturalHeight/this._ratio),this.setSize(t)}this._sceneGraphNode.size=t}else t=this._sceneGraphNode.size,this._userSetSize&&console.warn("[MapKit] Size set on the ImageAnnotation is removed."),this.setSize(t),this._userSetSize=!1;this._setElementSize(t),e.prototype.updateSize.call(this)},isAKnownOption:function(t){return"url"===t||e.prototype.isAKnownOption.call(this,t)},willMoveToMap:function(){this._isMoving=this.doesAnimate()},canShowCallout:function(){return!this._waitingForImageSize&&e.prototype.canShowCallout.call(this)},_handleImageLoaded:function(){this.updateSize()},_handleImageError:function(){console.error("[MapKit] Could not load image for ImageAnnotation at URL "+this._sceneGraphNode.image.src),this._setSceneGraphNodeToFallback(),this.updatePosition(),this.updateSize()},_setElementSize:function(t){this._element.style.width=t.width+"px",this._element.style.height=t.height+"px"},_setSceneGraphNode:function(){if(!(this._sceneGraphNode instanceof a)){var t=this._sceneGraphNode;this._sceneGraphNode=new a(this),t.parent&&t.parent.replaceChild(this._sceneGraphNode,t)}},_setSceneGraphNodeToFallback:function(){if(s||(s=t("./image-annotation-fallback-node")),!(this._sceneGraphNode instanceof s)){var e=this._sceneGraphNode;this._sceneGraphNode=new s(this),e.parent&&e.parent.replaceChild(this._sceneGraphNode,e)}}}),i.bestRatio=n,i}var s,a=t("./image-annotation-node"),r=t("../utils"),l=t("@maps/js-utils"),h=t("@maps/geometry/size"),c=t("@maps/geometry/point"),d=t("@maps/css-matrix");o.bestRatio=n,e.exports=o},{"../utils":237,"./image-annotation-fallback-node":129,"./image-annotation-node":132,"@maps/css-matrix":61,"@maps/geometry/point":71,"@maps/geometry/size":73,"@maps/js-utils":82}],131:[function(t,e,i){var n=t("./annotation-internal"),o=t("./image-annotation-internal-mixin")(n);e.exports=o},{"./annotation-internal":119,"./image-annotation-internal-mixin":130}],132:[function(t,e,i){function n(t){o.ImageNode.call(this),this._annotation=t}var o=t("../../../lib/scene-graph"),s=t("@maps/js-utils");n.prototype=s.inheritPrototype(o.ImageNode,n,{get position(){return this._annotation.nodePosition()}}),e.exports=n},{"../../../lib/scene-graph":51,"@maps/js-utils":82}],133:[function(t,e,i){function n(e,i){if(s(this,n)){var o=t("./image-annotation-internal");Object.defineProperty(this,"_impl",{value:new o(this,e,i)})}}var o=t("./annotation"),s=t("../check-instance-and-warn"),a=t("@maps/js-utils");t("./image-annotation-internal-mixin"),n.prototype=a.inheritPrototype(o,n,{get url(){return this._impl._url},set url(t){this._impl.url=t}}),e.exports=n},{"../check-instance-and-warn":162,"./annotation":122,"./image-annotation-internal":131,"./image-annotation-internal-mixin":130,"@maps/js-utils":82}],134:[function(t,e,i){function n(t,e){o.BaseNode.call(this),this.annotation=t,e&&(this._state=e)}var o=t("../../../lib/scene-graph"),s=t("@maps/js-utils"),a=t("./marker-annotation-balloon-renderer"),r=t("./marker-annotation-square-balloon-renderer"),l=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty);n.prototype=s.inheritPrototype(o.BaseNode,n,{stringInfo:function(){var t=this._renderer.rendererForSharedLayer,e=l(this,"_state")?"<"+this.state+">":"",i=l(t,"glyphFontSize")?' "'+this.annotation.glyphText+'"@'+t.glyphFontSize:"",n=this._renderer instanceof r?" â¹":"",o=t.glyphImageSrc?(this.annotation.isGlyphImagePOIIcon?" ð ":" ð¼ ")+t.glyphImageSrc:"";return"MarkerAnnotationBalloonNode"+e+("<color: "+this.annotation.color+">")+i+o+n},get state(){return l(this,"_state")?this._state:this.parent.state},get params(){return this.parent.params[this.state]},glyphImageError:function(t){"selected"===t&&this.selectedGlyphImage?delete this.selectedGlyphImage:delete this.glyphImage,this.needsDisplay=!0},setBalloonStyle:function(){this.annotation.useSquareBalloon?this._renderer=new r(this):this._renderer=new a(this)}}),e.exports=n},{"../../../lib/scene-graph":51,"./marker-annotation-balloon-renderer":135,"./marker-annotation-square-balloon-renderer":147,"@maps/js-utils":82}],135:[function(t,e,i){function n(t){o.call(this,t)}var o=t("./marker-annotation-base-balloon-renderer"),s=t("@maps/js-utils");n.prototype=s.inheritPrototype(o,n,{drawDotUnderCallout:function(t,e,i){t.strokeStyle=e,t.lineWidth=i,t.arc(i,i,i/2,0,2*Math.PI),t.stroke()},pathForBalloon:function(t,e,i){if(i){var n=i/6,o=i/3,s=2*e,a=.448*e,r=.385*e;t.moveTo(s,e),t.bezierCurveTo(s,1.5*e,s-r,s-i/3,e+i/2+o,s),t.bezierCurveTo(e+i/3,s+i/3,e+n,s+i,e,s+i),t.bezierCurveTo(e-n,s+i,e-i/3,s+i/3,e-(i/2+o),s),t.bezierCurveTo(r,s-i/3,0,1.5*e,0,e),t.bezierCurveTo(0,a,a,0,e,0),t.bezierCurveTo(s-a,0,s,a,s,e),t.closePath()}else t.arc(e,e,e,0,2*Math.PI)},pathForMask:function(t,e,i){t.arc(e,e,i,0,2*Math.PI)}}),e.exports=n},{"./marker-annotation-base-balloon-renderer":136,"@maps/js-utils":82}],136:[function(t,e,i){function n(t){d.call(this,t)}function o(t,e,i,o){null==o&&(o=e.glyphText),t.save(),t.textBaseline="bottom",t.fillStyle=e.glyphColor;var s,a=i.glyphFontSize;do{t.font=a--+"px "+c.MarkerAnnotationFontFamily,s=t.measureText(o).width}while(s>i.glyphImageSize&&a>0);var r=i.balloonRadius+a/2+1;n.needsLowerBaseline&&(r+=1);var l;return"1"===o?(t.textAlign="left",l=i.balloonRadius-s/2-t.measureText(o).width/16,t.fillText(o,l,r,i.glyphImageSize)):n.needsExtraRenderingWorkaround&&"2"===o&&13.5===i.balloonRadius?(t.textAlign="left",l=i.balloonRadius-s/2-.2,t.fillText(o,l,r,i.glyphImageSize)):(t.textAlign="center",t.fillText(o,i.balloonRadius,r,i.glyphImageSize)),t.restore(),a+1}function s(){function t(){0===--a&&((h=s).lifted=h.default,w="",b="default",v.forEach(function(t){t.needsDisplay=!0}))}function e(e){new p.ImageLoader(p.Priority.Highest,{urlForImageLoader:n+(e?"-":"")+e+o,loaderDidSucceed:function(i){s[e]=i.image,t()},loaderDidFail:function(e){console.warn("[MapKit] Error loading marker annotation image "+e.url+"; marker annotations may not display correctly."),w="?",b="default-error",t()}}).schedule()}var i=Math.min(m.devicePixelRatio,3),n=_.createImageUrl("pins/marker"),o=(i>1?"_"+i+"x":"")+".png",s={},a=y.length;y.forEach(function(t){s[t]={},e(t)})}function a(t,e,i,n,s,a){var c,d,u=s?2*n.balloonRadius:n.glyphImageSize,p=f.roundToDevicePixel((e.size.width-u)/2),m=!1;if(!(c="default"===i||"lifted"===i?e.glyphImage:e.selectedGlyphImage||e.glyphImage)&&e.injectedDefaultImage&&(c=e.injectedDefaultImage,d=e.injectedDefaultImageScale,u=n.glyphImageSize,p=f.roundToDevicePixel((e.size.width-u)/2,d),s=!1,m=!0),!c){if(w)return o(t,e.annotation,n,w),null;c=h[e.bubble?"bubble":i],u=n.glyphImageSize,p=f.roundToDevicePixel((e.size.width-u)/2),s=!1,m=!0}try{var g;return d?(g=s?r(c,e.annotation.color,u*d,a):l(c,e.annotation.glyphColor,u*d),t.save(),t.scale(1/d,1/d),t.drawImage(g,p*d,p*d,u*d,u*d),t.restore()):(g=s?r(c,e.annotation.color,u,a):l(c,e.annotation.glyphColor,u),t.drawImage(g,p,p,u,u)),m?null:c.src}catch(t){e.glyphImageError()}}function r(t,e,i,n){t._maskedPOIImage||(t._maskedPOIImage=[]);var o=i*f();if(!t._maskedPOIImage[o]){var s=o/2*56/60,a=u.createCanvas();a.width=o,a.height=o;var r=a.getContext("2d");r.fillStyle=e,r.beginPath(),n(r,o/2,s),r.fill(),r.globalCompositeOperation="source-atop",r.drawImage(t,0,0,o,o),t._maskedPOIImage[o]=a}return t._maskedPOIImage[o]}function l(t,e,i){t._tinted||(t._tinted={}),t._tinted[e]||(t._tinted[e]=[]);var n=i*f();if(!t._tinted[e][n]){var o=u.createCanvas();o.width=n,o.height=n;var s=o.getContext("2d");s.fillStyle=e,s.fillRect(0,0,n,n),s.globalCompositeOperation="destination-in",s.drawImage(t,0,0,n,n),t._tinted[e][n]=o}return t._tinted[e][n]}var h,c=t("../constants"),d=t("./marker-annotation-base-renderer"),u=t("@maps/js-utils"),p=t("@maps/loaders"),m=t("../utils"),g=t("../configuration"),_=t("../urls"),f=t("@maps/device-pixel-ratio"),y=["default","selected","bubble"],v=[],w="â¦",b="default-dotdotdot";n.needsLowerBaseline=!1,n.needsExtraRenderingWorkaround=!1,n.prototype=u.inheritPrototype(d,n,{draw:function(t){this._sharedLayer&&(this._sharedLayer.renderer=this),h||v.indexOf(this._node)<0&&v.push(this._node);var e=this._node,i=e.state,n=e.annotation,s=e.params;delete this.glyphImageSrc,delete this.renderType,t.save(),e.bubble||(t.shadowOffsetY=s.shadowOffsetY,t.shadowBlur=s.shadowBlur,t.shadowColor=s.shadowColor),t.beginPath(),"callout"===i?this.drawDotUnderCallout(t,n.color,s.radius):(t.fillStyle=n.color,this.pathForBalloon(t,s.balloonRadius,e.bubble?0:s.tailLength),t.fill()),t.restore(),"callout"!==i&&(delete this.glyphFontSize,n.glyphText?(this.glyphFontSize=o(t,n,s),this.renderType="glyphText"):(this.glyphImageSrc=a(t,e,i,s,n.isGlyphImagePOIIcon,this.pathForMask.bind(this)),this.renderType=this.glyphImageSrc?"glyphImage":b))},get rendererForSharedLayer(){return this._sharedLayer?this._sharedLayer.renderer:this},drawDotUnderCallout:function(){},pathForBalloon:function(){},pathForMask:function(){}}),g.addEventListener(g.Events.Initialized,function t(){g.removeEventListener(g.Events.Initialized,t),s()}),window.document||(h={}),e.exports=n},{"../configuration":165,"../constants":166,"../urls":234,"../utils":237,"./marker-annotation-base-renderer":138,"@maps/device-pixel-ratio":63,"@maps/js-utils":82,"@maps/loaders":83}],137:[function(t,e,i){function n(t){o.call(this,t)}var o=t("./marker-annotation-base-renderer"),s=t("@maps/js-utils");n.prototype=s.inheritPrototype(o,n,{draw:function(t){var e=this._node;t.save(),t.fillStyle=e.annotation.color,t.beginPath(),this.pathForDot(t,e.radius),t.fill(),t.restore()},pathForDot:function(){}}),e.exports=n},{"./marker-annotation-base-renderer":138,"@maps/js-utils":82}],138:[function(t,e,i){function n(t){o.RenderItem.call(this,t)}var o=t("../../../lib/scene-graph"),s=t("@maps/js-utils");n.prototype=s.inheritPrototype(o.RenderItem,n,{pathForSquareDot:function(t,e){var i=.6*e,n=.4*e;t.moveTo(e,0),t.lineTo(e+n,0),t.arc(e+n,i,i,Math.PI/2*3,0),t.lineTo(2*e,e+n),t.arc(e+n,e+n,i,0,Math.PI/2),t.lineTo(i,2*e),t.arc(i,e+n,i,Math.PI/2,Math.PI),t.lineTo(0,e-n),t.arc(i,i,i,Math.PI,Math.PI/2*3),t.lineTo(e,0)}}),e.exports=n},{"../../../lib/scene-graph":51,"@maps/js-utils":82}],139:[function(t,e,i){function n(t,e){t.useSquareBalloon?this._renderer=new a(this):this._renderer=new s(this),this.frozen=!0,this.annotation=t,this.state="selected",this.params=e,this.bubble=!0;var i=2*e.balloonRadius;this.size=new o.Size(i,i),this.layerBounds=new o.Rect(0,0,this.size.width,this.size.height)}var o=t("@maps/geometry"),s=t("./marker-annotation-balloon-renderer"),a=t("./marker-annotation-square-balloon-renderer");n.prototype.glyphImageError=function(t){"selected"===t&&this.selectedGlyphImage?delete this.selectedGlyphImage:delete this.glyphImage},n.prototype.updateGlyphImage=function(t){this.glyphImage=t},n.prototype.updateSelectedGlyphImage=function(t){this.selectedGlyphImage=t},e.exports=n},{"./marker-annotation-balloon-renderer":135,"./marker-annotation-square-balloon-renderer":147,"@maps/geometry":70}],140:[function(t,e,i){function n(t,e){o.BaseNode.call(this),this.annotation=t,this.radius=e,t.useSquareBalloon?this._renderer=new r(this):this._renderer=new a(this)}var o=t("../../../lib/scene-graph"),s=t("@maps/js-utils"),a=t("./marker-annotation-dot-renderer"),r=t("./marker-annotation-square-dot-renderer");n.prototype=s.inheritPrototype(o.BaseNode,n,{stringInfo:function(){var t=this._renderer instanceof r?" â¹":"";return"MarkerAnnotationDotNode<color: "+this.annotation.color+">"+t}}),e.exports=n},{"../../../lib/scene-graph":51,"./marker-annotation-dot-renderer":141,"./marker-annotation-square-dot-renderer":148,"@maps/js-utils":82}],141:[function(t,e,i){function n(t){o.call(this,t)}var o=t("./marker-annotation-base-dot-renderer"),s=t("@maps/js-utils");n.prototype=s.inheritPrototype(o,n,{pathForDot:function(t,e){t.arc(e,e,e,0,2*Math.PI)}}),e.exports=n},{"./marker-annotation-base-dot-renderer":137,"@maps/js-utils":82}],142:[function(t,e,i){function n(t){function e(e,i,n){this._sceneGraphNode=new a(this),t.call(this,e,i,t.div,n),this._public=e,n&&g.forEach(function(t){t in n&&(this[t]=n[t])},this),this.updateGlyph(),this.useSquareBalloon=this._glyphImage&&this._glyphImage.useSquareBalloon||this._selectedGlyphImage&&this._selectedGlyphImage.useSquareBalloon,this._sceneGraphNode._balloon.setBalloonStyle(),this._sceneGraphNode.updateState("default")}return e.StaticStyles=y,e.prototype=h.inheritPrototype(t,e,{_animates:!0,_calloutAnchorPoint:new window.DOMPoint(-a.prototype.params.callout.radius,1),_glyphImage:null,_selectedGlyphImage:null,_glyphText:"",_color:null,_glyphColor:null,_titleVisibility:a.FeatureVisibility.Adaptive,_subtitleVisibility:a.FeatureVisibility.Adaptive,shouldHideLabels:!0,skipRTNodePositionUpdateWhenCameraIsMoving:!0,needsInitialSizeMeasuredFromDOMElement:!1,get size(){return this._sceneGraphNode.size.copy()},set size(t){console.warn("[MapKit] The `size` property of a marker annotation cannot be set.")},get color(){return null!==this._color?this._color:this.map?_[this.map.colorScheme]:_.light},set color(t){null!==t&&h.checkType(t,"string","[MapKit] Expected a string value for MarkerAnnotation.color, but got `"+t+"` instead"),t!==this._color&&(this._color=t,this._sceneGraphNode.updateAppearance(!0),this._drawCalloutAccessory())},get glyphColor(){return null!==this._glyphColor?this._glyphColor:this.map?f[this.map.colorScheme]:f.light},set glyphColor(t){null!==t&&h.checkType(t,"string","[MapKit] Expected a string value for MarkerAnnotation.glyphColor, but got `"+t+"` instead"),t!==this._glyphColor&&(this._glyphColor=t,this._sceneGraphNode.updateAppearance(!0),this._drawCalloutAccessory())},get glyphImage(){return this._glyphImage},set glyphImage(t){this._setGlyphImage("_glyphImage","updateGlyphImage",t)},get selectedGlyphImage(){return this._selectedGlyphImage},set selectedGlyphImage(t){this._setGlyphImage("_selectedGlyphImage","updateSelectedGlyphImage",t)},updateGlyphImages:function(){this._setGlyphImage("_glyphImage","updateGlyphImage",this._glyphImage),this._setGlyphImage("_selectedGlyphImage","updateSelectedGlyphImage",this._selectedGlyphImage)},get glyphText(){return this._glyphText},set glyphText(t){h.checkType(t,"string","[MapKit] Expected a string value for MarkerAnnotation.glyphText, but got `"+t+"` instead"),t!==this._glyphText&&(this._glyphText=t,this.updateLocalizedText(),this.updateGlyph(),this._sceneGraphNode.updateGlyphText(),this._drawCalloutAccessory())},get glyph(){return this._glyph},get titleVisibility(){return this._titleVisibility},set titleVisibility(t){if(!h.checkValueIsInEnum(t,a.FeatureVisibility))throw new Error("[MapKit] Expected one of Hidden, Visible or Adaptive for MarkerAnnotation.titleVisibility");t!==this._titleVisibility&&(this._titleVisibility=t,this._sceneGraphNode.needsLayout=!0)},get subtitleVisibility(){return this._subtitleVisibility},set subtitleVisibility(t){if(!h.checkValueIsInEnum(t,a.FeatureVisibility))throw new Error("[MapKit] Expected one of Hidden, Visible or Adaptive for MarkerAnnotation.subtitleVisibility");t!==this._subtitleVisibility&&(this._subtitleVisibility=t,this._sceneGraphNode.needsLayout=!0)},labelsCanBeShown:function(){return this.delegate&&this.delegate.supportsLabelRegions()},titleCanBeShown:function(){return this.title&&this._titleVisibility!==a.FeatureVisibility.Hidden},subtitleCanBeShown:function(t){return this.subtitle&&(this._subtitleVisibility===a.FeatureVisibility.Visible||this._subtitleVisibility===a.FeatureVisibility.Adaptive&&(this._public.memberAnnotations||this.selected&&t))},updateLayout:function(t){t?this._sceneGraphNode.updateLayout():this._sceneGraphNode.needsLayout=!0},updatedLayout:function(){this._updatedProperty("")},calculateNodePosition:function(){return new u(p.roundToDevicePixel(this._position.x-this._anchorPoint.x-this._anchorOffset.x),this._position.y-this._anchorPoint.y-this._anchorOffset.y)},get darkColorScheme(){return!!this.map&&m.darkColorScheme(this.map._impl.mapNodeTint)},get isGlyphImagePOIIcon(){return this._glyphImage&&this._glyphImage.isPOIIcon||this._selectedGlyphImage&&this._selectedGlyphImage.isPOIIcon},setDelegate:function(e){t.prototype.setDelegate.call(this,e),this.labelsCanBeShown()&&this._updatedProperty("title")},doesAnimate:function(){return this._animates},willMoveToMap:function(t){this._isMoving=t&&this.animates},didMoveToMap:function(){var e=this._isMoving;t.prototype.didMoveToMap.call(this),this.delegate&&e&&this.visible&&!this._appearanceAnimation&&this._shown?(this._isAnimating=!0,this._sceneGraphNode.animateAppearance(function(t){t.node.annotation.finishedAnimating()})):this._sceneGraphNode.preventAnimation()},lift:function(e){this._sceneGraphNode.updateState("lifted"),t.prototype.lift.call(this,e)},droppedAfterLift:function(){this._sceneGraphNode.updateState("default"),t.prototype.droppedAfterLift.call(this)},canShowCallout:function(){return(!!this.callout||this.delegate&&!this.delegate.supportsLabelRegions())&&t.prototype.canShowCallout.call(this)},calloutWillAppear:function(t){this.isStable()&&this._sceneGraphNode.updateState(t?"callout":"selected")},calloutWillDisappear:function(){this.selected||(delete this._calloutAccessoryNode,this._sceneGraphNode.updateState("default"))},canvasForCalloutAccessory:function(){if(!this.callout||!(this.callout.calloutElementForAnnotation||this.callout.calloutContentForAnnotation||this.callout.calloutLeftAccessoryForAnnotation||this.callout.calloutRightAccessoryForAnnotation))return this._calloutAccessoryNode?this._calloutAccessoryNode._renderer.layer:(this._calloutAccessoryNode=new r(this,a.prototype.params.bubble),this._calloutAccessoryNode.glyphImage=this._sceneGraphNode._balloon.glyphImage,this._calloutAccessoryNode.selectedGlyphImage=this._sceneGraphNode._balloon.selectedGlyphImage,this._calloutAccessoryNode.glyphText=this._glyphText,this._drawCalloutAccessory(),this._calloutAccessoryNode._renderer.layer);delete this._calloutAccessoryNode},get ignoreCalloutCornerRadiusForLeftAccessory(){return!0},altText:function(){return t.prototype.altText.call(this)||d.get("Annotation.Marker.AccessibilityLabel")},isAKnownOption:function(e){return g.indexOf(e)>=0||t.prototype.isAKnownOption.call(this,e)},resetNodeTransform:function(){this.sceneGraphNode.transform=new l},updateGlyph:function(){this._glyph=this.glyphText||(this._glyphImageElement?this._glyphImageElement.src:"")},set staticStyle(t){var e;switch(t){case y.Dot:e="callout";break;case y.Large:e="selected";break;default:e="default"}this._sceneGraphNode.updateState(e),this._sceneGraphNode._usingStaticStyle=!0},_setGlyphImage:function(t,e,i){null!=i&&h.checkType(i,"object","[MapKit] Expected a hash value for MarkerAnnotation."+t.replace(/^_/,"")+", but got `"+i+"` instead"),this[t]=i;var n=t+"Element";if(!i)return delete this[n],this._sceneGraphNode[e](null),void(this._calloutAccessoryNode&&(this._calloutAccessoryNode[e](null),this._drawCalloutAccessory()));var a=s.bestRatio(i);a?o(this,i[a],n,e):(delete this[n],this._sceneGraphNode.glyphImageError(),this._calloutAccessoryNode&&this._calloutAccessoryNode.glyphImageError())},_updatedProperty:function(e){"title"!==e&&"subtitle"!==e||(this._sceneGraphNode.needsLayout=!0),t.prototype._updatedProperty.call(this,e)},_drawCalloutAccessory:function(){if(this._calloutAccessoryNode){var t=this._calloutAccessoryNode._renderer.layer;t.style.width=t.style.height=this._calloutAccessoryNode.size.width+"px",this._calloutAccessoryNode._renderer.draw(t.getContext("2d"))}}}),e}function o(t,e,i,n){new c.ImageLoader(c.Priority.Highest,{urlForImageLoader:e,loaderDidSucceed:function(e){t[i]=e.image,t.updateGlyph(),t._sceneGraphNode[n](e.image),t._calloutAccessoryNode&&(t._calloutAccessoryNode[n](e.image),t._drawCalloutAccessory())},loaderDidFail:function(){delete t[i],t.updateGlyph(),t._sceneGraphNode[n](),t._calloutAccessoryNode&&(t._calloutAccessoryNode[n](),t._drawCalloutAccessory())}}).schedule()}var s=t("./image-annotation-internal-mixin"),a=t("./marker-annotation-node"),r=t("./marker-annotation-callout-bubble-node"),l=t("@maps/css-matrix"),h=t("@maps/js-utils"),c=t("@maps/loaders"),d=t("../localizer").l10n,u=t("@maps/geometry/point"),p=t("@maps/device-pixel-ratio"),m=t("../utils"),g=["color","glyphColor","glyphImage","selectedGlyphImage","glyphText","titleVisibility","subtitleVisibility"],_={light:"#ff5b40",dark:"#e6523b"},f={light:"white",dark:"#e7e6e4"},y={Default:"default",Dot:"dot",Large:"large"};n.StaticStyles=y,n.DefaultColor=_,n.DefaultGlyphColor=f,e.exports=n},{"../localizer":187,"../utils":237,"./image-annotation-internal-mixin":130,"./marker-annotation-callout-bubble-node":139,"./marker-annotation-node":146,"@maps/css-matrix":61,"@maps/device-pixel-ratio":63,"@maps/geometry/point":71,"@maps/js-utils":82,"@maps/loaders":83}],143:[function(t,e,i){var n=t("./annotation-internal"),o=t("./marker-annotation-internal-mixin")(n);e.exports=o},{"./annotation-internal":119,"./marker-annotation-internal-mixin":142}],144:[function(t,e,i){function n(t,e,i,n){o.BaseNode.call(this),this.text=t,this.kind=e,this._renderer=new a(this),this.size=new r(i,this._renderer.params[this.kind].height),this.keyForFrozenLayer=(n?"dark":"light")+"-"+e+"#"+this.text}var o=t("../../../lib/scene-graph"),s=t("@maps/js-utils"),a=t("./marker-annotation-label-renderer"),r=t("@maps/geometry/size");n.prototype=s.inheritPrototype(o.BaseNode,n,{stringInfo:function(){return"MarkerAnnotationLabelNode<"+this.kind+'> "'+this.text+'"'},get lineHeight(){return this._renderer.params[this.kind].lineHeight}}),n.Font={title:a.prototype.params.title.font,subtitle:a.prototype.params.subtitle.font},e.exports=n},{"../../../lib/scene-graph":51,"./marker-annotation-label-renderer":145,"@maps/geometry/size":73,"@maps/js-utils":82}],145:[function(t,e,i){function n(t){s.RenderItem.call(this,t)}var o=t("../constants"),s=t("../../../lib/scene-graph"),a=t("@maps/js-utils");n.prototype=a.inheritPrototype(s.RenderItem,n,{params:{haloColor:{light:"rgba(255, 255, 255, .8)",dark:"black"},haloSize:2,miterLimit:2,textAlign:"center",title:{font:"600 11px "+o.MarkerAnnotationFontFamily,height:16,lineHeight:12,color:{light:"#2b2b2b",dark:"#e7e6e4"},yPadding:1},subtitle:{font:"500 10px "+o.MarkerAnnotationFontFamily,height:15,lineHeight:12,color:{light:"#4c4c4c",dark:"#e7e6e4"},yPadding:1}},draw:function(t){var e=this._node,i=e.parent.annotation.darkColorScheme?"dark":"light",n=this.params[e.kind];t.font=n.font,t.textAlign=this.params.textAlign,t.textBaseline="bottom",t.fillStyle=n.color[i],t.strokeStyle=this.params.haloColor[i],t.lineWidth=this.params.haloSize,t.miterLimit=this.params.miterLimit;var o=e.size.width/2,s=e.size.height-n.yPadding;t.strokeText(e.text,o,s),t.fillText(e.text,o,s)}}),e.exports=n},{"../../../lib/scene-graph":51,"../constants":166,"@maps/js-utils":82}],146:[function(t,e,i){function n(t){h.GroupNode.call(this),this.annotation=t,this._balloon=this.addChild(new C(t))}function o(t,e){E.font=e;for(var i=t.trim().split(/\s+/),n=[];i.length>0;){for(var o=[i.shift()],s=o.join(" ").length;i.length>0&&s<=16;)o.push(i.shift()),s=o.join(" ").length;s>16&&o.length>1&&i.unshift(o.pop()),n.push([o.join(" "),E.measureText(o.join(" ")).width+y.labelOutlineWidth])}return n}function s(t,e){var i=Object.create(t);for(var n in e)i[n]=e[n];return i}function a(t,e){new h.NodeAnimator.Opacity({node:t,duration:e.transitionDuration}).begin()}function r(t,e,i){t.fadingOut=!0,new h.NodeAnimator.Opacity({node:t,duration:e.transitionDuration,from:1,to:0,done:function(){delete t.fadingOut,t.remove()}}).begin()}function l(t,e,i,n,o,s){new h.NodeAnimator.Scale({node:t,duration:e.transitionDuration,from:i,to:n,center:new u(t.size.width/2,t.size.height),done:s,mass:o,stiffness:e.springStiffness,damping:e.springDamping,initialVelocity:e.initialSpringVelocity}).begin()}var h=t("../../../lib/scene-graph"),c=t("@maps/js-utils"),d=t("@maps/scheduler"),u=t("@maps/geometry/point"),p=t("@maps/device-pixel-ratio"),m=t("@maps/geometry/size"),g=t("@maps/css-matrix"),_=t("../constants").FeatureVisibility,f=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty),y={labelOutlineWidth:2,shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.15)",shadowOffsetY:1.5,transitionDuration:300,dotAnimationDuration:100,dotScale:1.5,springMass:1,springStiffness:100,springDamping:10,initialSpringVelocity:0};window.document||(y.transitionDuration=0);var v=s(y,{balloonRadius:13.5,dotRadius:0,glyphFontSize:15,glyphImageSize:20,offset:0,tailLength:5}),w=s(y,{balloonRadius:30,dotRadius:3,glyphFontSize:32,glyphImageSize:40,offset:8,tailLength:6}),b=s(y,{balloonRadius:20,dotRadius:3,glyphFontSize:28,glyphImageSize:30,offset:0,tailLength:0}),C=t("./marker-annotation-balloon-node"),S=t("./marker-annotation-dot-node"),k=t("./marker-annotation-label-node");n.prototype=c.inheritPrototype(h.BaseNode,n,{params:{default:v,lifted:v,selected:w,bubble:b,callout:s(y,{radius:4.5,shadowOffsetY:0,shadowBlur:0,shadowColor:"transparent"})},get position(){return this.annotation?this.annotation.nodePosition():new u},stringInfo:function(){return"MarkerAnnotationNode"+("default"!==this.state?"<"+this.state+">":"")},set needsLayout(t){t&&!this._needsLayout&&d.scheduleASAP(this),this._needsLayout=t},get needsLayout(){return this._needsLayout},balloonNodeSize:function(t){t||(t=this.state);var e=this.params[t];if("callout"===t)return new m(2*e.radius,2*e.radius);var i=2*e.balloonRadius;return new m(i,i+e.tailLength+e.offset)},updateAppearance:function(t){var e=this.annotation;if(window.document){var i=e.useSquareBalloon?"square":"";this._balloon.keyForFrozenLayer="default"===this.state?"balloon-"+[e.color,e.glyph,e.glyphColor,i].join("-"):""}t&&(this.needsDisplay=!0)},updateState:function(t){if(!this._usingStaticStyle){var e=this.annotation;this.state!==t&&((e.selected||"selected"===this.state||"callout"===this.state)&&(this._animateFromState=this._animateFromState||this.state),this.state=t,e._node.size=this._size=this._balloon.size=this.balloonNodeSize(),this.updateAppearance(),this.needsLayout=!0)}},injectDefaultImage:function(t,e){var i=this._balloon;t||(delete i.injectedDefaultImage,delete i.injectedDefaultImageScale),i.injectedDefaultImage=t,i.injectedDefaultImageScale=e},performScheduledUpdate:function(){this.updateLayout(!1)},updateLayout:function(t){this._needsLayout&&(this._layoutSubNodes(t),this._needsLayout=!1)},updateGlyphText:function(){this.updateAppearance(!0),this._balloon.needsDisplay=!0},updateGlyphImage:function(t){this.updateAppearance(),this._balloon.glyphImage=t,this._balloon.needsDisplay=!0},updateSelectedGlyphImage:function(t){this._balloon.selectedGlyphImage=t,this._balloon.needsDisplay=!0},glyphImageError:function(){this.updateAppearance(),this._balloon.glyphImageError(this.state)},animateAppearance:function(t){var e=this.params[this.state];this.children.forEach(function(t){a(t,e)}),l(this._balloon,e,1e-12,1,e.springMass,t)},preventAnimation:function(){this._animationPrevented=!0,this.needsLayout=!0},_layoutSubNodes:function(t){function e(t,e){n.forEach(function(e){e.kind===t&&(this.addChild(e),r(e,_,this.annotation))},this),delete this[e]}function i(t,e){var i=k.Font[t],n=c[t],s=y&&!!this.parent&&n!==e&&(!n||!e),r=this.annotation.darkColorScheme;return o(n,i).forEach(function(e){var i=new k(e[0],t,e[1],r);h=Math.max(h,e[1]),T=i.lineHeight/2,this.addChild(i),s&&a(i,_)},this),n}if(this.annotation){this.updateAppearance();var n=this.children.slice();this.children=[this._balloon],this._dot&&this.addChild(this._dot);var h=this._balloon.size.width,c=this.annotation,d=this.state,_=this.params[this.state],y=!this._animationPrevented;delete this._animationPrevented;var v="callout"!==d&&"lifted"!==d&&!("default"===d&&c.selected)&&c.labelsCanBeShown(),w=v&&c.titleCanBeShown();w?this._prevTitle=i.call(this,"title",this._prevTitle):e.call(this,"title","_prevTitle"),v&&c.subtitleCanBeShown(w)?this._prevSubtitle=i.call(this,"subtitle",this._prevSubtitle):e.call(this,"subtitle","_prevSubtitle");var b=this._balloon.size.height,E=b,T=0;this.children.forEach(function(t){t.position=new u((h-t.size.width)/2,t.lineHeight?E:0),t.lineHeight&&(E+=t.lineHeight,t.fadingOut||(b+=t.lineHeight,T=t.lineHeight/2))}),c._anchorPoint=new u(h/2,this._balloon.size.height),c._node.size=this.size=new m(h,b+T),c.updatePosition();var L=c._position.x-c._anchorPoint.x-c._anchorOffset.x,M=this.position.x;if(this.children.forEach(function(t){t.position=new u(p.roundToDevicePixel(L+t.position.x)-M,t.position.y)}),"selected"===d?(this._dot||(this._dot=this.addChild(new S(this.annotation,_.dotRadius*_.dotScale),1)),this._dot.size=new m(2*_.dotRadius*_.dotScale,2*_.dotRadius*_.dotScale),this._dot.position=new u(this._balloon.position.x+_.balloonRadius-_.dotRadius,this._balloon.size.height-2*_.dotRadius),this._dot.transform=(new g).scale(1/_.dotScale),this._dot.wantsLayerBacking=!0):this._dot&&(this._dot.remove(),delete this._dot),y&&f(this,"_animateFromState")){if("callout"===d||"callout"===this._animateFromState){var x=s(_);x.transitionDuration/=2;var A=this.addChild(new C(this.annotation,this._animateFromState));A.glyphImage=this._balloon.glyphImage,A.selectedGlyphImage=this._balloon.selectedGlyphImage,A.setBalloonStyle(),A.size=this.balloonNodeSize(A.state),A.position=new u((this.size.width-A.size.width)/2,this._balloon.size.height-A.size.height),this._balloon.transform=(new g).scale(1e-12),l(A,x,1,1e-12,0,function(){A.remove(),l(this._balloon,_,1e-12,1,_.springMass)}.bind(this))}else{var I=this.balloonNodeSize(this._animateFromState).height/this.balloonNodeSize().height;1!==I&&l(this._balloon,_,I,1,_.springMass);var O=this._dot;O&&a(O,{transitionDuration:_.dotAnimationDuration})}delete this._animateFromState}t||c.updatedLayout()}}}),n.FeatureVisibility=_;var E=c.createCanvas().getContext("2d");e.exports=n},{"../../../lib/scene-graph":51,"../constants":166,"./marker-annotation-balloon-node":134,"./marker-annotation-dot-node":140,"./marker-annotation-label-node":144,"@maps/css-matrix":61,"@maps/device-pixel-ratio":63,"@maps/geometry/point":71,"@maps/geometry/size":73,"@maps/js-utils":82,"@maps/scheduler":100}],147:[function(t,e,i){function n(){c=o(l),d=o(h)}function o(t){var e=t.concat(t.concat().reverse().map(function(t){return[100-t[1],100-t[0]]})),i=e.concat().reverse();return[].concat(e,i.map(function(t){return[t[0],100-t[1]]}),i.map(function(t){return[t[1],t[0]]}),e.map(function(t){return[t[1],100-t[0]]}))}function s(t){a.call(this,t)}var a=t("./marker-annotation-base-balloon-renderer"),r=t("@maps/js-utils"),l=[[36.162,100],[27.142,99.987],[21.467,99.844],[18.592,99.617],[15.762,99.189],[13.024,98.474],[10.425,97.407],[8.015,95.956],[5.867,94.134]],h=[[35.18,100],[25.598,99.987],[19.615,99.837],[16.757,99.612],[14.038,99.199],[11.517,98.541],[9.204,97.594],[7.107,96.329],[5.247,94.753]],c=[],d=[];s.prototype=r.inheritPrototype(a,s,{drawDotUnderCallout:function(t,e,i){t.fillStyle=e,this.pathForSquareDot(t,i),t.fill()},pathForBalloon:function(t,e,i){c.length||n();var o=2*e;t.moveTo(c[0][0]/100*o,c[0][1]/100*o);for(var s=1;s<c.length;s++)t.lineTo(c[s][0]/100*o,c[s][1]/100*o);if(i){var a=i/6,r=i/3;t.lineTo(e+i/2+r,o),t.bezierCurveTo(e+i/3,o+i/3,e+a,o+i,e,o+i),t.bezierCurveTo(e-a,o+i,e-i/3,o+i/3,e-(i/2+r),o)}t.closePath()},pathForMask:function(t,e,i){d.length||n();var o=2*i,s=e-i;t.moveTo(d[0][0]/100*o+s,d[0][1]/100*o+s);for(var a=1;a<d.length;a++)t.lineTo(d[a][0]/100*o+s,d[a][1]/100*o+s);t.closePath()}}),e.exports=s},{"./marker-annotation-base-balloon-renderer":136,"@maps/js-utils":82}],148:[function(t,e,i){function n(t){o.call(this,t)}var o=t("./marker-annotation-base-dot-renderer"),s=t("@maps/js-utils");n.prototype=s.inheritPrototype(o,n,{pathForDot:function(t,e){this.pathForSquareDot(t,e)}}),e.exports=n},{"./marker-annotation-base-dot-renderer":137,"@maps/js-utils":82}],149:[function(t,e,i){function n(e,i){if(s(this,n)){var o=t("./marker-annotation-internal");Object.defineProperty(this,"_impl",{value:new o(this,e,i)})}}var o=t("./annotation"),s=t("../check-instance-and-warn"),a=t("@maps/js-utils");t("./marker-annotation-internal-mixin"),n.prototype=a.inheritPrototype(o,n,{get size(){return this._impl.size},set size(t){this._impl.size=t},get color(){return this._impl.color},set color(t){this._impl.color=t},get glyphColor(){return this._impl.glyphColor},set glyphColor(t){this._impl.glyphColor=t},get glyphImage(){return this._impl.glyphImage},set glyphImage(t){this._impl.glyphImage=t},get selectedGlyphImage(){return this._impl.selectedGlyphImage},set selectedGlyphImage(t){this._impl.selectedGlyphImage=t},get glyphText(){return this._impl.glyphText},set glyphText(t){this._impl.glyphText=t},get titleVisibility(){return this._impl.titleVisibility},set titleVisibility(t){this._impl.titleVisibility=t},get subtitleVisibility(){return this._impl.subtitleVisibility},set subtitleVisibility(t){this._impl.subtitleVisibility=t}}),e.exports=n},{"../check-instance-and-warn":162,"./annotation":122,"./marker-annotation-internal":143,"./marker-annotation-internal-mixin":142,"@maps/js-utils":82}],150:[function(t,e,i){function n(t){o.call(this,t)}var o=t("./annotation-drag-controller"),s=t("@maps/css-matrix"),a=t("@maps/scheduler"),r=t("@maps/js-utils"),l=[1,2,3,2,1],h=Math.tan(.820304748437335);n.prototype=r.inheritPrototype(o,n,{get isBouncing(){return this._bounceAnimationFrameIndex>=0},animateDropAfterLift:function(){var t=Math.max(this._dropAnimationStartP-Math.min((Date.now()-this._dropAfterLiftAnimationStartDate)/this.liftDurationMs,1),0),e=this.liftAmount*t;this._annotation.sceneGraphNode.transform=(new s).translate(0,-e),this._dropAnimationRevert||(e*=1.25),this._annotation.sceneGraphNode.shadowTransform=(new s).translate(h*e,-e),0===t&&(delete this._annotation.floating,this._annotation.sceneGraphNode.updateState(),delete this._dropAfterLiftAnimationStartDate,delete this._dropAnimationStartP,delete this._dropAnimationRevert,this._dequeueNextAnimation()),a.scheduleOnNextFrame(this)},animateLift:function(){var t=Math.min((Date.now()-this._liftAnimationStartDate)/this.liftDurationMs,1),e=this.liftAmount*t;this._annotation.sceneGraphNode.transform=(new s).translate(this.translation.x,this.translation.y-e),this._shadowLiftDamping&&(e=this.liftAmount*(1+.25*t)),this._annotation.sceneGraphNode.shadowTransform=(new s).translate(h*e,-e),t<1?(a.scheduleOnNextFrame(this),this._liftAnimationProgress=t):(delete this._liftAnimationStartDate,delete this._liftAnimationProgress,delete this._shadowLiftDamping,this._dequeueNextAnimation())},drop:function(){var t=this._annotation.position().y;this._pinVerticalTranslation=-t-4,this._shadowHorizontalTranslation=h*-this._pinVerticalTranslation,this._shadowVerticalTranslation=this._pinVerticalTranslation;var e=t/this._annotation.delegate.mapForAnnotation(this._annotation._public)._impl.ensureRenderingFrame().size.height;this._dropDurationMs=1e3*Math.min(.35*(e+(1-e)/2),3),this._dropAnimationStartDate=Date.now(),this._annotation.floating=!0,this._annotation.sceneGraphNode.updateState(),this._animateDrop(),this._annotation._isAnimating=!0,this._animationQueue=[this._bounce,this._annotation.finishedAnimating.bind(this._annotation)],a.scheduleOnNextFrame(this)},dropAnnotationAfterDraggingAndRevertPosition:function(t){var e=this._annotation.droppedAfterLift.bind(this._annotation);this._bounceAnimationFrameIndex>=0?this._animationQueue=[e]:(this._liftAnimationStartDate?(this._dropAnimationStartP=this._liftAnimationProgress,delete this._liftAnimationStartDate,delete this._liftAnimationProgress):this._dropAnimationStartP=1,t?(this._dropAfterLift(),this._animationQueue=[this._bounce,e]):(this._annotation.draggingDidEnd(),this._shadowLiftDamping=!0,this._animationQueue=[this._dropAfterLift,this._bounce,e],o.prototype.lift.call(this,this.nominalLiftAmount)),this._dropAnimationRevert=t,a.scheduleOnNextFrame(this))},lift:function(t){this.nominalLiftAmount=t,this._animationQueue=[this._liftAfterBounce],this._bounce(),a.scheduleOnNextFrame(this)},setTranslation:function(t){this.translation=t,this._bounceAnimationFrameIndex>=0||this._liftAnimationStartDate||(this._annotation.sceneGraphNode.transform=(new s).translate(t.x,t.y-this.liftAmount),this._annotation.sceneGraphNode.shadowTransform=(new s).translate(h*this.liftAmount,-this.liftAmount))},performScheduledUpdate:function(){this._dropAnimationStartDate?this._animateDrop():this._bounceAnimationFrameIndex>=0?this._animateBounce():o.prototype.performScheduledUpdate.call(this)},_animateBounce:function(){this._bounceAnimationFrameIndex<l.length?(this._annotation.sceneGraphNode.updateState("down"+l[this._bounceAnimationFrameIndex]),++this._bounceAnimationFrameIndex):(delete this._bounceAnimationFrameIndex,this._dequeueNextAnimation()),a.scheduleOnNextFrame(this)},_animateDrop:function(){var t=Math.min((Date.now()-this._dropAnimationStartDate)/this._dropDurationMs,1),e=1-t;this._annotation.sceneGraphNode.transform=(new s).translate(0,e*this._pinVerticalTranslation),this._annotation.sceneGraphNode.shadowTransform=(new s).translate(e*this._shadowHorizontalTranslation,e*this._shadowVerticalTranslation),1===t&&(delete this._pinVerticalTranslation,delete this._shadowHorizontalTranslation,delete this._shadowVerticalTranslation,delete this._dropAnimationStartDate,delete this._dropDurationMs,this._annotation.floating=!1,this._annotation.sceneGraphNode.updateState(),this._dequeueNextAnimation()),a.scheduleOnNextFrame(this)},_bounce:function(){this._bounceAnimationFrameIndex=0},_dequeueNextAnimation:function(){this._animationQueue.length>0&&this._animationQueue.shift().call(this)},_dropAfterLift:function(){delete this.translation,this._dropAfterLiftAnimationStartDate=Date.now(),a.scheduleOnNextFrame(this)},_liftAfterBounce:function(){o.prototype.lift.call(this,this.nominalLiftAmount),this._annotation.floating=!0,this._annotation.sceneGraphNode.updateState()}}),e.exports=n},{"./annotation-drag-controller":116,"@maps/css-matrix":61,"@maps/js-utils":82,"@maps/scheduler":100}],151:[function(t,e,i){function n(t){function e(e,i,n){this._animationController=new s(this),this._dragController=this._animationController,this._sceneGraphNode=new o(this),t.call(this,e,i,t.div,n),this._public=e,this.setSize(d),n&&"color"in n&&(this.color=n.color)}return e.Colors=u,e.prototype=h.inheritPrototype(t,e,{_animates:!0,_color:u.Red,_anchorPoint:p,_calloutAnchorPoint:m,skipRTNodePositionUpdateWhenCameraIsMoving:!0,needsInitialSizeMeasuredFromDOMElement:!1,get size(){return d.copy()},set size(t){console.warn("[MapKit] The `size` property of a pin annotation cannot be set.")},get color(){return this._color},set color(t){h.checkType(t,"string","[MapKit] Expected a string value for PinAnnotation.color, but got `"+t+"` instead"),t!==this._color&&(this._color=t,this.updateLocalizedText(),this._sceneGraphNode.needsDisplay=!0)},get shouldPreventDrag(){return this._animationController.isBouncing},doesAnimate:function(){return this._animates},willMoveToMap:function(t){this._isMoving=t&&this.animates},didMoveToMap:function(){var e=this._isMoving;t.prototype.didMoveToMap.call(this),this.delegate&&e&&this.visible&&!this._appearanceAnimation&&this._shown&&(this._isAnimating=!0,this._animationController.drop())},droppedAfterLift:function(){this.resetNodeTransform(),this._sceneGraphNode.updateState(),t.prototype.droppedAfterLift.call(this)},finishedAnimating:function(){this._sceneGraphNode.updateState(),t.prototype.finishedAnimating.call(this)},altText:function(){return t.prototype.altText.call(this)||(this._color===u.Green?c.get("Annotation.Pin.Green.AccessibilityLabel"):this._color===u.Purple?c.get("Annotation.Pin.Purple.AccessibilityLabel"):this._color===u.Red?c.get("Annotation.Pin.Red.AccessibilityLabel"):c.get("Annotation.Pin.AccessibilityLabel"))},draggingDidEnd:function(){t.prototype.draggingDidEnd.call(this),t.prototype.updatePosition.call(this)},dragOffset:new r(0,2),isAKnownOption:function(e){return"color"===e||t.prototype.isAKnownOption.call(this,e)},resetNodeTransform:function(){this.sceneGraphNode.transform=new l}}),e}var o=t("./pin-annotation-node"),s=t("./pin-annotation-animation-controller"),a=t("@maps/geometry/size"),r=t("@maps/geometry/point"),l=t("@maps/css-matrix"),h=t("@maps/js-utils"),c=t("../localizer").l10n,d=new a(15,36),u={Red:"#ff3d38",Green:"#54d669",Purple:"#c969e0"},p=new window.DOMPoint(8,35),m=new window.DOMPoint(-8,0);n.Colors=u,e.exports=n},{"../localizer":187,"./pin-annotation-animation-controller":150,"./pin-annotation-node":153,"@maps/css-matrix":61,"@maps/geometry/point":71,"@maps/geometry/size":73,"@maps/js-utils":82}],152:[function(t,e,i){var n=t("./annotation-internal"),o=t("./pin-annotation-internal-mixin")(n);e.exports=o},{"./annotation-internal":119,"./pin-annotation-internal-mixin":151}],153:[function(t,e,i){function n(t){o.BaseNode.call(this),this.size=new s(32,39),this._annotation=t,this._renderer=new r(this),this.updateState()}var o=t("../../../lib/scene-graph"),s=t("@maps/geometry/size"),a=t("@maps/js-utils"),r=t("./pin-annotation-renderer");n.prototype=a.inheritPrototype(o.BaseNode,n,{get position(){return this._annotation.nodePosition()},stringInfo:function(){return"PinAnnotationNode"+(this._state?"<"+this._state+">":"")},updateState:function(t){t=this._annotation.floating?"floating":t||"",this._state!==t&&(this._state=t,this.needsDisplay=!0)}}),e.exports=n},{"../../../lib/scene-graph":51,"./pin-annotation-renderer":154,"@maps/geometry/size":73,"@maps/js-utils":82}],154:[function(t,e,i){function n(t){r.RenderItem.call(this,t)}function o(){function t(){0===--o&&(a=i,g.forEach(function(t){t.needsDisplay=!0}))}function e(e,o){var s=n+(e?"-":"")+e+"-"+o+p,a=h.htmlElement("img",{src:s}),r={handleEvent:function(n){switch(a.removeEventListener("load",r),a.removeEventListener("error",r),n.type){case"load":i[e][o]=a;break;case"error":console.warn("[MapKit] Error loading pin annotation image "+n.target.src+"; pin annotations may not display correctly."),_=!0}t()}};a.addEventListener("load",r),a.addEventListener("error",r)}var i={},n=d.createImageUrl("pins/pin"),o=["","floating","down1","down2","down3"].reduce(function(t,n){return i[n]={},e(n,"base"),e(n,"head"),t+2},1);e("","shadow")}function s(t,e,i,n){t.strokeStyle="#ff4040",t.lineWidth=2,t.strokeRect(0,e,i,n-e),t.beginPath(),t.moveTo(0,e),t.lineTo(i,n),t.moveTo(0,n),t.lineTo(i,e),t.stroke()}var a,r=t("../../../lib/scene-graph"),l=t("@maps/js-utils"),h=t("../utils"),c=t("../configuration"),d=t("../urls"),u=Math.min(h.devicePixelRatio,3),p=(u>1?"_"+u+"x":"")+".png",m={},g=[],_=!1;n.prototype=l.inheritPrototype(r.RenderItem,n,{draw:function(t){if(a){var e=this._node,i=e.size.width,n=e.size.height;if(_)s(t,n-e._annotation.size.height,e._annotation.size.width,n);else{var o=e._state,r=e._annotation.color;if(m[r]||(m[r]={}),!m[r][o]){var l=document.createElement("canvas");l.width=i*u,l.height=n*u;var h=l.getContext("2d");h.fillStyle=r,h.fillRect(0,0,l.width,l.height),h.save(),h.globalCompositeOperation="destination-in",h.drawImage(a[o].head,0,0),h.restore(),h.drawImage(a[o].base,0,0),m[r][o]=l}e.shadowTransform&&t.drawImage(a[""].shadow,e.shadowTransform.e,e.shadowTransform.f,i,n),t.drawImage(m[r][o],0,0,i,n)}}else g.indexOf(this._node)<0&&g.push(this._node)}}),c.addEventListener(c.Events.Initialized,function t(){c.removeEventListener(c.Events.Initialized,t),o()}),e.exports=n},{"../../../lib/scene-graph":51,"../configuration":165,"../urls":234,"../utils":237,"@maps/js-utils":82}],155:[function(t,e,i){function n(e,i){if(s(this,n)){console.warn("[MapKit] mapkit.PinAnnotation is deprecated and will be removed in a future release. Please use the newer mapkit.MarkerAnnotation class instead.");var o=t("./pin-annotation-internal");Object.defineProperty(this,"_impl",{value:new o(this,e,i)})}}var o=t("./annotation"),s=t("../check-instance-and-warn"),a=t("@maps/js-utils"),r=t("./pin-annotation-internal-mixin");n.Colors=r.Colors,n.prototype=a.inheritPrototype(o,n,{get size(){return this._impl.size},set size(t){this._impl.size=t},get color(){return this._impl._color},set color(t){this._impl.color=t}}),e.exports=n},{"../check-instance-and-warn":162,"./annotation":122,"./pin-annotation-internal":152,"./pin-annotation-internal-mixin":151,"@maps/js-utils":82}],156:[function(t,e,i){function n(t,e){o.call(this,t,e.coordinate,o.div),this._updateTitleAndSubtitleForLocale();var i=2*h.TOTAL_RADIUS;this.setSize(new l(i,i)),this._userSetSize=!0,this._sceneGraphNode=new s(this),this.shownPropertyWasUpdated(!0)}var o=t("./annotation-internal"),s=t("./user-location-annotation-node"),a=t("../localizer").l10n,r=t("@maps/js-utils"),l=t("@maps/geometry/size"),h=t("./user-location-annotation-style"),c=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty);n.prototype=r.inheritPrototype(o,n,{_anchorOffset:new window.DOMPoint(0,-h.TOTAL_RADIUS),_calloutAnchorPoint:new window.DOMPoint(-h.TOTAL_RADIUS,-h.SHADOW_BLUR),skipRTNodePositionUpdateWhenCameraIsMoving:!0,needsInitialSizeMeasuredFromDOMElement:!1,get coordinate(){return this._coordinate},set coordinate(t){c(this,"_coordinate")?console.warn("[MapKit] The `coordinate` property of the user location annotation cannot be set."):this._coordinate=t.copy()},get draggable(){return!1},set draggable(t){console.warn("[MapKit] The `draggable` property of the user location annotation cannot be set.")},get size(){return this._node.size.copy()},set size(t){console.warn("[MapKit] The `size` property of the user location annotation cannot be set.")},get node(){return this._node},handleEvent:function(t){switch(t.type){case a.Events.LocaleChanged:this._updateTitleAndSubtitleForLocale();break;case"blur":this._sceneGraphNode.pauseAnimation();break;case"focus":this._sceneGraphNode.resumeAnimation()}},shownPropertyWasUpdated:function(t){t?(this._sceneGraphNode.startAnimation(),this._startMonitoringFocus()):(this._sceneGraphNode.stopAnimation(),this._stopMonitoringFocus())},removedFromMap:function(){this._sceneGraphNode.stopAnimation(),a.removeEventListener(a.Events.LocaleChanged,this),this._stopMonitoringFocus()},stale:!1,setCoordinate:function(t){Object.getOwnPropertyDescriptor(o.prototype,"coordinate").set.call(this,t)},_startMonitoringFocus:function(){try{window.top.addEventListener("blur",this),window.top.addEventListener("focus",this)}catch(t){}},_stopMonitoringFocus:function(){try{window.top.removeEventListener("blur",this),window.top.removeEventListener("focus",this)}catch(t){}},_updateTitleAndSubtitleForLocale:function(){this.title=a.get("Location.Title"),this.subtitle=a.get("Location.Subtitle")}}),e.exports=n},{"../localizer":187,"./annotation-internal":119,"./user-location-annotation-node":157,"./user-location-annotation-style":159,"@maps/geometry/size":73,"@maps/js-utils":82}],157:[function(t,e,i){function n(t){s.BaseNode.call(this),this._annotation=t,this._renderer=new r(this)}var o=t("@maps/scheduler"),s=t("../../../lib/scene-graph"),a=t("@maps/js-utils"),r=t("./user-location-annotation-renderer");n.prototype=a.inheritPrototype(s.BaseNode,n,{stringInfo:function(){var t=[];return this.stale&&t.push("stale"),null!=this._pausedTime&&t.push("paused@"+this._pausedTime),"UserLocationAnnotationNode"+(t.length>0?"<"+t.join(", ")+">":"")},get startTime(){return this._startTime},get size(){return this._annotation.node.size},get position(){return this._annotation.nodePosition()},startAnimation:function(){this._startTime=Date.now(),this._pausedTime=null,o.scheduleASAP(this)},stopAnimation:function(){this._startTime=null,this._pausedTime=null},pauseAnimation:function(){this._pausedTime=Date.now()},resumeAnimation:function(){null!=this._pausedTime&&(this._startTime+=Date.now()-this._pausedTime,this._pausedTime=null,o.scheduleASAP(this))},performScheduledUpdate:function(){null!=this._startTime&&(this.needsDisplay=!0,null==this._pausedTime&&o.scheduleOnNextFrame(this))}}),e.exports=n},{"../../../lib/scene-graph":51,"./user-location-annotation-renderer":158,"@maps/js-utils":82,"@maps/scheduler":100}],158:[function(t,e,i){function n(t){s.RenderItem.call(this,t)}function o(t,e,i){return"rgb("+t.map(function(t,n){return Math.round(t+(e[n]-t)*i)}).join(", ")+")"}var s=t("../../../lib/scene-graph"),a=t("@maps/js-utils"),r=t("./user-location-annotation-style"),l=t("../utils");n.prototype=a.inheritPrototype(s.RenderItem,n,{draw:function(t){var e=(Date.now()-this._node.startTime)%r.ANIMATION_DURATION_MS,i=l.easeInOut(e<r.ANIMATION_HALF_DURATION_MS?1-e/r.ANIMATION_HALF_DURATION_MS:(e-r.ANIMATION_HALF_DURATION_MS)/r.ANIMATION_HALF_DURATION_MS),n=r.ANIMATION_SCALE_TO+(r.ANIMATION_SCALE_FROM-r.ANIMATION_SCALE_TO)*i;t.save(),t.beginPath(),t.arc(r.TOTAL_RADIUS,r.TOTAL_RADIUS,r.OUTER_RADIUS,0,2*Math.PI),t.fillStyle=r.OUTER_FILL,t.shadowColor=r.SHADOW_COLOR,t.shadowBlur=r.SHADOW_BLUR,t.fill(),t.restore(),t.beginPath(),t.arc(r.TOTAL_RADIUS,r.TOTAL_RADIUS,r.INNER_RADIUS*n,0,2*Math.PI),t.fillStyle=this.node.stale?r.STALE_FILL:o(r.ANIMATION_FILL_FROM,r.ANIMATION_FILL_TO,i),t.fill()}}),e.exports=n},{"../../../lib/scene-graph":51,"../utils":237,"./user-location-annotation-style":159,"@maps/js-utils":82}],159:[function(t,e,i){e.exports={INNER_RADIUS:8,OUTER_RADIUS:11,SHADOW_BLUR:10,TOTAL_RADIUS:21,OUTER_FILL:"white",STALE_FILL:"rgb(180, 180, 180)",SHADOW_COLOR:"rgba(0, 0, 0, 0.3)",ANIMATION_DURATION_MS:3e3,ANIMATION_HALF_DURATION_MS:1500,ANIMATION_SCALE_FROM:1,ANIMATION_SCALE_TO:.75,ANIMATION_FILL_FROM:[68,152,252],ANIMATION_FILL_TO:[26,129,251]}},{}],160:[function(t,e,i){function n(e){var i=t("./user-location-annotation-internal");Object.defineProperty(this,"_impl",{value:new i(this,e)})}var o=t("./annotation"),s=t("@maps/js-utils"),a=function(){throw new TypeError("[MapKit] UserLocationAnnotation may not be constructed.")};n.prototype=a.prototype=s.inheritPrototype(o,a,{set coordinate(t){this._impl.coordinate=t},get coordinate(){return this._impl.coordinate},get draggable(){return this._impl.draggable},set draggable(t){this._impl.draggable=t},get size(){return this._impl.size},set size(t){this._impl.size=t}}),e.exports=n},{"./annotation":122,"./user-location-annotation-internal":156,"@maps/js-utils":82}],161:[function(t,e,i){var n="function"==typeof ErrorEvent;e.exports=function(t,e,i,o){if(!n)return t.apply(e,i);try{return t.apply(e,i)}catch(t){console.error(t);var s=new ErrorEvent("error",{message:t.message||t.toString()||"(Unknown error)",filename:t.fileName||t.stack||"(Unknown filename)",lineno:t.lineNumber,colno:t.columnNumber,error:t});return window.dispatchEvent(s),o}}},{}],162:[function(t,e,i){e.exports=function(t,e){return t instanceof e||(console.warn("[MapKit] Unexpected object instance. Did you forget to `new`?"),"function"==typeof console.trace&&console.trace(),!1)}},{}],163:[function(t,e,i){"use strict";function n(t,e){this.items=t,this.data=e}n.prototype={constructor:n,get data(){return this._data},set data(t){this._data=t},get items(){return this._items},set items(t){this._items=t instanceof Array?t:null===t?[]:[t]},getFlattenedItemList:function(){var t=[];return this.items.forEach(function(e){"function"==typeof e.getFlattenedItemList?t=t.concat(e.getFlattenedItemList(e)):t.push(e)},this),t}},e.exports=n},{}],164:[function(t,e,i){function n(t,e){Object.defineProperty(this,"_impl",{value:new o(t,e)})}var o=t("./item-collection-internal");n.prototype={get data(){return this._impl.data},set data(t){this._impl.data=t},get items(){return this._impl._items},set items(t){this._impl.items=t},getFlattenedItemList:function(){return this._impl.getFlattenedItemList()}},e.exports=n},{"./item-collection-internal":163}],165:[function(t,e,i){function n(){}var o=t("../build.json"),s=t("./localizer"),a=t("../../lib/bootstrap"),r=t("@maps/js-utils"),l=t("./unsafe-dom");n.prototype=r.inheritPrototype(a,n,{_instrumented:!1,get instrumented(){return this._instrumented},get previewLoCSR(){return!!this._previewLoCSR},get didFallback(){return this._syrupRequestedFallback},get proxyPrefixes(){return this._proxyPrefixes},init:function(t){t&&"object"==typeof t&&("instrumented"in t&&(this._instrumented=!!t.instrumented,delete t.instrumented),"_previewLoCSR"in t&&(this._previewLoCSR=!!t._previewLoCSR,delete t._previewLoCSR),"_proxyPrefixes"in t&&Array.isArray(t._proxyPrefixes)&&(this._proxyPrefixes=t._proxyPrefixes,delete t._proxyPrefixes)),a.prototype.init.call(this,t,"[MapKit] mapkit.init(): ");var e=new l.Event(this.Events.Initialized);this.dispatchEvent(e)},Events:{Initialized:"configuration-init",Changed:"configuration-change",Error:"error"}});var h=new n;h.withParameters({mkjsVersion:o.version,poi:"1",languageSupport:s.languageSupport,l10n:s.l10n}),e.exports=h},{"../../lib/bootstrap":2,"../build.json":102,"./localizer":187,"./unsafe-dom":233,"@maps/js-utils":82}],166:[function(t,e,i){var n=t("@maps/geometry/size");e.exports={MapTypes:{Satellite:"satellite",Hybrid:"hybrid",MutedStandard:"mutedStandard",Standard:"standard"},Distances:{Adaptive:"adaptive",Metric:"metric",Imperial:"imperial"},Emphasis:{Muted:"muted",Standard:"standard"},FeatureVisibility:{Adaptive:"adaptive",Hidden:"hidden",Visible:"visible"},MarkerAnnotationFontFamily:'"SFProRegular", "-apple-system", "BlinkMacSystemFont", "Helvetica Neue", Helvetica, Arial, sans-serif',MapTiledLayerMinZoomLevel:2,MapTiledLayerMaxZoomLevel:20,ZoomTypes:{Button:"BUTTON",Scroll:"SCROLL",DoubleTap:"DOUBLE_TAP",Pinch:"PINCH"},MapSizes:{minimumSizeToShowControls:new n(262,222),minimumSizeToShowLogo:new n(200,100),minimumSizeToShowLogoWithReducedMargin:new n(100,100)}}},{"@maps/geometry/size":73}],167:[function(t,e,i){e.exports=':host(.mk-controls-container.mk-dragging-annotation) .mk-legal,:host(.mk-controls-container.mk-dragging-annotation) .mk-map-type,:host(.mk-controls-container.mk-dragging-annotation) .mk-rotation-control,:host(.mk-controls-container.mk-dragging-annotation) .mk-rotation-control input,:host(.mk-controls-container.mk-dragging-annotation) .mk-user-location-control,:host(.mk-controls-container.mk-dragging-annotation) .mk-zoom-in,:host(.mk-controls-container.mk-dragging-annotation) .mk-zoom-out{cursor:none}@media (inverted-colors){:host(.mk-controls-container) img{filter:initial}}:host(.mk-controls-container) ::selection{background:0 0}.mk-top-left-controls-container,.mk-top-right-controls-container{position:absolute;top:12px;left:12px}.mk-top-right-controls-container{left:auto;right:12px}.mk-rotation-control~.mk-user-location-control,.mk-zoom-controls~.mk-user-location-control{right:60px}.mk-control.mk-pressed{background:#ededed}:host(.mk-dark-mode) .mk-control.mk-pressed{background:#979797}.mk-scale{vertical-align:top}.mk-user-location-control{position:absolute;right:0;bottom:0;cursor:pointer;position:relative;width:23px;height:23px;background-color:#fff;box-shadow:0 0 0 1px #bfbfbf;border-radius:4px;pointer-events:auto;margin:0;transition:background-color .2s ease}:host(.mk-dark-mode) .mk-user-location-control{background-color:#747474;border-color:rgba(0,0,0,.13);box-shadow:0 .5px .5px 0 rgba(0,0,0,.15)}.mk-user-location-control .mk-icon{pointer-events:none;position:absolute;top:0;left:0;width:14px;height:14px}:host(.mk-controls-container) div.mk-user-location-control svg.mk-icon{margin:5px 5px 4px 4px}.mk-user-location-control .mk-icon-waiting{opacity:0;top:-1px;left:1px}.mk-user-location-control.mk-tracking{box-shadow:0 0 0 1px rgba(255,255,255,.7);background-color:#007aff}:host(.mk-dark-mode) .mk-user-location-control.mk-tracking{background-color:#747474}.mk-user-location-control.mk-tracking .mk-icon{fill:#fff}.mk-user-location-control.mk-focus,:host(.mk-dark-mode) .mk-user-location-control.mk-focus{box-shadow:0 0 0 3px rgba(0,122,255,.2),0 0 0 1px #007aff}.mk-user-location-control.mk-pressed.mk-focus{background-color:#e0ecfa}.mk-user-location-control.mk-tracking.mk-focus{background-color:#007aff;box-shadow:0 0 0 3px rgba(0,122,255,.2)}:host(.mk-dark-mode) .mk-user-location-control.mk-tracking.mk-focus{background-color:#747474}.mk-user-location-control.mk-focus:not(.mk-tracking) .mk-icon{fill:#007aff;fill-rule:nonzero}:host(.mk-dark-mode) .mk-user-location-control.mk-focus:not(.mk-tracking) .mk-icon{fill:rgba(255,255,255,.85)}.mk-error-message{font-family:"-apple-system-font","Helvetica Neue",Helvetica,Arial,sans-serif;position:absolute;background-color:rgba(250,250,250,.95);color:#333;font-size:13px;bottom:0;box-shadow:0 0 0 1px #bfbfbf;opacity:0;border-radius:5px;padding:7px;max-width:250px;pointer-events:auto;transform-origin:100% 50% 0}:host(.mk-dark-mode) .mk-error-message{background-color:#3e3e3e;color:rgba(255,255,255,.85);box-shadow:none;border:1px solid rgba(255,255,255,.2)}:host(.mk-dark-mode) .mk-error-message>.mk-error-support:visited{color:#00e}.mk-error-support{white-space:nowrap}.mk-error-message-pop{animation-name:mk-pop;animation-duration:.7s;animation-timing-function:ease-in;animation-fill-mode:forwards}@keyframes mk-pop{0%{transform:translate3d(0,0,0) scale3d(.01,.05,1);opacity:0}50%{opacity:0}70%{transform:scale3d(1.1,1.1,1)}85%{transform:scale3d(.95,.95,1)}100%{transform:translate3d(0,0,0) scale3d(1,1,1);opacity:1}}:host(.mk-controls-container) :focus{outline:0}.mk-logo-control{position:absolute;bottom:0;left:0}.mk-logo-control .mk-logo{vertical-align:bottom;width:auto}:host(.mk-controls-container) div.mk-logo-control img.mk-logo{width:82px;height:24px;margin-left:9px;margin-right:9px;margin-bottom:5px}:host(.mk-controls-container.mk-reduce-margin) div.mk-logo-control img.mk-logo{margin-left:4px;margin-right:4px}:host(.mk-controls-container) .mk-logo-control .mk-logo.mk-logo-special.mk-logo-special{width:215px;height:auto;margin-bottom:30px!important;margin-left:40px!important}:host(.mk-controls-container) div.mk-logo-control img.mk-logo.mk-logo-autonavi.mk-logo-autonavi{width:68px;height:45px;margin:0}.mk-bottom-right-controls-container{position:absolute;bottom:12px;right:12px}.mk-bottom-right-controls-container .mk-control.mk-rotation-control.mk-with-zoom-control{bottom:33px}.mk-legal-controls{position:absolute;bottom:5px;left:11px;pointer-events:auto}.mk-bottom-left-controls-container .mk-legal-controls.mk-legal-controls-autonavi{left:60px}.mk-bottom-right-controls-container .mk-legal-controls{left:auto;right:0;bottom:0;margin-right:-5px;margin-bottom:-6px}:host(.mk-reduce-margin) .mk-bottom-right-controls-container .mk-legal-controls{margin-right:-11px;margin-bottom:-10px}.mk-bottom-right-controls-container *+.mk-legal-controls{margin-right:7px}.mk-rotation-control~.mk-legal-controls,.mk-zoom-controls~.mk-legal-controls{right:51px}.mk-user-location-control~.mk-legal-controls{right:20px}.mk-rotation-control~.mk-user-location-control~.mk-legal-controls,.mk-zoom-controls~.mk-user-location-control~.mk-legal-controls{right:80px}.mk-legal-controls .mk-pressed{background:rgba(0,0,0,.07)}.mk-legal-controls .mk-legal{color:rgba(0,0,0,.7);font:9px "-apple-system-font","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:500;text-decoration:underline;text-shadow:0 0 1px rgba(255,255,255,.85);pointer-events:auto;white-space:nowrap;cursor:pointer;padding:4px 5px 6px 5px}.mk-legal-controls .mk-legal.mk-legal-satellite,:host(.mk-dark-mode) .mk-legal-controls .mk-legal{color:rgba(255,255,255,.9);text-shadow:0 0 1px rgba(0,0,0,.5),0 0 10px rgba(0,0,0,1)}.mk-legal-controls.mk-focus{background-color:#e2eef9;border-radius:2px;box-shadow:0 0 0 1px #007aff}:host(.mk-dark-mode) .mk-legal-controls.mk-focus{background-color:initial}.mk-legal-controls.mk-focus .mk-legal{color:#157efb;text-shadow:none}:host(.mk-dark-mode) .mk-legal-controls.mk-focus .mk-legal{color:rgba(255,255,255,.9)}.mk-zoom-controls{position:absolute;right:0;bottom:0;width:51px;height:23px;background:#fff;box-shadow:0 0 0 1px #bfbfbf;border-radius:4px;pointer-events:auto}:host(.mk-dark-mode) .mk-zoom-controls{background-color:#747474;border-color:rgba(0,0,0,.13);box-shadow:0 .5px .5px 0 rgba(0,0,0,.15)}.mk-zoom-controls .mk-icon{pointer-events:none;width:13px;height:13px;fill:#333}:host(.mk-controls-container) div.mk-zoom-controls svg.mk-icon{margin:5px 6px}:host(.mk-controls-container.mk-dark-mode) .mk-icon{fill:rgba(255,255,255,.85)}.mk-zoom-controls .mk-disabled,.mk-zoom-controls.mk-disabled .mk-zoom-in,.mk-zoom-controls.mk-disabled .mk-zoom-out{opacity:.25}.mk-zoom-controls .mk-zoom-in,.mk-zoom-controls .mk-zoom-out{position:absolute;z-index:2;width:25px;height:23px;cursor:pointer}.mk-zoom-controls .mk-zoom-in{border-top-right-radius:inherit;border-bottom-right-radius:inherit;right:0}.mk-zoom-controls .mk-zoom-out{border-top-left-radius:inherit;border-bottom-left-radius:inherit}.mk-zoom-controls.mk-focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus{background:#fafafa;box-shadow:0 0 0 3px rgba(0,122,255,.2)}:host(.mk-dark-mode) .mk-zoom-controls.mk-focus{background:#747474}.mk-zoom-controls.mk-focus .mk-zoom-in:focus,.mk-zoom-controls.mk-focus .mk-zoom-out:focus{box-shadow:0 0 0 1px #007aff}.mk-zoom-controls.mk-focus .mk-zoom-in.mk-pressed:focus,.mk-zoom-controls.mk-focus .mk-zoom-out.mk-pressed:focus{background:rgba(0,122,255,.1)}.mk-zoom-controls.mk-focus .mk-zoom-in:focus .mk-icon,.mk-zoom-controls.mk-focus .mk-zoom-out:focus .mk-icon{fill:#007aff}:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-in:focus .mk-icon,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-out:focus .mk-icon{fill:rgba(255,255,255,.85)}.mk-zoom-controls .mk-pressed{background:#ededed}:host(.mk-dark-mode) .mk-zoom-controls .mk-pressed{background:rgba(255,255,255,.36)}.mk-zoom-controls .mk-divider{position:absolute;left:25px;width:1px;height:23px;border-left:1px solid #bfbfbf;box-sizing:border-box}:host(.mk-dark-mode) .mk-zoom-controls .mk-divider{border-color:rgba(0,0,0,.2)}:host(.mk-controls-container) .mk-map-type-control{display:inline-block;vertical-align:top;height:23px;margin-left:7px;overflow:hidden;background:#fff;box-shadow:0 0 0 1px #bfbfbf;border-radius:4px;pointer-events:auto;transition:height .3s,margin-top .3s}:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control{background-color:#747474;border:.5px solid rgba(0,0,0,.13);box-shadow:0 .5px .5px 0 rgba(0,0,0,.15)}:host(.mk-controls-container) .mk-map-type-control .mk-map-type{position:relative;cursor:pointer;font:13px/23px "-apple-system-font",HelveticaNeue-Medium,Helvetica,Arial,sans-serif;color:#424242;letter-spacing:.1px;text-align:left;padding:0 24px 0 6px;margin-top:-24px;border-bottom:1px solid #e1e1e1;visibility:hidden}:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control .mk-map-type{color:rgba(255,255,255,.85);border-bottom:1px solid rgba(255,255,255,.15)}:host(.mk-controls-container) .mk-map-type-control .mk-map-type.mk-active{margin-top:auto;visibility:visible}:host(.mk-controls-container) .mk-map-type-control .mk-map-type .mk-icon{pointer-events:none;position:absolute;width:9px;height:6px;right:5px;top:9px;fill:none;stroke-width:1.5;stroke:#7c7c7c}:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control .mk-map-type .mk-icon{stroke:rgba(255,255,255,.85)}:host(.mk-controls-container) .mk-map-type-control .mk-map-type.mk-pressed{background:#ededed}:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control .mk-map-type.mk-pressed{background:rgba(255,255,255,.36)}:host(.mk-controls-container) .mk-map-type-control.mk-open.mk-opening{overflow:hidden}:host(.mk-controls-container) .mk-map-type-control.mk-open{height:71px;overflow:visible}:host(.mk-controls-container) .mk-map-type-control.mk-open .mk-map-type{position:relative;visibility:visible;margin-top:auto}:host(.mk-controls-container) .mk-map-type-control:not(.mk-open) .mk-map-type.mk-active{border-bottom:none;border-radius:3px}:host(.mk-controls-container) .mk-map-type-control.mk-open .mk-map-type:first-child{border-radius:3px 3px 0 0}:host(.mk-controls-container) .mk-map-type-control.mk-open .mk-map-type:last-child{border:none;border-radius:0 0 3px 3px}:host(.mk-controls-container) .mk-map-type-control.mk-open .mk-map-type .mk-icon{width:11px;height:9px;right:5px;top:7px;stroke:none;fill:#333}:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control.mk-open .mk-map-type .mk-icon{fill:rgba(255,255,255,.85)}:host(.mk-controls-container) .mk-map-type-control.mk-focus.mk-show-focus{background-color:#fff}:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control.mk-focus.mk-show-focus{background-color:#747474}:host(.mk-controls-container) .mk-map-type-control.mk-focus.mk-show-focus,:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control.mk-focus.mk-show-focus{box-shadow:0 0 0 1px #007aff,0 0 0 3px rgba(0,122,255,.2)}:host(.mk-controls-container) .mk-map-type-control.mk-focus.mk-show-focus:not(.mk-open) .mk-map-type.mk-active{color:#007aff}:host(.mk-controls-container) .mk-map-type-control.mk-focus.mk-show-focus:not(.mk-open) .mk-map-type.mk-active.mk-tinted{color:#007aff!important}:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control.mk-focus.mk-show-focus:not(.mk-open) .mk-map-type.mk-active{color:rgba(255,255,255,.85)}:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control.mk-focus.mk-show-focus:not(.mk-open) .mk-map-type.mk-active{color:rgba(255,255,255,.85)}:host(.mk-controls-container) .mk-map-type-control.mk-focus.mk-show-focus:not(.mk-open) .mk-map-type.mk-pressed.mk-active{background-color:rgba(0,122,255,.1)}:host(.mk-controls-container) .mk-map-type-control.mk-focus.mk-show-focus:not(.mk-open) .mk-map-type .mk-icon{stroke:#007aff}:host(.mk-controls-container) .mk-map-type-control.mk-focus.mk-show-focus:not(.mk-open) .mk-map-type.mk-active.mk-tinted .mk-icon{stroke:#007aff!important}:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control.mk-focus.mk-show-focus:not(.mk-open) .mk-map-type .mk-icon{stroke:rgba(255,255,255,.85)}:host(.mk-controls-container) .mk-map-type-control.mk-open.mk-focus.mk-show-focus{box-shadow:0 0 0 3px rgba(0,122,255,.2)}:host(.mk-controls-container) .mk-map-type-control.mk-open.mk-focus .mk-map-type.mk-active{color:#424242}:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control.mk-open.mk-focus .mk-map-type.mk-active{color:rgba(255,255,255,.85)}:host(.mk-controls-container) .mk-map-type-control.mk-open .mk-map-type .mk-icon{stroke:none;fill:#333}:host(.mk-controls-container) .mk-map-type-control.mk-open .mk-map-type.mk-active.mk-tinted .mk-icon{stroke:none!important}:host(.mk-controls-container) .mk-map-type-control.mk-open .mk-map-type.mk-active.mk-focus .mk-icon,:host(.mk-controls-container) .mk-map-type-control.mk-open.mk-show-focus .mk-map-type.mk-active:focus .mk-icon{fill:#007aff}:host(.mk-controls-container) .mk-map-type-control.mk-open .mk-map-type.mk-active.mk-focus.mk-tinted .mk-icon,:host(.mk-controls-container) .mk-map-type-control.mk-open.mk-show-focus .mk-map-type.mk-active.mk-tinted:focus .mk-icon{fill:#007aff!important}:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control.mk-open .mk-map-type.mk-active.mk-focus .mk-icon,:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control.mk-open.mk-show-focus .mk-map-type.mk-active:focus .mk-icon{fill:rgba(255,255,255,.85)}:host(.mk-controls-container) .mk-map-type-control.mk-open.mk-show-focus .mk-map-type:focus{color:#007aff;box-shadow:0 0 0 1px #007aff}:host(.mk-controls-container) .mk-map-type-control.mk-open.mk-show-focus.mk-tinted .mk-map-type:focus{color:#007aff!important}:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control.mk-open.mk-show-focus .mk-map-type:focus{color:rgba(255,255,255,.85)}:host(.mk-controls-container) .mk-map-type-control.mk-open:focus.mk-show-focus .mk-map-type.mk-pressed:focus{background-color:rgba(0,122,255,.1)}.mk-style-helper{opacity:0;pointer-events:none}.mk-rotation-control{width:53px;height:53px;cursor:-webkit-grab;cursor:grab;pointer-events:auto;position:absolute;bottom:-2px;right:-1px;border-radius:50px;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:-1;overflow:hidden;line-height:0;transition:opacity .1s cubic-bezier(.19,1,.22,1)}.mk-rotation-control{transition:opacity .3s}:host(.mk-dark-mode) .mk-rotation-control{background-color:#747474;box-shadow:0 .5px .5px 0 rgba(0,0,0,.15)}.mk-rotation-control>.mk-rotation-wrapper{width:53px;height:53px;position:absolute;will-change:transform}.mk-rotation-control.mk-pressed{cursor:-webkit-grabbing;cursor:grabbing}.mk-rotation-control .mk-compass{width:53px}.mk-rotation-control .mk-compass-border{width:59px;position:absolute;top:-2px;left:-3px;max-width:none}.mk-rotation-control .mk-north-indicator{font:16px/18px "-apple-system-font",HelveticaNeue-Medium,Helvetica,Arial,sans-serif;color:#000;position:absolute;top:24px;left:26.5%;width:25px;overflow:hidden;text-overflow:clip;text-align:center}:host(.mk-dark-mode) .mk-rotation-control .mk-compass{width:46.5px;position:absolute;top:3px;left:3px}:host(.mk-dark-mode) .mk-rotation-control .mk-north-indicator{color:rgba(255,255,255,.85)}.mk-rotation-control .mk-north-indicator.mk-north-indicator-long{font-size:12px}.mk-rotation-control.mk-focus,:host(.mk-dark-mode) .mk-rotation-control.mk-focus{box-shadow:0 0 0 1px #007aff,0 0 0 3px rgba(0,122,255,.2)}.mk-rotation-control.mk-focus .mk-north-indicator{color:#007aff}:host(.mk-dark-mode) .mk-rotation-control.mk-focus .mk-north-indicator{color:rgba(255,255,255,.85)}.mk-rotation-control .mk-rotation-slider{position:absolute;left:0;width:100%;height:15px;top:-30px}@supports (backdrop-filter:blur(5px)) or (-webkit-backdrop-filter:blur(5px)){:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control,:host(.mk-dark-mode) .mk-rotation-control,:host(.mk-dark-mode) .mk-user-location-control,:host(.mk-dark-mode) .mk-zoom-controls{background-color:rgba(191,191,191,.5);-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px)}:host(.mk-dark-mode) .mk-zoom-controls .mk-disabled,:host(.mk-dark-mode) .mk-zoom-controls.mk-disabled .mk-zoom-in,:host(.mk-dark-mode) .mk-zoom-controls.mk-disabled .mk-zoom-out{opacity:.5}:host(.mk-dark-mode) .mk-control.mk-pressed{background:rgba(255,255,255,.36)}:host(.mk-controls-container.mk-dark-mode) .mk-map-type-control.mk-focus.mk-show-focus,:host(.mk-dark-mode) .mk-user-location-control.mk-tracking,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus{background-color:rgba(255,255,255,.25)}}:host(.mk-rtl) *{text-align:right!important;direction:rtl}:host(.mk-rtl) .mk-user-location-control{right:auto;left:0}:host(.mk-rtl) .mk-logo-control{right:0}:host(.mk-rtl) .mk-top-right-controls-container{left:12px;right:auto}:host(.mk-rtl) .mk-top-left-controls-container{left:auto;right:12px}:host(.mk-controls-container.mk-rtl) .mk-map-type-control .mk-map-type{padding:0 6px 0 24px}:host(.mk-controls-container.mk-rtl) .mk-map-type-control .mk-map-type .mk-icon{left:5px;right:auto}:host(.mk-rtl) .mk-zoom-controls{right:auto;left:0}:host(.mk-rtl) .mk-zoom-controls .mk-zoom-out{border-top-left-radius:initial;border-bottom-left-radius:initial;border-top-right-radius:inherit;border-bottom-right-radius:inherit;right:0;left:auto}:host(.mk-rtl) .mk-zoom-controls .mk-zoom-in{border-top-left-radius:inherit;border-bottom-left-radius:inherit;border-top-right-radius:initial;border-bottom-right-radius:initial;right:auto;left:0}:host(.mk-rtl) .mk-bottom-right-controls-container{left:12px;right:auto}:host(.mk-rtl) .mk-bottom-right-controls-container .mk-zoom-controls{margin-left:0;margin-right:9px}:host(.mk-rtl) .mk-rotation-control~.mk-user-location-control,:host(.mk-rtl) .mk-zoom-controls~.mk-user-location-control{right:auto;left:60px}:host(.mk-controls-container.mk-rtl) .mk-map-type-control{margin-right:7px;margin-left:0}:host(.mk-rtl) .mk-legal-controls{left:auto;right:11px}:host(.mk-rtl) .mk-bottom-left-controls-container .mk-legal-controls.mk-legal-controls-autonavi{right:60px}:host(.mk-rtl) .mk-bottom-right-controls-container .mk-legal-controls{left:0;right:auto;margin-left:-5px;margin-right:0}:host(.mk-rtl.mk-reduce-margin) .mk-bottom-right-controls-container .mk-legal-controls{margin-left:-11px}:host(.mk-rtl) .mk-bottom-right-controls-container *+.mk-legal-controls{margin-left:7px}:host(.mk-rtl) .mk-rotation-control~.mk-legal-controls,:host(.mk-rtl) .mk-zoom-controls~.mk-legal-controls{right:auto;left:51px}:host(.mk-rtl) .mk-user-location-control~.mk-legal-controls{right:auto;left:20px}:host(.mk-rtl) .mk-rotation-control~.mk-user-location-control~.mk-legal-controls,:host(.mk-rtl) .mk-zoom-controls~.mk-user-location-control~.mk-legal-controls{right:auto;left:80px}:host(.mk-rtl) .mk-error-message{transform-origin:0 50% 0}:host(.mk-rtl) .mk-rotation-control{right:auto;left:-1px}:host(.mk-rtl) .mk-rotation-control .mk-north-indicator{text-align:center!important}@keyframes mk-fadeout{from{opacity:1}to{opacity:0}}'},{}],168:[function(t,e,i){function n(t){c.call(this,t),this.classList.add(u.CONTROL)}function o(t){this._control=t}function s(t){this._control=t}function a(t){this._control=t}var r=t("../utils"),l=t("../unsafe-dom"),h=t("@maps/js-utils"),c=t("@maps/render-tree").Node,d=t("../localizer").l10n,u={CONTROL:"mk-control",DISABLED:"mk-disabled",FOCUS:"mk-focus"};n.prototype=h.inheritPrototype(c,n,{constructor:n,_enabled:!1,hasFocus:!1,pageHasFocus:!1,get enabled(){return this._enabled},set enabled(t){var e=!!t;this._enabled!==e&&(e?(this.classList.remove(u.DISABLED),this._createListeners(),this.element.addEventListener(r.startEventType,this._eventListener),this.parent&&(this._addFocusAndBlurListeners(),this._addKeyboardListeners(),this.addEventListeners())):(this.classList.add(u.DISABLED),this.element.removeEventListener(r.startEventType,this._eventListener),this.removeEventListeners(),this._removeFocusAndBlurListeners(),this._removeKeyboardListeners()),this._enabled=e,this.reset())},set canShowTooltips(t){t?this._updateLabels():this._clearLabels()},willMoveToParent:function(t){t?this.parent||(this._createListeners(),d.addEventListener(d.Events.LocaleChanged,this._eventListener),this.enabled&&(this._addFocusAndBlurListeners(),this._addKeyboardListeners(),this.addEventListeners())):(d.removeEventListener(d.Events.LocaleChanged,this._eventListener),this.removeEventListeners(),this._removeFocusAndBlurListeners(),this._removeKeyboardListeners(),this._destroyListeners())},blurFocusedElement:function(t){var e=r.getShadowDOMTargetFromEvent(this.element,t);if(!this.element.contains(e)){var i=r.containingDocumentOrShadowRoot(this.element);i.activeElement&&this.element.contains(i.activeElement)&&i.activeElement.blur()}},reset:function(){},touchesBegan:function(t){},touchesMoved:function(t){},touchesEnded:function(t){},touchesCanceled:function(t){},spaceBarKeyDown:function(t){},spaceBarKeyUp:function(t){},escapeKeyDown:function(t){},escapeKeyUp:function(t){},downArrowKeyUp:function(t){},downArrowKeyDown:function(t){},upArrowKeyUp:function(t){},upArrowKeyDown:function(t){},rightArrowKeyUp:function(t){},leftArrowKeyUp:function(t){},rightArrowKeyDown:function(t){},leftArrowKeyDown:function(t){},focused:function(t){},blurred:function(t){},pageDidFocus:function(t){},pageDidBlur:function(t){},updateTintColor:function(t){},removeEventListeners:function(){},addEventListeners:function(){},localeChanged:function(){},_clearLabels:function(){r.updateLabel(this.element,"")},_createListeners:function(){this._eventListener||(this._eventListener=new o(this)),this._windowEventListener||(this._windowEventListener=new a(this)),this._cancelFocusEventListener||(this._cancelFocusEventListener=new s(this))},_destroyListeners:function(){this._eventListener&&(this.element.removeEventListener(r.startEventType,this._eventListener),this._eventListener.destroy(),delete this._eventListener),this._windowEventListener&&(this._windowEventListener.destroy(),delete this._windowEventListener),this._cancelFocusEventListener&&(this._cancelFocusEventListener.destroy(),delete this._cancelFocusEventListener)},_addFocusAndBlurListeners:function(){this.element.addEventListener("focus",this._eventListener,!0),this.element.addEventListener("blur",this._eventListener,!0),window.addEventListener("focus",this._windowEventListener),window.addEventListener("blur",this._windowEventListener)},_removeFocusAndBlurListeners:function(){this.element.removeEventListener("focus",this._eventListener,!0),this.element.removeEventListener("blur",this._eventListener,!0),window.removeEventListener("focus",this._windowEventListener),window.removeEventListener("blur",this._windowEventListener)},_addKeyboardListeners:function(){this.element.addEventListener("keydown",this._eventListener),this.element.addEventListener("keyup",this._eventListener)},_removeKeyboardListeners:function(){this.element.removeEventListener("keydown",this._eventListener),this.element.removeEventListener("keyup",this._eventListener)}}),l.EventTarget(n.prototype),o.prototype={destroy:function(){window.removeEventListener(r.startEventType,this._control._cancelFocusEventListener,!0),this._removeEventListeners(),delete this._control},handleEvent:function(t){switch(t.type){case r.startEventType:this._touchesBegan(t);break;case r.moveEventType:this._control.touchesMoved(t);break;case r.endEventType:this._removeEventListeners(),this._control.touchesEnded(t);break;case r.cancelEventType:this._removeEventListeners(),this._control.touchesCanceled(t);break;case"keydown":this._keyDown(t);break;case"keyup":this._keyUp(t);break;case"focus":this._focus(t);break;case"blur":this._blur(t);break;case d.Events.LocaleChanged:this._control.localeChanged(t)}},_touchesBegan:function(t){t.preventDefault(),t.stopPropagation(),("mousedown"===t.type||"pointerdown"===t.type&&"mouse"===t.pointerType)&&(0!==t.button||t.ctrlKey)||(window.addEventListener(r.moveEventType,this,!0),window.addEventListener(r.endEventType,this,!0),r.cancelEventType&&window.addEventListener(r.cancelEventType,this,!0),this._control.touchesBegan(t))},_keyDown:function(t){switch(t.keyCode){case h.KeyCodes.Escape:this._control.escapeKeyDown(t);break;case h.KeyCodes.SpaceBar:t.preventDefault(),this._control.spaceBarKeyDown(t);break;case h.KeyCodes.DownArrow:t.preventDefault(),this._control.downArrowKeyDown(t);break;case h.KeyCodes.UpArrow:t.preventDefault(),this._control.upArrowKeyDown(t);break;case h.KeyCodes.RightArrow:t.preventDefault(),this._control.rightArrowKeyDown(t);break;case h.KeyCodes.LeftArrow:t.preventDefault(),this._control.leftArrowKeyDown(t)}},_keyUp:function(t){switch(t.keyCode){case h.KeyCodes.Escape:this._control.escapeKeyUp(t);break;case h.KeyCodes.DownArrow:t.preventDefault(),this._control.downArrowKeyUp(t);break;case h.KeyCodes.UpArrow:t.preventDefault(),this._control.upArrowKeyUp(t);break;case h.KeyCodes.RightArrow:t.preventDefault(),this._control.rightArrowKeyUp(t);break;case h.KeyCodes.LeftArrow:t.preventDefault(),this._control.leftArrowKeyUp(t);break;case h.KeyCodes.SpaceBar:t.preventDefault(),this._control.spaceBarKeyUp(t)}},_focus:function(t){this._control.hasFocus||r.containingDocumentOrShadowRoot(this._control.element).activeElement===t.target&&(this._control.hasFocus=!0,this._control.classList.add(u.FOCUS),window.addEventListener(r.startEventType,this._control._cancelFocusEventListener,!0),this._control.focused(t))},_blur:function(t){this._control.hasFocus&&(this._control.hasFocus=!1,window.removeEventListener(r.startEventType,this._control._cancelFocusEventListener,!0),this._control.classList.remove(u.FOCUS),this._control.blurred(t))},_removeEventListeners:function(){window.removeEventListener(r.moveEventType,this,!0),window.removeEventListener(r.endEventType,this,!0),r.cancelEventType&&window.removeEventListener(r.cancelEventType,this,!0)}},s.prototype={destroy:function(){delete this._control},handleEvent:function(t){this._control.blurFocusedElement(t)}},a.prototype={destroy:function(){delete this._control},handleEvent:function(t){switch(t.type){case"focus":this._control.pageHasFocus||(this._control.pageHasFocus=!0,this._control.pageDidFocus(t));break;case"blur":this._control.pageHasFocus=!1,this._control.pageDidBlur(t)}}},e.exports=n},{"../localizer":187,"../unsafe-dom":233,"../utils":237,"@maps/js-utils":82,"@maps/render-tree":98}],169:[function(t,e,i){function n(e){_.call(this,o.htmlElement("div",{class:k})),this._map=e,this._topRightControlsNode=new _(o.htmlElement("div",{class:T})),this._bottomRightControlsNode=new _(o.htmlElement("div",{class:E})),this._bottomLeftControlsNode=new _(o.htmlElement("div",{class:L})),this._shadowRootNode=o.addShadowRootChild(this,t("../controls-css")),this._shadowRootNode.addChild(this._topRightControlsNode),this._shadowRootNode.addChild(this._bottomRightControlsNode),this._shadowRootNode.addChild(this._bottomLeftControlsNode),this._logo=new r,this._legalControl=new l,s.addEventListener(s.Events.Changed,this),this._controlsPending=!1,y.activeLocale&&(this._rtl=y.activeLocale.rtl),y.addEventListener(y.Events.LocaleChanged,this)}var o=t("../utils"),s=t("../configuration"),a=t("@maps/js-utils"),r=t("./logo"),l=t("./legal-control"),h=t("./map-type-control"),c=t("./scale"),d=t("./zoom-control"),u=t("./user-location-control"),p=t("./rotation-control"),m=t("@maps/geometry/point"),g=t("@maps/render-tree"),_=t("@maps/render-tree").Node,f=t("../user-location/user-location"),y=t("../localizer").l10n,v=t("@maps/geometry/rect"),w=t("../constants"),b=w.FeatureVisibility,C=t("@maps/device-pixel-ratio"),S=["ca-ES","en-GB","en-US","es-ES","es-MX","hi-IN","id-ID","ja-JP","ko-KR","ms-MY","nb-NO","pt-BR","pt-PT","ro-RO","zh-CN","zh-HK","zh-TW"],k="mk-controls-container",E="mk-bottom-right-controls-container",T="mk-top-right-controls-container",L="mk-bottom-left-controls-container",M=new m(7,11);n.prototype=a.inheritPrototype(_,n,{_rtl:!1,get controlsPending(){return this._controlsPending},set canShowTooltips(t){this._userLocationControl&&(this._userLocationControl.canShowTooltips=t),this._zoomControl&&(this._zoomControl.canShowTooltips=t),this._mapTypeControl&&(this._mapTypeControl.canShowTooltips=t),this._rotationControl&&(this._rotationControl.canShowTooltips=t)},mapPaddingDidChange:function(t){var e=this.element.style;e.top=t.top+"px",e.left=t.left+"px",e.bottom=t.bottom+"px",e.right=t.right+"px",this.sizeDidChange()},sizeDidChange:function(){var t=this._shouldHideControls();this._toggleControl(this._map.showsZoomControl&&!t,this._zoomControl,this.updateZoomControl),this._toggleControl(this._map.showsMapTypeControl&&!t,this._mapTypeControl,this.updateMapTypeControl),this._toggleControl(this._map.showsUserLocationControl&&!t,this._userLocationControl,this.updateUserLocationControl),this.updateLogo(),this.updateLegalControl(),this.updateRotationControl(),this.updateScale(),this.zoomLevelDidChange(),this._setReduceMargin()},zoomLevelDidChange:function(){this._zoomControl&&(this._zoomControl.zoomOutEnabled=this._map.zoomLevel!==this._map.minZoomLevel,this._zoomControl.zoomInEnabled=this._map.zoomLevel!==this._map.maxZoomLevel)},update:function(){this._map&&(this._shouldHideControls()?(this._removeZoomControl(),this._removeMapTypeControl(),this._removeUserLocationControl(),this._removeRotationControl(),this._removeScale()):(this.updateZoomControl(),this.updateMapTypeControl(),this.updateUserLocationControl(),this.updateRotationControl(),this.updateScale()),this.updateLogo(),this.updateLegalControl(),this._setReduceMargin())},scaleDidChange:function(){this._scale&&(this._scale.update(),this._scale.hideIfNeeded())},updateScale:function(){this._map.showsScale===b.Hidden||this._shouldHideControls()?this._removeScale():(this._addScale(),this._scale.node.mapWidth=this._map._mapNode.size.width,this._scale.updateTheme(this._map.mapNodeTint),this._positionScale(),this._scale.update())},updateZoomControl:function(){this._map.showsZoomControl&&!this._shouldHideControls()?(this._addZoomControl(),this._zoomControl.enabled=this._map.isZoomEnabled,this._zoomControl.zoomOutEnabled=this._map.zoomLevel!==this._map.minZoomLevel,this._zoomControl.zoomInEnabled=this._map.zoomLevel!==this._map.maxZoomLevel,this._zoomControl.updateTintColor(this._map.tintColorForControls)):this._removeZoomControl()},updateMapTypeControl:function(){this._map.showsMapTypeControl&&!this._shouldHideControls()?(this._addMapTypeControl(),this._mapTypeControl.mapType=this._map.mapType,this._mapTypeControl.enabled=!0,this._mapTypeControl.updateTintColor(this._map.tintColorForControls)):this._removeMapTypeControl()},updateUserLocationControl:function(){if(this._map.showsUserLocationControl&&!this._shouldHideControls()){switch(this._addUserLocationControl(),this._userLocationControl.enabled=!0,this._userLocationControl.state){case u.States.Default:f.isAvailable?this._map.tracksUserLocation&&f&&f.location?this._userLocationControl.toTrackingState():(this._map.tracksUserLocation||this._map.showsUserLocation&&!this._map.userLocationAnnotation)&&this._userLocationControl.toWaitingState():this._userLocationControl.toDisabledState();break;case u.States.Waiting:f&&f.location&&this.userLocationDidChange(f),this._map.showsUserLocation||this._userLocationControl.toDefaultState();break;case u.States.Tracking:this._map.tracksUserLocation||this._userLocationControl.toDefaultState()}this._userLocationControl.updateTintColor(this._map.tintColorForControls)}else this._removeUserLocationControl()},updateRotationControl:function(){this._shouldHideControls()||this._map.isCompassHidden?this._removeRotationControl():(this._addRotationControl(),this._rotationControl.rotation=this._map.rotation,this._rotationControl.updateImage(C(),o.darkColorScheme(this._map.mapNodeTint)),this._rotationControl.updateTintColor(this._map.tintColorForControls))},updateLegalControl:function(){this._addAndUpdateLegalControl()},updateLogo:function(){var t=s.showMapsLogo||s.isAutoNavi;!this._shouldHideLogo()&&t?this._addAndUpdateLogo():this._logo.remove(),this._legalControl.updateWithMapTypeAndTint(this._map.mapType,this._map.mapNodeTint)},devicePixelRatioDidChange:function(t){this._userLocationControl&&this._userLocationControl.updateIcons(t.value),this._rotationControl&&this._rotationControl.updateImage(t.value,o.darkColorScheme(this._map.mapNodeTint)),this._scale&&this._scale.update(),this._logo.updateWithMapNodeTint(this._map.mapNodeTint)},handleEvent:function(t){if(this._map)switch(t.type){case h.EVENTS.MAPTYPE_CHANGE:this._mapTypeControl&&(this._map.mapType=this._mapTypeControl.mapType);break;case u.EVENTS.PRESSED:this._userLocationControl.state===u.States.Waiting?this._map.tracksUserLocation=!0:this._userLocationControl.state!==u.States.Tracking&&(this._map.tracksUserLocation=!1);break;case y.Events.LocaleChanged:this._handleLocaleChanged(t);break;case"update":this._unsetPendingControls(),this._map.addWaitingAnnotations();break;case s.Events.Changed:this.updateLogo(),this.updateLegalControl()}},mapWasDestroyed:function(){this._unsetPendingControls(),y.removeEventListener(y.Events.LocaleChanged,this),s.removeEventListener(s.Events.Changed,this),this._destroyZoomControl(),this._destroyMapTypeControl(),this._destroyUserLocationControl(),this._destroyRotationControl(!0),this._legalControl.remove(),delete this._legalControl,this._logo.mapWasDestroyed(),this._logo.remove(),delete this._logo,this._removeScale(),this.remove(),delete this._map},userLocationDidChange:function(t){this._userLocationControl&&(this._map.tracksUserLocation?this._userLocationControl.toTrackingState():this._userLocationControl.toDefaultState())},userLocationDidError:function(t){this._userLocationControl&&this._userLocationControl.toDisabledState(),this._map.userLocationAnnotation||3===t.errorCode||(this._map.showsUserLocation=!1)},mapTypeControlWasOpened:function(){},mapTypeControlWasClosed:function(){},_handleLocaleChanged:function(t){this._rtl!==t.locale.rtl?(this._rtl=t.locale.rtl,this._rtlChanged=!0,this.update(),this._rtlChanged=!1):this.updateLogo()},_addScale:function(){this._scale||(this._setPendingControls(),this._scale=new c(this._map),this._shadowRootNode.addChild(this._scale,0))},_positionScale:function(){var t=this._map.ensureVisibleFrame().size,e=!this._rtl;this._scale.node.leftAligned=e,this._scale.position=e?new m(M.x,M.y):new m(t.width-this._scale.size.width-M.x,M.y),this._scale.shouldDisplayScale||this._scale.node.setOpacityAnimated(0,!1)},_removeScale:function(){this._scale&&(this._setPendingControls(),this._scale.node.l10n=null,this._scale.node.remove(),this._scale.scene.destroy(),this._scale.remove(),delete this._scale)},_addZoomControl:function(){!this._map.showsZoomControl||this._zoomControl||this._shouldHideControls()||(this._setPendingControls(),this._zoomControl=new d,this._zoomControl.enabled=this._map.isZoomEnabled,this._zoomControl.addEventListener(d.EVENTS.ZOOM_START,this._map),this._zoomControl.addEventListener(d.EVENTS.ZOOM_END,this._map),this._bottomRightControlsNode.insertBefore(this._zoomControl,this._userLocationControl||this._legalControl),this._rotationControl&&this._rotationControl.classList.add("mk-with-zoom-control"))},_removeZoomControl:function(){!this._shouldHideControls()&&this._map.showsZoomControl||!this._zoomControl||(this._setPendingControls(),this._zoomControl.enabled=!1,this._destroyZoomControl())},_destroyZoomControl:function(){this._zoomControl&&(this._zoomControl.removeEventListener(d.EVENTS.ZOOM_START,this._map),this._zoomControl.removeEventListener(d.EVENTS.ZOOM_END,this._map),this._zoomControl.remove(),this._rotationControl&&this._rotationControl.classList.remove("mk-with-zoom-control"),delete this._zoomControl)},_addMapTypeControl:function(){!this._map.showsMapTypeControl||this._mapTypeControl||this._shouldHideControls()||(this._setPendingControls(),this._mapTypeControl=new h(t("../map").MapTypes,this._map.mapType,this),this._mapTypeControl.addEventListener(h.EVENTS.MAPTYPE_CHANGE,this),this._topRightControlsNode.addChild(this._mapTypeControl))},_removeMapTypeControl:function(){this._mapTypeControl&&(this._setPendingControls(),this._mapTypeControl.enabled=!1,this._destroyMapTypeControl())},_destroyMapTypeControl:function(){this._mapTypeControl&&(this._mapTypeControl.removeEventListener(h.EVENTS.MAPTYPE_CHANGE,this),this._mapTypeControl.remove(),delete this._mapTypeControl)},_toggleControl:function(t,e,i){(e&&!t||!e&&t)&&i.call(this)},_shouldHideControls:function(){if(!s.ready)return!0;var t=this._map.ensureVisibleFrame().size;return t.width<w.MapSizes.minimumSizeToShowControls.width||t.height<w.MapSizes.minimumSizeToShowControls.height},_shouldHideLogo:function(){if(!s.ready)return!0;var t=-1===S.indexOf(y.localeId)?w.MapSizes.minimumSizeToShowLogo:w.MapSizes.minimumSizeToShowLogoWithReducedMargin,e=this._map.ensureVisibleFrame().size;return e.width<t.width||e.height<t.height},_addRotationControl:function(){this._shouldHideControls()||this._rotationControl||(this._setPendingControls(),this._rotationControl=new p(this._map),this._rotationControl.enabled=!0,this._bottomRightControlsNode.insertBefore(this._rotationControl,this._zoomControl||this._userLocationControl||this._legalControl),this._zoomControl&&this._rotationControl.classList.add("mk-with-zoom-control"))},_removeRotationControl:function(){this._rotationControl&&(this._setPendingControls(),this._destroyRotationControl())},_destroyRotationControl:function(t){function e(){clearTimeout(n),i.element.removeEventListener(o.transitionend,e),i.mapWasDestroyed(),i.remove()}if(this._rotationControl){if(t)this._rotationControl.mapWasDestroyed(),this._rotationControl.remove();else{var i=this._rotationControl;i.opacity=0;var n=setTimeout(e,300);i.element.addEventListener(o.transitionend,e)}delete this._rotationControl}},_addUserLocationControl:function(){!this._map.showsUserLocationControl||this._userLocationControl||this._shouldHideControls()||(this._setPendingControls(),this._userLocationControl=new u(this._map,this._rtl),this._userLocationControl.addEventListener(u.EVENTS.PRESSED,this),this._bottomRightControlsNode.insertBefore(this._userLocationControl,this._legalControl))},_removeUserLocationControl:function(){!this._shouldHideControls()&&this._map.showsUserLocationControl||!this._userLocationControl||(this._setPendingControls(),this._destroyUserLocationControl())},_destroyUserLocationControl:function(){this._userLocationControl&&(this._userLocationControl.removeEventListener(u.EVENTS.STATE_CHANGE,this._map),this._userLocationControl.mapWasDestroyed(),this._userLocationControl.remove(),delete this._userLocationControl)},_addAndUpdateLegalControl:function(){s.showMapsLogo&&this._legalControl.parent!==this._bottomRightControlsNode?this._bottomRightControlsNode.addChild(this._legalControl):s.showMapsLogo||this._legalControl.parent===this._bottomLeftControlsNode||this._bottomLeftControlsNode.addChild(this._legalControl),this._legalControl.updateWithMapTypeAndTint(this._map.mapType,this._map.mapNodeTint)},_addAndUpdateLogo:function(){this._logo.parent||this._bottomLeftControlsNode.insertBefore(this._logo,this._legalControl),this._logo.updateWithMapNodeTint(this._map.mapNodeTint)},_setPendingControls:function(){this._controlsPending=!0,g.addEventListener("update",this)},_unsetPendingControls:function(){this._controlsPending=!1,g.removeEventListener("update",this)},_setReduceMargin:function(){var t=this._map.ensureVisibleFrame().size.width<w.MapSizes.minimumSizeToShowLogo.width&&s.showMapsLogo;this.classList.toggle("mk-reduce-margin",t)},controlBounds:function(){var t=[];return[this._topRightControlsNode,this._bottomLeftControlsNode,this._bottomRightControlsNode].forEach(function(e){0!==e.children.length&&(e===this._bottomRightControlsNode?Array.prototype.push.apply(t,e.children):t.push(e))},this),t.map(function(t){try{var e=t.element.getBoundingClientRect(),i=window.getComputedStyle(this._map.element);if("none"===(i.transform||i.msTransform||i.webkitTransform)){var n=this._map.element.getBoundingClientRect();return new v(e.left-n.left,e.top-n.top,e.width,e.height)}return v.rectFromClientRect(e)}catch(t){return new v}},this)}}),e.exports=n},{"../configuration":165,"../constants":166,"../controls-css":167,"../localizer":187,"../map":190,"../user-location/user-location":236,"../utils":237,"./legal-control":170,"./logo":171,"./map-type-control":172,"./rotation-control":173,"./scale":174,"./user-location-control":175,"./zoom-control":176,"@maps/device-pixel-ratio":63,"@maps/geometry/point":71,"@maps/geometry/rect":72,"@maps/js-utils":82,"@maps/render-tree":98}],170:[function(t,e,i){function n(){var t=o.htmlElement("div");r.call(this,t),this.classList.add(c.CONTROL),this._elLegal=o.htmlElement("div",{role:"button",tabindex:0}),this._elLegal.textContent=l.get("Legal.Label"),this._elLegalNode=new h(this._elLegal),this._elLegalNode.classList.add(c.LEGAL),t.appendChild(this._elLegal),this.enabled=!0}var o=t("../utils"),s=t("@maps/js-utils"),a=t("../configuration"),r=t("./control"),l=t("../localizer").l10n,h=t("@maps/render-tree").Node;e.exports=n;var c={CONTROL:"mk-legal-controls",CONTROL_AUTONAVI:"mk-legal-controls-autonavi",LEGAL:"mk-legal",LEGAL_SATELLITE:"mk-legal-satellite"};n.prototype=s.inheritPrototype(r,n,{_attributionUrl:"",updateWithMapTypeAndTint:function(t,e){if(this.mapType=t,this.tint=e,this.classList.toggle(c.CONTROL_AUTONAVI,a.isAutoNavi),this._elLegalNode.classList.toggle(c.LEGAL_SATELLITE,o.darkColorScheme(e)),this._elLegal.textContent=l.get("Legal.Label"),a.isAutoNavi)if(a.ready){var i=a.types[this.mapType].tileSources[0];i.attribution&&i.attribution.url&&(this._attributionUrl=i.attribution.url)}else this._attributionUrl="";else this._attributionUrl=l.get("Legal.Apple.URL")},localeChanged:function(t){this.mapType&&this.updateWithMapTypeAndTint(this.mapType,this.tint)},touchesEnded:function(t){this._pressed(t)},spaceBarKeyUp:function(t){this._pressed(t)},_pressed:function(t){this._attributionUrl&&window.open(this._attributionUrl)}})},{"../configuration":165,"../localizer":187,"../utils":237,"./control":168,"@maps/js-utils":82,"@maps/render-tree":98}],171:[function(t,e,i){function n(){this._logoElement=a.htmlElement("img"),this._logoElementNode=new c(this._logoElement),this._logoElementNode.classList.add(g.LOGO),c.call(this,a.htmlElement("div",{class:g.CONTROL},this._logoElement)),d.addEventListener(d.Events.LocaleChanged,this),l.addEventListener(l.Events.Changed,this),this.rtl=d.activeLocale.rtl}function o(t,e,i){t.classList.toggle(g.LOGO_AUTONAVI,l.isAutoNavi),t.classList.toggle(g.LOGO_SPECIAL,l.specialLogoSize),t.setAttribute("src",s(e,i))}function s(t,e){var i=[h.createImageUrl("logos/logo-wordmark")],n=".png",o=[1,2,3];return l.isAutoNavi&&(i=[h.createImageUrl("logos/logo"),p]),t&&i.push(u),l.isAutoNavi&&e&&i.push(m),l.isAutoNavi||i.push(d.localeId),l.specialLogoSize&&!l.isAutoNavi&&(n=".svg",o=[1]),a.imagePathForDevice(o,i.join("-"),n)}var a=t("../utils"),r=t("@maps/js-utils"),l=t("../configuration"),h=t("../urls"),c=t("@maps/render-tree").Node,d=t("../localizer").l10n;t("../../../lib/map-node/src/constants").Tints;e.exports=n;var u="satellite",p="autonavi",m="rtl",g={CONTROL:"mk-logo-control",LOGO:"mk-logo",LOGO_AUTONAVI:"mk-logo-autonavi",LOGO_SPECIAL:"mk-logo-special"};n.prototype=r.inheritPrototype(c,n,{tint:void 0,updateWithMapNodeTint:function(t){this.tint=t;var e=a.darkColorScheme(t),i=this._logoElementNode;l.state===l.States.UNINITIALIZED?l.addEventListener(l.Events.Initialized,function t(){l.removeEventListener(l.Events.Initialized,t),o(i,e,this.rtl)}):o(i,e,this.rtl),i.setAttribute("alt",d.get("Logo."+l.tileProvider+".Tooltip"))},handleEvent:function(t){switch(t.type){case d.Events.LocaleChanged:this.rtl=t.locale.rtl,this._handleLocaleChange(t);break;case l.Events.Changed:if(!this.tint)return;this.updateWithMapNodeTint(this.tint)}},mapWasDestroyed:function(){d.removeEventListener(d.Events.LocaleChanged,this),l.removeEventListener(l.Events.Changed,this)},_handleLocaleChange:function(t){this.tint&&this.updateWithMapNodeTint(this.tint)}})},{"../../../lib/map-node/src/constants":15,"../configuration":165,"../localizer":187,"../urls":234,"../utils":237,"@maps/js-utils":82,"@maps/render-tree":98}],172:[function(t,e,i){function n(t,e,i){d.call(this),this.classList.add(g.CONTROL),this._caretIcon=o(),this._checkmarkIcon=s(),["Standard","Hybrid","Satellite"].forEach(function(i){var n=new u.Node(l.htmlElement("div",{class:g.MAP_TYPE})),o="Mode."+i;n.element.setAttribute(m.MAP_TYPE,t[i]),n.element.setAttribute(m.L10N,o),n.element.textContent=p.get(o),n.mapType=t[i],t[i]===e&&(this._mapType=e,this._updateActiveNode(n)),this.addChild(n)},this),this._updateLabels(),this._updateAccessibilityState(),this.enabled=!0,this._delegate=i}function o(){return l.createSVGIcon(l.svgElement("path",{d:"M1,1 L4.5,4.5 L8,1"}),{viewBox:"0 0 9 6"})}function s(){return l.createSVGIcon(l.svgElement("path",{d:"M3.76776695,8.47487373 L3.41421356,8.82842712 L2.70710678,8.12132034 L0.707106781,6.12132034 L0,5.41421356 L1.41421356,4 L2.12132034,4.70710678 L3.41421356,6 L8.70710678,0.707106781 L9.41421356,0 L10.8284271,1.41421356 L10.1213203,2.12132034 L4.12132034,8.12132034 L3.76776695,8.47487373 Z"}),{viewBox:"0 0 11 9"})}function a(t){t.focus(),t.setAttribute("tabindex",0),t.setAttribute("aria-checked","true")}function r(t){t.blur(),t.setAttribute("tabindex",-1),t.setAttribute("aria-checked","false")}var l=t("../utils"),h=t("../unsafe-dom"),c=t("@maps/js-utils"),d=t("./control"),u=t("@maps/render-tree"),p=t("../localizer").l10n;e.exports=n;var m={MAP_TYPE:"data-map-type",L10N:"data-l10n-key"},g={CONTROL:"mk-map-type-control",MAP_TYPES:"mk-map-types",MAP_TYPE:"mk-map-type",ACTIVE:"mk-active",PRESSED:"mk-pressed",OPEN:"mk-open",OPENING:"mk-opening",FOCUS:"mk-focus",SHOW_FOCUS:"mk-show-focus",TINTED:"mk-tinted"};n.EVENTS={MAPTYPE_CHANGE:"map-type-change"},n.prototype=c.inheritPrototype(d,n,{constructor:n,_transitioning:!1,_shouldFocusOnClose:!0,_canShowFocusOutline:!0,_hadFocusOutline:!1,_pageLostFocus:!1,_activeMapTypeNode:null,_activeIcon:null,get mapType(){return this._mapType},set mapType(t){t!==this._mapType&&(this._mapType=t,this._updateDisplay(),this.dispatchEvent(new h.Event(n.EVENTS.MAPTYPE_CHANGE)))},handleEvent:function(t){switch(t.type){case l.startEventType:var e=l.getShadowDOMTargetFromEvent(this.element,t);this.element.contains(e)?this._shouldFocusOnClose=!0:(this._shouldFocusOnClose=!1,this._close());break;case l.transitionend:this._handleTransitionend(t)}},localeChanged:function(t){this._updateLabels(),this.children.forEach(function(t){var e=t.element.getAttribute(m.L10N);t.element.textContent=p.get(e)}),this._updateActiveIcon()},touchesBegan:function(t){if(!this._transitioning){if(this._isOpen){var e=this._findMapTypeNodeFromMapTypeDOMElement(l.parentNodeForSvgTarget(l.getShadowDOMTargetFromEvent(this.element,t)));this._updatePressedMapType(e)}else this._updatePressedMapType(this.children[0]);this._clearOutline(),this._isDown=!0,this._canShowFocusOutline=!1,this._open()}},touchesMoved:function(t){if(this._isOpen&&this._isDown){var e=this._findMapTypeNodeFromMapTypeDOMElement(l.parentNodeForSvgTarget(l.getShadowDOMTargetFromEvent(this.element,t)));this._updatePressedMapType(e)}},touchesEnded:function(t){var e=this._findMapTypeNodeFromMapTypeDOMElement(l.parentNodeForSvgTarget(l.getShadowDOMTargetFromEvent(this.element,t)));t.stopPropagation(),this._isDown=!1,this._clearPressedState(),Date.now()-this._openTime<200?this._openTime=0:this._isOpen&&!this._transitioning&&(this._shouldFocusOnClose=!0,this._canShowFocusOutline=!1,e&&e.mapType&&(this.mapType=e.mapType),this.reset())},blurred:function(t){setTimeout(function(){var t=l.containingDocumentOrShadowRoot(this.element);t.activeElement&&"body"!==t.activeElement.tagName.toLowerCase()&&!this.element.contains(t.activeElement)&&(this._clearPressedState(),this._shouldFocusOnClose=!1,this._close())}.bind(this),0)},touchesCanceled:function(t){this.reset()},spaceBarKeyDown:function(t){var e=this._findMapTypeNodeFromMapTypeDOMElement(l.parentNodeForSvgTarget(t.target));this._isOpen||(e=this._activeMapTypeNode),this._updatePressedMapType(e),this._isDown=!0},spaceBarKeyUp:function(t){var e=this._findMapTypeNodeFromMapTypeDOMElement(l.parentNodeForSvgTarget(t.target));this._isDown=!1,this._clearPressedState(),this._isOpen&&e?(this.mapType=e.mapType,this.resetWithFocusOutline()):this._isOpen||(this._canShowFocusOutline=!0,this._open())},escapeKeyDown:function(t){this._isOpen&&this.resetWithFocusOutline()},downArrowKeyUp:function(t){this._handleUpAndDownArrows("down")},upArrowKeyUp:function(t){this._handleUpAndDownArrows("up")},focused:function(t){var e=this._findMapTypeNodeFromMapTypeDOMElement(l.parentNodeForSvgTarget(t.target)),i=this._canShowFocusOutline&&!this._pageLostFocus||this._canShowFocusOutline&&this._pageLostFocus&&this._hadFocusOutline;this._hadFocusOutline=i,this.classList.toggle(g.SHOW_FOCUS,i),this._outlinedMapTypeNode||(this._outlinedMapTypeNode=this._activeMapTypeNode),this._isDown&&i&&this._updatePressedMapType(e)},pageDidFocus:function(t){setTimeout(function(){this._pageLostFocus=!1}.bind(this),0)},pageDidBlur:function(t){this._pageLostFocus=!0,this._clearPressedState(),this._close()},updateTintColor:function(t){this.tintColor=t,this._activeMapTypeNode.element.style.color=this.tintColor,this._checkmarkIcon.style.fill=this.tintColor,this._caretIcon.style.stroke=this.tintColor,this._activeIcon.style[this._isOpen?"fill":"stroke"]=this.tintColor,this.classList.toggle(g.TINTED,t),this._activeMapTypeNode.classList.toggle(g.TINTED,t)},reset:function(){this._close()},resetWithFocusOutline:function(){this._shouldFocusOnClose=!0,this._canShowFocusOutline=!0,this.reset()},removeEventListeners:function(){this.element.removeEventListener(l.transitionend,this)},addEventListeners:function(){this.element.addEventListener(l.transitionend,this)},_updateLabels:function(){l.updateLabel(this,p.get("MapType.Tooltip"))},_open:function(){this._isOpen||(window.addEventListener(l.startEventType,this,!0),this._isOpen=!0,this._openTime=Date.now(),this._transitioning=!0,this.classList.add(g.OPEN),this._updateActiveIcon(),this.classList.add(g.OPENING),this._delegate.mapTypeControlWasOpened())},_close:function(){this._isOpen&&(window.removeEventListener(l.startEventType,this,!0),delete this._isOpen,delete this._isDown,delete this._openTime,this._transitioning=!0,this.classList.remove(g.OPEN),this._updateActiveIcon(),this._clearOutline(),this._delegate.mapTypeControlWasClosed())},_updateDisplay:function(){this.localeChanged();var t=this.findNode(function(t){return t.mapType===this._mapType},this);t&&(this._updateActiveNode(t),this._updateAccessibilityState())},_updateActiveNode:function(t){t!==this._activeMapTypeNode&&(this._activeMapTypeNode&&(this._activeMapTypeNode.element.style.removeProperty("color"),this._activeMapTypeNode.classList.remove(g.ACTIVE)),this._activeMapTypeNode=t,this._activeMapTypeNode.classList.add(g.ACTIVE),this._updateActiveIcon())},_updateActiveIcon:function(){this._activeIcon&&this._activeIcon.parentNode&&this._activeIcon.parentNode.removeChild(this._activeIcon),this._activeMapTypeNode?(this._activeIcon=this._isOpen?this._checkmarkIcon:this._caretIcon,this._activeMapTypeNode.element.appendChild(this._activeIcon)):this._activeIcon=null},_updatePressedMapType:function(t){this._clearPressedState(),t&&t.classList.add(g.PRESSED)},_handleLocaleChange:function(){this.children.forEach(function(t){var e=t.element.getAttribute(m.L10N);t.element.textContent=p.get(e)}),this._updateActiveIcon()},_handleTransitionend:function(){this._updateAccessibilityState(),this._focusWhenClosed(),this.updateTintColor(this.tintColor),this._isOpen&&this._activeMapTypeNode&&a(this._activeMapTypeNode.element),delete this._transitioning,c.isIEAndNotEdge()?setTimeout(function(){this._canShowFocusOutline=!0}.bind(this),0):this._canShowFocusOutline=!0},_handleUpAndDownArrows:function(t){if(this._isOpen){var e,i=this.children.indexOf(this._outlinedMapTypeNode||this._activeMapTypeNode);this.classList.contains(g.SHOW_FOCUS)?e="up"===t?Math.max(0,i-1):Math.min(i+1,this.children.length-1):(e=i,this._canShowFocusOutline=!0),this._clearOutline(),this._outlinedMapTypeNode=this.children[e],a(this._outlinedMapTypeNode.element)}},_clearOutline:function(){this._outlinedMapTypeNode&&(r(this._outlinedMapTypeNode.element),this._outlinedMapTypeNode=null)},_clearPressedState:function(){this._clearState(g.PRESSED)},_clearState:function(t){this.children.forEach(function(e){e.classList.remove(t)})},_focusWhenClosed:function(){this._isOpen?this.classList.add(g.OPENING):(this._shouldFocusOnClose&&this.element.focus(),this._shouldFocusOnClose=!1)},_updateAccessibilityState:function(){this._isOpen?(this.element.setAttribute("role","menu"),this.element.setAttribute("aria-expanded",!0),this.element.setAttribute("tabindex",-1)):(this.element.setAttribute("role","button"),this.element.setAttribute("aria-expanded",!1),this.element.setAttribute("tabindex",0)),this.children.forEach(function(t){var e=t.classList.contains(g.ACTIVE);t.element.setAttribute("tabindex",e&&this._isOpen?0:-1),t.element.setAttribute("aria-checked",e&&this._isOpen?"true":"false"),this._isOpen?(t.element.setAttribute("role","menuitem"),t.element.removeAttribute("aria-hidden")):(t.element.removeAttribute("role"),e||t.element.setAttribute("aria-hidden",!0))},this)},_findMapTypeNodeFromMapTypeDOMElement:function(t){return this.findNode(function(e){return e.element===t},this)}})},{"../localizer":187,"../unsafe-dom":233,"../utils":237,"./control":168,"@maps/js-utils":82,"@maps/render-tree":98}],173:[function(t,e,i){function n(t){this.element=l.htmlElement("div",{tabindex:0}),c.call(this,this.element),this.classList.add(f.CONTROL);var e=l.htmlElement("input",{class:f.SLIDER,type:"range",min:0,max:360,value:0,"aria-label":d.get("Compass.Degrees.Plural",{n:0})});e.addEventListener("change",this),this._slider=e,this.element.appendChild(e);var i=l.htmlElement("img",{class:f.BORDER,role:"presentation"});this._border=i,this.element.appendChild(i),this._compassNode=new m.Node(r()),this.element.appendChild(this._compassNode.element);var n=l.htmlElement("img",{class:f.COMPASS,role:"presentation"});this._compass=n,this._compassNode.element.appendChild(n);var o=l.htmlElement("div");if(this._northIndicator=o,this._northIndicatorNode=new m.Node(o),this._northIndicatorNode.classList.add(f.NORTH_INDICATOR),this._compassNode.element.appendChild(o),_.state===_.States.UNINITIALIZED)_.addEventListener(_.Events.Initialized,function e(){_.removeEventListener(_.Events.Initialized,e);var o=a(l.devicePixelRatio,l.darkColorScheme(t._mapNode.tint));n.src=o.content,i.src=o.border});else{var s=a(l.devicePixelRatio,l.darkColorScheme(t._mapNode.tint));n.src=s.content,i.src=s.border}this._map=t,this._rotation=0,this._activeKeyRightAt=null,this._activeKeyLeftAt=null,this._updateLabels(),this._setupGestureRecognizers()}function o(t,e,i,n){var o=e-n,a=t-i;return t>i?e<n?90+s(Math.atan(o/a)):180-s(Math.atan(a/o)):e<n?360-s(Math.atan(a/o)):270+s(Math.atan(o/a))}function s(t){return 180*t/Math.PI}function a(t,e){var i=e?"dark_":"",n=[1,2,3];return{content:l.imagePathForDevice(n,u.createImageUrl("icons/"+i+"compass"),".png"),border:l.imagePathForDevice(n,u.createImageUrl("icons/"+i+"compass_border"),".png")}}function r(){return l.htmlElement("div",{class:f.WRAPPER})}var l=t("../utils"),h=t("@maps/js-utils"),c=t("./control"),d=t("../localizer").l10n,u=t("../urls"),p=t("@maps/gesture-recognizers"),m=t("@maps/render-tree"),g=t("@maps/scheduler"),_=t("../configuration"),f={CONTROL:"mk-rotation-control",ROTATION:"mk-rotation",BORDER:"mk-compass-border",COMPASS:"mk-compass",PRESSED:"mk-pressed",NORTH_INDICATOR:"mk-north-indicator",LONG_NORTH_INDICATOR:"mk-north-indicator-long",WRAPPER:"mk-rotation-wrapper",SLIDER:"mk-rotation-slider"};n.prototype=h.inheritPrototype(c,n,{set rotation(t){t===this._rotation||360===this._rotation&&0===t||(this._rotation=t,this._updateSlider(t),this._rotateTo(t))},localeChanged:function(t){this._updateLabels()},mapWasDestroyed:function(){delete this._map},updateTintColor:function(t){this.tintColor!==t&&(this.tintColor=t,this._northIndicator.style.color=t)},updateImage:function(t,e){if((this._dprValue!==t||this._darkColorScheme!==e)&&(this._dprValue=t,this._darkColorScheme=e,_.state!==_.States.UNINITIALIZED)){var i=a(0,e);this._compass.src=i.content,this._border.src=i.border}},reset:function(t){this._map&&this._center&&this._map.compassDraggingDidEnd(),this.classList.remove(f.PRESSED),!t||t.target!==this._tapRecognizer&&t.keyCode!==h.KeyCodes.UpArrow&&t.keyCode!==h.KeyCodes.SpaceBar||this._map.setRotationAnimated(0,!0),delete this._angleOffset},spaceBarKeyDown:function(t){this.reset(t)},upArrowKeyUp:function(t){this.reset(t)},rightArrowKeyDown:function(t){this._beginKeyboardRotate(t)},rightArrowKeyUp:function(t){this._endKeyboardRotate(t)},leftArrowKeyDown:function(t){this._beginKeyboardRotate(t)},leftArrowKeyUp:function(t){this._endKeyboardRotate(t)},performScheduledUpdate:function(){if(!this._activeKeyRightAt&&!this._activeKeyLeftAt)return!1;this._keyboardRotate(),g.scheduleOnNextFrame(this)},handleEvent:function(t){switch(t.target){case this._tapRecognizer:t.target.state===p.States.Recognized&&this.reset(t);break;case this._panRecognizer:t.target.state===p.States.Possible?this._beginDrag(t):t.target.state===p.States.Changed?this._drag(t):t.target.state!==p.States.Recognized&&t.target.state!==p.States.Failed||this.reset(t);break;case this._slider:this._handleSliderChange(t)}},fadeIn:function(){this.element.style.opacity=1},fadeOut:function(){this.element.style.opacity=0},_updateLabels:function(t){this._northIndicator.textContent=d.get("Compass.NorthIndicator"),l.updateLabel(this.element,d.get("Compass.Tooltip")),"ar"===_.language||"th"===_.language?this._northIndicatorNode.classList.add(f.LONG_NORTH_INDICATOR):this._northIndicatorNode.classList.remove(f.LONG_NORTH_INDICATOR)},_rotateTo:function(t){return Math.abs(t)<5&&(t=0),this._compassNode.transform="rotate("+t+"deg)",t},_setupGestureRecognizers:function(){var t=new p.Tap;t.numberOfTapsRequired=1,t.addEventListener("statechange",this),t.target=this.element,this._tapRecognizer=t;var e=new p.Pan;e.addEventListener("statechange",this),e.target=this.element,this._panRecognizer=e},removeEventListeners:function(){this._tapRecognizer.removeEventListener("statechange",this),this._tapRecognizer.enabled=!1,this._tapRecognizer.target=null,this._panRecognizer.removeEventListener("statechange",this),this._panRecognizer.enabled=!1,this._panRecognizer.target=null,this._slider.removeEventListener("change",this)},_beginDrag:function(t){if(this._map.compassDraggingWillStart()){this.classList.add(f.PRESSED);var e=this.element.getBoundingClientRect();this._center={x:e.right-e.width/2,y:e.bottom-e.height/2};var i=o(t.target.locationInClient().x,t.target.locationInClient().y,this._center.x,this._center.y);this._angleOffset=i-this._map.rotation}},_drag:function(t){if(this._center&&!isNaN(this._angleOffset)){var e=o(t.target.locationInClient().x,t.target.locationInClient().y,this._center.x,this._center.y)-this._angleOffset;e=this._rotateTo(e),this._map.setRotationAnimated(e,!1,!0)}},_beginKeyboardRotate:function(t){var e=this._activeKeyRightAt&&t.keyCode===h.KeyCodes.RightArrow,i=this._activeKeyLeftAt&&t.keyCode===h.KeyCodes.LeftArrow;if(!e&&!i){var n=Date.now();t.keyCode===h.KeyCodes.RightArrow?this._activeKeyRightAt=n:this._activeKeyLeftAt=n,this._timeAtLastFrame=n,g.scheduleASAP(this)}},_keyboardRotate:function(){var t=Math.max(this._activeKeyRightAt||0,this._activeKeyLeftAt||0);if(t&&this._timeAtLastFrame){var e=Date.now(),i=this._rotation,n=e-this._timeAtLastFrame;i+=(4*(t===this._activeKeyLeftAt)?-1:1)*(60*n)/1e3,this._map.rotation=i,this._timeAtLastFrame=Date.now()}},_endKeyboardRotate:function(t){t.keyCode===h.KeyCodes.RightArrow?this._activeKeyRightAt=null:this._activeKeyLeftAt=null,this._activeKeyRightAt||this._activeKeyLeftAt||(this._timeAtLastFrame=null)},_handleSliderChange:function(t){var e=parseInt(t.target.value);if(e!==this._rotation){var i=e;0===e?i=360:360===e&&(i=0),this.rotation=i,this._map.setRotationAnimated(i,!1,!0)}},_updateSlider:function(t){var e=Math.round(t);this._slider.value=e;var i=d.get(1===e?"Compass.Degrees.Single":"Compass.Degrees.Plural",{n:e});this._slider.setAttribute("aria-label",i)}}),e.exports=n},{"../configuration":165,"../localizer":187,"../urls":234,"../utils":237,"./control":168,"@maps/gesture-recognizers":74,"@maps/js-utils":82,"@maps/render-tree":98,"@maps/scheduler":100}],174:[function(t,e,i){function n(t){this._map=t,this.scene=new d.Scene,this.scene.size=m,this.node=this.scene.addChild(new c),this.node.size=m,this.node.position=new h(0,0),this.node.opacity=0,this.node.l10n=r,this.node.useMetric=t.useMetric,o.call(this,this.scene.element),this.classList.add(g.Control),this.size=m}var o=t("./control"),s=t("../../../lib/geo"),a=t("@maps/js-utils"),r=t("../localizer").l10n,l=t("@maps/device-pixel-ratio"),h=t("@maps/geometry/point"),c=t("../../../lib/scale-node"),d=t("../../../lib/scene-graph"),u=t("@maps/geometry/size"),p=t("../constants").FeatureVisibility,m=new u(170,20),g={Control:"mk-scale"};n.prototype=a.inheritPrototype(o,n,{get shouldDisplayScale(){return this._map._showsScale===p.Visible||this._map._showsScale===p.Adaptive&&this._map.cameraIsZooming},updateTheme:function(t){this.node.theme=c.Themes[t]},update:function(){var t=this._map;if(this.node&&this.shouldDisplayScale){var e=t.renderingMapRect.origin.toCoordinate().latitude,i=t.renderingMapRect.size.width/s.mapUnitsPerMeterAtLatitude(e);i/t._visibleFrame.size.width*l()>=7500?this.hideIfNeeded(!0):(this.node.distance=i,this.node.useMetric=this._map.useMetric,this.node.setOpacityAnimated(1,!1))}},hideIfNeeded:function(t){!this.node||this.shouldDisplayScale&&!t||this.node.setOpacityAnimated(0,!0)},localeChanged:function(){this.node.useMetric=this._map.useMetric}}),e.exports=n},{"../../../lib/geo":4,"../../../lib/scale-node":41,"../../../lib/scene-graph":51,"../constants":166,"../localizer":187,"./control":168,"@maps/device-pixel-ratio":63,"@maps/geometry/point":71,"@maps/geometry/size":73,"@maps/js-utils":82}],175:[function(t,e,i){function n(t,e){c.call(this,a.htmlElement("div",{class:_.CONTROL,role:"button",tabindex:"0"})),this._wrapper=a.htmlElement("div",{class:_.WRAPPER}),this.element.appendChild(this._wrapper),this._arrowIconNode=new u.Node(o()),this._waitingIconNode=new u.Node(s()),this._wrapper.appendChild(this._arrowIconNode.element),this._wrapper.appendChild(this._waitingIconNode.element),this._updateLabels(),this.updateIcons(a.devicePixelRatio),this._map=t,this._showsErrorMessage=!1,this._rtl=e}function o(){var t=a.svgElement("path"),e=a.createSVGIcon(t);return e.setAttribute("class",e.getAttribute("class")+" "+_.ARROW_ICON),e}function s(){var t=a.svgElement("path");t.setAttribute("d","M14.5732357,10 C13.5436447,12.9129809 10.7655471,15 7.5,15 C3.35786438,15 0,11.6421356 0,7.5 C0,3.35786438 3.35786438,0 7.5,0 C10.7655471,0 13.5436447,2.08701907 14.5732357,5 L13.5018367,5 C12.522277,2.65104815 10.20395,1 7.5,1 C3.91014913,1 1,3.91014913 1,7.5 C1,11.0898509 3.91014913,14 7.5,14 C10.20395,14 12.522277,12.3489518 13.5018367,10 L14.5732357,10 L14.5732357,10 Z");var e=a.createSVGIcon(t,{viewBox:"0 0 15 15"});return e.setAttribute("class",e.getAttribute("class")+" "+_.WAITING_ICON),e}var a=t("../utils"),r=t("@maps/scheduler"),l=t("../unsafe-dom"),h=t("@maps/js-utils"),c=t("./control"),d=t("../localizer").l10n,u=t("@maps/render-tree");e.exports=n;var p=.25,m={"1x":"M0,6 L8,6 L8,14 L14,0 Z M3.65,5.25 L12.6,1.4 L8.75,10.35 L8.75,5.25 Z","2x":"M0,12 L16,12 L16,28 L28,0 Z M7.3,10.5 L25.2,2.8 L17.5,20.7 L17.5,10.5 Z","3x":"M0,18 L24,18 L24,42 L42,0 Z M10.95,15.75 L37.8,4.2 L26.25,31.05 L26.25,15.75 Z"},g={"1x":"M0,6 L8,6 L8,14 L14,0 Z","2x":"M0,12 L16,12 L16,28 L28,0 Z","3x":"M0,18 L24,18 L24,42 L42,0 Z"},_={CONTROL:"mk-user-location-control",WRAPPER:"mk-user-location-control-wrapper",BUTTON_USER_LOCATION:"mk-user-location-button",PRESSED:"mk-pressed",TRACKING:"mk-tracking",WAITING:"mk-waiting",DISABLED:"mk-disabled",WAITING_ICON:"mk-icon-waiting",ARROW_ICON:"mk-icon-arrow",ERROR:"mk-error-message",ERROR_TEXT:"mk-error-text",ERROR_SUPPORT:"mk-error-support",ERROR_ANIMATE_IN:"mk-error-message-pop"};n.States={Default:"default",Waiting:"waiting",Tracking:"tracking",Disabled:"disabled"},n.EVENTS={PRESSED:"pressed"},n.prototype=h.inheritPrototype(c,n,{_state:n.States.Default,_tintColor:"",_arrowIconDurationMs:200,_waitingIconDurationMs:200,_waitingIconCycleTimeMs:1500,get state(){return this._state},set state(t){this._state!==t&&(this._state=t,this.classList.toggle(_.TRACKING,this.isTrackingState()),this.classList.toggle(_.WAITING,this.isWaitingState()),this.classList.toggle(_.DISABLED,this.isDisabledState()),this.updateTintColor(this._tintColor),!this.isWaitingState()&&this._waitingIconInStart&&(this._waitingIconOutStart=Date.now(),r.scheduleOnNextFrame(this)),this.isWaitingState()&&(this._arrowIconOutStart=Date.now(),r.scheduleOnNextFrame(this)),this.isDisabledState()?this._arrowIconNode.opacity=p:this._arrowIconNode.opacity=1)},isDefaultState:function(){return this.state===n.States.Default},toDefaultState:function(){this.state=n.States.Default,this.updateIcons(a.devicePixelRatio),this._removeErrorMessage()},isTrackingState:function(){return this.state===n.States.Tracking},toTrackingState:function(){this.state=n.States.Tracking,this.updateIcons(a.devicePixelRatio),this._removeErrorMessage()},isWaitingState:function(){return this.state===n.States.Waiting},toWaitingState:function(){this.state=n.States.Waiting},isDisabledState:function(){return this.state===n.States.Disabled},toDisabledState:function(){if(!this._map.tracksUserLocation||!this._map.userLocationAnnotation)if(this.state=n.States.Disabled,this._showsErrorMessage)this._removeErrorMessage();else{if(0===this.element.getBoundingClientRect().width)return;this._errorMessageNode||(this._errorMessageElement=this._createErrorMessageElement(),this._errorMessageNode=new u.Node(this._errorMessageElement)),this._addUpdatedErrorMessage()}},handleEvent:function(t){switch(t.type){case a.startEventType:var e=a.getShadowDOMTargetFromEvent(this.element,t);this._errorMessageElement.contains(e)||(this._removeErrorMessage(),window.removeEventListener(a.startEventType,this,!0));break;case"animationend":case"webkitAnimationEnd":"mk-fadeout"===t.animationName&&this._errorMessageNode.remove(),this._errorMessageElement.removeEventListener("animationend",this),this._errorMessageElement.removeEventListener("webkitAnimationEnd",this);break;case"keydown":27===t.keyCode&&this._removeErrorMessage()}},touchesBegan:function(t){this._pressed(t)},touchesEnded:function(t){this.reset(),this.dispatchEvent(new l.Event(n.EVENTS.PRESSED))},touchesCanceled:function(t){this.reset()},spaceBarKeyDown:function(t){this._pressed(t)},spaceBarKeyUp:function(t){this.reset(t),this.dispatchEvent(new l.Event(n.EVENTS.PRESSED))},updateTintColor:function(t){this._tintColor=t,this._arrowIconNode.element.querySelector("g").style.fill=this.isTrackingState()?"":t,this._waitingIconNode.element.querySelector("g").style.fill=t,this.element.style.backgroundColor=this.isTrackingState()?t:""},updateIcons:function(t){var e=14*(t=h.clamp(Math.floor(t),1,3)),i=this.isDefaultState()?m[t+"x"]:g[t+"x"];this._arrowIconNode.element.setAttribute("viewBox",[0,0,e,e].join(" ")),this._arrowIconNode.element.querySelector("path").setAttribute("d",i)},reset:function(){this.classList.contains(_.PRESSED)&&(this.classList.remove(_.PRESSED),this.isDefaultState()?this.toWaitingState():this.isDisabledState()?this.toWaitingState():this.toDefaultState()),delete this._mousedown,window.removeEventListener(a.endEventType,this),a.supportsPointerEvents?window.removeEventListener("pointercancel",this):a.supportsTouches&&window.removeEventListener("touchcancel",this)},localeChanged:function(t){this._updateLabels(),this._rtl=t.locale.rtl,this._showsErrorMessage&&(this._removeErrorMessage(),this._addUpdatedErrorMessage())},remove:function(){this._removeErrorMessage(),c.prototype.remove.call(this)},performScheduledUpdate:function(){this._arrowIconOutStart&&this._animateArrowIconOut(),this._waitingIconInStart&&this._animateWaitingIconIn(),this._waitingIconOutStart&&this._animateWaitingIconOut(),this._waitingIconSpinStart&&this._animateWaitingIconSpin()},mapWasDestroyed:function(){delete this._map},blurred:function(t){this._removeErrorMessage()},_updateLabels:function(){a.updateLabel(this.element,d.get("Track.User.Location.Tooltip"))},_pressed:function(t){this.classList.add(_.PRESSED)},_animateArrowIconOut:function(){var t=Math.min((Date.now()-this._arrowIconOutStart)/this._arrowIconDurationMs,1),e=Math.max(0,1-t);this._arrowIconNode.opacity=e,this._arrowIconNode.transform="scale("+e+")",this.isWaitingState()&&!this._waitingIconInStart&&t>.15&&(this._waitingIconInStart=Date.now(),r.scheduleOnNextFrame(this)),this.isWaitingState()||(delete this._arrowIconOutStart,this._arrowIconNode.opacity=this.isDisabledState()?p:1,this._arrowIconNode.transform="scale(1)"),t<1?r.scheduleOnNextFrame(this):delete this._arrowIconOutStart},_animateWaitingIconIn:function(){var t=Math.min((Date.now()-this._waitingIconInStart)/this._waitingIconDurationMs,1),e=Math.min(1,t);this._waitingIconNode.opacity=e,this._waitingIconNode.transform="scale("+e+")",t<1?r.scheduleOnNextFrame(this):(delete this._waitingIconInStart,this.isWaitingState()&&(this._waitingIconSpinStart=Date.now(),r.scheduleOnNextFrame(this)))},_animateWaitingIconOut:function(){var t=Math.min((Date.now()-this._waitingIconOutStart)/this._waitingIconDurationMs,1),e=Math.max(0,1-t);this._waitingIconNode.opacity=e,this._waitingIconNode.transform="scale("+e+")",t<1?r.scheduleOnNextFrame(this):(delete this._waitingIconOutStart,this._arrowIconNode.opacity=this.isDisabledState()?p:1,this._arrowIconNode.transform="scale(1)")},_animateWaitingIconSpin:function(){var t=(Date.now()-this._waitingIconSpinStart)%this._waitingIconCycleTimeMs/this._waitingIconCycleTimeMs,e=2*Math.PI*t;this._waitingIconNode.transform="rotate("+e+"rad)",this.isWaitingState()?r.scheduleOnNextFrame(this):(delete this._waitingIconSpinStart,this._waitingIconOutStart=Date.now(),r.scheduleOnNextFrame(this))},_createErrorMessageElement:function(){var t=a.htmlElement("div",{class:_.ERROR});return this._supportLink=a.htmlElement("a",{class:_.ERROR_SUPPORT,target:"__blank"}),t.appendChild(a.htmlElement("span",{class:_.ERROR_TEXT})),t.appendChild(this._supportLink),t},_updateErrorMessage:function(){this._errorMessageElement.getElementsByClassName(_.ERROR_TEXT)[0].textContent=d.get("Location.Error.Message")+" ",this._supportLink.textContent=d.get("Location.Error.Support.Label"),this._supportLink.href=d.get("Location.Error.Support.URL")},_positionErrorMessage:function(){var t,e,i=this.element.getBoundingClientRect(),n=this._map.element.getBoundingClientRect();t="left"===this._messagePlacementSide()?i.left+i.width+9-n.left-this._map.padding.left:n.right-i.right+9+i.width-this._map.padding.right,e=n.bottom-i.bottom-this._map.padding.bottom,this._errorMessageElement.removeAttribute("style"),this._errorMessageElement.style[this._messagePlacementSide()]=t+"px",this._errorMessageElement.style.bottom=e+"px"},_addUpdatedErrorMessage:function(){this._showsErrorMessage=!0,this._updateErrorMessage(),this._positionErrorMessage(),this._animateErrorMessageIn(),this.parent.parent.addChild(this._errorMessageNode),window.addEventListener(a.startEventType,this,!0),window.addEventListener("keydown",this,!0)},_removeErrorMessage:function(){this._errorMessageNode&&(this._errorMessageNode.classList.remove(_.ERROR_ANIMATE_IN),this._showsErrorMessage=!1,this._errorMessageElement.style.webkitAnimation=this._errorMessageElement.style.animation="mk-fadeout 300ms ease-out",this._errorMessageElement.style.webkitAnimationName||this._errorMessageElement.style.animationName?(this._errorMessageElement.addEventListener("animationend",this),this._errorMessageElement.addEventListener("webkitAnimationEnd",this)):this._errorMessageNode.remove(),window.removeEventListener(a.startEventType,this,!0),window.removeEventListener("keydown",this,!0))},_animateErrorMessageIn:function(){this._errorMessageNode.classList.remove(_.ERROR_ANIMATE_OUT),this._errorMessageNode.classList.add(_.ERROR_ANIMATE_IN)},_messagePlacementSide:function(){return this._rtl?"left":"right"}})},{"../localizer":187,"../unsafe-dom":233,"../utils":237,"./control":168,"@maps/js-utils":82,"@maps/render-tree":98,"@maps/scheduler":100}],176:[function(t,e,i){function n(){var t=r.htmlElement("div");c.call(this,t),this.classList.add(p.CONTROL),this._zoomInButton=r.htmlElement("div",{role:"button",tabindex:"0"}),this._zoomInButtonNode=new d.Node(this._zoomInButton),this._zoomInButtonNode.classList.add(p.BUTTON_ZOOM_IN),this._zoomInButton.appendChild(s()),t.appendChild(this._zoomInButton),t.appendChild(r.htmlElement("div",{class:p.BUTTON_DIVIDER})),this._zoomOutButton=r.htmlElement("div",{role:"button",tabindex:"0"}),this._zoomOutButtonNode=new d.Node(this._zoomOutButton),this._zoomOutButtonNode.classList.add(p.BUTTON_ZOOM_OUT),this._zoomOutButton.appendChild(a()),t.appendChild(this._zoomOutButton),this._updateLabels()}function o(t,e){e?(t.classList.remove(p.DISABLED),t.element.removeAttribute("aria-disabled"),t.setAttribute("tabindex",0)):(t.classList.add(p.DISABLED),t.setAttribute("aria-disabled","true"),t.setAttribute("tabindex",-1))}function s(){var t=r.svgElement("path");return t.setAttribute("d","M7,6 L7,1 L6,1 L6,6 L1,6 L1,7 L6,7 L6,12 L7,12 L7,7 L12,7 L12,6 L7,6 Z"),r.createSVGIcon(t,{viewBox:"0 0 13 13"})}function a(){var t=r.svgElement("rect",{x:1,y:6,width:12,height:1});return r.createSVGIcon(t,{viewBox:"0 0 13 13"})}var r=t("../utils"),l=t("../unsafe-dom"),h=t("@maps/js-utils"),c=t("./control"),d=t("@maps/render-tree"),u=t("../localizer").l10n;e.exports=n;var p={CONTROL:"mk-zoom-controls",BUTTON_DIVIDER:"mk-divider",BUTTON_ZOOM_IN:"mk-zoom-in",BUTTON_ZOOM_OUT:"mk-zoom-out",PRESSED:"mk-pressed",DISABLED:"mk-disabled"};n.EVENTS={ZOOM_START:"zoom-start",ZOOM_END:"zoom-end"},n.prototype=h.inheritPrototype(c,n,{_zoomInEnabled:!0,_zoomOutEnabled:!0,get zoomInEnabled(){return this._zoomInEnabled},set zoomInEnabled(t){this._enabled&&t===this._zoomInEnabled||(this._zoomInEnabled=this._enabled&&t,o(this._zoomInButtonNode,this._zoomInEnabled))},get zoomOutEnabled(){return this._zoomOutEnabled},set zoomOutEnabled(t){this._enabled&&t===this._zoomOutEnabled||(this._zoomOutEnabled=this._enabled&&t,o(this._zoomOutButtonNode,this._zoomOutEnabled))},localeChanged:function(t){this._updateLabels()},touchesBegan:function(t){this._pressed(t)},touchesEnded:function(t){this.reset(t)},touchesCanceled:function(t){this.reset(t)},focused:function(t){this.updateTintColor(this.tintColor),t.target.style.fill=r.focusColor},blurred:function(t){this.updateTintColor(this.tintColor)},spaceBarKeyDown:function(t){this._pressed(t)},spaceBarKeyUp:function(t){this.reset(t)},updateTintColor:function(t){this.tintColor=t,this._zoomInButton.firstChild.style.fill=t,this._zoomOutButton.firstChild.style.fill=t},reset:function(t){var e;if(this._zoomInButtonNode.classList.contains(p.PRESSED)?e=this._zoomInButtonNode:this._zoomOutButtonNode.classList.contains(p.PRESSED)&&(e=this._zoomOutButtonNode),e){var i=Date.now()-this._zoomStartTimestamp;e.classList.remove(p.PRESSED);var o=new l.Event(n.EVENTS.ZOOM_END);o.dt=i,this.dispatchEvent(o)}delete this._zoomStartTimestamp,window.removeEventListener(r.endEventType,this),r.supportsPointerEvents?window.removeEventListener("pointercancel",this):r.supportsTouches&&window.removeEventListener("touchcancel",this)},_clearLabels:function(t){r.updateLabel(this._zoomInButtonNode,""),r.updateLabel(this._zoomOutButtonNode,"")},_updateLabels:function(t){r.updateLabel(this._zoomInButtonNode,u.get("Zoom.In.Tooltip")),r.updateLabel(this._zoomOutButtonNode,u.get("Zoom.Out.Tooltip"))},_pressed:function(t){var e=this._findButtonNodeFromButtonDOMElement(r.parentNodeForSvgTarget(t.target));if(e){if(this.hasFocus){var i=r.containingDocumentOrShadowRoot(this.element).activeElement;i!==e.element&&i.blur()}e.classList.add(p.PRESSED),this._zoomStartTimestamp=Date.now();var o=new l.Event(n.EVENTS.ZOOM_START);o.zoomIn=e===this._zoomInButtonNode,this.dispatchEvent(o)}},_findButtonNodeFromButtonDOMElement:function(t){return t===this._zoomOutButton?this._zoomOutButtonNode:t===this._zoomInButton?this._zoomInButtonNode:null}})},{"../localizer":187,"../unsafe-dom":233,"../utils":237,"./control":168,"@maps/js-utils":82,"@maps/render-tree":98}],177:[function(t,e,i){"use strict";function n(t,e,i){new r(e,{getDataToSend:function(){return t},loaderDidSucceed:function(t,e){if(e.status<200||e.status>=300)i(new Error("HTTP error:"+e.status));else try{i(null,JSON.parse(e.responseText))}catch(t){return void i(new Error("Failed to parse response: "+e.responseText))}},loaderDidFail:function(t,e){i(new Error("Network error"))}},{method:"POST"}).schedule()}function o(t){var e=t.toMapPoint(),i=c*a.tileSize;return{x:Math.floor(e.x*i),y:Math.floor(e.y*i),z:h}}function s(t){function e(t){return t/c/a.tileSize}return new l(e(t.x),e(t.y)).toCoordinate()}var a=t("../../lib/geo"),r=t("@maps/loaders").XHRLoader,l=a.MapPoint,h=21,c=Math.pow(2,h);i.shift=function(t,e,i){n(JSON.stringify({pixelPoint:o(t)}),e,function(t,e){t?i(new Error):e&&e.shiftedPixelPoint?i(null,s(e.shiftedPixelPoint)):i(new Error)})}},{"../../lib/geo":4,"@maps/loaders":83}],178:[function(t,e,i){e.exports=".mk-map-view{width:100%;height:100%;overflow:hidden;-webkit-tap-highlight-color:transparent}.mk-map-view.mk-dragging-annotation{cursor:none}.mk-map-view.mk-disable-all-gestures{touch-action:none}.mk-map-view.mk-disable-pinch-gestures{touch-action:pan-x pan-y}.mk-map-view.mk-disable-zoom-gestures{touch-action:manipulation}.mk-map-view.mk-disable-pan-gestures{touch-action:none;touch-action:pinch-zoom}div.mk-map-view.mk-map-view img,div.mk-map-view.mk-map-view svg{margin:0;padding:0}.mk-annotation-container,.mk-map-view{z-index:0}.mk-map-view>*{position:absolute;left:0;-webkit-user-select:none;-moz-user-select:none}.mk-map-node-element{background-color:rgba(0,0,0,0)}.mk-map-view .rt-root{letter-spacing:.3px}.mk-map-view .mk-annotation-container,.mk-map-view .mk-controls-container{-ms-user-select:text}.mk-map-view.mk-panning ::selection{background:0 0}.mk-map-view.mk-dragging-cursor{cursor:pointer;cursor:-moz-grabbing;cursor:-webkit-grabbing;cursor:grabbing}.mk-map-view>iframe{width:100%;height:100%;pointer-events:none;opacity:0;border:0}.mk-controls-container{position:absolute;overflow:hidden;top:0;bottom:0;left:0;right:0;z-index:3;pointer-events:none}"},{}],179:[function(t,e,i){"use strict";function n(t,e){var i=new o(t,{loaderDidSucceed:function(i,n){var o;try{o=JSON.parse(n.responseText)}catch(i){return void e(new Error("[MapKit] The response of "+t+" does not appear to be valid JSON:"+n.responseText))}e(null,o)},loaderDidFail:function(i,n){e(new Error("[MapKit] Failed to load "+t))}});return i.schedule(),i.id}var o=t("@maps/loaders").XHRLoader,s=t("../../lib/geojson-adapter"),a=t("../../src/js/call-function-safely");e.exports=function(t,e){var i="function"==typeof e,o="object"==typeof e,r="string"==typeof t;if(r&&!i&&!o)throw new Error("[MapKit] For GeoJSON file imports, a callback must be provided as a second argument");return r?n(t,function(t,n){if(!t)return s.importGeoJSON(n,e);o&&e.geoJSONDidError?a(e.geoJSONDidError,e,[t]):i&&a(e,null,[t])}):s.importGeoJSON(t,e)}},{"../../lib/geojson-adapter":7,"../../src/js/call-function-safely":161,"@maps/loaders":83}],180:[function(t,e,i){function n(){throw new TypeError("[MapKit] MapKit may not be constructed.")}var o=t("../../lib/geo"),s=t("../build.json"),a=t("./configuration"),r=t("./utils"),l=t("./public-dom"),h=t("@maps/js-utils"),c=t("./point-of-interest-filter");window.DOMPoint||(window.DOMPoint=t("@maps/geometry-interfaces"));var d=t("./overlays/polyline-overlay"),u=t("./services/directions-internal");Object.defineProperty(u.Route.prototype,"polyline",{enumerable:!0,get:function(){return this._polyline||(this._polyline=new d(this._path.reduce(function(t,e){return t.concat(e)},[]))),this._polyline}});var p=t("./map-internal.js");n.prototype=h.inheritPrototype(l.EventTarget,n,{init:function(t){a.init(t);var e=function(t){var e=new l.Event(t.type);e.status=t.status,this.dispatchEvent(e)}.bind(this);a.addEventListener(a.Events.Changed,e),a.addEventListener(a.Events.Error,e)},get version(){return s.version},get build(){return s.build+""},get language(){return a.language},set language(t){a.language=t},toString:function(){return["MapKit JS",this.version,"("+this.build+")"].join(" ")},importGeoJSON:t("./import-geojson-method"),get _tileProvider(){return a.tileProvider},get _countryCode(){return a.countryCode},set _countryCode(t){a.countryCode=t},_restore:function(){a._restore()},get _environment(){return a.environment},get maps(){return p.maps},FeatureVisibility:t("./constants").FeatureVisibility,CoordinateRegion:o.CoordinateRegion,CoordinateSpan:o.CoordinateSpan,Coordinate:o.Coordinate,BoundingRegion:o.BoundingRegion,MapPoint:o.MapPoint,MapRect:o.MapRect,MapSize:o.MapSize,Padding:t("./padding"),CameraZoomRange:o.CameraZoomRange,Style:t("./overlays/style"),_LineGradient:t("./overlays/line-gradient"),CircleOverlay:t("./overlays/circle-overlay"),PolylineOverlay:d,PolygonOverlay:t("./overlays/polygon-overlay"),Geocoder:t("./services/geocoder"),Search:t("./services/search"),Directions:t("./services/directions"),Map:t("./map"),Annotation:t("./annotations/annotation"),PinAnnotation:t("./annotations/pin-annotation"),ImageAnnotation:t("./annotations/image-annotation"),MarkerAnnotation:t("./annotations/marker-annotation"),TileOverlay:t("../../lib/map-node").TileOverlay,PointOfInterestCategory:t("./point-of-interest-category"),PointOfInterestFilter:c.exposedConstructor,get filterIncludingAllCategories(){return c.filterIncludingAllCategories},get filterExcludingAllCategories(){return c.filterExcludingAllCategories}});var m=Object.create(n.prototype);e.exports=m,document.head.appendChild(r.htmlElement("style",t("./css")))},{"../../lib/geo":4,"../../lib/map-node":9,"../build.json":102,"./annotations/annotation":122,"./annotations/image-annotation":133,"./annotations/marker-annotation":149,"./annotations/pin-annotation":155,"./configuration":165,"./constants":166,"./css":178,"./import-geojson-method":179,"./map":190,"./map-internal.js":188,"./overlays/circle-overlay":195,"./overlays/line-gradient":198,"./overlays/polygon-overlay":206,"./overlays/polyline-overlay":209,"./overlays/style":211,"./padding":216,"./point-of-interest-category":217,"./point-of-interest-filter":218,"./public-dom":219,"./services/directions":221,"./services/directions-internal":220,"./services/geocoder":223,"./services/search":226,"./utils":237,"@maps/geometry-interfaces":69,"@maps/js-utils":82}],181:[function(t,e,i){function n(t,e){r.call(this,t),this._map=e}function o(t){a.call(this),this._renderer=new n(this,t)}var s=t("@maps/js-utils"),a=t("../../lib/scene-graph/src/model/scene"),r=t("../../lib/scene-graph/src/render/c2d/render-scene");n.prototype=s.inheritPrototype(r,n,{update:function(){var t=performance&&performance.now()||Date.now();r.prototype.update.call(this);var e=performance&&performance.now()||Date.now();this._map._performanceLog.push({name:"render-frame",timestamp:t,duration:e-t})}}),o.prototype=s.inheritPrototype(a,o,{}),e.exports={Scene:o,now:window.performance&&window.performance.now?function(){return window.performance.now()}:Date.now}},{"../../lib/scene-graph/src/model/scene":56,"../../lib/scene-graph/src/render/c2d/render-scene":60,"@maps/js-utils":82}],182:[function(t,e,i){function n(t,e){this._delegate=e,this._snapsToIntegralZoomLevels=t}var o=t("../utils"),s=t("@maps/js-utils"),a=t("@maps/scheduler");n.prototype={constructor:n,_speed:.03,_startTime:0,_shouldStop:!1,_animating:!1,start:function(t,e){var i=Date.now();return this._gasPedalValue=0,this._startTime=i,this._shouldStop&&this._cleanUp(),this._shouldStop=!1,this.zoomsIn=!!e,o.supportsForceTouch&&window.addEventListener("webkitmouseforcechanged",this),!this._animating&&(this._animating=!0,this._zoomLevel=t,this._timeAtLastFrame=i,a.scheduleOnNextFrame(this),!0)},stop:function(){this._shouldStop=!0,o.supportsForceTouch&&(window.removeEventListener("webkitmouseforcechanged",this),delete this._speed)},set snapsToIntegralZoomLevels(t){this._snapsToIntegralZoomLevels=!!t},performScheduledUpdate:function(){var t=!0,e=Date.now(),i=e-this._timeAtLastFrame,n=this._speed*(this.zoomsIn?1:-1);this._zoomLevel+=60*i*s.log2(1+n)/1e3,this._timeAtLastFrame=e,this._shouldStop&&e-this._startTime>=250&&(this._zoomLevelAtWhichToStop?(t=this.zoomsIn&&this._zoomLevel<this._zoomLevelAtWhichToStop||!this.zoomsIn&&this._zoomLevel>this._zoomLevelAtWhichToStop)||(this._zoomLevel=this._zoomLevelAtWhichToStop):this._snapsToIntegralZoomLevels?this._zoomLevelAtWhichToStop=this.zoomsIn?Math.ceil(this._zoomLevel):Math.floor(this._zoomLevel):t=!1),this._delegate&&this._delegate.linearZoomControllerDidZoom(this._zoomLevel),t?a.scheduleOnNextFrame(this):this._cleanUp()},handleEvent:function(t){this._handleForceChangedEvent(t)},_handleForceChangedEvent:function(t){var e=s.clamp(t.webkitForce,MouseEvent.WEBKIT_FORCE_AT_MOUSE_DOWN,MouseEvent.WEBKIT_FORCE_AT_FORCE_MOUSE_DOWN)-MouseEvent.WEBKIT_FORCE_AT_MOUSE_DOWN;Math.abs(e-this._gasPedalValue)>.01&&(this._gasPedalValue=e),this._speed=.01+this._gasPedalValue*(.06-.01)},_cleanUp:function(){this._animating=!1,this._shouldStop=!1,delete this._zoomLevelAtWhichToStop,this._delegate&&this._delegate.linearZoomControllerDidStop()}},e.exports=n},{"../utils":237,"@maps/js-utils":82,"@maps/scheduler":100}],183:[function(t,e,i){function n(){a.LongPress.call(this),this.minimumPressDuration=500}var o=t("@maps/js-utils"),s=t("@maps/geometry/point"),a=t("@maps/gesture-recognizers");n.prototype=o.inheritPrototype(a.LongPress,n,{constructor:n,touchesBegan:function(t){(o.isIEAndNotEdge()||o.isEdge())&&document.getSelection().removeAllRanges(),a.LongPress.prototype.touchesBegan.call(this,t),this._domEvents.push(t),this.translation=new s,this._translationOrigin=this._lastTouchLocation=this.locationInElement()},enterRecognizedState:function(){a.LongPress.prototype.enterBeganState.call(this)},touchesMoved:function(t){this.preventDefault(t);var e=this.locationInElement();this.state===a.States.Possible?a.LongPress.prototype.touchesMoved.call(this,t):this.state!==a.States.Began&&this.state!==a.States.Changed||(this.translation.x+=e.x-this._lastTouchLocation.x,this.translation.y+=e.y-this._lastTouchLocation.y,this.enterChangedState()),this._lastTouchLocation=e},touchesCanceled:function(t){this.interruptGesture()},touchesEnded:function(t){this.state===a.States.Changed?(this.preventDefault(t),this.enterEndedState()):this.enterFailedState()},interruptGesture:function(){this.state===a.States.Changed?this.enterEndedState():this.state===a.States.Began&&this.enterFailedState()},reset:function(){a.LongPress.prototype.reset.call(this),delete this._translationOrigin,delete this._lastTouchLocation,this._domEvents=[]}}),e.exports=n},{"@maps/geometry/point":71,"@maps/gesture-recognizers":74,"@maps/js-utils":82}],184:[function(t,e,i){function n(t,e){this._target=t,this._delegate=e,this._touchCount=0,this.initialEventTargetForCurrentInteraction=null,this._doubleTapWithOneFingerRecognizer=this._addGestureRecognizer(o.Tap),this._doubleTapWithOneFingerRecognizer.numberOfTouchesRequired=1,this._doubleTapWithOneFingerRecognizer.numberOfTapsRequired=2,this._singleTapWithOneFingerRecognizer=this._addGestureRecognizer(o.Tap),this._longPressAndPanRecognizer=this._addGestureRecognizer(s),this._longPressAndPanRecognizer.delegate=this,t.addEventListener(a.startEventType,this),t.addEventListener("dragstart",this),this.updateGestureEnableState()}var o=t("@maps/gesture-recognizers"),s=t("./long-press-and-pan-gesture-recognizer"),a=t("../utils"),r="auto"===a.htmlElement("div",{style:"pointer-events: auto"}).style.pointerEvents;n.prototype={constructor:n,handleEvent:function(t){switch(t.type){case"pointerdown":this._installEndListeners(),this._touchCount++,this.initialEventTargetForCurrentInteraction=this._delegate.getEventTargetFromSubShadowDOM(t),this._suppressDefaultBehavior(t);break;case"pointerup":case"pointercancel":0===--this._touchCount&&(this._removeEndListeners(),document.removeEventListener("selectstart",this,!0),this.initialEventTargetForCurrentInteraction=null);break;case"dragstart":this._delegate.elementShouldPreventDragstart(t.target)&&t.preventDefault();break;case"mousedown":if(this._installEndListeners(),this.initialEventTargetForCurrentInteraction=this._delegate.getEventTargetFromSubShadowDOM(t),!r&&"none"===window.getComputedStyle(this.initialEventTargetForCurrentInteraction).pointerEvents){var e=this.initialEventTargetForCurrentInteraction.style,i=e.display;e.display="none",this.initialEventTargetForCurrentInteraction=document.elementFromPoint(t.clientX,t.clientY),e.display=i}this._suppressDefaultBehavior(t);break;case"mouseup":this._removeEndListeners(),document.removeEventListener("selectstart",this,!0),this.initialEventTargetForCurrentInteraction=null;break;case"touchstart":t.touches.length===t.changedTouches.length&&(this._installEndListeners(),this.initialEventTargetForCurrentInteraction=this._delegate.getEventTargetFromSubShadowDOM(t),this._delegate.elementWantsDefaultBrowserBehavior(this.initialEventTargetForCurrentInteraction,t,t.touches.length)||t.preventDefault());break;case"touchend":case"touchcancel":0===t.touches.length&&(this._removeEndListeners(),this.initialEventTargetForCurrentInteraction=null);break;case"statechange":this._handleStatechange(t);break;case"selectstart":t.preventDefault()}},_handleStatechange:function(t){switch(t.target){case this._doubleTapWithOneFingerRecognizer:this._handleDoubleTapWithOneFingerChange(t);break;case this._singleTapWithOneFingerRecognizer:this._handleSingleTapWithOneFingerChange(t);break;case this._longPressAndPanRecognizer:this._handleLongPressAndPanChange(t)}},gestureRecognizerShouldBegin:function(t){return this._delegate.userDidLongPress(t)},updateGestureEnableState:function(){var t=this._delegate.isScrollEnabled,e=this._delegate.isRotationEnabled,i=this._delegate.isZoomEnabled,n=(t?1:0)|(e?2:0)|(i?4:0),o=[void 0,"mk-disable-pan-gestures","mk-disable-pinch-gestures","mk-disable-all-gestures","mk-disable-zoom-gestures","mk-disable-all-gestures","mk-disable-pinch-gestures","mk-disable-all-gestures"];this._delegate.rootNode.classList.remove("mk-disable-all-gestures"),this._delegate.rootNode.classList.remove("mk-disable-pan-gestures"),this._delegate.rootNode.classList.remove("mk-disable-pinch-gestures"),this._delegate.rootNode.classList.remove("mk-disable-zoom-gestures"),o[n]&&this._delegate.rootNode.classList.add(o[n])},mapWasDestroyed:function(){this._removeEndListeners(),this._target.removeEventListener(a.startEventType,this),this._target.removeEventListener("dragstart",this),this._doubleTapWithOneFingerRecognizer.removeEventListener("statechange",this),this._doubleTapWithOneFingerRecognizer.enabled=!1,this._doubleTapWithOneFingerRecognizer=null,this._singleTapWithOneFingerRecognizer.removeEventListener("statechange",this),this._singleTapWithOneFingerRecognizer.enabled=!1,this._singleTapWithOneFingerRecognizer=null,this._longPressAndPanRecognizer.removeEventListener("statechange",this),this._longPressAndPanRecognizer.enabled=!1,this._longPressAndPanRecognizer.delegate=null,this._longPressAndPanRecognizer=null,delete this.initialEventTargetForCurrentInteraction,delete this._target,delete this._delegate},_addGestureRecognizer:function(t){var e=new t;return e.target=this._target,e.addEventListener("statechange",this),e},_handleDoubleTapWithOneFingerChange:function(t){var e=t.target;e.state===o.States.Recognized&&(this._delayedSingleTapRecognizerTimeoutID&&(this._delegate.userCanceledTap(),window.clearTimeout(this._delayedSingleTapRecognizerTimeoutID),delete this._delayedSingleTapRecognizerTimeoutID),this._singleTapWithOneFingerRecognizer.enabled=!1,this._delegate.userDidDoubleTap(e))},_handleSingleTapWithOneFingerChange:function(t){var e=t.target;if(this._singleTapWithOneFingerRecognizer.enabled&&e.state===o.States.Recognized){this._delegate.userWillTap(e);var i=this._delegate.shouldDelaySingleTap()?350:0;this._delayedSingleTapRecognizerTimeoutID=window.setTimeout(function(){delete this._delayedSingleTapRecognizerTimeoutID,this._delegate.userDidTap()}.bind(this),i)}},_handleLongPressAndPanChange:function(t){var e=t.target;switch(e.state){case o.States.Possible:this._delegate.userMayStartPanningAfterLongPress();break;case o.States.Began:this._singleTapWithOneFingerRecognizer.enabled=!1,this._doubleTapWithOneFingerRecognizer.enabled=!1,this._doubleTapWithOneFingerRecognizer.enabled=!0;break;case o.States.Changed:this._delegate.userDidPanAfterLongPress(e.translation);break;case o.States.Ended:case o.States.Failed:this._singleTapWithOneFingerRecognizer.enabled=!0,this._delegate.userDidStopPanningAfterLongPress(e.state!==o.States.Failed)}},_stopDraggingAnnotation:function(){this._longPressAndPanRecognizer.interruptGesture()},_suppressDefaultBehavior:function(t){this._delegate.elementWantsDefaultBrowserBehavior(this.initialEventTargetForCurrentInteraction,t,this._touchCount)||((!("pointerType"in t)||"mouse"===t.pointerType)&&a.insideIframe?(document.addEventListener("selectstart",this,!0),document.getSelection().removeAllRanges()):t.preventDefault())},_installEndListeners:function(){window.addEventListener(a.endEventType,this),a.cancelEventType&&window.addEventListener(a.cancelEventType,this)},_removeEndListeners:function(){window.removeEventListener(a.endEventType,this),a.cancelEventType&&window.removeEventListener(a.cancelEventType,this)}},e.exports=n},{"../utils":237,"./long-press-and-pan-gesture-recognizer":183,"@maps/gesture-recognizers":74}],185:[function(t,e,i){function n(t){this._map=t,this._items=[]}function o(t,e){var i=t.toCoordinateRegion();if(i.span.latitudeDelta>=e.latitudeDelta&&i.span.longitudeDelta>=e.longitudeDelta)return t;i.span.latitudeDelta=Math.max(i.span.latitudeDelta,e.latitudeDelta),i.span.longitudeDelta=Math.max(i.span.longitudeDelta,e.longitudeDelta);var n=i.span.latitudeDelta/2,o=i.span.longitudeDelta/2,a=new h(s.convertLongitudeToX(i.center.longitude-o),s.convertLatitudeToY(i.center.latitude+n)),l=new h(s.convertLongitudeToX(i.center.longitude+o),s.convertLatitudeToY(i.center.latitude-n));return a.x>l.x&&a.x--,new r(a.x,a.y,Math.min(l.x-a.x,1),l.y-a.y)}var s=t("../../lib/geo"),a=t("@maps/js-utils"),r=s.MapRect,l=s.CoordinateSpan,h=s.MapPoint,c=t("./padding"),d=t("./types-internal"),u=t("./public-dom"),p=new l(.001,.001),m=new c(12,12,12,12),g={Select:"select",Deselect:"deselect"};n.checkShowItemsParameters=function(t,e){return a.checkArray(t,"[MapKit] Map.showItems expects an array of items as its first parameter."),e=a.checkOptions(e,"object","[MapKit] Map.showItems expects an object as optional second parameter."),Object.keys(e).forEach(function(t){switch(t){case"animate":break;case"padding":a.checkInstance(e.padding,c,"[MapKit] Map.showItems expects a Padding object for `options.padding`.");break;case"minimumSpan":a.checkInstance(e.minimumSpan,l,"[MapKit] Map.showItems expects a CoordinateSpan for `options.minimumSpan`.");break;default:console.warn("[MapKit] `"+t+"` is not a valid option of Map.showItems.")}}),e},n.setRegionForItems=function(t,e,i){if(t.ensureRenderingFrame().size.height<=0||t.ensureRenderingFrame().size.width<=0)return!1;if(0===e.length)return!0;for(var n=!!i.animate,s=i.padding||m,a=i.minimumSpan||p,l=0,h=0,u=0,g=0,_=[],f=0,y=e.length;f<y;++f){var v=e[f];if(v.map===t.public){var w=v._impl._boundingRect||v._impl.boundingRectAtScale&&v._impl.boundingRectAtScale(1);if(w){if(v._impl.style){var b=v._impl.style._impl.halfStrokeWidthAtResolution();l=Math.max(l,b),h=Math.max(h,b),u=Math.max(u,b),g=Math.max(g,b)}_.push(w)}else{v._impl.updateLayout(!0);var C=v._impl.delegate.paddingForAnnotation(v);l=Math.max(l,C.top),h=Math.max(h,C.right),u=Math.max(u,C.bottom),g=Math.max(g,C.left),_.push(new r(v._impl.x,v._impl.y,0,0))}}}if(0===_.length)return!0;s=new c(s.top+l,s.right+h,s.bottom+u,s.left+g);var S=o(d.boundingRectForSortedRects(_.sort(function(t,e){return t.minX()-e.minX()})),a);return t.setVisibleMapRectAnimated(t.padMapRect(S,s),n),!0},n.prototype={constructor:n,_map:null,_selectedItem:null,_selectionDistance:10,get node(){return this._node},get items(){return this._items.filter(this.isItemExposed,this)},set items(t){a.checkArray(t,"[MapKit] Map."+this.itemName+"s expected an array of "+this.itemName+"s, but got `"+t+"` instead."),t.forEach(function(t,e){a.checkInstance(t,this.itemConstructor,"[MapKit] Map."+this.itemName+"s expected an "+this.itemName+" at index "+e+", but got `"+t+"` instead.")},this),t=t.filter(function(t){return!t.map||t.map._impl===this._map||(console.warn("[MapKit] Map."+this.capitalizedItemName+"s: "+this.itemName+" is already in another map."),!1)},this);var e=[].concat(this._items);t=[].concat(this._items.filter(function(t){return!this.isItemExposed(t)},this),t);for(var i=0,n=0,o=!1;i<t.length;)e[n]!==t[i]?e[n]&&-1===t.indexOf(e[n])?(this.removedItem(e[n]),o=!0,n++):(t[i].map&&t[i].map._impl===this._map?e.splice(e.indexOf(t[i]),1):(this.addedItem(t[i],!0),o=!0),i++):(i++,n++);for(;n<e.length;)this.removedItem(e[n]),o=!0,n++;this._items=t,o&&this.manyItemsChanged(t,!0)},get selectedItem(){return this._selectedItem},set selectedItem(t){if(t!==this._selectedItem){if(null!=t&&(a.checkInstance(t,this.itemConstructor,"[MapKit] Map.selected"+this.capitalizedItemName+" expected an "+this.itemName+" or `null`, but got `"+t+"` instead."),t.map!==this._map.public))throw new Error("[MapKit] Map.selected"+this.capitalizedItemName+" cannot be set to an "+this.itemName+" that is not in the map.");if(this._selectedItem){var e=this._selectedItem;this._selectedItem=null,e.selected=!1,this._map.selectionMayChange=!1,e.dispatchEvent(new u.Event(g.Deselect)),delete this._map.selectionMayChange}t&&(this._selectedItem=t,t.selected=!0,this._map.selectionMayChange=!1,t.dispatchEvent(new u.Event(g.Select)),delete this._map.selectionMayChange)}},addItem:function(t,e){return a.checkInstance(t,this.itemConstructor,"[MapKit] Map.add"+this.capitalizedItemName+" expected an "+this.itemName+", but got `"+t+"` instead."),(t=this.addItemToList(t,!1,e))&&this.manyItemsAdded([t],!1),t},addItems:function(t){a.checkArray(t,"[MapKit] Map.add"+this.capitalizedItemName+"s expected an array of "+this.itemName+"s, but got `"+t+"` instead.");var e=t.filter(function(t,e){return a.checkInstance(t,this.itemConstructor,"[MapKit] Map.add"+this.capitalizedItemName+"s expected an "+this.itemName+" at index "+e+", but got `"+t+"` instead."),!!this.addItemToList(t,!0)},this);return e.length>0&&this.manyItemsAdded(e,!0),e},shouldAddItem:function(t,e){return!t.map||(t.map._impl!==this._map&&console.warn("[MapKit] Map."+this.capitalizedItemName+(e?"s":"")+": "+this.itemName+" is already in another map."),!1)},removeItem:function(t){return a.checkInstance(t,this.itemConstructor,"[MapKit] Map.remove"+this.capitalizedItemName+" expected an "+this.itemName+", but got `"+t+"` instead."),this.isItemExposed(t)?t.map!==this._map.public?console.warn("[MapKit] Map.remove"+this.capitalizedItemName+": cannot remove "+this.itemName+" as it is not attached to this map."):this.removeAnyItem(t):console.warn("[MapKit] Map.remove"+this.capitalizedItemName+": cannot remove "+this.itemName),t},removeAnyItem:function(t){var e=this._items.indexOf(t);return e>=0&&(this._items.splice(e,1),this.removedItem(t),this.manyItemsRemoved([t],!1)),t},removeItems:function(t){return a.checkArray(t,"[MapKit] Map.remove"+this.capitalizedItemName+"s expected an array of "+this.itemName+"s, but got `"+t+"` instead."),t.forEach(function(t,e){a.checkInstance(t,this.itemConstructor,"[MapKit] Map.remove"+this.capitalizedItemName+"s expected an "+this.itemName+" at index "+e+", but got `"+t+"` instead."),this.isItemExposed(t)?t.map!==this._map.public?console.warn("[MapKit] Map.remove"+this.capitalizedItemName+"s: cannot remove "+this.itemName+" at index "+e+" as it is not attached to this map."):t._impl._toBeRemoved=!0:console.warn("[MapKit] Map.remove"+this.capitalizedItemName+"s: cannot remove "+this.itemName+" at index "+e)},this),this._items=this._items.filter(function(t){return!t._impl._toBeRemoved}),t.forEach(function(t){t._impl._toBeRemoved&&(delete t._impl._toBeRemoved,this.removedItem(t))},this),t.length>0&&this.manyItemsRemoved(t,!0),t},enabledItemCloseToPoint:function(t,e){return this._previousPointForPickingItem&&this._previousPointForPickingItem.equals(t)?e?this._closeItems[this._closeItemIndex]:(this._closeItemIndex=(this._closeItemIndex+1)%this._closeItems.length,this._closeItems[this._closeItemIndex]):(this._previousPointForPickingItem=t,this._closeItems=this._itemsCloseToPoint(t).filter(function(t){return t.enabled}),this._closeItemIndex=!e&&this._closeItems.length>1&&this._closeItems[0].selected?1:0,this._closeItems[this._closeItemIndex])},get selectionMayChange(){return!this._map||this._map.selectionMayChange},addItemToList:function(t,e,i){if(this.shouldAddItem(t,e))return(void 0===i||i<0||i>this._items.length)&&(i=this._items.length),this._items.splice(i,0,t),this.addedItem(t,e),t},addedItem:function(t,e){"function"==typeof t._impl.setDelegate?t._impl.setDelegate(this):t._impl.delegate=this,t._impl.addedToMap&&t._impl.addedToMap()},manyItemsAdded:function(t,e){},removedItem:function(t){t.selected=!1,delete t._impl.delegate,t._impl.removedFromMap&&t._impl.removedFromMap()},manyItemsRemoved:function(t,e){},manyItemsChanged:function(t,e){},mapWasDestroyed:function(){delete this._map,this.removedReferenceToMap()},_node:null,_deletePreviousPointForPickingItem:function(){delete this._previousPointForPickingItem,delete this._closeItems,delete this._closeItemIndex},_itemsCloseToPoint:function(t){var e=this._items.filter(function(t){return t._impl.canBePicked()});return 0===e.length?[]:this.pickableItemsCloseToPoint(e,t)}},e.exports=n},{"../../lib/geo":4,"./padding":216,"./public-dom":219,"./types-internal":232,"@maps/js-utils":82}],186:[function(t,e,i){e.exports={preprocessPoints:function(t,e){function i(t,e){var i=r[t];return r[t]=r[e],r[e]=i,r[t]._index=t,r[e]._index=e,e}function n(t){for(;t>0;){var e=Math.floor((t-1)/2);if(r[e]._area<=r[t]._area)return;t=i(t,e)}}function o(t){for(;;){var e=2*t+1,n=2*t+2,o=r[t]._area,s=r[e]?r[e]._area:1/0,a=r[n]?r[n]._area:1/0;if(o<=s&&o<=a)return;t=i(t,s<=o&&s<=a?e:n)}}function s(t){var e=t._prev,i=t,n=t._next;return Math.abs((e.x-n.x)*(i.y-e.y)-(e.x-i.x)*(n.y-e.y))/2}function a(t,e){var i=t._area;t._area=Math.max(s(t),e),t._area<i?n(t._index):o(t._index)}var r=[],l=t.length-1;if(e&&l>1){if(!t[l].equals(t[0])){t.push(t[0].copy());var h=!0;++l}var c=!0;t.unshift(t[l-1].copy()),++l}t[0]._area=t[l]._area=1/0;for(var d=1;d<l;++d){var u=t[d];u._prev=t[d-1],u._next=t[d+1],u._area=s(u),function(t){var e=r.length;t._index=e,r.push(t),n(e)}(u)}for(c&&t.shift(),h&&t.pop();r.length>0;){var p=function(){var t=r[0],e=r.pop();return r.length>0&&(r[0]=e,e._index=0,o(0)),t}(),m=p._prev,g=p._next;m._prev&&(m._next=g,a(m,p._area)),g._next&&(g._prev=m,a(g,p._area)),delete p._index,delete p._next,delete p._prev}},filterPointsAtScale:function(t,e){var i=1/(e*e),n=t.filter(function(t){return t._area>i});if(2===n.length){var o=n[0].x-n[1].x,s=n[0].y-n[1].y;if(o*o+s*s<1*i)return[]}return n}}},{}],187:[function(t,e,i){var n=t("@maps/localizer"),o=t("@maps/js-utils"),s="locales/{{locale}}/strings.json",a=t("./urls"),r=new n.LanguageSupport({supportedLocales:t("../locales/supported-tile-locales.json"),regionToScriptMap:t("../locales/region-to-script-map.json"),localesMap:t("../locales/locales-map.json")}),l=new n.L10n({supportedLocales:t("../locales/supported-locales.json"),primaryLocales:t("../locales/primary-locales.json"),localesMap:t("../locales/locales-map.json"),regionToScriptMap:t("../locales/region-to-script-map.json"),rtlLocales:t("../locales/rtl-locales.json"),enUSDictionary:t("../locales/en-US/strings.json"),get localeUrl(){return o.isNode()?"file://"+e.require("path").resolve(t.resolve("."),"..","..",s):a.createUrl(s)}});l._useMetric=!1,l.addEventListener(n.L10n.Events.LocaleChanged,function(){var t=n.LangTag.parse(l.requestedLocaleId);l._useMetric=n.UseMetric.forLanguageTag(t)}),l.useMetric=function(){return this._useMetric},e.exports={languageSupport:r,l10n:l}},{"../locales/en-US/strings.json":238,"../locales/locales-map.json":239,"../locales/primary-locales.json":240,"../locales/region-to-script-map.json":241,"../locales/rtl-locales.json":242,"../locales/supported-locales.json":243,"../locales/supported-tile-locales.json":244,"./urls":234,"@maps/js-utils":82,"@maps/localizer":91}],188:[function(t,e,i){function n(t,e,i){if(m.instrumented){this._instrumented=m.instrumented,this._performanceLog=[];var o=U.now()}m.state===m.States.READY?this.state=X.Initialized:this.state=X.InitializedWithoutConfiguration,e&&(this._bootstrapSize=new M(e.offsetWidth,e.offsetHeight)),this.public=t,n.maps.push(this.public),e=this._checkParent(e),i=p.checkOptions(i),this._checkOptions(i),this._setDefaultState(i),this._setupScene(),this._setupRenderTree(),this._setupControllers(i);var s="isRotationEnabled"in i;this._setIsRotationEnabled(!s||i.isRotationEnabled,s),i.rotation&&(this.rotation=i.rotation),this._flushToDOM(e),this._handleOptions(i,e),this._setupListeners(),A.scheduleOnNextFrame(this),this._instrumented&&this._performanceLog.push({name:"map-init",timestamp:o,duration:U.now()-o})}function o(t){this.selected=t}function s(t){t.selected=!0,this._logWithMap(O.Events.AnnotationClick)}function a(t,e,i,n){if(!p.checkValueIsInEnum(t,e))throw new Error("[MapKit] Unknown value for `"+i+"`. Choose from "+n+".")}function r(t,e){var i=new u.Event(t),n=e.locationInElement();return i.pointOnPage=new DOMPoint(n.x,n.y),i.domEvents=e.domEvents.slice(),i}var l=t("../../lib/geo"),h=t("../../lib/scene-graph"),c=t("../../lib/map-node/src/constants").Tints,d=t("./utils"),u=t("./public-dom"),p=t("@maps/js-utils"),m=t("./configuration"),g=t("./types-internal"),_=t("./padding"),f=t("./interaction/linear-zoom-controller"),y=t("./interaction/map-user-interaction-controller"),v=t("./localizer").l10n,w=t("./overlays/overlays-controller"),b=t("./annotations/annotations-controller"),C=t("./map-node-controller"),S=t("./controls/zoom-control"),k=t("./user-location/user-location-controller"),E=t("./controls/controls-layer"),T=t("@maps/geometry/point"),L=t("@maps/geometry/rect"),M=t("@maps/geometry/size"),x=t("@maps/render-tree"),A=t("@maps/scheduler"),I=t("@maps/device-pixel-ratio"),O=t("./analytics/analytics"),R=t("./layer-items-controller"),P=t("./overlays/overlay"),D=t("./annotations/annotation"),N=t("./collections/item-collection"),z=t("./constants"),F=z.FeatureVisibility,j=t("./point-of-interest-filter"),U=t("./instruments"),B=l.CoordinateRegion,G=l.Coordinate,Z=l.MapPoint,W=l.MapSize,K=l.MapRect,V=d.supportsTouches,q=new K(0,0,1,1),H="mk-dragging-annotation",X={InitializedWithoutConfiguration:"InitializedWithoutConfiguration",Initialized:"Initialized",ReadyWithoutConfiguration:"ReadyWithoutConfiguration",Ready:"Ready",Rendered:"Rendered",Switched:"Switched",Destroyed:"Destroyed"},Y={padding:"rw",isScrollEnabled:"rw",isZoomEnabled:"rw",center:"rw",region:"rw",rotation:"rw",isRotationEnabled:"rw",showsCompass:"rw",visibleMapRect:"rw",tintColor:"rw",annotations:"rw",selectedAnnotation:"rw",overlays:"rw",selectedOverlay:"rw",showsUserLocation:"rw",tracksUserLocation:"rw",mapType:"rw",colorScheme:"rw",_allowWheelToZoom:"rw",_showsDefaultTiles:"rw",showsPointsOfInterest:"rw",showsMapTypeControl:"rw",showsZoomControl:"rw",showsScale:"rw",showsUserLocationControl:"rw",pointOfInterestFilter:"rw",annotationForCluster:"rw",cameraDistance:"rw",cameraZoomRange:"rw",cameraBoundary:"rw",distances:"rw",tileOverlays:"rw",element:"ro",userLocationAnnotation:"ro"};n.maps=[];var J={ZOOM_START:"zoom-start",ZOOM_END:"zoom-end",SELECT:"select",DESELECT:"deselect",DRAG_START:"drag-start",DRAGGING:"dragging",DRAG_END:"drag-end",REGION_CHANGE_START:"region-change-start",REGION_CHANGE_END:"region-change-end",SCROLL_START:"scroll-start",SCROLL_END:"scroll-end",MAP_TYPE_CHANGE:"map-type-change",ROTATION_START:"rotation-start",ROTATION_END:"rotation-end",SINGLE_TAP:"single-tap",DOUBLE_TAP:"double-tap",LONG_PRESS:"long-press",MAP_NODE_CHANGE:"map-node-change",MAP_NODE_READY:"map-node-ready",COMPLETE:"complete"};n.MapTypes=z.MapTypes,n.Distances=z.Distances,n.ColorSchemes=c,n.prototype={constructor:n,_showsUserLocation:!1,_tracksUserLocation:!1,_tintColor:"",_annotationForCluster:null,_emphasis:z.Emphasis.Standard,get padding(){return this._padding.copy()},set padding(t){if(p.checkInstance(t,_,"[MapKit] The `padding` parameter passed to `Map.padding` is not a Padding."),!this._padding.equals(t)){this._padding=t.copy();var e=this.ensureRenderingFrame();if(!e.equals(L.Zero)){this.rotation=0;var i=this._mapRectAccountingForPadding(),n=i.midX(),o=i.midY();this._setRenderingFrameValue(e);var s=this._mapRectAccountingForPadding(),a=n-s.midX(),r=o-s.midY(),l=new K(s.minX()+a,s.minY()+r,s.size.width,s.size.height);this.setVisibleMapRectAnimated(l,!1)}this.controlsLayer&&this.controlsLayer.mapPaddingDidChange(this._adjustedPadding)}},get isScrollEnabled(){return this._mapNode.pannable},set isScrollEnabled(t){this._mapNode.pannable=!!t,this._mapUserInteractionController.updateGestureEnableState()},get isZoomEnabled(){return this._mapNode.zoomable},set isZoomEnabled(t){this._mapNode.zoomable=!!t,this.controlsLayer.updateZoomControl(),this._mapUserInteractionController.updateGestureEnableState()},get showsZoomControl(){return this._showsZoomControl},set showsZoomControl(t){(t=!!t)!==this._showsZoomControl&&(this._showsZoomControl=t,this.controlsLayer.updateZoomControl(),this.controlsLayer.updateScale())},get showsScale(){return this._showsScale},set showsScale(t){p.checkValueIsInEnum(t,F)?t!==this._showsScale&&(this._showsScale=t,this.controlsLayer&&this.controlsLayer.updateScale()):console.warn("[MapKit] value passed to `Map.showsScale` setter must be part of the mapkit.FeatureVisibility enum.")},get mapType(){return this._mapType},set mapType(t){t!==this._mapType&&(a(t,n.MapTypes,"mapType","Map.MapTypes"),this._setMapTypeAndEmphasis(t,this._emphasis))},getMapTypeWithEmphasis:function(){return this._mapType===n.MapTypes.Standard&&this._emphasis===z.Emphasis.Muted?n.MapTypes.MutedStandard:this._mapType},setMapTypeWithEmphasis:function(t){var e=z.Emphasis.Standard;t===n.MapTypes.MutedStandard?(t=n.MapTypes.Standard,e=z.Emphasis.Muted):a(t,n.MapTypes,"mapType","Map.MapTypes"),e===this._emphasis&&t===this._mapType||this._setMapTypeAndEmphasis(t,e)},_setMapTypeAndEmphasis:function(t,e){this._mapType=t,this._emphasis=e,this._updateMapNodeTintAndEmphasis(this._mapNode),this._mapNodeController.handleMapConfigurationChange(),this.controlsLayer&&this.controlsLayer.update(),this.public.dispatchEvent(new u.Event(J.MAP_TYPE_CHANGE)),this._logWithMap(O.Events.MapTypeChange)},get distances(){return this._distances},set distances(t){t!==this._distances&&(a(t,n.Distances,"distances","Map.Distances"),this._distances=t,this.controlsLayer.updateScale())},get colorScheme(){return this._colorScheme},set colorScheme(t){t!==this._colorScheme&&(a(t,n.ColorSchemes,"colorScheme","Map.ColorSchemes"),this._colorScheme=t,this._updateMapNodeTintAndEmphasis(this._mapNode))},get _allowWheelToZoom(){return this._mapNode.allowWheelToZoom},set _allowWheelToZoom(t){this._mapNode.allowWheelToZoom=t},get _showsTileInfo(){return this._mapNode._impl.debug},set _showsTileInfo(t){this._mapNode._impl.debug=t},get _showsDefaultTiles(){return this._mapNode.showsDefaultTiles},set _showsDefaultTiles(t){this._mapNode.showsDefaultTiles=t},get tileOverlays(){return this._mapNode.tileOverlays},set tileOverlays(t){this._mapNode.tileOverlays=t,this.controlsLayer.updateZoomControl()},addTileOverlay:function(t){var e=this._mapNode.addTileOverlay(t);return this.controlsLayer.updateZoomControl(),e},addTileOverlays:function(t){var e=this._mapNode.addTileOverlays(t);return this.controlsLayer.updateZoomControl(),e},removeTileOverlay:function(t){var e=this._mapNode.removeTileOverlay(t);return this.controlsLayer.updateZoomControl(),e},removeTileOverlays:function(t){var e=this._mapNode.removeTileOverlays(t);return this.controlsLayer.updateZoomControl(),e},get showsMapTypeControl(){return this._showsMapTypeControl},set showsMapTypeControl(t){(t=!!t)!==this._showsMapTypeControl&&(this._showsMapTypeControl=t,this.controlsLayer.updateMapTypeControl())},get showsUserLocationControl(){return this._showsUserLocationControl},set showsUserLocationControl(t){(t=!!t)!==this._showsUserLocationControl&&(this._showsUserLocationControl=t,this.controlsLayer.updateUserLocationControl(),this.controlsLayer.updateScale())},get showsPointsOfInterest(){return null===this.pointOfInterestFilter||null===this.pointOfInterestFilter._includes&&0===this.pointOfInterestFilter._excludes.length},set showsPointsOfInterest(t){if(t){if(null===this.pointOfInterestFilter)return;this.pointOfInterestFilter=null}else{if(this.pointOfInterestFilter===j.filterExcludingAllCategories)return;this.pointOfInterestFilter=j.filterExcludingAllCategories}},get pointOfInterestFilter(){return this._mapNode.pointOfInterestFilter},set pointOfInterestFilter(t){null!==t&&p.checkInstance(t,j,"[MapKit] Value passed to `Map.pointOfInterestFilter` setter must be an instance of mapkit.PointOfInterestFilter."),this._mapNode.pointOfInterestFilter=t},get element(){return this.rootNode&&this.rootNode.element},set element(t){console.warn("[MapKit] The `element` property is read-only.")},get renderingMapRect(){return this._mapNode.visibleMapRect},get visibleMapRect(){return this._visibleMapRect||(this._visibleMapRect=this._mapRectAccountingForPadding()),this._visibleMapRect},set visibleMapRect(t){this.setVisibleMapRectAnimated(t,!1)},setVisibleMapRectAnimated:function(t,e,i){p.required(t,"[MapKit] Missing `visibleMapRect` parameter in call to `Map.setVisibleMapRectAnimated()`.").checkInstance(t,K,"[MapKit] The `visibleMapRect` parameter passed to `Map.setVisibleMapRectAnimated()` is not a MapRect.");var n=this.ensureRenderingFrame();if(0===n.size.width||0===n.size.height)this._visibleMapRect=t;else{delete this._visibleMapRect;var o=this._visibleFrame,s=t,a=this._adjustedPadding;if(!a.equals(_.Zero)){var r=n.size.width/o.size.width,h=n.size.height/o.size.height;s=new K(t.minX()-a.left*r*t.size.width,t.minY()-a.top*h*t.size.height,t.size.width*r,t.size.height*h)}var c=new Z(t.midX(),t.midY()),d=l.zoomLevelForMapRectInViewport(s,n.size,l.tileSize);d=p.clamp(this._mapNode.snapsToIntegralZoomLevels?Math.floor(d+1e-6):d,this.minZoomLevel,this.maxZoomLevel);var u=Math.pow(2,Math.ceil(d))*(l.tileSize*Math.pow(2,d-Math.ceil(d))),m=new W(o.size.width/u,o.size.height/u);t=new K(c.x-m.width/2,c.y-m.height/2,m.width,m.height)}return e=null==e||!!e,this._setVisibleMapRect(t,e,i),delete this._delayedShowItems,this.public},get region(){return this.visibleMapRect.toCoordinateRegion()},set region(t){this.setRegionAnimated(t,!1)},setRegionAnimated:function(t,e,i){return p.required(t,"[MapKit] Tried to set `Map.region` property to a non-existent value.").checkInstance(t,B,"[MapKit] Region passed to `Map.region` setter is not a CoordinateRegion."),this.region.equals(t)||this.setVisibleMapRectAnimated(t.toMapRect(),e,i),this.public},get isRotationAvailable(){return m.previewLoCSR?!m.didFallback&&this.csrCapable:m.ready||m.didFallback?m.canRunCSR&&this.csrCapable:this.csrCapable},set isRotationAvailable(t){console.warn("[MapKit] Map.isRotationAvailable is a read-only property")},get isRotationEnabled(){return this._mapNode.isRotationEnabled},set isRotationEnabled(t){this._setIsRotationEnabled(t,!0)},get rotation(){return this._mapNode.rotation},set rotation(t){this.setRotationAnimated(t,!1),this.controlsLayer.updateRotationControl()},get showsCompass(){return this.usingCSR?this._showsCompass:F.Hidden},set showsCompass(t){p.checkValueIsInEnum(t,F)?(this.isRotationEnabled||t!==F.Visible&&t!==F.Adaptive||console.warn("[MapKit] The compass cannot be shown when `Map.isRotationEnabled` is false."),this._usingDefaultShowsCompassValue=!1,t!==this._showsCompass&&(this._showsCompass=t,this.controlsLayer&&this.controlsLayer.updateRotationControl())):console.warn("[MapKit] value passed to `Map.showsCompass` setter must be part of the MapKit.FeatureVisibility enum.")},get usingCSR(){return!this._mapNodeController.usingSSR},setRotationAnimated:function(t,e,i){if(this.isRotationAvailable){if(p.required(t,"[MapKit] Tried to set `Map.rotation` property to a non-existent value."),"number"==typeof t&&isFinite(t)){var n=this._centerMapPoint(),o=t-this._mapNode.getRotation(),s=(e||null==e||!i)&&this.mapCanStartRotating();if((e||null==e)&&s){var a=this.camera.copy();a.rotateAroundCenter(n,o),this._mapNode.setCameraAnimated(a,!0,n)}else(s||i)&&this._mapNode.rotateCameraAroundMapPoint(n,o),i||this.mapDidStopRotating();return this.public}console.warn("[MapKit] Argument for `Map.rotation` is not a finite number.")}else console.warn("[MapKit] Rotation is not available.")},get center(){return this._centerMapPoint().toCoordinate()},set center(t){this.setCenterAnimated(t,!1)},setCenterAnimated:function(t,e,i){p.required(t,"[MapKit] Tried to set `Map.center` property to a non-existent value.").checkInstance(t,G,"[MapKit] Value passed to `Map.center` setter is not a Coordinate object.");var n=this.ensureRenderingFrame();if(0!==n.size.width&&0!==n.size.height){var o=this._offsetCenterWithPaddingAndRotation(t.toMapPoint(),-1);o&&(t=o.toCoordinate())}return this._mapNode.setCenterAnimated(t,null==e||!!e),delete this._visibleMapRect,i||(this.tracksUserLocation=!1),this.public},get cameraZoomRange(){return this._mapNode.cameraZoomRange},set cameraZoomRange(t){this.setCameraZoomRangeAnimated(t,!1)},setCameraZoomRangeAnimated:function(t,e){return null!=t&&p.checkInstance(t,l.CameraZoomRange,"[MapKit] Expected a `mapkit.CameraZoomRange` object for `Map.cameraZoomRange`, but got `"+t+"` instead."),this._mapNode.setCameraZoomRangeAnimated(t,null==e||!!e),this.public},get cameraDistance(){return this._mapNode.getCurrentCameraDistance()},set cameraDistance(t){this.setCameraDistanceAnimated(t,!1)},setCameraDistanceAnimated:function(t,e){if(!(t>=0))throw new Error("[MapKit] Expected a number for Map.cameraDistance, but got `"+t+"` instead");return this._mapNode.setCameraDistanceAnimated(t,null==e||!!e),this.public},get cameraBoundary(){var t=this._cameraBoundary;return t?{region:t.toCoordinateRegion?t.toCoordinateRegion():t.copy(),mapRect:t.toMapRect?t.toMapRect():t.copy()}:null},set cameraBoundary(t){this.setCameraBoundaryAnimated(t,!1)},setCameraBoundaryAnimated:function(t,e){var i=null;if(null==t)delete this._cameraBoundary;else if(t instanceof B)i=t.toMapRect(),this._cameraBoundary=t.copy();else{if(!(t instanceof K))throw new Error("[MapKit] `Map.cameraBoundaryRect` expected a CoordinateRegion or a MapRect, but got `"+t+"` instead.");i=t,this._cameraBoundary=i.copy()}var n=this._centerMapPoint();return this._mapNode.setCameraBoundaryAnimated(i,null==e||!!e),this.tracksUserLocation&&!this._mapNode.isMapPointWithinBounds(n)&&(this.tracksUserLocation=!1),this.public},get overlays(){return this._overlaysController.items},set overlays(t){this._overlaysController.items=t},get selectedOverlay(){return this._overlaysController.selectedItem},set selectedOverlay(t){this._overlaysController.selectedItem=t},addOverlay:function(t){return this._overlaysController.addItem(t)},addOverlays:function(t){return this._overlaysController.addItems(t),t},removeOverlay:function(t){return this._overlaysController.removeItem(t)},removeOverlays:function(t){return this._overlaysController.removeItems(t)},topOverlayAtPoint:function(t){p.checkInstance(t,window.DOMPoint,"[MapKit] Map.topOverlayAtPoint expected a DOMPoint, but got `"+t+"` instead.");var e=this.rootNode.convertPointFromPage(t),i=this._overlaysController.pickableItemsCloseToPoint(this.overlays,e,0),n=this.selectedOverlay;return n&&i.indexOf(n)>0?n:i[0]},overlaysAtPoint:function(t){p.checkInstance(t,window.DOMPoint,"[MapKit] Map.overlaysAtPoint expected a DOMPoint, but got `"+t+"` instead.");var e=this.rootNode.convertPointFromPage(t);return this._overlaysController.pickableItemsCloseToPoint(this.overlays,e,0).reverse()},get annotations(){return this._annotationsController.items},set annotations(t){this._annotationsController.items=t},get selectedAnnotation(){return this._annotationsController.selectedItem},set selectedAnnotation(t){this._annotationsController.selectedItem=t},addAnnotation:function(t){return this._annotationsController.addItem(t)},addAnnotations:function(t){return this._annotationsController.addItems(t)},removeAnnotation:function(t){return this._annotationsController.removeItem(t)},removeAnnotations:function(t){return this._annotationsController.removeItems(t)},showItems:function(t,e){var i=new N(t).getFlattenedItemList();e=R.checkShowItemsParameters(i,e);var n=[],o=[];return i.forEach(function(t){t instanceof P&&!t.map&&(t._impl._map=this.public,n.push(t)),t instanceof D&&this._annotationsController.preAddedAnnotation(t)&&o.push(t)},this),this.isRooted()&&R.setRegionForItems(this,i,e)||(this._delayedShowItems=[i,e]),n.forEach(function(t){delete t._impl._map}),o.forEach(this._annotationsController.resetAnnotation.bind(this._annotationsController)),this._addItems(i),t},addItems:function(t){var e=new N(t).getFlattenedItemList();return this._addItems(e)},removeItems:function(t){var e=[],i=[];return new N(t).getFlattenedItemList().forEach(function(t,n){if(!(t instanceof P||t instanceof D))throw new Error("[MapKit] Map.removeItems expected an Annotation, Overlay, ItemCollection, or Array of valid items at index "+n+", but got `"+t+"` instead.");t instanceof P?e.push(t):i.push(t)},this),this.removeOverlays(e),this.removeAnnotations(i),t},annotationsInMapRect:function(t){return this._annotationsController.annotationsInMapRect(t)},updateSize:function(t){return console.warn("[MapKit] Map resizing is now automatic, the Map.updateSize() method has been deprecated and will be removed in a future version."),this.public},convertCoordinateToPointOnPage:function(t){p.checkInstance(t,G,"[MapKit] Map.convertCoordinateToPointOnPage expected a Coordinate, but got `"+t+"` instead.");var e=this.camera.transformMapPoint(t.toMapPoint()),i=this.rootNode.convertPointToPage(e);return new window.DOMPoint(i.x,i.y)},convertPointOnPageToCoordinate:function(t){p.checkInstance(t,window.DOMPoint,"[MapKit] Map.convertPointOnPageToCoordinate expected a DOMPoint, but got `"+t+"` instead.");var e=this.camera.transformGestureCenter(this.rootNode.convertPointFromPage(new T(t.x,t.y))),i=this.renderingMapRect.origin;return new G(l.convertYToLatitude(i.y+e.y/this.worldSize),l.convertXToLongitude(i.x+e.x/this.worldSize))},get showsUserLocation(){return this._userLocationController.showsUserLocation},set showsUserLocation(t){(t=!!t)!==this.showsUserLocation&&(this._userLocationController.showsUserLocation=t,t||(this._removeUserLocationDisplay(),this.tracksUserLocation=!1),this.showsUserLocationControl&&(this.controlsLayer.updateUserLocationControl(),this.controlsLayer.updateScale()))},get userLocationAnnotation(){return this._annotationsController.userLocationAnnotation},get tracksUserLocation(){return this._userLocationController.tracksUserLocation},set tracksUserLocation(t){(t=!!t)!==this.tracksUserLocation&&(this._userLocationController.tracksUserLocation=t,this._mapNode.staysCenteredDuringZoom=t,t?this.showsUserLocation=!0:this.userLocationAnnotation||(this.showsUserLocation=!1),this._firstCameraUpdateToTrackUserLocationPending=t,this._updateCameraToTrackUserLocation(this._userLocationController.userLocation),this._userLocationController.tracksUserLocation===t&&(this.controlsLayer.updateUserLocationControl(),this._userLocationTrackingDelegate&&"function"==typeof this._userLocationTrackingDelegate.mapUserLocationTrackingDidChange&&this._userLocationTrackingDelegate.mapUserLocationTrackingDidChange(this.public)))},get tintColor(){return this._tintColor},set tintColor(t){if(t!==this._tintColor){if(null!=t){if(p.checkType(t,"string","[MapKit] Expected a string value for Map.tintColor, but got `"+t+"` instead"),""!==t&&!d.isValidCSSColor(t))return void console.warn("[MapKit] value passed to `Map.tintColor` is not a valid color value. Ignoring: "+t);this._tintColor=t}else delete this._tintColor;this.controlsLayer&&this.controlsLayer.update()}},get tintColorForControls(){return d.darkColorScheme(this.mapNodeTint)?"":this._tintColor},get minZoomLevel(){return this._mapNode.minZoomLevel},get maxZoomLevel(){return this._mapNode.maxZoomLevel},get zoomLevel(){return this._mapNode.zoomLevel},set zoomLevel(t){this._mapNode.zoomLevel=t},get worldSize(){return l.pointsPerAxis(this._mapNode.zoomLevel)},get camera(){return this._mapNodeController.node.camera},get cameraIsPanning(){return this._mapNode.cameraIsPanning},get cameraIsZooming(){return this._mapNode.cameraIsZooming},get cameraIsRotating(){return this._mapNode.cameraIsRotating},get cameraIsAnimating(){return this._mapNode.cameraIsAnimating},get cameraIsMoving(){return this.cameraIsPanning||this.cameraIsZooming||this.cameraIsRotating||this.cameraIsAnimating},get _mapNode(){return this._mapNodeController.node},get csrCapable(){return this._mapNodeController.csrCapable},destroy:function(){this.state=X.Destroyed,this.removeAnnotations(this.annotations),this.removeOverlays(this.overlays),this._stopStabilizationTimeout(),this._linearZoomController.stop(),this.showsUserLocation&&this._removeUserLocationDisplay(),this.controlsLayer.mapWasDestroyed(),this.controlsLayer=null,this._mapUserInteractionController.mapWasDestroyed(),this._overlaysController.mapWasDestroyed(),this._annotationsController.mapWasDestroyed(),this._userLocationController.mapWasDestroyed(),this._linearZoomController._delegate=null,m.removeEventListener(m.Events.Changed,this),v.removeEventListener(v.Events.LocaleChanged,this),I.removeEventListener("device-pixel-ratio-change",this),this._iframe&&(this._iframe.removeEventListener("load",this),this._iframe.contentWindow&&this._iframe.contentWindow.removeEventListener("resize",this),this.element.removeChild(this._iframe),this._iframe=null),this._mapNodeController.destroy(),this._mapRoot.remove(),this._mapRoot=null,this._scene.destroy(),this._scene=null,this._removePrintListener(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.rootNode.remove(),this.rootNode=null;var t=n.maps.indexOf(this.public);t>=0&&n.maps.splice(t,1)},adjustMapItemPoint:function(t){return this._mapNode.adjustMapItemPoint(t)},get annotationForCluster(){return this._annotationForCluster},set annotationForCluster(t){if(null==t)delete this._annotationForCluster;else{if("function"!=typeof t)throw new Error("[MapKit] annotationForCluster must be a function or null");this._annotationForCluster=t}},selectionMayChange:!0,handleEvent:function(t){switch(t.type){case m.Events.Changed:this._configurationDidBecomeAvailable();break;case S.EVENTS.ZOOM_START:this._handleZoomStartEvent(t);break;case S.EVENTS.ZOOM_END:this._handleZoomEndEvent(t);break;case v.Events.LocaleChanged:this._handleLocaleChange(t);break;case"device-pixel-ratio-change":this._devicePixelRatioDidChange(t);break;case"load":this._iframeDidLoad();break;case"resize":this._iframeSizeDidChange()}},elementShouldPreventDragstart:function(t){return!this._annotationsController.isElementInCustomCallout(t)},elementWantsDefaultBrowserBehavior:function(t,e,i){if(e&&i&&("touchstart"===e.type||"pointerdown"===e.type&&"touch"===e.pointerType)){if(1===i&&!this.isScrollEnabled)return!0;if(2===i&&!this.isZoomEnabled&&!this.isRotationEnabled)return!0}return this._annotationsController.isElementInCallout(t)},getEventTargetFromSubShadowDOM:function(t){var e=t.touches?t.touches[0].target:t.target;return d.supportsShadowDOM&&e===this._annotationsController.node.element?this._annotationsController.getShadowDOMTargetFromEvent(t)||e:e},tileAccessForbidden:function(){m.accessKeyHasExpired()},mapDidFinishRendering:function(t){this.state!==X.Destroyed&&(this.state=X.Rendered,this._instrumented&&this._performanceLog.push({name:"map-fully-rendered",timestamp:U.now()}),this.addWaitingAnnotations(),this._startStabilizationTimeoutIfNeeded())},mapCanStartPanning:function(t){return this._panningWasPrevented?(delete this._panningWasPrevented,!1):!(this.tracksUserLocation&&this.cameraIsZooming||this._annotationsController.dragging||this._isInitialInteractionTargetInUIElement()||!this.public.dispatchEvent(new u.Event(J.SCROLL_START)))},mapWillStartPanning:function(t){this._stopStabilizationTimeout(),this.tracksUserLocation=!1,this.rootNode.classList.add("mk-panning"),this.rootNode.classList.add("mk-dragging-cursor")},mapWillStopPanning:function(t){this.rootNode.classList.remove("mk-dragging-cursor")},mapDidStopPanning:function(t){this._startStabilizationTimeoutIfNeeded(),this.rootNode.classList.remove("mk-panning"),this.public.dispatchEvent(new u.Event(J.SCROLL_END))},mapCanStartZooming:function(t){return!(this._isInitialInteractionTargetInUIElement()||!this.public.dispatchEvent(new u.Event(J.ZOOM_START)))},mapWillStartZooming:function(t,e,i,n){this._stopStabilizationTimeout(),n&&(this.tracksUserLocation=!1),this._logWithMap(O.Events.Zoom,{eventValue:e})},mapDidStopZooming:function(t){this._startStabilizationTimeoutIfNeeded(),this.public.dispatchEvent(new u.Event(J.ZOOM_END)),this.controlsLayer.scaleDidChange()},mapCameraWillChange:function(t,e){this.mapNodeCameraBeforeChange=t.camera},mapCameraDidChange:function(t,e){if(this.state!==X.Destroyed){var i=this.mapNodeCameraBeforeChange;delete this.mapNodeCameraBeforeChange,delete this._visibleMapRect,this._overlaysController.mapCameraDidChange(),this._annotationsController.updateVisibleAnnotations(),this.controlsLayer.scaleDidChange(),i&&i.rotation===t.camera.rotation||this.controlsLayer.updateRotationControl()}},mapCameraChangesWillStart:function(t,e){this._zoomLevelWhenCameraChangeStarted=this.zoomLevel,this.public.dispatchEvent(new u.Event(J.REGION_CHANGE_START))},mapCameraChangesDidEnd:function(t){this.state!==X.Destroyed&&(this._zoomLevelWhenCameraChangeStarted!==this.zoomLevel&&this.controlsLayer.zoomLevelDidChange(),delete this._zoomLevelWhenCameraChangeStarted,this.public.dispatchEvent(new u.Event(J.REGION_CHANGE_END)))},mapMinAndMaxZoomLevelsDidChange:function(t){this.controlsLayer.zoomLevelDidChange()},mapCanStartRotating:function(t){return this.public.dispatchEvent(new u.Event(J.ROTATION_START))},mapRotationDidChange:function(t){this.controlsLayer.updateRotationControl()},mapDidStopRotating:function(t){this.public.dispatchEvent(new u.Event(J.ROTATION_END))},mapTransformCenter:function(t){return this._centerMapPoint()},userWillTap:function(t){var e=t.locationInElement();if(this._isInitialInteractionTargetInUIElement())d.supportsTouches&&(this._delayedTapFunction=this._elementWasTapped.bind(this,this._mapUserInteractionController.initialEventTargetForCurrentInteraction));else if(!this._annotationsController.selectedItem||!this._annotationsController.selectedItem._impl.alwaysSelected){var i=this.rootNode.convertPointFromPage(e),n=this._annotationsController.enabledItemCloseToPoint(i);if(n)this._delayedTapFunction=s.bind(this,n);else{var a=this._overlaysController.enabledItemCloseToPoint(i);if(a)this._delayedTapFunction=o.bind(a,!0);else{var l=r(J.SINGLE_TAP,t);this._delayedTapFunction=function(){this._annotationsController.selectedItem=null,this._overlaysController.selectedItem=null,this.public.dispatchEvent(l)}.bind(this)}}}},shouldDelaySingleTap:function(){return this.isZoomEnabled||this.public._listeners&&(this.public._listeners[J.SINGLE_TAP]&&this.public._listeners[J.SINGLE_TAP].length>0||this.public._listeners[J.DOUBLE_TAP]&&this.public._listeners[J.DOUBLE_TAP].length>0)},userDidTap:function(t){this._delayedTapFunction&&(this._delayedTapFunction(),delete this._delayedTapFunction)},userCanceledTap:function(t){delete this._delayedTapFunction},userDidDoubleTap:function(t){var e=t.modifierKeys.alt;(!this.isZoomEnabled||e&&this.zoomLevel===this._mapNode.minZoomLevel||!e&&this.zoomLevel===this._mapNode.maxZoomLevel)&&this.public.dispatchEvent(r(J.DOUBLE_TAP,t))},userDidLongPress:function(t){if(this._isInitialInteractionTargetInUIElement())return!1;var e=t.locationInElement(),i=this._annotationsController.enabledItemCloseToPoint(this.rootNode.convertPointFromPage(e),!0);if(!i){var n=r(J.LONG_PRESS,t);return this.public.dispatchEvent(n),n.defaultPrevented&&(this._panningWasPrevented=!0),d.supportsTouches}return i._impl.isDraggable()&&!this.cameraIsMoving?(this._annotationsController.startDraggingAnnotation(i,e),!0):d.supportsTouches?(s.call(this,i),!0):d.supportsTouches},userMayStartPanningAfterLongPress:function(){delete this._panningWasPrevented},userDidPanAfterLongPress:function(t){this._annotationsController.annotationDraggingDidChange(t)},userDidStopPanningAfterLongPress:function(t){this._annotationsController.annotationDraggingDidEnd(t)},linearZoomControllerDidZoom:function(t){this.cameraIsZooming&&(this.zoomLevel=t,(t<=this.minZoomLevel&&!this._linearZoomController.zoomsIn||t>=this.maxZoomLevel&&this._linearZoomController.zoomsIn)&&this._mapNode.cameraDidStopZooming())},linearZoomControllerDidStop:function(){this._mapNode.cameraDidStopZooming()},userLocationDidChange:function(t){this._updateUserLocationDisplay(t.target),this.controlsLayer.userLocationDidChange(t.target),this.tracksUserLocation&&this._updateCameraToTrackUserLocation(t.target),this.public.dispatchEvent(t)},userLocationDidError:function(t){this._updateUserLocationDisplay(t.target),this.controlsLayer.userLocationDidError(t.target),this.public.dispatchEvent(t)},get mapNodeTint(){var t=this._mapNodeController&&this._mapNodeController.node;return t?t.tint:n.ColorSchemes.Light},isRooted:function(){return this.element&&this.element.ownerDocument.body.contains(this.element)},stopDraggingAnnotation:function(){this._mapUserInteractionController._stopDraggingAnnotation()},translateVisibleMapRectAnimated:function(t,e){var i=this.visibleMapRect;this._setVisibleMapRect(new K(i.minX()+t.x/this.worldSize,i.minY()+t.y/this.worldSize,i.size.width,i.size.height),!!e)},translateCameraAnimated:function(t,e){this._mapNode.setCameraAnimated(this.camera.translate(t),!!e)},setCameraAnimated:function(t,e){this._mapNode.setCameraAnimated(t,!!e)},shouldWaitForTilesAndControls:function(){return this.state!==X.Rendered||this.controlsLayer.controlsPending},ensureRenderingFrame:function(){return this._renderingFrame||new L},ensureVisibleFrame:function(){return this._visibleFrame||new L},annotationDraggingWillStart:function(){this.rootNode.classList.add(H),this.controlsLayer.classList.add(H),this.controlsLayer.canShowTooltips=!1},annotationDraggingDidEnd:function(){this.rootNode.classList.remove(H),this.controlsLayer.classList.remove(H),this.controlsLayer.canShowTooltips=!0},get useMetric(){switch(this.distances){case n.Distances.Adaptive:return v.useMetric();case n.Distances.Metric:return!0;case n.Distances.Imperial:return!1}},get isCompassHidden(){return this.showsCompass===F.Hidden||d.supportsTouches&&this.showsCompass===F.Adaptive&&0===this.rotation||!this.isRotationEnabled},compassDraggingWillStart:function(){var t=this.mapCanStartRotating();return t&&this.rootNode.classList.add("mk-dragging-cursor"),t},compassDraggingDidEnd:function(){this.mapDidStopRotating(),this.rootNode.classList.remove("mk-dragging-cursor")},panningDuringAnnotationDrag:function(){this._annotationsController.mapPanningDuringAnnotationDrag()},padMapRect:function(t,e){p.checkType(e,"object","[MapKit] padding must be an object with any of `top`, `left`, `bottom`, `right`"),["top","left","bottom","right"].forEach(function(t){if(t in e){var i=e[t];if("number"!=typeof i||i<0)throw new Error("[MapKit] property `"+t+"` of padding must be a number >= 0; got `"+i+"`")}else e[t]=0});var i=this.ensureRenderingFrame().size,n=p.log2(Math.min((i.width-(e.left+e.right))/(t.size.width*l.tileSize),(i.height-(e.top+e.bottom))/(t.size.height*l.tileSize))),o=l.pointsPerAxis(n);return g.padMapRect(t,{top:e.top/o,left:e.left/o,bottom:e.bottom/o,right:e.right/o})},supportsLabelRegions:function(){return!this._mapNodeController.usingSSR},createLabelRegion:function(){return this._mapNode.createLabelRegion()},updatedLabelRegion:function(){this._mapNode.updatedLabelRegion()},unregisterLabelRegion:function(t){this._mapNode.unregisterLabelRegion(t)},_addItems:function(t){var e=[];return t.forEach(function(t,i){if(!(t instanceof P||t instanceof D))throw new Error("[MapKit] Map.addItems expected an Annotation, Overlay, ItemCollection, or Array of valid items at index "+i+", but got `"+t+"` instead.");t.map||(t instanceof P?this.addOverlay(t):e.push(t))},this),this.addAnnotations(e),t},_configurationDidBecomeAvailable:function(t){var e=t&&this.state===X.Initialized;t||(this.state===X.InitializedWithoutConfiguration?(this.state=X.Initialized,e=!0):this.state===X.ReadyWithoutConfiguration&&(this.state=X.Ready,e=!0)),this._mapNodeController.configurationDidBecomeAvailable(t),e&&this._logWithMap(O.Events.MapsLoad),this.controlsLayer.update(),this.public._internalAppDelegate&&"function"==typeof this.public._internalAppDelegate.networkConfigurationUpdated&&this.public._internalAppDelegate.networkConfigurationUpdated({madabaDomains:m.madabaDomains,tileGroup:m.tileGroup,accessKey:m.accessKey})},_setupScene:function(){this._instrumented?this._scene=new U.Scene(this):this._scene=new h.Scene,this._scene.element.className="rt-root"},_checkOptions:function(t){p.checkType(t,"object","[MapKit] The `options` object is invalid."),Object.keys(t).forEach(function(t){var e=Y[t];"rw"===e||("ro"===e?console.warn("[MapKit] `"+t+"` is read-only and can't be set on a Map."):console.warn("[MapKit] `"+t+"` is not a valid property of Map."))})},_checkParent:function(t){if(void 0!==t&&null!==t){var e="string"==typeof t?document.getElementById(t):t;if(!e||!p.isElement(e))throw new Error("[MapKit] `parent` must either be a DOM element or its ID.");return e}},_setDefaultState:function(t){this._showsScale=F.Hidden,this._visibleMapRect=q,this._padding=new _,this._adjustedPadding=new _,this._showsCompass=F.Adaptive,this._usingDefaultShowsCompassValue=!0,this._distances=n.Distances.Adaptive,this._showsZoomControl="showsZoomControl"in t?!!t.showsZoomControl:!V,this._showsMapTypeControl="showsMapTypeControl"in t?!!t.showsMapTypeControl:!V,this._showsUserLocationControl="showsUserLocationControl"in t&&!!t.showsUserLocationControl;var e=t.mapType||n.MapTypes.Standard;a(e,n.MapTypes,"mapType","Map.MapTypes"),e===n.MapTypes.MutedStandard?(this._emphasis=z.Emphasis.Muted,this._mapType=n.MapTypes.Standard):(this._emphasis=z.Emphasis.Standard,this._mapType=e);var i=t.colorScheme||n.ColorSchemes.Light;a(i,n.ColorSchemes,"colorScheme","Map.ColorSchemes"),this._colorScheme=i},_setIsRotationEnabled:function(t,e){"boolean"==typeof t?(this.isRotationAvailable?this._mapNode.isRotationEnabled=t:e&&t&&console.warn("[MapKit] Rotation can't be enabled because it's not available."),this.controlsLayer.updateRotationControl(),this._mapUserInteractionController.updateGestureEnableState()):console.warn("[MapKit] Value passed to `Map.isRotationEnabled` is not a Boolean.")},_setupRenderTree:function(){var t=document.createElement("div");t.className="mk-map-view",t.appendChild(this._scene.element),this.rootNode=new x.Node(t)},_setupControllers:function(t){this.controlsLayer=new E(this),this._overlaysController=new w(this),this._scene.addChild(this._overlaysController.node),this._annotationsController=new b(this),this._scene.addChild(this._annotationsController.sceneGraphNode),this._userLocationController=new k(this),this._mapNodeController=new C(this,t),this._linearZoomController=new f(this._mapNode.snapsToIntegralZoomLevels,this),this._mapUserInteractionController=new y(this.rootNode.element,this)},_handleOptions:function(t,e){t.showsScale&&(this.showsScale=t.showsScale),t.showsCompass&&(this.showsCompass=t.showsCompass),t.padding&&(this.padding=t.padding),t.cameraZoomRange&&(this.cameraZoomRange=t.cameraZoomRange),t.cameraBoundary&&(this.cameraBoundary=t.cameraBoundary),t.visibleMapRect?this.visibleMapRect=t.visibleMapRect:t.region?this.region=t.region:(t.center&&(this.center=t.center),"cameraDistance"in t&&(this.cameraDistance=t.cameraDistance));var i=[],n=!t.visibleMapRect&&!t.region&&!t.center&&e;t.overlays&&(p.checkArray(t.overlays,"[MapKit] Map constructor overlays option expected an array of overlays, but got `"+t.annotations+"` instead."),n?i.push.apply(i,t.overlays):this.overlays=t.overlays),t.annotations&&(p.checkArray(t.annotations,"[MapKit] Map constructor annotations option expected an array of annotations, but got `"+t.annotations+"` instead."),n?i.push.apply(i,t.annotations):this.annotations=t.annotations),i.length>0&&this.showItems(i),t.selectedOverlay&&(this.selectedOverlay=t.selectedOverlay),t.selectedAnnotation&&(this.selectedAnnotation=t.selectedAnnotation),t.distances&&(this.distances=t.distances),this.tintColor=t.tintColor,this.showsUserLocation=t.showsUserLocation,this.tracksUserLocation=t.tracksUserLocation,t.tileOverlays&&(this.tileOverlays=t.tileOverlays)},_flushToDOM:function(t){this._addMapToParent(t),A.flush(),this._ensureContainerIsPositioned()},_addMapToParent:function(t){void 0!==t&&null!==t&&(t.appendChild(this.element),this._bootstrapSize.width&&this._bootstrapSize.height&&this._updateRenderingFrameSize(this._bootstrapSize),delete this._bootstrapSize)},performScheduledUpdate:function(){this.state!==X.Destroyed&&(this.state===X.InitializedWithoutConfiguration?this.state=X.ReadyWithoutConfiguration:this.state===X.Initialized&&(this.state=X.Ready),this._loadIframe())},_loadIframe:function(){this._iframe||(this._iframe=d.htmlElement("iframe",{tabindex:-1,"aria-hidden":!0}),this._iframe.addEventListener("load",this),this.element.insertBefore(this._iframe,this._scene.element))},_updateUserLocationDisplay:function(t){this._annotationsController.updateUserLocationAnnotation(t),this._overlaysController.updateUserLocationAccuracyRingOverlay(t)},_removeUserLocationDisplay:function(){this._annotationsController.removeUserLocationAnnotation(),this._overlaysController.removeUserLocationAccuracyRingOverlay()},_updateCameraToTrackUserLocation:function(t){var e,i;if(this.tracksUserLocation&&this.showsUserLocation&&t.coordinate){if(this._mapNode.isMapPointWithinBounds(t.coordinate.toMapPoint()))if(this._firstCameraUpdateToTrackUserLocationPending&&this.zoomLevel<9.5){var n=14;if(t.location.accuracy>0){var o=5*t.location.accuracy*l.mapUnitsPerMeterAtLatitude(t.location.latitude),s=new K(0,0,o,o),a=this._visibleFrame.size;n=Math.max(this.zoomLevel,l.zoomLevelForMapRectInViewport(s,a,l.tileSize))}e=this._mapRectForCenterAndZoomLevel(t.coordinate.toMapPoint(),n),this._userLocationTrackingDelegate&&"function"==typeof this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation&&(i=e.toCoordinateRegion(),this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation(this.public,i),e=i.toMapRect()),this._mapNode.setCameraAnimated(this.camera.withNewMapRect(e),!0,!0)}else this._userLocationTrackingDelegate&&"function"==typeof this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation?(i=(e=this._mapRectForCenterAndZoomLevel(t.coordinate.toMapPoint(),this.zoomLevel)).toCoordinateRegion(),this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation(this.public,i),this._mapNode.setCameraAnimated(this.camera.withNewMapRect(e),!0,!0)):this.setCenterAnimated(t.coordinate,!0,!0);else this.setCenterAnimated(t.coordinate,!0,!0),this._userLocationController.tracksUserLocation=!1,this._mapNode.staysCenteredDuringZoom=!1,this.controlsLayer.updateUserLocationControl();delete this._firstCameraUpdateToTrackUserLocationPending}},_updateRenderingFrameFromElement:function(){var t=this.rootNode.element,e=t.offsetWidth,i=t.offsetHeight;0!==e&&0!==i&&this._updateRenderingFrameSize(new M(e,i))},_setRenderingFrameValue:function(t){this._renderingFrame=t,this._visibleFrame=t;var e=this._adjustedPadding.copy(),i=this._adjustedPadding=this._adjustedPaddingForMapSize(t.size);i.equals(_.Zero)||(this._visibleFrame=new L(t.origin.x+i.left,t.origin.y+i.top,t.size.width-i.left-i.right,t.size.height-i.top-i.bottom)),!i.equals(e)&&this.controlsLayer&&this.controlsLayer.mapPaddingDidChange(i)},_adjustedPaddingForMapSize:function(t){var e=new M(Math.min(z.MapSizes.minimumSizeToShowLogo.width,t.width),Math.min(z.MapSizes.minimumSizeToShowLogo.height,t.height)),i=this._padding.copy();i.top<0&&(i.top=0),i.left<0&&(i.left=0),i.bottom<0&&(i.bottom=0),i.right<0&&(i.right=0);var n=i.left+i.right,o=i.top+i.bottom,s=n+e.width-t.width,a=o+e.height-t.height;if(s>0&&n>0){var r=(n-s)/n;i.left*=r,i.right*=r}if(a>0&&o>0){var l=(o-a)/o;i.top*=l,i.bottom*=l}return i},_iframeDidLoad:function(){this._iframe.contentWindow.addEventListener("resize",this),this._ensureContainerIsPositioned(),this._iframeSizeDidChange()},_iframeSizeDidChange:function(){"function"==typeof window.matchMedia&&window.matchMedia("print").matches||this._updateRenderingFrameFromElement()},_updateRenderingFrameSize:function(t){var e=!this._renderingFrame;0===t.width||0===t.height||!e&&this._renderingFrame.size.equals(t)||(this._setRenderingFrameValue(new L(0,0,t.width,t.height)),this._scene.size=t,this._mapRoot.size=t,this._mapNodeController.updateSize(t),this._delayedShowItems&&(R.setRegionForItems(this,this._delayedShowItems[0],this._delayedShowItems[1]),delete this._delayedShowItems),this.controlsLayer.sizeDidChange(),this._annotationsController.mapSizeDidUpdate())},_mapRectForCenterAndZoomLevel:function(t,e){var i=this.ensureVisibleFrame().size,n=l.pointsPerAxis(e),o=i.width/n,s=i.height/n;return new K(t.x-o/2,t.y-s/2,o,s)},_isInitialInteractionTargetInUIElement:function(){var t=this._mapUserInteractionController.initialEventTargetForCurrentInteraction;return!!t&&(!!this._annotationsController.isElementInCallout(t)||!!this.controlsLayer.element.contains(t))},_handleZoomStartEvent:function(t){t.zoomIn&&this.zoomLevel>=this.maxZoomLevel||!t.zoomIn&&this.zoomLevel<=this.minZoomLevel||this._linearZoomController.start(this.zoomLevel,t.zoomIn)&&this._mapNode.cameraWillStartZooming(z.ZoomTypes.Button)},_handleZoomEndEvent:function(t){this._linearZoomController.stop()},_centerMapPoint:function(){if(0!==this.rotation){var t=this.renderingMapRect,e=new Z(t.midX(),t.midY()),i=this._offsetCenterWithPaddingAndRotation(e,1);if(i)return i}var n=this.visibleMapRect;return new Z(n.midX(),n.midY())},_offsetCenterWithPaddingAndRotation:function(t,e){var i=2*e*this.worldSize,n=(this._adjustedPadding.right-this._adjustedPadding.left)/i,o=(this._adjustedPadding.bottom-this._adjustedPadding.top)/i;if(0!==n||0!==o){var s=-this.rotation/180*Math.PI;return new Z(t.x-n*Math.cos(s)+o*Math.sin(s),t.y-n*Math.sin(s)-o*Math.cos(s))}},_setVisibleMapRect:function(t,e,i){i||(this.tracksUserLocation=!1);var n=t,o=this._adjustedPadding,s=this.ensureRenderingFrame(),a=this.ensureVisibleFrame();o.equals(_.Zero)||a.equals(L.Zero)||(n=new K(t.minX()-o.left/a.size.width*t.size.width,t.minY()-o.top/a.size.height*t.size.height,t.size.width*(s.size.width/a.size.width),t.size.height*(s.size.height/a.size.height))),this._mapNode.setVisibleMapRectAnimated(n,e)},_ensureContainerIsPositioned:function(){var t=this.rootNode.element;"static"===t.ownerDocument.defaultView.getComputedStyle(t).position&&(t.style.position="relative")},didInsertNewMapNode:function(t){t.delegate=this,this.state===X.Rendered&&(this.state=X.Switched),this._updateMapRoot(t),this._updateMapNodeTintAndEmphasis(t),window.setTimeout(function(){this.public.dispatchEvent(new u.Event(J.MAP_NODE_CHANGE))}.bind(this),0)},didReconfigureMapNode:function(t){t.snapsToIntegralZoomLevels&&t.zoomLevel%1!=0&&!t.cameraIsAnimating&&(t.zoomLevel=Math.floor(t.zoomLevel+1e-6)),this._linearZoomController&&(this._linearZoomController.snapsToIntegralZoomLevels=t.snapsToIntegralZoomLevels),this.controlsLayer.updateZoomControl()},didFinishMapNodeInitialization:function(t){if(t.customCanvas){var e=this._scene.element;e.parentNode.insertBefore(t.customCanvas,e)}else this._scene.addChild(t,0)},mapNodeReady:function(t){window.setTimeout(function(){var e=new u.Event(J.MAP_NODE_READY);e.usingCSR=t,this.public.dispatchEvent(e),this._logWithMap(O.Events.MapNodeReady)}.bind(this),0),this.controlsLayer.updateRotationControl(),this._annotationsController.mapSupportForLabelRegionsChanged()},_updateMapRoot:function(t){this._mapRoot&&this._mapRoot.remove(),this._mapRoot=this.rootNode.insertBefore(new x.Node(t.element),this.rootNode.firstChild),t.element.className="mk-map-node-element",this._mapRoot.size=t.size=this._scene.size,this._mapRoot.addChild(this._annotationsController.node),this._mapRoot.addChild(this.controlsLayer)},_updateMapNodeTintAndEmphasis:function(t){var e=this._mapType===n.MapTypes.Standard?this._colorScheme:n.ColorSchemes.Dark,i=this._colorScheme;this._mapType===n.MapTypes.Hybrid&&(i=n.ColorSchemes.Light),t.setTintAndEmphasis(e,i,this._emphasis),this.controlsLayer.update(),this._annotationsController.mapNodeTintWasSet(e),this._overlaysController.mapNodeTintWasSet(e),this.rootNode.classList.toggle("mk-dark-mode",d.darkColorScheme(e)),this.controlsLayer.classList.toggle("mk-dark-mode",d.darkColorScheme(e)),this._annotationsController.node.classList.toggle("mk-dark-mode",d.darkColorScheme(e))},overlaySelectionDidChange:function(t){t.selected&&(this._annotationsController.selectedItem=null);var e=new u.Event(t.selected?J.SELECT:J.DESELECT);e.overlay=t,this.selectionMayChange=!1,this.public.dispatchEvent(e),delete this.selectionMayChange},annotationSelectionDidChange:function(t){t.selected&&(this._overlaysController.selectedItem=null),this.selectionMayChange=!1,this.dispatchEventWithAnnotation(t.selected?J.SELECT:J.DESELECT,t),delete this.selectionMayChange},dispatchEventWithAnnotation:function(t,e,i){var n=new u.Event(t);if(n.annotation=e,i)for(var o in i)n[o]=i[o];this.public.dispatchEvent(n)},addWaitingAnnotations:function(){this.shouldWaitForTilesAndControls()||this._annotationsController.addWaitingAnnotations(this._dispatchCompleteEvent.bind(this))},_dispatchCompleteEvent:function(){this._mapNode.fullyRendered&&this.public.dispatchEvent(new u.Event(J.COMPLETE))},_handleLocaleChange:function(t){this._mapNodeController.handleMapConfigurationChange(),this.controlsLayer.classList.toggle("mk-rtl",t.locale.rtl),this._annotationsController.rtl=t.locale.rtl,this._annotationsController.updateUserLocationAnnotation(this._userLocationController.userLocation,!0);var e=this.ensureRenderingFrame();0!==e.size.width&&0!==e.size.height&&this._setRenderingFrameValue(e)},_elementWasTapped:function(t){for(;null!==t;t=t.parentNode)if(function(t){return"a"===t.localName||"button"===t.localName||"input"===t.localName&&"button"===t.type}(t))return void t.click()},_devicePixelRatioDidChange:function(t){this.controlsLayer.devicePixelRatioDidChange(t),this._annotationsController.devicePixelRatioDidChange(),this._mapNode.devicePixelRatioDidChange()||this._mapNodeController.handleRecreate()},_mapRectAccountingForPadding:function(){var t=this.renderingMapRect;if(this._adjustedPadding.equals(_.Zero))return t.copy();var e=this.ensureVisibleFrame(),i=this.ensureRenderingFrame();return new K(t.minX()+this._adjustedPadding.left/i.size.width*t.size.width,t.minY()+this._adjustedPadding.top/i.size.height*t.size.height,t.size.width*(e.size.width/i.size.width),t.size.height*(e.size.height/i.size.height))},_setupListeners:function(){m.state===m.States.READY&&this._configurationDidBecomeAvailable(!0),m.addEventListener(m.Events.Changed,this),v.activeLocale&&this._handleLocaleChange({locale:v.activeLocale}),v.addEventListener(v.Events.LocaleChanged,this),I.addEventListener("device-pixel-ratio-change",this),"function"==typeof window.matchMedia&&(this._boundPrintListener=this._printMediaQueryChanged.bind(this),this._mediaQuery=window.matchMedia("print"),this._mediaQuery.addListener(this._boundPrintListener))},_removePrintListener:function(){"function"==typeof window.matchMedia&&(this._mediaQuery.removeListener(this._boundPrintListener),this._boundPrintListener=null,this._mediaQuery=null)},_printMediaQueryChanged:function(t){var e=this._mapNode;t.matches?(this.rootNode.element.style.background=this.rootNode.element.parentNode.getAttribute("data-map-printing-background"),e.fullyRendered?this._ensureMapCenterDuringPrint(!0):(e.opacity=0,this._annotationsController.addWaitingAnnotations()),this._mapNodeController.handlePrintMatch(),A.flush()):(this._mapNodeController.handlePrintUnmatch(),e.opacity=1,this.rootNode.element.style.background="",this._ensureMapCenterDuringPrint(!1))},_ensureMapCenterDuringPrint:function(t){var e=[this._scene.element];this._mapNode.customCanvas&&e.push(this._mapNode.customCanvas),e.forEach(function(e){if(t){var i=this._scene.size;e.style.left="50%",e.style.marginLeft="-"+i.width/2+"px",e.style.top="50%",e.style.marginTop="-"+i.height/2+"px"}else e.style.left="",e.style.marginLeft="",e.style.top="",e.style.marginTop=""},this)},_mapStabilizationTimeout:null,_startStabilizationTimeoutIfNeeded:function(){this._mapNode&&this._mapNode.fullyRendered&&!this.cameraIsMoving&&this._mapNode.cssBackgroundProperty&&(this._stopStabilizationTimeout(),this._mapStabilizationTimeout=window.setTimeout(this._updatePrintingBackground.bind(this),500))},_stopStabilizationTimeout:function(){this._mapStabilizationTimeout&&(window.clearTimeout(this._mapStabilizationTimeout),this._mapStabilizationTimeout=null)},_updatePrintingBackground:function(){this._mapNode&&this._mapNode.fullyRendered&&this.isRooted()&&this.rootNode.element.parentNode.setAttribute("data-map-printing-background",this._mapNode.cssBackgroundProperty)},_loadSpileAndSwitchToCSR:function(t,e){if(m.state===m.States.READY)if(this._mapNode){var i=function(){e&&(m._madabaBaseUrl=e,m._customMadabaUrl=!0),m._disableCsr=!1,this._mapNodeController.forceSyrup()}.bind(this);if(t){if(!this._mapNodeController.hasSpile){var n=document.head.appendChild(document.createElement("script"));return n.addEventListener("error",function(){n.remove()}),n.addEventListener("load",i),void(n.src=t)}console.warn("Spile is already loaded; will not load again from "+t+".")}i()}else console.warn("Will not force switch to CSR: no map node yet.");else console.warn("Will not force switch to CSR: configuration not loaded.")},_logWithMap:function(t,e){if(this.state!==X.Destroyed){var i={map:this,eventTarget:O.EventTarget};if(e)for(var n in e)i[n]=e[n];O.log(t,i)}}},e.exports=n},{"../../lib/geo":4,"../../lib/map-node/src/constants":15,"../../lib/scene-graph":51,"./analytics/analytics":103,"./annotations/annotation":122,"./annotations/annotations-controller":124,"./collections/item-collection":164,"./configuration":165,"./constants":166,"./controls/controls-layer":169,"./controls/zoom-control":176,"./instruments":181,"./interaction/linear-zoom-controller":182,"./interaction/map-user-interaction-controller":184,"./layer-items-controller":185,"./localizer":187,"./map-node-controller":189,"./overlays/overlay":201,"./overlays/overlays-controller":203,"./padding":216,"./point-of-interest-filter":218,"./public-dom":219,"./types-internal":232,"./user-location/user-location-controller":235,"./utils":237,"@maps/device-pixel-ratio":63,"@maps/geometry/point":71,"@maps/geometry/rect":72,"@maps/geometry/size":73,"@maps/js-utils":82,"@maps/render-tree":98,"@maps/scheduler":100}],189:[function(t,e,i){function n(t,e){this._state=null,this._map=t,this._previousNode=null,this.node=null,this._initialOptions=e,this._cachedWebGLCheck=null,this.hasSpile=null,this._previousCanRunCSR=!1;this._updateState("sg_grid")}function o(t){return btoa(t)}function s(t){if(d.supportsLocalStorage)try{return window.localStorage.getItem(t)}catch(t){return}}function a(t,e){if(d.supportsLocalStorage)try{window.localStorage.setItem(t,e)}catch(t){return}}function r(t){if(d.supportsLocalStorage)try{window.localStorage.removeItem(t)}catch(t){return}}function l(t){try{return JSON.parse(t)}catch(t){return}}var h=t("../build.json"),c=t("./configuration"),d=t("@maps/js-utils"),u=t("../../lib/map-node").SceneGraphMapNode,p=t("../../lib/map-node").SyrupMapNode,m=t("./urls"),g=t("@maps/fast-webgl-check"),_=t("@maps/loaders").XHRLoader,f=t("@maps/loaders").Priority,y=t("./constants").FeatureVisibility,v=t("./point-of-interest-filter"),w={MissingMadaba:1,SpileFailed:3,SpileAdvancedRunning:4,SyrupInitFailure:5},b="mapkit.SpileTestResults",C=.2,S={sg_grid:{"global-configuration":"sg_ready",upgrade:"syrup_insert"},sg_insert:{"global-configuration":"sg_ready",upgrade:"syrup_insert",recreate:"sg_insert"},syrup_insert:{"global-configuration":"syrup_need_spile",fallback:"sg_insert",recreate:"syrup_insert"},syrup_need_spile:{"spile-load":"syrup_init",fallback:"sg_insert",recreate:"syrup_insert"},syrup_init:{"global-configuration":"syrup_network_stalled",fallback:"sg_insert",recreate:"syrup_insert","syrup-complete":"syrup_ready"},syrup_network_stalled:{"global-configuration":"syrup_network_stalled",fallback:"sg_insert",recreate:"syrup_insert","syrup-complete":"syrup_ready"},sg_ready:{"global-configuration":"sg_ready",upgrade:"syrup_insert",recreate:"sg_insert","map-configuration":"sg_ready"},syrup_ready:{"global-configuration":"syrup_ready",fallback:"sg_insert",recreate:"syrup_insert","map-configuration":"syrup_ready","print-match":"syrup_printing"},syrup_printing:{"print-unmatch":"syrup_ready"}};n.prototype={constructor:n,get defaultSpileURL(){return this._defaultSpileURL?this._defaultSpileURL:(this._defaultSpileURL=m.createBaseSyrupUrl("ti/csr/1.x.x/mk-csr.js?mapkitVersion="+h.version),this._defaultSpileURL)},set defaultSpileURL(t){this._defaultSpileURL=t},get usingSSR(){return"sg_insert"===this._state||"sg_ready"===this._state},get usingAdvancedAPIs(){return!0},get manageableMap(){var t=this._map.ensureRenderingFrame(),e=this._gpuInfo.MAX_RENDERBUFFER_SIZE*C;return t.size.width<=e&&t.size.height<=e},get csrCapable(){return this._webglCheckResult.shouldTryCSR&&!this.knownBadRendering},get shouldDynamicallyLoadSyrup(){return this._webglCheckResult.shouldTryCSR},get knownGoodRendering(){return!!this._cachedSpileResult&&!!this._cachedSpileResult.pass},get knownBadRendering(){return!!this._cachedSpileResult&&!this._cachedSpileResult.pass},get _webglCheckResult(){if(null===this._cachedWebGLCheck){var t=this._map.ensureRenderingFrame().size;this._cachedWebGLCheck=g(t.width,t.height)}return this._cachedWebGLCheck},get _gpuInfo(){return this._webglCheckResult&&this._webglCheckResult.webGL?this._webglCheckResult.webGL.gpuInfo:{MAX_RENDERBUFFER_SIZE:0,VERSION:"unknown"}},get gpuKey(){return o(this._gpuInfo.VERSION)},get _cachedSpileResult(){var t=s(b);if(t){var e=l(t);if(e)return e[this.gpuKey]}},get renderingMode(){var t="CLIENT";return this.usingSSR?t="SERVER":this._switchedToLoCSR&&(t="HYBRID"),t},configurationDidBecomeAvailable:function(t){var e=this._previousCanRunCSR,i=c.canRunCSR;this._previousCanRunCSR=i,!e||i||this.usingSSR?!e&&i?this.handleUpgrade():t||this.handleGlobalConfigurationChange():this.handleFallback()},forceSyrup:function(){this.hasSpile=null,this._transition("upgrade")},updateSize:function(t){this.node.size=t,this._previousNode&&(this._previousNode.size=t)},destroy:function(){this.node.removeEventListener("reconfigured",this),this.node.destroy(),this.node.delegate=null,this.node=null,this._previousNode&&(this._previousNode.destroy(),this._previousNode=null)},handleEvent:function(t){"reconfigured"===t.type&&(this._switchedToLoCSR=this.node.snapsToIntegralZoomLevels,this._map.didReconfigureMapNode(this.node))},handleGlobalConfigurationChange:function(){this._transition("global-configuration")},handleSpileLoad:function(){this._transition("spile-load")},handleFallback:function(t){t?this._logFallback("TEST_FAILURE"):c.didFallback?this._logFallback("BOOTSTRAP_FALLBACK"):this._logFallback("SYRUP_FALLBACK"),this._transition("fallback")},handleUpgrade:function(){this._transition("upgrade")},handleRecreate:function(){this._transition("recreate")},handleMapConfigurationChange:function(){this._transition("map-configuration")},handleSyrupComplete:function(){this._transition("syrup-complete")},handlePrintMatch:function(){this._transition("print-match")},handlePrintUnmatch:function(){this._transition("print-unmatch")},_transition:function(t){var e=S[this._state][t];e&&this._updateState(e)},_updateState:function(t){this._state=t;var e=this["_enter_"+t];"function"==typeof e&&e.call(this)},_loadSpileIfNeeded:function(t){var e=null,i=function(){e&&(e.removeEventListener("error",i),e.removeEventListener("load",i),e=null),this.hasSpile=!!window.Spile&&!!window.Spile.Syrup,t.call(this,this.hasSpile)}.bind(this);null!=this.hasSpile?t.call(this,this.hasSpile):"function"==typeof window.Spile?i():((e=document.head.appendChild(document.createElement("script"))).addEventListener("error",i),e.addEventListener("load",i),e.src=this.defaultSpileURL)},_insertSceneGraphNode:function(){this.usingSSR&&(this.node.isRotationEnabled=!1);var t=new u;this._insertNewMapNode(t),this._map.didFinishMapNodeInitialization(t)},_enter_sg_grid:function(){this._insertSceneGraphNode(),c.ready&&!c.canRunCSR&&this._updateState("sg_ready")},_enter_sg_insert:function(){this._insertSceneGraphNode(),c.ready&&this._updateState("sg_ready")},_enter_syrup_insert:function(){var t=new p;t.pendingConfigurationUpdates={},this._insertNewMapNode(t),c.state===c.States.READY&&this._updateState("syrup_need_spile")},_insertNewMapNode:function(t){var e=this._initialOptions||{};this._initialOptions||this.node._impl._cameraWillChange(this.node,!1),this.node?(this._removePreviousMapNode(),this._previousNode=this.node,this._previousNode.deactivate(),this.node.migrateStateTo(t),this.node.removeEventListener("reconfigured",this)):(t.allowWheelToZoom="_allowWheelToZoom"in e&&!!e._allowWheelToZoom,t.pannable=!("isScrollEnabled"in e)||!!e.isScrollEnabled,t.zoomable=!("isZoomEnabled"in e)||!!e.isZoomEnabled,"pointOfInterestFilter"in e?("showsPointsOfInterest"in e&&console.warn("[MapKit] `showsPointsOfInterest` is ignored because `pointOfInterestFilter` is set."),null!==e.pointOfInterestFilter&&d.checkInstance(e.pointOfInterestFilter,v,"[MapKit] Unknown value for `pointOfInterestFilter`. It must be an instance of mapkit.PointOfInterestFilter."),t.pointOfInterestFilter=e.pointOfInterestFilter):"showsPointsOfInterest"in e&&(t.pointOfInterestFilter=e.showsPointsOfInterest?null:v.filterExcludingAllCategories),t.showsDefaultTiles=!("_showsDefaultTiles"in e)||!!e._showsDefaultTiles),this.node=t,this.node.addEventListener("reconfigured",this),this._map.didInsertNewMapNode(t),this._initialOptions?delete this._initialOptions:this.node._impl._cameraDidChange(this.node,!1)},_removePreviousMapNode:function(){this._previousNode&&(this._previousNode.destroy(!0),this._previousNode.remove(),this._previousNode=null)},_enter_syrup_need_spile:function(){if(this.shouldDynamicallyLoadSyrup)return this.knownBadRendering?(this.handleFallback(),void this._loadSpileIfNeeded(function(t){t&&(this.isSpileResultValid(this._cachedSpileResult)||(this.invalidateSpileCache(),this.spileRun()))})):void this._loadSpileIfNeeded(function(t){t?this.handleSpileLoad():this.handleFallback()});this.handleFallback()},_enter_syrup_init:function(){if(!c.madabaDomains||!c.madabaDomains.length)return this._csrWarning(w.MissingMadaba),void this.handleFallback();this._cachedSpileResult&&!this.isSpileResultValid(this._cachedSpileResult)&&this.invalidateSpileCache();var t=Spile.getRendererWithoutAnyWarranty();if(this._switchedToLoCSR=!(this.knownGoodRendering&&this.manageableMap&&!c.previewLoCSR),this.manageableMap||this.usingAdvancedAPIs||c.previewLoCSR){var e=this.node;this._reConfigureMapNode(),e.init(c,t,Spile.Syrup.Camera,this._switchedToLoCSR,function(t){t?(this._csrWarning(w.SyrupInitFailure),this.handleFallback()):(this._reConfigureMapNode(),e.needsDisplay=!0,this._map.didFinishMapNodeInitialization(e),this.handleSyrupComplete())}.bind(this))}else this.handleFallback()},_csrWarning:function(t){console.warn("[MapKit] CSR is unavailable:",t)},_enter_syrup_network_stalled:function(){this.node.updateNetworkConfiguration(c)},_enter_sg_ready:function(){this._removePreviousMapNode(),this.node.snapsToIntegralZoomLevels=!0,this.node.isRotationEnabled=!1,this._reConfigureMapNode(),this._map.mapNodeReady(!1)},_enter_syrup_ready:function(){this._removePreviousMapNode(),this._reConfigureMapNode(),this.node.updateNetworkConfiguration(c),this.node.makePendingConfigurationUpdates(),this._map.mapNodeReady(!0),this._cachedSpileResult||this.spileRun()},_reConfigureMapNode:function(){this.node.language=c.language,this.node.configuration=c.types[this._map.mapType],this.node._impl.debug||(this.node._impl.debug=!!c.showsTileInfo),this._map.didReconfigureMapNode(this.node)},_enter_syrup_printing:function(){this.node.forceRerender(),this.node.needsDisplay=!0},_logFallback:function(t){if(!d.doNotTrack()){var e="https://gsp10-ssl.ls.apple.com/hvr/mw/v1/spile";c.proxyPrefixes&&(e=c.proxyPrefixes[c.proxyPrefixes.length-1]+e),this._fallbackReason=t,new _(e,this,{method:"POST",priority:f.Low}).schedule()}},_usingCSRAPI:function(){return!(this._map._showsCompass!==y.Visible&&(this._map._showsCompass!==y.Adaptive||this._map._usingDefaultShowsCompassValue)&&0===this._map.rotation&&!this._map._annotationsController.containsMarkerAnnotation())},getDataToSend:function(t){return t.setRequestHeader("Content-Type","text/plain"),t.responseType="text",JSON.stringify({ssrFallback:{reason:this._fallbackReason,usingCSRAPI:this._usingCSRAPI()}})},spileRun:function(){Spile&&Spile.testRendering&&Spile.testRendering(this.cacheSpileResult.bind(this))},cacheSpileResult:function(t){if(t.status!==Spile.Status.MAYBE&&t["gpu-identifier"]){var e=o(t["gpu-identifier"].VERSION),i=t.status===Spile.Status.YES,n=s(b),r=n?l(n)||{}:{};r[e]={pass:i,version:Spile.version},a(b,JSON.stringify(r)),i||this.usingSSR||this.handleFallback(!0)}},isSpileResultValid:function(t){if(Spile&&Spile.version)return t.version===Spile.version},invalidateSpileCache:function(){r(b)}},e.exports=n},{"../../lib/map-node":9,"../build.json":102,"./configuration":165,"./constants":166,"./point-of-interest-filter":218,"./urls":234,"@maps/fast-webgl-check":65,"@maps/js-utils":82,"@maps/loaders":83}],190:[function(t,e,i){function n(t,e){r(this,n)&&(Object.defineProperty(this,"_impl",{value:Object.create(o.prototype)}),o.call(this._impl,this,t,e))}var o=t("./map-internal"),s=t("@maps/js-utils"),a=t("./public-dom"),r=t("./check-instance-and-warn");n.MapTypes=o.MapTypes,n.ColorSchemes=o.ColorSchemes,n.Distances=o.Distances,n.prototype=s.inheritPrototype(a.EventTarget,n,{get padding(){return this._impl.padding},set padding(t){this._impl.padding=t},get isScrollEnabled(){return this._impl.isScrollEnabled},set isScrollEnabled(t){this._impl.isScrollEnabled=t},get isZoomEnabled(){return this._impl.isZoomEnabled},set isZoomEnabled(t){this._impl.isZoomEnabled=t},get showsZoomControl(){return this._impl.showsZoomControl},set showsZoomControl(t){this._impl.showsZoomControl=t},get showsScale(){return this._impl.showsScale},set showsScale(t){this._impl.showsScale=t},get mapType(){return this._impl.getMapTypeWithEmphasis()},set mapType(t){this._impl.setMapTypeWithEmphasis(t)},get colorScheme(){return this._impl.colorScheme},set colorScheme(t){this._impl.colorScheme=t},get distances(){return this._impl.distances},set distances(t){this._impl.distances=t},get _allowWheelToZoom(){return this._impl._allowWheelToZoom},set _allowWheelToZoom(t){this._impl._allowWheelToZoom=t},get _showsTileInfo(){return this._impl._showsTileInfo},set _showsTileInfo(t){this._impl._showsTileInfo=t},get _showsDefaultTiles(){return this._impl._showsDefaultTiles},set _showsDefaultTiles(t){this._impl._showsDefaultTiles=t},get tileOverlays(){return this._impl.tileOverlays},set tileOverlays(t){this._impl.tileOverlays=t},addTileOverlay:function(t){return this._impl.addTileOverlay(t)},addTileOverlays:function(t){return this._impl.addTileOverlays(t)},removeTileOverlay:function(t){return this._impl.removeTileOverlay(t)},removeTileOverlays:function(t){return this._impl.removeTileOverlays(t)},get showsMapTypeControl(){return this._impl.showsMapTypeControl},set showsMapTypeControl(t){this._impl.showsMapTypeControl=t},get showsUserLocationControl(){return this._impl.showsUserLocationControl},set showsUserLocationControl(t){this._impl.showsUserLocationControl=t},get showsPointsOfInterest(){return this._impl.showsPointsOfInterest},set showsPointsOfInterest(t){this._impl.showsPointsOfInterest=t},get pointOfInterestFilter(){return this._impl.pointOfInterestFilter},set pointOfInterestFilter(t){this._impl.pointOfInterestFilter=t},get element(){return this._impl.element},set element(t){this._impl.element=t},get visibleMapRect(){return this._impl.visibleMapRect},set visibleMapRect(t){this._impl.visibleMapRect=t},setVisibleMapRectAnimated:function(t,e){return this._impl.setVisibleMapRectAnimated(t,e)},get region(){return this._impl.region},set region(t){this._impl.region=t},setRegionAnimated:function(t,e){return this._impl.setRegionAnimated(t,e)},get isRotationAvailable(){return this._impl.isRotationAvailable},set isRotationAvailable(t){this._impl.isRotationAvailable=t},get isRotationEnabled(){return this._impl.isRotationEnabled},set isRotationEnabled(t){this._impl.isRotationEnabled=t},get rotation(){return this._impl.rotation},set rotation(t){this._impl.rotation=t},get showsCompass(){return this._impl.showsCompass},set showsCompass(t){this._impl.showsCompass=t},setRotationAnimated:function(t,e){return this._impl.setRotationAnimated(t,e)},get center(){return this._impl.center},set center(t){this._impl.center=t},setCenterAnimated:function(t,e){return this._impl.setCenterAnimated(t,e)},get cameraZoomRange(){return this._impl.cameraZoomRange},set cameraZoomRange(t){this._impl.cameraZoomRange=t},setCameraZoomRangeAnimated:function(t,e){return this._impl.setCameraZoomRangeAnimated(t,e)},get cameraDistance(){return this._impl.cameraDistance},set cameraDistance(t){this._impl.cameraDistance=t},setCameraDistanceAnimated:function(t,e){return this._impl.setCameraDistanceAnimated(t,e)},get cameraBoundary(){return this._impl.cameraBoundary},set cameraBoundary(t){this._impl.cameraBoundary=t},setCameraBoundaryAnimated:function(t,e){return this._impl.setCameraBoundaryAnimated(t,e)},get overlays(){return this._impl.overlays},set overlays(t){this._impl.overlays=t},get selectedOverlay(){return this._impl.selectedOverlay},set selectedOverlay(t){this._impl.selectedOverlay=t},addOverlay:function(t){return this._impl.addOverlay(t)},addOverlays:function(t){return this._impl.addOverlays(t)},removeOverlay:function(t){return this._impl.removeOverlay(t)},removeOverlays:function(t){return this._impl.removeOverlays(t)},topOverlayAtPoint:function(t){return this._impl.topOverlayAtPoint(t)},overlaysAtPoint:function(t){return this._impl.overlaysAtPoint(t)},get annotations(){return this._impl.annotations},set annotations(t){this._impl.annotations=t},get selectedAnnotation(){return this._impl.selectedAnnotation},set selectedAnnotation(t){this._impl.selectedAnnotation=t},addAnnotation:function(t){return this._impl.addAnnotation(t)},addAnnotations:function(t){return this._impl.addAnnotations(t)},removeAnnotation:function(t){return this._impl.removeAnnotation(t)},removeAnnotations:function(t){return this._impl.removeAnnotations(t)},showItems:function(t,e){return this._impl.showItems(t,e)},addItems:function(t){return this._impl.addItems(t)},removeItems:function(t){return this._impl.removeItems(t)},annotationsInMapRect:function(t){return this._impl.annotationsInMapRect(t)},updateSize:function(t){return this._impl.updateSize(t)},convertCoordinateToPointOnPage:function(t){return this._impl.convertCoordinateToPointOnPage(t)},convertPointOnPageToCoordinate:function(t){return this._impl.convertPointOnPageToCoordinate(t)},get showsUserLocation(){return this._impl.showsUserLocation},set showsUserLocation(t){this._impl.showsUserLocation=t},get userLocationAnnotation(){return this._impl.userLocationAnnotation},get tracksUserLocation(){return this._impl.tracksUserLocation},set tracksUserLocation(t){this._impl.tracksUserLocation=t},get tintColor(){return this._impl.tintColor},set tintColor(t){this._impl.tintColor=t},get performanceLog(){return this._impl._performanceLog},destroy:function(){this._impl.destroy()},get annotationForCluster(){return this._impl.annotationForCluster},set annotationForCluster(t){this._impl.annotationForCluster=t}}),e.exports=n},{"./check-instance-and-warn":162,"./map-internal":188,"./public-dom":219,"@maps/js-utils":82}],191:[function(t,e,i){function n(t){s.call(this,t.coordinate,o(t),{style:l})}function o(t){return!t.stale&&t.location.accuracy>0&&t.location.accuracy<h?t.location.accuracy:0}var s=t("./circle-overlay"),a=t("./style"),r=t("@maps/js-utils"),l=new a({strokeColor:null}),h=3e4;n.prototype=r.inheritPrototype(s,n,{updateForUserLocation:function(t){this.coordinate=t.coordinate,this.radius=o(t)}}),e.exports=n},{"./circle-overlay":195,"./style":211,"@maps/js-utils":82}],192:[function(t,e,i){function n(t,e,i,n){s.call(this,new a(this),t,n),this.coordinate=e,this.radius=i}function o(){return[this._coordinate.toMapPoint()]}var s=t("./styled-overlay-internal"),a=t("./circle-overlay-node"),r=t("../../../lib/geo"),l=r.Coordinate,h=r.MapRect,c=t("@maps/js-utils");n.prototype=c.inheritPrototype(s,n,{get coordinate(){return this._coordinate},set coordinate(t){c.checkInstance(t,l,"[MapKit] CircleOverlayInternal.coordinate expected a Coordinate value, but got `"+t+"` instead."),this._coordinate&&this._coordinate.latitude===t.latitude&&this._coordinate.longitude===t.longitude||(this._coordinate=t.copy(),this.updateGeometry())},get radius(){return this._radius},set radius(t){var e="[MapKit] CircleOverlayInternal.radius expected a non-negative number (radius in meters), but got `"+t+"` instead.";c.checkType(t,"number",e),t<0&&console.warn(e);var i=Math.max(0,t);this._radius!==i&&(this._radius=i,this.updateGeometry())},calculateBoundingRect:function(){if(!this._coordinate||isNaN(this._radius))return null;var t=this._center=this._coordinate.toMapPoint(),e=this._mapRadius=this._radius*r.mapUnitsPerMeterAtLatitude(this._coordinate.latitude);return new h(t.x-e,t.y-e,2*e,2*e)},simplifyShapeAtLevel:o,clip:o}),e.exports=n},{"../../../lib/geo":4,"./circle-overlay-node":193,"./styled-overlay-internal":212,"@maps/js-utils":82}],193:[function(t,e,i){function n(t){o.call(this,t,!0,new s(this))}var o=t("./styled-overlay-node.js"),s=t("./circle-overlay-renderer.js"),a=t("@maps/js-utils");n.prototype=a.inheritPrototype(o,n,{stringInfo:function(){var t=this.overlay;return"CircleOverlayNode<radius:"+t.radius+","+t.coordinate.toString().toLowerCase()+">"+(t.style.toString()?"["+t.style+"]":"")}}),e.exports=n},{"./circle-overlay-renderer.js":194,"./styled-overlay-node.js":213,"@maps/js-utils":82}],194:[function(t,e,i){function n(t){r.call(this,t)}function o(t,e,i,n,o,s,r){t.beginPath();var l=e.transformMapPoint(new a(i.x+n,i.y));s&&(s+=e.rotation),r&&(r-=e.rotation),t.arc(l.x,l.y,o,s||0,r||h,!0)}var s=t("../../../lib/geo").MapPoint,a=t("@maps/geometry/point"),r=t("./styled-overlay-renderer"),l=t("@maps/js-utils"),h=2*Math.PI;n.prototype=l.inheritPrototype(r,n,{drawShapes:function(t,e,i,n,s){var a=this._node.shapes[0],r=a[0],l=this._node.overlay._mapRadius,h=l*s.worldSize;h<.5||this.drawClipped(t,e,i,n,s,r,l,a.xOffset)||(o(t,s,r,a.xOffset,h),i&&this._node.overlay.fillPath(t,e),n&&this._node.overlay.strokePath(t,e,1))},drawClipped:function(t,e,i,n,r,l,c,d){function u(t,e){var i=w-t,n=b-e;return i*i+n*n<=c*c}var p=r.toRenderingMapRect();if(!n||c<p.size.width||c<p.size.height)return!1;var m,g=e._impl.halfStrokeWidthAtResolution()/r.worldSize,_=p.minX()-g-d,f=p.maxX()+g-d,y=p.minY()-g,v=p.maxY()+g,w=l.x,b=l.y,C=[];u(f,v)&&C.push(new s(f,v));var S=Math.acos((f-w)/c);if(!isNaN(S)){var k=b+c*Math.sin(S);k>=y&&k<=v&&((m=new s(f,k)).angle=S,C.push(m)),(k=b-c*Math.sin(S))>=y&&k<=v&&((m=new s(f,k)).angle=h-S,C.push(m))}u(f,y)&&C.push(new s(f,y));var E=Math.asin((y-b)/c);if(!isNaN(E)){var T=w+c*Math.cos(E);T>=_&&T<=f&&((m=new s(T,y)).angle=(E+h)%h,C.push(m)),(T=w-c*Math.cos(E))>=_&&T<=f&&((m=new s(T,y)).angle=Math.PI-E,C.push(m))}u(_,y)&&C.push(new s(_,y));var L=Math.acos((_-w)/c);if(!isNaN(L)){var M=b-c*Math.sin(L);M>=y&&M<=v&&((m=new s(_,M)).angle=h-L,C.push(m)),(M=b+c*Math.sin(L))>=y&&M<=v&&((m=new s(_,M)).angle=L,C.push(m))}u(_,v)&&C.push(new s(_,v));var x=Math.asin((v-b)/c);if(!isNaN(x)){var A=w-c*Math.cos(x);A>=_&&A<=f&&((m=new s(A,v)).angle=Math.PI-x,C.push(m)),(A=w+c*Math.cos(x))>=_&&A<=f&&((m=new s(A,v)).angle=(x+h)%h,C.push(m))}for(var I=C.length,O=1;I>2&&O<I&&(!isNaN(C[O-1].angle)||isNaN(C[O].angle)||isNaN(C[(O+1)%I].angle));)O+=1;if(O<I){for(var R=(O+1)%I;I>2&&!isNaN(C[R].angle)&&!isNaN(C[(R+1)%I].angle);)R=(R+1)%I;var P=c*r.worldSize,D=Math.abs(C[O].angle-C[R].angle),N=P*D-2*P*Math.sin(D/2)>.001,z=r.transformMapPoint(new a(C[O].x+d,C[O].y)),F=r.transformMapPoint(new a(C[R].x+d,C[R].y));if(i){N?o(t,r,l,d,P,C[O].angle,C[R].angle):(t.beginPath(),t.moveTo(z.x,z.y),t.lineTo(F.x,F.y));for(var j=(R+1)%I;isNaN(C[j].angle);j=(j+1)%I){var U=r.transformMapPoint(new a(C[j].x+d,C[j].y));t.lineTo(U.x,U.y)}this._node.overlay.fillPath(t,e)}n&&(N?o(t,r,l,d,P,C[O].angle,C[R].angle):(t.beginPath(),t.moveTo(z.x,z.y),t.lineTo(F.x,F.y)),this._node.overlay.strokePath(t,e))}else I>0&&i&&(t.fillStyle=e.fillColor,t.globalAlpha=e.fillOpacity,t.fillRect(0,0,p.size.width*r.worldSize,p.size.height*r.worldSize));return!0}}),e.exports=n},{"../../../lib/geo":4,"./styled-overlay-renderer":214,"@maps/geometry/point":71,"@maps/js-utils":82}],195:[function(t,e,i){function n(t,e,i){r(this,n)&&Object.defineProperty(this,"_impl",{value:new s(this,t,e,i)})}var o=t("./styled-overlay"),s=t("./circle-overlay-internal"),a=t("@maps/js-utils"),r=t("../check-instance-and-warn");n.prototype=a.inheritPrototype(o,n,{get coordinate(){return this._impl.coordinate},set coordinate(t){this._impl.coordinate=t},get radius(){return this._impl.radius},set radius(t){this._impl.radius=t}}),e.exports=n},{"../check-instance-and-warn":162,"./circle-overlay-internal":192,"./styled-overlay":215,"@maps/js-utils":82}],196:[function(t,e,i){function n(){this._overlays=[]}var o=t("@maps/js-utils"),s=t("@maps/scheduler");n.prototype={constructor:n,fadeOverlayTo:function(t,e){Object.prototype.hasOwnProperty.call(t,"fadeInOutOpacity")?t.fadeInOutOpacity.durationMs=350*Math.abs(t.fadeInOutOpacity.value-t.fadeInOutOpacity.end):(t.fadeInOutOpacity={durationMs:350},t.setFadeInOutOpacity(1-e),this._overlays.push(t)),t.fadeInOutOpacity.start=t.fadeInOutOpacity.value,t.fadeInOutOpacity.end=e,t.fadeInOutOpacity.startTime=Date.now(),s.scheduleASAP(this)},performScheduledUpdate:function(){var t=Date.now();this._overlays=this._overlays.filter(function(e){return e.setFadeInOutOpacity(o.clamp(e.fadeInOutOpacity.start+(e.fadeInOutOpacity.end-e.fadeInOutOpacity.start)*((t-e.fadeInOutOpacity.startTime)/e.fadeInOutOpacity.durationMs),0,1)),e.fadeInOutOpacity.value!==e.fadeInOutOpacity.end||(delete e.fadeInOutOpacity,!1)}),this._overlays.length>0&&s.scheduleOnNextFrame(this)}},e.exports=n},{"@maps/js-utils":82,"@maps/scheduler":100}],197:[function(t,e,i){function n(t){if(this._offsets=[[0],[1]],this._indices=[],this._lastUpdate=a++,"object"==typeof t)for(var e in t)this.addColorStop(parseFloat(e),t[e])}var o=t("../unsafe-dom"),s=t("@maps/js-utils"),a=0;n.UPDATE_EVENT="update-color-stop",n.prototype=s.inheritPrototype(o.EventTarget,n,{constructor:n,get offsets(){return this._offsets},get indices(){return this._indices},get lastUpdate(){return this._lastUpdate},addColorStop:function(t,e){if("number"!=typeof t||!(t>=0&&t<=1))throw new Error("[MapKit] Expected a number between 0 and 1 for offset of LineGradient.addColorStop, but got `"+t+"` instead.");s.checkType(e,"string","[MapKit] Expected a string value for color in LineGradient.addColorStop, but got `"+e+"` instead."),this._addColorStop(this._offsets,t,e)},addColorStopAtIndex:function(t,e){if("number"!=typeof t||t<0||t%1!=0)throw new Error("[MapKit] Expected a integer greater than or equal to 0 for index of LineGradient.addColorStopAtIndex, but got `"+t+"` instead.");s.checkType(e,"string","[MapKit] Expected a string value for color in LineGradient.addColorStopAtIndex, but got `"+e+"` instead."),this._addColorStop(this._indices,t,e)},toString:function(){return"LineGradient"},_addColorStop:function(t,e,i){for(var s=0,r=t.length;s<r&&t[s][0]<e;)++s;s<r&&t[s][0]===e?t[s][1]=i:t.splice(s,0,[e,i]),this._lastUpdate=a++,this.dispatchEvent(new o.Event(n.UPDATE_EVENT))}}),e.exports=n},{"../unsafe-dom":233,"@maps/js-utils":82}],198:[function(t,e,i){function n(t){s(this,n)&&Object.defineProperty(this,"_impl",{value:new o(t)})}var o=t("./line-gradient-internal.js"),s=t("../check-instance-and-warn");n.prototype={constructor:n,addColorStop:function(t,e){this._impl.addColorStop(t,e)},addColorStopAtIndex:function(t,e){this._impl.addColorStopAtIndex(t,e)},toString:function(){return this._impl.toString()}},e.exports=n},{"../check-instance-and-warn":162,"./line-gradient-internal.js":197}],199:[function(t,e,i){function n(t,e,i){this._node=t,this._public=e,i=s.checkOptions(i),a.forEach(function(t){t in i&&(this[t]=i[t])},this),Object.keys(i).forEach(function(t){a.indexOf(t)<0&&console.warn("[MapKit] Unknown option: "+t+". Use the data property to store custom data.")})}var o=t("../../../lib/geo").MapRect,s=t("@maps/js-utils"),a=["visible","enabled","selected","data"];n.prototype={constructor:n,delegate:null,_map:null,_visible:!0,_enabled:!0,_selected:!1,get map(){return this._map},set map(t){console.warn("[MapKit] The `map` property of an overlay is read-only. Use map.addOverlay() instead.")},get data(){return Object.prototype.hasOwnProperty.call(this,"_data")||(this._data={}),this._data},set data(t){this._data=t},get visible(){return this._visible},set visible(t){var e=!!t;this._visible!==e&&(this._visible=e,this.updatedProperty("visible"))},get enabled(){return this._enabled},set enabled(t){this._enabled=!!t},get selected(){return this._selected},set selected(t){var e=!!t;if(e!==this._selected){if(this.delegate&&!this.delegate.selectionMayChange)return void console.warn("[MapKit] Selection may not change in select/deselect event handler.");this._selected=e,this.updatedProperty("selected")}},get node(){return this._node},canBePicked:function(){return this.shown&&this._visible},setMap:function(t){t?this._map=t:this._map&&delete this._map},handleEvent:function(){},updatedProperty:function(t){this.delegate&&this.delegate.overlayPropertyDidChange(this._public,t)},visibleAfterClipping:function(t,e,i,n,s){this._node.shapes=[];var a=this.visibilityToleranceAtScale(i),r=this._boundingRect||this.boundingRectAtScale(i);if(!this.visible||r.maxY()+a<t.minY()||r.minY()-a>t.maxY())return!1;for(var l=r.minX()-a,h=r.maxX()+a,c=-1;c<=1;++c){var d=0===c?t:new o(t.origin.x-c,t.origin.y,t.size.width,t.size.height);if(h>=d.minX()&&l<=d.maxX()){var u=this.clipOverlay(d,e,i,n,s);u.length>0&&(u.xOffset=c,this._node.shapes.push(u))}}return this._node.shapes.length>0},visibilityToleranceAtScale:function(){return 0}},e.exports=n},{"../../../lib/geo":4,"@maps/js-utils":82}],200:[function(t,e,i){function n(t){o.BaseNode.call(this),this.overlay=t}var o=t("../../../lib/scene-graph"),s=t("@maps/js-utils");n.prototype=s.inheritPrototype(o.BaseNode,n,{}),e.exports=n},{"../../../lib/scene-graph":51,"@maps/js-utils":82}],201:[function(t,e,i){function n(t){Object.defineProperty(this,"_impl",{value:new a(null,this,t)})}var o=t("@maps/js-utils"),s=t("../public-dom"),a=t("./overlay-internal");n.Events={Select:"select",Deselect:"deselect"},n.prototype=o.inheritPrototype(s.EventTarget,n,{get map(){return this._impl.map},set map(t){this._impl.map=t},get data(){return this._impl.data},set data(t){this._impl.data=t},get visible(){return this._impl.visible},set visible(t){this._impl.visible=t},get enabled(){return this._impl.enabled},set enabled(t){this._impl.enabled=t},get selected(){return this._impl.selected},set selected(t){this._impl.selected=t}}),e.exports=n},{"../public-dom":219,"./overlay-internal":199,"@maps/js-utils":82}],202:[function(t,e,i){function n(t){o.GroupNode.call(this),this._controller=t}var o=t("../../../lib/scene-graph"),s=t("@maps/js-utils");n.prototype=s.inheritPrototype(o.GroupNode,n,{stringInfo:function(){return"OverlaysControllerNode"}}),e.exports=n},{"../../../lib/scene-graph":51,"@maps/js-utils":82}],203:[function(t,e,i){function n(t){o.call(this,t),this._node=new s(this),this._fadeAnimationController=new r}var o=t("../layer-items-controller"),s=t("./overlays-controller-node"),a=t("./overlay"),r=t("./fade-animation-controller"),l=t("./accuracy-ring-overlay"),h=t("../utils"),c=t("@maps/js-utils"),d=t("@maps/scheduler");n.prototype=c.inheritPrototype(o,n,{itemConstructor:a,itemName:"overlay",capitalizedItemName:"Overlay",get map(){return this._map},isItemExposed:function(t){return t!==this._userLocationAccuracyRingOverlay},removeUserLocationAccuracyRingOverlay:function(){this._userLocationAccuracyRingOverlay&&(this.removeAnyItem(this._userLocationAccuracyRingOverlay),delete this._userLocationAccuracyRingOverlay)},removedReferenceToMap:function(){this._items.forEach(function(t){t._impl.setMap(null)})},mapNodeTintWasSet:function(t){this._userLocationAccuracyRingOverlay&&(this._userLocationAccuracyRingOverlay.style.fillOpacity=h.darkColorScheme(t)?.4:.1)},mapCameraDidChange:function(){0!==this._items.length&&(d.scheduleASAP(this),this._deletePreviousPointForPickingItem())},overlayPropertyDidChange:function(t,e){switch(e){case"selected":t.selected?this.selectedItem=t:this.selectedItem=null,this._map.overlaySelectionDidChange(t),d.scheduleASAP(this);break;case"style":case"visible":case"geometry":d.scheduleASAP(this)}},fadeOverlayTo:function(t,e){this._fadeAnimationController.fadeOverlayTo(t,e)},updateUserLocationAccuracyRingOverlay:function(t){if(t.coordinate)return this._userLocationAccuracyRingOverlay?void this._userLocationAccuracyRingOverlay.updateForUserLocation(t):(this._userLocationAccuracyRingOverlay=this.addItem(new l(t)),void this.mapNodeTintWasSet(this._map.mapNodeTint))},addedItem:function(t,e){o.prototype.addedItem.call(this,t,e),t._impl.setMap(this._map.public),t.selected&&(this.selectedItem=t),d.scheduleASAP(this)},removedItem:function(t){t._impl.setMap(null),o.prototype.removedItem.call(this,t),d.scheduleASAP(this)},pickableItemsCloseToPoint:function(t,e,i){var n=document.createElement("canvas"),o=n.getContext("2d"),s=n.width=n.height=1,a=this._map.camera,r=s/2,l=e.x-r,c=e.y-r;o.translate(-l,-c);var d="number"==typeof i?i:this._selectionDistance/h.devicePixelRatio,u=!1;return t.filter(function(t){return!!t._impl.shown&&(u&&(o.clearRect(l,c,n.width,n.height),u=!1),t._impl.node._renderer.render(o,a,d),u=!0,!!o.getImageData(Math.floor(r),Math.floor(r),1,1).data[3])},this).reverse()},performScheduledUpdate:function(){var t=this.map;if(t){for(var e=t.camera.toRenderingMapRect(),i=t.worldSize,n=Math.ceil(c.log2(i)),o=[],s=this._items,a=0,r=s.length;a<r;++a){var l=s[a];l._impl.shown=l._impl.visibleAfterClipping(e,!0,i,n,!0),l._impl.shown&&!l.selected&&(o.push(l._impl.node),l._impl.node.needsDisplay=!0)}var h=this.selectedItem;h&&h._impl.shown&&(o.push(h._impl.node),h._impl.node.needsDisplay=!0),this._node.children=o}}}),e.exports=n},{"../layer-items-controller":185,"../utils":237,"./accuracy-ring-overlay":191,"./fade-animation-controller":196,"./overlay":201,"./overlays-controller-node":202,"@maps/js-utils":82,"@maps/scheduler":100}],204:[function(t,e,i){function n(t,e,i){h.call(this,new c(this),t,i),this.points=e,this.updateGeometry()}function o(t){var e=t.filter(function(t){return t.length>2}).map(function(t){var e=t.reduce(function(t,e){return e.x<t.xMin&&(t.xMin=e.x),e.x>t.xMax&&(t.xMax=e.x),e.y<t.yMin&&(t.yMin=e.y),e.y>t.yMax&&(t.yMax=e.y),t},{xMin:1/0,xMax:-1/0,yMin:1,yMax:0});return new l(e.xMin,e.yMin,e.xMax-e.xMin,e.yMax-e.yMin)}).sort(function(t,e){return t.minX()-e.minX()});return p.boundingRectForSortedRects(e)}function s(t,e,i){for(var n=e.minX()-i,o=e.minY()-i,s=e.maxX()+i,a=e.maxY()+i,r=[],l=0,h=t.length;l<h;++l){for(var c=t[l],d=[],u=0,p=c.length;u<p;++u){var m=c[u];(m.x>=n||c[(u-1+p)%p].x>=n||c[(u+1)%p].x>=n)&&d.push(m)}var g=[];for(u=0,p=d.length;u<p;++u)((m=d[u]).y>=o||d[(u-1+p)%p].y>=o||d[(u+1)%p].y>=o)&&g.push(m);var _=[];for(u=0,p=g.length;u<p;++u)((m=g[u]).x<=s||g[(u-1+p)%p].x<=s||g[(u+1)%p].x<=s)&&_.push(m);var f=[];for(u=0,p=_.length;u<p;++u)((m=_[u]).y<=a||_[(u-1+p)%p].y<=a||_[(u+1)%p].y<=a)&&f.push(m);f.length>2&&r.push(f)}return r}var a=t("../../../lib/geo"),r=a.Coordinate,l=a.MapRect,h=t("./styled-overlay-internal"),c=t("./polygon-overlay-node"),d=t("../line-simplification"),u=t("@maps/js-utils"),p=t("../types-internal");n.prototype=u.inheritPrototype(h,n,{get points(){return this._points.map(function(t){return t.slice()})},set points(t){u.checkArray(t,"[MapKit] PolygonOverlay.points expected an array of Coordinates."),Array.isArray(t[0])||(t=[t]),this._points=t.map(function(t,e){return u.checkArray(t,"[MapKit] PolygonOverlay.points expected an array at index: "+e),t.slice()}),this._polygons=this._points.map(function(t,e){return t.map(function(t,i){return u.checkInstance(t,r,"[MapKit] PolygonOverlay.points expected a Coordinate at index: "+e+", "+i),t.toUnwrappedMapPoint()})}),this.updateGeometry()},calculateBoundingRect:function(){var t=o(this._polygons);return delete this._simplifiedShapeLevel,t.size.width>1&&console.warn("[MapKit] Polygon overlay spans over 360Âº in longitude and may not render correctly."),this._polygons.forEach(function(e){0!==e.length&&(e.forEach(function(e){var i=u.mod(e.x,1);e.x=i+(i<t.minX()?1:0)}),d.preprocessPoints(e,!0))}),t},simplifyShapeAtLevel:function(t){var e=this._simplifiedShapeLevel>t?this._simplifiedShape:this._polygons,i=Math.pow(2,t);return e.reduce(function(t,e){var n=d.filterPointsAtScale(e,i);return n.length>0&&t.push(n),t},[])},clip:function(t,e,i){return!e||p.mapRectContains(e,this._boundingRect)?t:s(t,e,i)}}),e.exports=n},{"../../../lib/geo":4,"../line-simplification":186,"../types-internal":232,"./polygon-overlay-node":205,"./styled-overlay-internal":212,"@maps/js-utils":82}],205:[function(t,e,i){function n(t){s.call(this,t,!0)}function o(t){return t.map(function(t){return t.map(function(t){return t.toString()}).join(",")}).join("|")}var s=t("./styled-overlay-node.js"),a=t("@maps/js-utils");n.prototype=a.inheritPrototype(s,n,{stringInfo:function(){var t=this.overlay;return"PolygonOverlayNode<points:"+o(t.points)+">"+(t.style.toString()?"["+t.style+"]":"")}}),e.exports=n},{"./styled-overlay-node.js":213,"@maps/js-utils":82}],206:[function(t,e,i){function n(t,e){a(this,n)&&Object.defineProperty(this,"_impl",{value:new s(this,t,e)})}var o=t("./styled-overlay"),s=t("./polygon-overlay-internal"),a=t("../check-instance-and-warn"),r=t("@maps/js-utils");n.prototype=r.inheritPrototype(o,n,{get points(){return this._impl.points},set points(t){this._impl.points=t}}),e.exports=n},{"../check-instance-and-warn":162,"./polygon-overlay-internal":204,"./styled-overlay":215,"@maps/js-utils":82}],207:[function(t,e,i){function n(t,e,i){c.call(this,new d(this),t,i),this.points=e,this.updateGeometry()}function o(t,e,i){for(var n=t[i],o=null,s=i-1;!o;--s)void 0!==t[s]._offset&&(o=t[s]);var a=null;for(s=i+1;!a;++s)void 0!==t[s]._offset&&(a=t[s]);var r=Math.sqrt(Math.pow(o.x-n.x,2)+Math.pow(o.y-n.y,2));t[i]._offset=Math.min(o._offset+r/e,a._offset)}function s(t,e,i){for(var n,o=e.minX()-i,s=e.minY()-i,a=e.maxX()+i,r=e.maxY()+i,l=[],h=0,c=t.length;h<c-1;++h){var d,u=t[h],p=t[h+1],m=p.x-u.x;if(0!==m){var g=(o-u.x)/m,_=(a-u.x)/m;d=!(g<0&&_<0||g>1&&_>1)}else d=u.x>=o&&u.x<=a;if(d){var f=p.y-u.y;if(0!==f){var y=(s-u.y)/f,v=(r-u.y)/f;d=!(y<0&&v<0||y>1&&v>1)}else d=u.y>=s&&u.y<=r}d?(n||(n=[]),n.push(u)):n&&(n.push(u),l.push(n),n=null)}return n&&(n.push(p),l.push(n)),l}function a(t,e,i,n){if(i>=n)return[];for(var o=0,s=!1,a=[],r=0,l=t.length;r<l-1;++r){var h=t[r],c=t[r+1],d=e[r];if(o+=d,!s&&o>=i){s=!0;var u=(o-i)/d;h={x:u*h.x+(1-u)*c.x,y:u*h.y+(1-u)*c.y,_offset:u*h._offset+(1-u)*c._offset}}if(s&&(a.push(h),o>=n)){c={x:(u=(o-n)/d)*h.x+(1-u)*c.x,y:u*h.y+(1-u)*c.y,_offset:u*h._offset+(1-u)*c._offset};break}}return a.push(c),a}var r=t("../../../lib/geo"),l=r.Coordinate,h=r.MapRect,c=t("./styled-overlay-internal"),d=t("./polyline-overlay-node"),u=t("../line-simplification"),p=t("../types-internal"),m=t("@maps/js-utils");n.prototype=m.inheritPrototype(c,n,{_fillable:!1,get points(){return this._points.slice()},set points(t){m.checkInstance(t,Array,"[MapKit] PolylineOverlay.points expected an array of Coordinates."),this._points=t.slice(),this._mapPoints=this._points.map(function(t,e){return m.checkInstance(t,l,"[MapKit] PolylineOverlay.points expected a Coordinate at index: "+e),t.toUnwrappedMapPoint()}),this._pointsNeedRemapping=!0,delete this._distances,delete this._colorStops,this.updateGeometry()},calculateBoundingRect:function(){if(0===this._mapPoints.length)return new h(0,0,0,0);var t=this._mapPoints.reduce(function(t,e){return e.x<t.xMin&&(t.xMin=e.x),e.x>t.xMax&&(t.xMax=e.x),e.y<t.yMin&&(t.yMin=e.y),e.y>t.yMax&&(t.yMax=e.y),t},{xMin:1/0,xMax:-1/0,yMin:1,yMax:0}),e=t.xMax-t.xMin,i=m.mod(t.xMin,1);if(this._pointsNeedRemapping){delete this._pointsNeedRemapping,e>1&&console.warn("[MapKit] Polyline overlay spans over 360Âº in longitude and may not render correctly.");var n=t.xMin-i;this._mapPoints.forEach(function(t){t.x-=n}),u.preprocessPoints(this._mapPoints),delete this._simplifiedShapeLevel}return new h(i,t.yMin,e,t.yMax-t.yMin)},simplifyShapeAtLevel:function(t){delete this._distances;var e=this._simplifiedShapeLevel>t?this._simplifiedShape:this._mapPoints;return u.filterPointsAtScale(e,Math.pow(2,t))},clip:function(t,e,i){return t.length>0&&(t=this.clipShapeByStyleProperties(t)),!e||p.mapRectContains(e,this._boundingRect)?0===t.length?[]:[t]:s(t,e,i)},clipShapeByStyleProperties:function(t){var e=this.style._impl.strokeStart,i=this.style._impl.strokeEnd,n=this.style._impl.lineGradient;if(0!==e||1!==i||n){if(!this._distances||n&&!this._colorStops){this._length=0,this._distances=[];for(var o=0,s=t.length;o<s-1;++o){var r=t[o],l=t[o+1],h=Math.sqrt(Math.pow(r.x-l.x,2)+Math.pow(r.y-l.y,2));this._length+=h,this._distances.push(h)}if(n){if(n._impl.indices.length>0&&void 0!==this._mapPoints[0]._offset)for(var c=0,d=this._mapPoints.length;c<d;++c)delete this._mapPoints[c]._offset;for(var u=0,p=0;u<s-1;++u)t[u]._offset=p/this._length,p+=this._distances[u];s>0&&(t[s-1]._offset=1)}}0===e&&1===i||(t=a(t,this._distances,e*this._length,i*this._length))}return t},getColorStops:function(t){if(!this._colorStops||this._colorStops.lastUpdate!==t.lastUpdate){var e=t.offsets,i=t.indices;this._colorStops=e.slice(),this._colorStops.lastUpdate=t.lastUpdate;for(var n=0,s=this._mapPoints.length,a=0,r=i.length;n<this._colorStops.length&&a<r;++n,++a){var l=i[a],h=l[0];if(!(h<s))break;void 0===this._mapPoints[h]._offset&&o(this._mapPoints,this._length,h);for(var c=this._mapPoints[h]._offset,d=l[1];this._colorStops[n][0]<c;)++n;this._colorStops[n][0]===c?this._colorStops[n][1]=d:this._colorStops.splice(n,0,[c,d])}}return this._colorStops}}),e.exports=n},{"../../../lib/geo":4,"../line-simplification":186,"../types-internal":232,"./polyline-overlay-node":208,"./styled-overlay-internal":212,"@maps/js-utils":82}],208:[function(t,e,i){function n(t){s.call(this,t,!1)}function o(t){return t.map(function(t){return t.toString()}).join(",")}var s=t("./styled-overlay-node.js"),a=t("@maps/js-utils");n.prototype=a.inheritPrototype(s,n,{supportsLineGradient:!0,stringInfo:function(){var t=this.overlay;return"PolylineOverlayNode<points:"+o(t.points)+">"+(t.style.toString()?"["+t.style+"]":"")}}),e.exports=n},{"./styled-overlay-node.js":213,"@maps/js-utils":82}],209:[function(t,e,i){function n(t,e){a(this,n)&&Object.defineProperty(this,"_impl",{value:new s(this,t,e)})}var o=t("./styled-overlay"),s=t("./polyline-overlay-internal"),a=t("../check-instance-and-warn"),r=t("@maps/js-utils");n.prototype=r.inheritPrototype(o,n,{get points(){return this._impl.points},set points(t){this._impl.points=t}}),e.exports=n},{"../check-instance-and-warn":162,"./polyline-overlay-internal":207,"./styled-overlay":215,"@maps/js-utils":82}],210:[function(t,e,i){function n(t){a.checkOptions(t);for(var e in t){var i=Object.getOwnPropertyDescriptor(n.prototype,e);i&&i.set?this[e]=t[e]:console.warn("[MapKit] Style has no property named `"+e+"`, ignoring.")}}var o=t("../utils"),s=t("../unsafe-dom"),a=t("@maps/js-utils"),r=t("./line-gradient"),l=t("./line-gradient-internal"),h={lineCap:["butt","round","square"],lineJoin:["miter","round","bevel"],fillRule:["nonzero","evenodd"]};n.UPDATE_EVENT="update-style";n.prototype=a.inheritPrototype(s.EventTarget,n,{_strokeColor:"rgb(0, 122, 255)",_strokeOpacity:1,_strokeStart:0,_strokeEnd:1,_lineWidth:1,_lineCap:"round",_lineJoin:"round",_lineDash:[],_lineDashOffset:0,_lineGradient:null,_fillColor:"rgb(0, 122, 255)",_fillOpacity:.1,_fillRule:"nonzero",get strokeColor(){return this._strokeColor},set strokeColor(t){null!=t&&a.checkType(t,"string","[MapKit] Expected a string value for Style.strokeColor, but got `"+t+"` instead."),this._strokeColor!==t&&(this._strokeColor=t,this._updated())},get strokeOpacity(){return this._strokeOpacity},set strokeOpacity(t){a.checkType(t,"number","[MapKit] Expected a number value for Style.strokeOpacity, but got `"+t+"` instead.");var e=a.clamp(t,0,1);this._strokeOpacity!==e&&(this._strokeOpacity=e,this._updated())},get strokeStart(){return this._strokeStart},set strokeStart(t){if("number"!=typeof t||!(t>=0&&t<=1))throw new Error("[MapKit] Expected a number between 0 and 1 for Style.strokeStart, but got `"+t+"` instead.");this._strokeStart!==t&&(this._strokeStart=t,this._updated())},get strokeEnd(){return this._strokeEnd},set strokeEnd(t){if("number"!=typeof t||!(t>=0&&t<=1))throw new Error("[MapKit] Expected a number between 0 and 1 for Style.strokeEnd, but got `"+t+"` instead.");this._strokeEnd!==t&&(this._strokeEnd=t,this._updated())},get lineWidth(){return this._lineWidth},set lineWidth(t){a.checkType(t,"number","[MapKit] Expected a number value for Style.lineWidth, but got `"+t+"` instead.");var e=Math.max(0,t);this._lineWidth!==e&&(this._lineWidth=e,this._updated())},get lineCap(){return this._lineCap},set lineCap(t){var e=h.lineCap,i="[MapKit] Expected one of "+e.map(function(t){return"`"+t+"`"}).join(", ")+" for Style.lineCap, but got `"+t+"` instead.";if(a.checkType(t,"string",i),e.indexOf(t)<0)throw new TypeError(i);this._lineCap!==t&&(this._lineCap=t,this._updated())},get lineJoin(){return this._lineJoin},set lineJoin(t){var e=h.lineJoin,i="[MapKit] Expected one of "+e.map(function(t){return"`"+t+"`"}).join(", ")+" for Style.lineJoin, but got `"+t+"` instead.";if(a.checkType(t,"string",i),e.indexOf(t)<0)throw new TypeError(i);this._lineJoin!==t&&(this._lineJoin=t,this._updated())},get lineDash(){return this._lineDash},set lineDash(t){a.checkArray(t,"[MapKit] Expected an array of numbers for Style.lineDash, but got `"+t+"` instead."),t.forEach(function(t,e){a.checkType(t,"number","[MapKit] Expected an array of numbers for Style.lineDash, but got `"+t+"` at index "+e+" instead.")}),this._lineDash=t.slice(),this._updated()},get lineDashOffset(){return this._lineDashOffset},set lineDashOffset(t){a.checkType(t,"number","[MapKit] Expected a number value for Style.lineDashOffset, but got `"+t+"` instead."),this._lineDashOffset!==t&&(this._lineDashOffset=t,this._updated())},get lineGradient(){return this._lineGradient},set lineGradient(t){null!==t&&a.checkInstance(t,r,"[MapKit] Expected a LineGradient object value (or null) for Style.lineGradient, but got `"+t+"` instead."),this._lineGradient!==t&&(this._lineGradient&&this._lineGradient._impl.removeEventListener(l.UPDATE_EVENT,this),this._lineGradient=t,this._lineGradient&&this._lineGradient._impl.addEventListener(l.UPDATE_EVENT,this),this._updated())},colorStopsForOverlay:function(t){if(!this._lineGradient)return null;var e=this._lineGradient;return 0===e._impl.indices.length?e._impl.offsets:t.getColorStops(e._impl)},get fillColor(){return this._fillColor},set fillColor(t){null!=t&&a.checkType(t,"string","[MapKit] Expected a string value for Style.fillColor, but got `"+t+"` instead."),this._fillColor!==t&&(this._fillColor=t,this._updated())},get fillOpacity(){return this._fillOpacity},set fillOpacity(t){a.checkType(t,"number","[MapKit] Expected a number value for Style.fillOpacity, but got `"+t+"` instead.");var e=a.clamp(t,0,1);this._fillOpacity!==e&&(this._fillOpacity=e,this._updated())},get fillRule(){return this._fillRule},set fillRule(t){var e=h.fillRule,i="[MapKit] Expected one of "+e.map(function(t){return"`"+t+"`"}).join(", ")+" for Style.fillRule, but got `"+t+"` instead.";if(a.checkType(t,"string",i),e.indexOf(t)<0)throw new TypeError(i);this._fillRule!==t&&(this._fillRule=t,this._updated())},shouldStroke:function(){return(this.strokeColor||this.lineGradient)&&this.strokeOpacity>0&&this.lineWidth>0},shouldFill:function(){return this.fillColor&&this.fillOpacity>0},halfStrokeWidthAtResolution:function(){return this.strokeColor&&this.strokeOpacity>0?this.lineWidth/2*o.devicePixelRatio:0},styleForHitTesting:function(t){var e=Object.create(this);return null!=this._fillColor&&(e._fillColor="rgb(0, 122, 255)",e._fillOpacity=1),e._strokeColor="rgb(0, 122, 255)",e._strokeOpacity=1,e._lineWidth=this.lineWidth+t,e._impl=e,e},toString:function(){return["strokeColor","strokeOpacity","strokeStart","strokeEnd","lineWidth","lineCap","lineJoin","lineDash","lineDashOffset","lineGradient","fillColor","fillOpacity","fillRule"].filter(function(t){return Object.prototype.hasOwnProperty.call(this,"_"+t)},this).map(function(t){return t+":"+(Array.isArray(this[t])?JSON.stringify(this[t]):this.prop&&this[t].toString?this[t].toString():this[t])},this).join(",")},handleEvent:function(t){t.type===l.UPDATE_EVENT&&this._updated()},_updated:function(){this.dispatchEvent(new s.Event(n.UPDATE_EVENT))}}),e.exports=n},{"../unsafe-dom":233,"../utils":237,"./line-gradient":198,"./line-gradient-internal":197,"@maps/js-utils":82}],211:[function(t,e,i){function n(t){s(this,n)&&Object.defineProperty(this,"_impl",{value:new o(t)})}var o=t("./style-internal.js"),s=t("../check-instance-and-warn");n.prototype={constructor:n,get strokeColor(){return this._impl.strokeColor},set strokeColor(t){this._impl.strokeColor=t},get strokeOpacity(){return this._impl.strokeOpacity},set strokeOpacity(t){this._impl.strokeOpacity=t},get lineWidth(){return this._impl.lineWidth},set lineWidth(t){this._impl.lineWidth=t},get lineCap(){return this._impl.lineCap},set lineCap(t){this._impl.lineCap=t},get lineJoin(){return this._impl.lineJoin},set lineJoin(t){this._impl.lineJoin=t},get lineDash(){return this._impl.lineDash},set lineDash(t){this._impl.lineDash=t},get lineDashOffset(){return this._impl.lineDashOffset},set lineDashOffset(t){this._impl.lineDashOffset=t},get fillColor(){return this._impl.fillColor},set fillColor(t){this._impl.fillColor=t},get fillOpacity(){return this._impl.fillOpacity},set fillOpacity(t){this._impl.fillOpacity=t},get fillRule(){return this._impl.fillRule},set fillRule(t){this._impl.fillRule=t},toString:function(){return this._impl.toString()}},e.exports=n},{"../check-instance-and-warn":162,"./style-internal.js":210}],212:[function(t,e,i){function n(t,e,i){if(i&&"object"==typeof i&&"style"in i){this.style=i.style;var n={};Object.keys(i).forEach(function(t){"style"!==t&&(n[t]=i[t])}),i=n}o.call(this,t,e,i)}var o=t("./overlay-internal"),s=t("./style"),a=t("./style-internal"),r=t("../utils"),l=t("@maps/js-utils");n.prototype=l.inheritPrototype(o,n,{constructor:n,_fillable:!0,fadeInOutOpacity:{value:1},get style(){return this._style||(this._style=new s,this._style._impl.addEventListener(a.UPDATE_EVENT,this)),this._style},set style(t){if(this._style){if(this._style===t)return;this._style._impl.removeEventListener(a.UPDATE_EVENT,this)}l.checkInstance(t,s,"[MapKit] Expected a mapkit.Style value for Overlay.style, but got `"+t+"` instead."),this._style!==t&&(this._style=t,this._style&&this._style._impl.addEventListener(a.UPDATE_EVENT,this),this.updatedProperty("style"))},visibilityToleranceAtScale:function(t){return this.style._impl.halfStrokeWidthAtResolution()/t},clipOverlay:function(t,e,i,n,o){if(this._simplifiedShapeLevel!==n){var s=Math.abs(this._simplifiedShapeLevel-n),a=!!this._hasPoints,r=this._simplifiedShape;this._simplifiedShape=this.simplifyShapeAtLevel(n),this._simplifiedShapeLevel=n,this._hasPoints=this._simplifiedShape.length>0,1===s&&a!==this._hasPoints&&(this.delegate.fadeOverlayTo(this,a?0:1),a&&(this.fadeInOutOpacity.previousShape=this.clip(r)))}var l=this.fadeInOutOpacity.previousShape||(e||!this.clippedShape?this.clip(this._simplifiedShape,t,this.style._impl.halfStrokeWidthAtResolution()/i):this.clippedShape);return o&&(this.clippedShape=l),l},setFadeInOutOpacity:function(t){this.fadeInOutOpacity.value=t,this.updatedProperty("style")},handleEvent:function(t){t.type===a.UPDATE_EVENT&&this.updatedProperty("style")},fillPath:function(t,e){t.save(),t.fillStyle=e.fillColor,t.globalAlpha=e.fillOpacity*this.fadeInOutOpacity.value,t.fill(e.fillRule),t.restore()},strokePath:function(t,e,i,n){t.save(),t.strokeStyle=n||e.strokeColor,t.globalAlpha=e.strokeOpacity*this.fadeInOutOpacity.value;var o=i||r.devicePixelRatio;t.lineWidth=e.lineWidth*o,e.lineDash.length>0&&"function"==typeof t.setLineDash&&(t.setLineDash(e.lineDash.map(function(t){return t*o})),t.lineDashOffset=e.lineDashOffset*o),t.lineJoin=e.lineJoin,t.lineCap=e.lineCap,t.stroke(),t.restore()},updateGeometry:function(){var t=this.calculateBoundingRect();t&&(this._boundingRect=t,this.updatedProperty("geometry"))}}),e.exports=n},{"../utils":237,"./overlay-internal":199,"./style":211,"./style-internal":210,"@maps/js-utils":82}],213:[function(t,e,i){function n(t,e,i){o.call(this,t),this._closed=!!e,this._renderer=i||new s(this)}var o=t("./overlay-node.js"),s=t("./styled-overlay-renderer.js"),a=t("@maps/js-utils");n.prototype=a.inheritPrototype(o,n,{get closed(){return this._closed}}),e.exports=n},{"./overlay-node.js":200,"./styled-overlay-renderer.js":214,"@maps/js-utils":82}],214:[function(t,e,i){function n(t){a.RenderItem.call(this,t)}function o(t){return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"}function s(t,e,i){var n=1-i;return[Math.round(t[0]*n+e[0]*i),Math.round(t[1]*n+e[1]*i),Math.round(t[2]*n+e[2]*i),Math.round(t[3]*n+e[3]*i)]}var a=t("../../../lib/scene-graph"),r=t("@maps/js-utils"),l=t("@maps/geometry/point");n.prototype=r.inheritPrototype(a.RenderItem,n,{draw:function(t){if(this._node.overlay.map){var e=this._node.overlay.map._impl.camera;this.render(t,e)}},render:function(t,e,i){var n=this._node.overlay.style;"number"==typeof i&&(n=n._impl.styleForHitTesting(i));var o=this._node.closed&&n._impl.shouldFill(),s=n._impl.shouldStroke();(o||s)&&this.drawShapes(t,n,o,s,e)},drawShapes:function(t,e,i,n,o){e._impl.lineGradient&&this._node.supportsLineGradient?n&&this.drawGradient(t,e,o):(t.beginPath(),this._node.shapes.forEach(function(e){e.forEach(function(i){var n=o.transformMapPoint(new l(i[0].x+e.xOffset,i[0].y));t.moveTo(n.x,n.y);for(var s=1,a=i.length;s<a;s++)n=o.transformMapPoint(new l(i[s].x+e.xOffset,i[s].y)),t.lineTo(n.x,n.y);this._node.closed&&t.closePath()},this)},this),i&&this._node.overlay.fillPath(t,e),n&&this._node.overlay.strokePath(t,e,1))},drawGradient:function(t,e,i){var n=e._impl.colorStopsForOverlay(this._node.overlay),a=0;this._node.shapes.forEach(function(r){r.forEach(function(c){for(var d=[];c[0]._offset>n[a][0];)_=n[++a][0];for(var u=0,p=c.length;u<p;){var m=c[u]._offset,g=i.transformMapPoint(new l(c[u].x+r.xOffset,c[u].y)),_=n[a][0],f=h.normalize(n[a][1]||e.strokeColor);if(m===_)d.push([m,g,f]),++u,++a;else if(m<_){var y=n[a-1],v=y[0],w=y[1]||e.strokeColor,b=o(s(h.stringToRGBA(w),h.stringToRGBA(f),(m-v)/(_-v)));d.push([m,g,b]),++u}else d[d.length-1].push([_,f]),++a}this.strokePathForLineEvents(t,d,e)},this)},this)},strokePathForLineEvents:function(t,e,i){for(var n=0,o=e.length-1;n<o;++n){t.beginPath();var s=e[n],a=s[1],l=e[n+1][1];t.moveTo(a.x,a.y),t.lineTo(l.x,l.y);var h=t.createLinearGradient(a.x,a.y,l.x,l.y);if(h.addColorStop(0,s[2]),s.length>2)for(var c=s[0],d=e[n+1][0]-c,u=3;u<s.length;++u)h.addColorStop(r.clamp((s[u][0]-c)/d,0,1),s[u][1]||i.strokeColor);h.addColorStop(1,e[n+1][2]),this._node.overlay.strokePath(t,i,1,h)}}});var h={colorMap:{},normalize:function(t){return o(this.stringToRGBA(t))},stringToRGBA:function(t){if(t in this.colorMap)return this.colorMap[t];if(!this.context){var e=document.createElement("canvas");this.context=e.getContext("2d")}this.context.canvas.width=1,this.context.fillStyle=t,this.context.fillRect(0,0,1,1);var i=this.context.getImageData(0,0,1,1).data,n=[i[0],i[1],i[2],i[3]];return this.colorMap[t]=n,n}};e.exports=n},{"../../../lib/scene-graph":51,"@maps/geometry/point":71,"@maps/js-utils":82}],215:[function(t,e,i){function n(t){Object.defineProperty(this,"_impl",{value:new s(this,t)})}var o=t("./overlay"),s=t("./styled-overlay-internal"),a=t("@maps/js-utils");n.prototype=a.inheritPrototype(o,n,{constructor:n,get style(){return this._impl.style},set style(t){this._impl.style=t}}),e.exports=n},{"./overlay":201,"./styled-overlay-internal":212,"@maps/js-utils":82}],216:[function(t,e,i){function n(){if(s(this,n)){var t=arguments.length;if(1===t&&"object"==typeof arguments[0]){this.top=0,this.right=0,this.bottom=0,this.left=0;var e=arguments[0];Object.keys(e).forEach(function(t){"top"===t||"right"===t||"bottom"===t||"left"===t?this[t]=e[t]:console.warn("[MapKit] Unknown property `"+t+"` for Padding constructor.")},this)}else this.top=t>0?arguments[0]:0,this.right=t>1?arguments[1]:0,this.bottom=t>2?arguments[2]:0,this.left=t>3?arguments[3]:0;o.checkType(this.top,"number","[MapKit] Expected a number for `top` in Padding constructor but got `"+this.top+"` instead."),o.checkType(this.left,"number","[MapKit] Expected a number for `left` in Padding constructor but got `"+this.left+"` instead."),o.checkType(this.bottom,"number","[MapKit] Expected a number for `bottom` in Padding constructor but got `"+this.bottom+"` instead."),o.checkType(this.right,"number","[MapKit] Expected a number for `right` in Padding constructor but got `"+this.right+"` instead.")}}var o=t("@maps/js-utils"),s=t("./check-instance-and-warn");n.Zero=new n,n.prototype={constructor:n,toString:function(){return"Padding("+[this.top,this.right,this.bottom,this.left].join(", ")+")"},copy:function(){return new n(this.top,this.right,this.bottom,this.left)},equals:function(t){return this.top===t.top&&this.right===t.right&&this.bottom===t.bottom&&this.left===t.left}},e.exports=n},{"./check-instance-and-warn":162,"@maps/js-utils":82}],217:[function(t,e,i){e.exports={Airport:"Airport",AmusementPark:"AmusementPark",Aquarium:"Aquarium",ATM:"ATM",Bakery:"Bakery",Bank:"Bank",Beach:"Beach",Brewery:"Brewery",Cafe:"Cafe",Campground:"Campground",CarRental:"CarRental",EVCharger:"EVCharger",FireStation:"FireStation",FitnessCenter:"FitnessCenter",FoodMarket:"FoodMarket",GasStation:"GasStation",Hospital:"Hospital",Hotel:"Hotel",Laundry:"Laundry",Library:"Library",Marina:"Marina",MovieTheater:"MovieTheater",Museum:"Museum",NationalPark:"NationalPark",Nightlife:"Nightlife",Park:"Park",Parking:"Parking",Pharmacy:"Pharmacy",Police:"Police",PostOffice:"PostOffice",PublicTransport:"PublicTransport",Restaurant:"Restaurant",Restroom:"Restroom",School:"School",Stadium:"Stadium",Store:"Store",Theater:"Theater",University:"University",Winery:"Winery",Zoo:"Zoo"}},{}],218:[function(t,e,i){function n(t){return t.map(function(t){if(!s.checkValueIsInEnum(t,a))throw new Error("[MapKit] Unknown category `"+t+"`. Choose from mapkit.PointOfInterestCategory.");return t})}function o(t){if("includes"in(t=s.checkOptions(t))&&"excludes"in t)throw new Error("[MapKit] `includes` and `excludes` may not be specified at the same time.");if(!("includes"in t||"excludes"in t))throw new Error("[MapKit] Either `includes` or `excludes` should be specified.");"includes"in t&&(this._includes=n(t.includes)),"excludes"in t&&(this._excludes=n(t.excludes))}var s=t("@maps/js-utils"),a=t("./point-of-interest-category"),r=function(){throw new Error("[MapKit] `PointOfInterestFilter` may not be constructed directly. Use the mapkit.PointOfInterestFilter.including or the mapkit.PointOfInterestFilter.excluding methods.")};o.prototype=r.prototype={constructor:r,_includes:null,_excludes:null,includesCategory:function(t){if(!s.checkValueIsInEnum(t,a))throw new Error("[MapKit] Unknown category `"+t+"`. Choose from mapkit.PointOfInterestCategory.");return this._includes?-1!==this._includes.indexOf(t):this._excludes?-1===this._excludes.indexOf(t):void 0},excludesCategory:function(t){if(!s.checkValueIsInEnum(t,a))throw new Error("[MapKit] Unknown category `"+t+"`. Choose from mapkit.PointOfInterestCategory.");return this._includes?-1===this._includes.indexOf(t):this._excludes?-1!==this._excludes.indexOf(t):void 0}},Object.defineProperties(r,{including:{get:function(){return o.including}},excluding:{get:function(){return o.excluding}}}),Object.defineProperties(o,{exposedConstructor:{value:r},including:{value:function(t){return s.checkArray(t,"[MapKit] mapkit.pointOfInterestFilterIncludingCategories expected an array of categories."),new o({includes:t})}},excluding:{value:function(t){return s.checkArray(t,"[MapKit] mapkit.pointOfInterestFilterExcludingCategories expected an array of categories."),new o({excludes:t})}},filterIncludingAllCategories:{get:function(){var t=this.excluding([]);return Object.defineProperty(this,"filterIncludingAllCategories",{value:t}),t},configurable:!0},filterExcludingAllCategories:{get:function(){var t=this.including([]);return Object.defineProperty(this,"filterExcludingAllCategories",{value:t}),t},configurable:!0}}),e.exports=o},{"./point-of-interest-category":217,"@maps/js-utils":82}],219:[function(t,e,i){function n(){}var o=t("@maps/dom-events"),s=t("./call-function-safely");(n.prototype=Object.create(o.EventTarget.prototype)).dispatchEvent=function(t){return s(o.EventTarget.prototype.dispatchEvent,this,[t],!0)};var a={EventTarget:n,Event:o.Event};e.exports=a},{"./call-function-safely":161,"@maps/dom-events":64}],220:[function(t,e,i){function n(t){t=c.checkOptions(t),this._checkOptions(t,u),d.call(this,"Directions",t)}function o(t,e){return t instanceof Date&&!isNaN(t.getTime())||(console.warn("[MapKit] Expected a `Date` object for `"+e+"`, but got `"+t+"` instead."),!1)}function s(t){if("string"==typeof t)return{q:t};if("object"==typeof t&&t.muid)return{muid:t.muid};var e=t.coordinate||t;if(e instanceof h)return{loc:{lat:e.latitude,lng:e.longitude}};throw new Error("[MapKit] Location must be an address (string), Coordinate object or Place object.")}function a(t,e,i){this.name=t.name,this.distance=t.distanceMeters,this.expectedTravelTime=t.durationSeconds,this.transportType=t.transportType,this._path=t.stepIndexes.map(function(t){return i[t]}),this.steps=t.stepIndexes.map(function(t){return e[t]})}function r(t,e,i){if(this.instructions=t.instructions,this.pathIndex=t.stepPathIndex,this.distance=t.distanceMeters,this.transportType=t.transportType,this.path=e[t.stepPathIndex],i&&i.length&&t.maneuver){var n,o,s=i[t.stepPathIndex%i.length],a=t.maneuver;if(a.names&&a.names.length){var r=a.names.filter(function(t){return t.type&&t.shieldUrl});r.length&&(n="//"+s+r[0].shieldUrl)}a.arrowUrl&&(o="//"+s+a.arrowUrl);var l=n&&-1!==g.indexOf(a.type);this._imageUrl=l?n:o}}var l=t("../configuration"),h=t("../../../lib/geo").Coordinate,c=t("@maps/js-utils"),d=t("./service-internal"),u=["language"],p=["origin","destination","transportType","requestsAlternateRoutes","arrivalDate","departureDate"],m=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty);n.Transport={Automobile:"AUTOMOBILE",Walking:"WALKING"},n.prototype=c.inheritPrototype(d,n,{constructor:n,route:function(t,e){c.required(t,"[MapKit] Missing `request` in call to `Directions.route()`.").checkOptions(t,"[MapKit] `request` is not a valid object."),c.required(e,"[MapKit] Missing `callback` in call to `Directions.route()`.").checkType(e,"function","[MapKit] `callback` passed to `Directions.route()` is not a function."),this._checkOptions(t,p);var i={},a=t.origin,r=t.destination,h=t.transportType,d=t.arrivalDate,u=t.departureDate;c.required(a,"[MapKit] Missing required property `origin` in `request` object."),c.required(r,"[MapKit] Missing required property `destination` in `request` object."),i.wps=JSON.stringify([s(a),s(r)]),h&&(h===n.Transport.Automobile||h===n.Transport.Walking?i.transport=h:console.warn("[MapKit] transportType must be either Directions.Transport.Automobile or Directions.Transport.Walking.")),d&&u?console.warn("[MapKit] `Directions.route()` should not be sent an `arrivalDate` and `departureDate` in the same request. These parameters have been dropped from the request."):"CN"===l.countryCode&&(d||u)?console.warn("[MapKit] `arrivalDate` and `departureDate` are not supported in China yet. These parameters have been dropped from the request."):d?o(d,"arrivalDate")&&(i.arrivalDate=d.toISOString()):u&&o(u,"departureDate")&&(i.departureDate=u.toISOString()),m(t,"requestsAlternateRoutes")?i.n=t.requestsAlternateRoutes?"3":"1":i.n="1";var g=this.language||l.language;return g&&(i.lang=g),this._send("directions",i,e,this._handleResponse,"directions")},_handleResponse:function(t,e){var i=e.stepPaths.map(function(t){return t.map(function(t){return new h(t.lat,t.lng)})}),n=e.steps.map(function(t){return new r(t,i,e.shieldDomains)});return{request:t,routes:e.routes.map(function(t){return new a(t,n,i)})}}}),a.prototype={get path(){return console.warn("[MapKit] The `Route.path` property is deprecated and will be removed in a future release."),this._path}},n.Route=a;var g=["ON_RAMP","OFF_RAMP","HIGHWAY_OFF_RAMP_LEFT","HIGHWAY_OFF_RAMP_RIGHT","CHANGE_HIGHWAY","CHANGE_HIGHWAY_LEFT","CHANGE_HIGHWAY_RIGHT"];e.exports=n},{"../../../lib/geo":4,"../configuration":165,"./service-internal":227,"@maps/js-utils":82}],221:[function(t,e,i){function n(t){r(this,n)&&Object.defineProperty(this,"_impl",{value:new a(t)})}var o=t("@maps/js-utils"),s=t("./service"),a=t("./directions-internal"),r=t("../check-instance-and-warn");n.Transport=a.Transport,n.prototype=o.inheritPrototype(s,n,{constructor:n,route:function(t,e){return this._impl.route(t,e)}}),e.exports=n},{"../check-instance-and-warn":162,"./directions-internal":220,"./service":228,"@maps/js-utils":82}],222:[function(t,e,i){"use strict";function n(t){t=s.checkOptions(t),this._checkOptions(t,c),r.call(this,"Geocoder",t)}var o=t("../configuration"),s=t("@maps/js-utils"),a=t("../../../lib/geo"),r=t("./service-internal"),l=a.BoundingRegion,h=a.Coordinate,c=["language","getsUserLocation"],d=["language","region","coordinate","limitToCountries"],u=["language"];n.prototype=s.inheritPrototype(r,n,{constructor:n,lookup:function(t,e,i){var n={};i=s.checkOptions(i),this._checkOptions(i,d),s.required(t,"[MapKit] Missing `address` in call to `Geocoder.lookup()`.").checkType(t,"string","[MapKit] `address` passed to `Geocoder.lookup()` is not a string."),s.required(e,"[MapKit] Missing `callback` in call to `Geocoder.lookup()`.").checkType(e,"function","[MapKit] `callback` passed to `Geocoder.lookup()` is not a function."),n.q=t;var a=i.region,r=i.coordinate,l=i.limitToCountries,h=this.language||o.language;if(a){var c=a.toBoundingRegion();n.searchRegion=[c.northLatitude,c.eastLongitude,c.southLatitude,c.westLongitude].join(",")}else r&&(n.searchLocation=[r.latitude,r.longitude].join(","));return i.language&&(h=this._bestLanguage(i.language)),h&&(n.lang=h),l&&(s.checkType(l,"string","[MapKit] `limitToCountries` is not a string."),n.limitToCountries=l),this._sendImmediatelyOrWithUserLocation("geocode",n,e,this._transform,"geocode")},reverseLookup:function(t,e,i){var n={},a=this.language||o.language;return i=s.checkOptions(i),this._checkOptions(i,u),s.required(t,"[MapKit] Missing `coordinate` in call to `Geocoder.reverseLookup()`.").checkInstance(t,h,"[MapKit] `coordinate` passed to `Geocoder.reverseLookup()` is not a Coordinate."),s.required(e,"[MapKit] Missing `callback` in call to `Geocoder.reverseLookup()`.").checkType(e,"function","[MapKit] `callback` passed to `Geocoder.reverseLookup()` is not a function."),n.loc=t.latitude+","+t.longitude,i.language&&(a=this._bestLanguage(i.language)),a&&(n.lang=a),this._send("reverseGeocode",n,e,this._transform,"reverseGeocode")},_transform:function(t,e){var i={status:e.status,results:[]};return e.results&&(i.results=e.results.map(function(t){var e,i,n={};return t.displayMapRegion&&(e=t.displayMapRegion,i=new l(e.northLat,e.eastLng,e.southLat,e.westLng),n.region=i.toCoordinateRegion(),n.coordinate=n.region.center),t.formattedAddressLines&&(n.formattedAddress=t.formattedAddressLines.join(", ")),t.center&&(n.coordinate=new h(t.center.lat,t.center.lng)),t.countryCode&&(n.countryCode=t.countryCode),t.geocodeAccuracy&&(n.geocodeAccuracy=t.geocodeAccuracy),n.name=t.name,n.telephone=t.telephone,n.urls=t.urls||[],n.country=t.country,n.administrativeArea=t.administrativeArea,n.administrativeAreaCode=t.administrativeAreaCode,n.locality=t.locality,n.postCode=t.postCode,n.subLocality=t.subLocality,n.thoroughfare=t.thoroughfare,n.subThoroughfare=t.subThoroughfare,n.fullThoroughfare=t.fullThoroughfare,n.areasOfInterest=t.areasOfInterest,n.dependentLocalities=t.dependentLocalities,n.timezone=t.timezone,n.timezoneSecondsFromGmt=t.timezoneSecondsFromGmt,n})),i}}),e.exports=n},{"../../../lib/geo":4,"../configuration":165,"./service-internal":227,"@maps/js-utils":82}],223:[function(t,e,i){function n(t){r(this,n)&&Object.defineProperty(this,"_impl",{value:new a(t)})}var o=t("@maps/js-utils"),s=t("./service"),a=t("./geocoder-internal"),r=t("../check-instance-and-warn");n.prototype=o.inheritPrototype(s,n,{constructor:n,lookup:function(t,e,i){return this._impl.lookup(t,e,i)},reverseLookup:function(t,e,i){return this._impl.reverseLookup(t,e,i)}}),e.exports=n},{"../check-instance-and-warn":162,"./geocoder-internal":222,"./service":228,"@maps/js-utils":82}],224:[function(t,e,i){function n(){this._requests={},this._types={},this._counter=1}n.prototype={constructor:n,add:function(t,e){var i=this._counter;return this._counter+=1,this._requests[i]=t,this._types[i]=e,i},get:function(t){return this._requests[t]},typeForId:function(t){return this._types[t]},idsByType:function(t){return Object.keys(this._requests).filter(function(e){return this._types[e]===t},this).map(function(t){return parseInt(t)})},remove:function(t){return!!this.get(t)&&(delete this._requests[t],delete this._types[t],!0)}},e.exports=n},{}],225:[function(t,e,i){function n(t){this.displayLines=t.displayLines,t.location&&(this.coordinate=new p(t.location.lat,t.location.lng)),this._completionUrl=t.completionUrl,t.attribution&&(this._providerId=t.attribution.vendorId,this._providerItemId=t.attribution.externalItemId),this.name=t.name,this.telephone=t.telephone,this.urls=t.urls||[],this.country=t.country,this.administrativeArea=t.administrativeArea,this.administrativeAreaCode=t.administrativeAreaCode,this.locality=t.locality,this.postCode=t.postCode,this.subLocality=t.subLocality,this.thoroughfare=t.thoroughfare,this.subThoroughfare=t.subThoroughfare,this.fullThoroughfare=t.fullThoroughfare,this.areasOfInterest=t.areasOfInterest,this.dependentLocalities=t.dependentLocalities,this.timezone=t.timezone,this.timezoneSecondsFromGmt=t.timezoneSecondsFromGmt}function o(t){t=a.checkOptions(t),this._checkOptions(t,m),l.call(this,"Search",t),this.coordinate=t.coordinate,this.region=t.region,"includeAddresses"in t&&(this.includeAddresses=t.includeAddresses),"includePointsOfInterest"in t&&(this.includePointsOfInterest=t.includePointsOfInterest),"includeQueries"in t&&(this.includeQueries=t.includeQueries),"pointOfInterestFilter"in t&&(this.pointOfInterestFilter=t.pointOfInterestFilter)}var s=t("../configuration"),a=t("@maps/js-utils"),r=t("../../../lib/geo"),l=t("./service-internal"),h=t("../point-of-interest-category"),c=t("../point-of-interest-filter"),d=r.BoundingRegion,u=r.CoordinateRegion,p=r.Coordinate,m=["language","getsUserLocation","coordinate","region","includeAddresses","includePointsOfInterest","includeQueries","pointOfInterestFilter"],g=["language","region","coordinate","includeAddresses","includePointsOfInterest","pointOfInterestFilter"],_=g.concat(["includeQueries"]),f=function(){throw new TypeError("[MapKit] SearchAutocompleteResult may not be constructed.")};n.prototype=f.prototype={constructor:f},o.prototype=a.inheritPrototype(l,o,{constructor:o,_coordinate:null,_region:null,_includeAddresses:!0,_includePointsOfInterest:!0,_includeQueries:!0,_pointOfInterestFilter:null,get coordinate(){return this._coordinate},set coordinate(t){null!=t&&(a.checkInstance(t,p,"[MapKit] Search.coordinate expected a Coordinate value."),t=t.copy()),this._coordinate=t||null},get region(){return this._region},set region(t){null!=t&&(a.checkInstance(t,u,"[MapKit] Search.region expected a CoordinateRegion value."),t=t.copy()),this._region=t||null},get includeAddresses(){return this._includeAddresses},set includeAddresses(t){this._includeAddresses=!!t},get includePointsOfInterest(){return this._includePointsOfInterest},set includePointsOfInterest(t){this._includePointsOfInterest=!!t},get includeQueries(){return this._includeQueries},set includeQueries(t){this._includeQueries=!!t},get pointOfInterestFilter(){return this._pointOfInterestFilter},set pointOfInterestFilter(t){t&&a.checkInstance(t,c,"[MapKit] Unknown value for `pointOfInterestFilter`. It must be an instance of mapkit.PointOfInterestFilter."),this._pointOfInterestFilter=t||null},search:function(t,e,i){return i=a.checkOptions(i),this._checkOptions(i,g),this._request("search","search",this._searchTransform,t,e,i)},autocomplete:function(t,e,i){i=a.checkOptions(i),this._checkOptions(i,_),this._request("autocomplete","searchAutocomplete",this._autocompleteTransform,t,e,i)},_request:function(t,e,i,o,r,l){if("object"==typeof r){var h=r;r=function(e,i){var n="search"===t?h.searchDidError:h.autocompleteDidError,o="search"===t?h.searchDidComplete:h.autocompleteDidComplete;e?"function"==typeof n&&n.call(h,e):"function"==typeof o&&o.call(h,i)}}var d={},u="Search."+t+"()";if(a.required(o,"[MapKit] Missing `query` in call to `"+u+"`."),a.required(r,"[MapKit] Missing `callback` in call to `"+u+"`.").checkType(r,"function","[MapKit] `callback` passed to `"+u+"` is not a function."),o instanceof n)e=o._completionUrl;else{if("string"!=typeof o)throw new TypeError("[MapKit] `query` passed to `"+u+"` is neither a string nor SearchAutocompleteResult.");d.q=o}var p=l.region||this.region,m=l.coordinate||this.coordinate,g=this.language||s.language;if(p){var _=p.toBoundingRegion();d.searchRegion=[_.northLatitude,_.eastLongitude,_.southLatitude,_.westLongitude].join(",")}else m&&(d.searchLocation=[m.latitude,m.longitude].join(","));l.language&&(g=this._bestLanguage(l.language)),g&&(d.lang=g),l.pointOfInterestFilter&&a.checkInstance(l.pointOfInterestFilter,c,"[MapKit] Unknown value for `pointOfInterestFilter`. It must be an instance of mapkit.PointOfInterestFilter.");var f=l.pointOfInterestFilter||this.pointOfInterestFilter;f&&(l.includePointsOfInterest||this.includePointsOfInterest||console.warn("[MapKit] `includePointsOfInterest` is false but `pointOfInterestFilter` is set."),f._includes&&(d.includePoiCategories=f._includes.join(",")),f._excludes&&(d.excludePoiCategories=f._excludes.join(",")));var y=[];if("includeAddresses"in l?l.includeAddresses&&y.push("address"):this.includeAddresses&&y.push("address"),f?y.push("poi"):"includePointsOfInterest"in l?l.includePointsOfInterest&&y.push("poi"):this.includePointsOfInterest&&y.push("poi"),"searchAutocomplete"===e&&("includeQueries"in l?l.includeQueries&&y.push("query"):this.includeQueries&&y.push("query")),0===y.length)throw new Error("[MapKit] At least one of the types needs to be included in the search/autocomplete request.");return d.resultTypeFilter=y.join(","),this._sendImmediatelyOrWithUserLocation(e,d,r,i,t)},_searchTransform:function(t,e){var i={places:[]};if(t.q&&(i.query=t.q),e.displayMapRegion){var n=new d(e.displayMapRegion.northLat,e.displayMapRegion.eastLng,e.displayMapRegion.southLat,e.displayMapRegion.westLng);i.boundingRegion=n.toCoordinateRegion()}return e.results&&(i.places=e.results.map(function(t){var e,i,n={};return t.muid&&(n.muid=t.muid),t.placecardUrl&&(n._wpURL=t.placecardUrl),t.style&&t.style.attributes&&(n._styleAttributes=t.style.attributes.map(function(t){return t.key+":"+t.value}).join(","),t.poiCategory&&-1!==Object.keys(h).indexOf(t.poiCategory)&&(n.pointOfInterestCategory=h[t.poiCategory])),t.name&&(n.name=t.name),t.attribution&&(n._providerId=t.attribution.vendorId,n._providerItemId=t.attribution.externalItemId),t.displayMapRegion&&(e=t.displayMapRegion,i=new d(e.northLat,e.eastLng,e.southLat,e.westLng),n.region=i.toCoordinateRegion(),n.coordinate=n.region.center),t.formattedAddressLines&&(n.formattedAddress=t.formattedAddressLines.join(", ")),t.center&&(n.coordinate=new p(t.center.lat,t.center.lng)),t.countryCode&&(n.countryCode=t.countryCode),n.telephone=t.telephone,n.urls=t.urls||[],n.country=t.country,n.administrativeArea=t.administrativeArea,n.administrativeAreaCode=t.administrativeAreaCode,n.locality=t.locality,n.postCode=t.postCode,n.subLocality=t.subLocality,n.thoroughfare=t.thoroughfare,n.subThoroughfare=t.subThoroughfare,n.fullThoroughfare=t.fullThoroughfare,n.areasOfInterest=t.areasOfInterest,n.dependentLocalities=t.dependentLocalities,n.timezone=t.timezone,n.timezoneSecondsFromGmt=t.timezoneSecondsFromGmt,n})),i},_autocompleteTransform:function(t,e){var i={query:t.q,results:[]};return e.results&&(i.results=e.results.map(function(t){return new n(t)})),i}}),e.exports=o},{"../../../lib/geo":4,"../configuration":165,"../point-of-interest-category":217,"../point-of-interest-filter":218,"./service-internal":227,"@maps/js-utils":82}],226:[function(t,e,i){function n(t){r(this,n)&&Object.defineProperty(this,"_impl",{value:new a(t)})}var o=t("@maps/js-utils"),s=t("./service"),a=t("./search-internal"),r=t("../check-instance-and-warn");n.prototype=o.inheritPrototype(s,n,{constructor:n,get coordinate(){return this._impl.coordinate},set coordinate(t){this._impl.coordinate=t},get region(){return this._impl.region},set region(t){this._impl.region=t},get includeAddresses(){return this._impl.includeAddresses},set includeAddresses(t){this._impl.includeAddresses=t},get includePointsOfInterest(){return this._impl.includePointsOfInterest},set includePointsOfInterest(t){this._impl.includePointsOfInterest=t},get includeQueries(){return this._impl.includeQueries},set includeQueries(t){this._impl.includeQueries=t},get pointOfInterestFilter(){return this._impl.pointOfInterestFilter},set pointOfInterestFilter(t){this._impl.pointOfInterestFilter=t},search:function(t,e,i){return this._impl.search(t,e,i)},autocomplete:function(t,e,i){return this._impl.autocomplete(t,e,i)}}),e.exports=n},{"../check-instance-and-warn":162,"./search-internal":225,"./service":228,"@maps/js-utils":82}],227:[function(t,e,i){function n(t,e){this._name=t,this._requestMap=new h,o.state===o.States.ERROR&&(this._configFailed=!0),this.language=e.language,this.getsUserLocation=!!e.getsUserLocation}var o=t("../configuration"),s=t("../localizer").languageSupport,a=t("@maps/js-utils"),r=t("../user-location/user-location"),l=t("../../../lib/geo").Coordinate,h=t("./request-map"),c=t("@maps/loaders").XHRLoader,d=t("../../build.json"),u=t("../analytics/analytics"),p=t("../../../src/js/call-function-safely"),m={enableHighAccuracy:!1,timeout:8e3,maximumAge:9e5};n.prototype={constructor:n,get getsUserLocation(){return this._getsUserLocation},set getsUserLocation(t){this._getsUserLocation=!!t},get language(){return this._language},set language(t){this._language=null==t?null:this._bestLanguage(t)},cancel:function(t){a.required(t,"[MapKit] Missing `id` in call to `"+this._name+".cancel()`.").checkType(t,"number","[MapKit] `id` passed to `"+this._name+".cancel()` is not a number.");var e=this._requestMap.typeForId(t);if(e)switch(e){case"query":case"geo":return this._requestMap.remove(t);case"xhr":var i=this._requestMap.get(t);if(i)return i.unschedule(),this._requestMap.remove(t);break;default:throw new Error("Unknown type: "+e)}return!1},handleEvent:function(t){switch(t.type){case o.Events.Error:this._configFailed=!0;case o.Events.Changed:this._requestMap.idsByType("query").forEach(function(t){var e=this._requestMap.get(t);this._send(e.path,e.parameters,e.callback,e.transform,e.name),this._requestMap.remove(t)},this)}0===this._requestMap.idsByType("query").length&&this._stopWatchingConfiguration()},_watchingConfiguration:!1,_watchConfiguration:function(){this._watchingConfiguration||(this._watchingConfiguration=!0,o.addEventListener(o.Events.Changed,this),o.addEventListener(o.Events.Error,this))},_stopWatchingConfiguration:function(){this._watchingConfiguration&&(this._watchingConfiguration=!1,o.removeEventListener(o.Events.Changed,this),o.removeEventListener(o.Events.Error,this))},_logNetworkEvent:function(t,e){var i;switch(t){case"search":i=u.Events.Search;break;case"autocomplete":i=u.Events.SearchAC;break;case"geocode":i=u.Events.ForwardGeocoder;break;case"reverseGeocode":i=u.Events.ReverseGeocoder;break;case"directions":i=u.Events.Directions;break;default:return}u.log(i,e)},_send:function(t,e,i,n,s){var r=this._requestMap;if(!o.apiBaseUrl||o.state===o.States.PENDING)return this._configFailed?(setTimeout(function(){p(i,null,[new Error("MapKit failed to initialize.")])}),0):(console.warn("[MapKit] The configuration has not been initialized, or it is loading. The request has been queued."),this._watchConfiguration(),r.add({path:t,parameters:e,callback:i,transform:n,name:s},"query"));var l;l=0===t.search(/\/v?[0-9]+\//)?o.apiBaseUrl.replace(/\/v?[0-9]+\//,"")+t:o.apiBaseUrl+t,(e=e||{}).mkjsVersion=d.version;var h=a.toQueryString(e);""!==h&&(l+=(a.parseURL(t).search?"&":"?")+h);var u=this,m=new c(l,{loaderDidSucceed:function(t,o){u._logNetworkEvent(s,{responseCode:o.status});var a;if(r.remove(t.id),o.status<200||o.status>=300){try{a=JSON.parse(o.responseText)}catch(t){return void p(i,null,[new Error("HTTP error: "+o.status)])}a&&a.error&&a.error.message?(/categor(y|ies)/i.test(a.error.message)&&console.warn("[MapKit] The version of MapKit may be deprecated."),p(i,null,[new Error("HTTP error: "+o.status+". Message: "+a.error.message+".")])):p(i,null,[new Error("HTTP error: "+o.status)])}else{try{a=JSON.parse(o.responseText)}catch(t){return void p(i,null,[new Error("Failed to parse response: "+o.responseText)])}p(i,null,[null,n(e,a)])}},loaderDidFail:function(t,e){u._logNetworkEvent(s,{responseCode:e.status}),r.remove(t.id);var n="Network error";e.status===o.HTTP.UNAUTHORIZED?n=o.ErrorStatus.Unauthorized:e.status===o.HTTP.TOO_MANY_REQUESTS&&(n=o.ErrorStatus.TooManyRequests),p(i,null,[new Error(n)])}},o.appendServiceAuthOptions({}));return m.schedule(),m.id=r.add(m,"xhr"),m.id},_sendImmediatelyOrWithUserLocation:function(t,e,i,n,o){return this.getsUserLocation||e.getsUserLocation?this._sendWithUserLocation.apply(this,arguments):this._send.apply(this,arguments)},_sendWithUserLocation:function(t,e,i,n,o){var s=this._requestMap.add({path:t,parameters:e,callback:i,transform:n,name:o},"geo");return this._locate(function(t,e){var i=this._requestMap.get(s);i&&(t?console.warn("[MapKit] Unable to get current location:",t.message):i.parameters.userLocation=[e.latitude,e.longitude].join(","),this._send(i.path,i.parameters,i.callback,i.transform,i.name),this._requestMap.remove(s))}.bind(this)),s},_checkOptions:function(t,e){a.checkType(t,"object","[MapKit] The `options` object is invalid."),Object.keys(t).forEach(function(t){-1===e.indexOf(t)&&console.warn("[MapKit] `"+t+"` is not a valid option.")})},_bestLanguage:function(t){a.checkType(t,"string","[MapKit] `language` is not a string.");var e=s.bestMatch(t);return null===e?console.warn("[MapKit] Geocoder: â"+t+"â is not supported."):e!==t&&console.warn("[MapKit] Geocoder: â"+t+"â is not supported. Substituting â"+e+"â"),e},_locate:function(t){a.required(t,"Missing callback").checkType(t,"function"),r.locate(function(e){var i=e.coords;t(null,new l(i.latitude,i.longitude))},function(e){var i;switch(e.code){case e.PERMISSION_DENIED:i="PERMISSION_DENIED";break;case e.POSITION_UNAVAILABLE:i="POSITION_UNAVAILABLE";break;case e.TIMEOUT:i="TIMEOUT";break;default:throw new Error("Unknown PositionError code: "+e.code)}t(new Error(i))},m)}},e.exports=n},{"../../../lib/geo":4,"../../../src/js/call-function-safely":161,"../../build.json":102,"../analytics/analytics":103,"../configuration":165,"../localizer":187,"../user-location/user-location":236,"./request-map":224,"@maps/js-utils":82,"@maps/loaders":83}],228:[function(t,e,i){function n(t,e){Object.defineProperty(this,"_impl",{value:new o(t,e)})}var o=t("./service-internal");n.prototype={constructor:n,get getsUserLocation(){return this._impl.getsUserLocation},set getsUserLocation(t){this._impl.getsUserLocation=t},get language(){return this._impl.language},set language(t){this._impl.language=t},cancel:function(t){return this._impl.cancel(t)}},e.exports=n},{"./service-internal":227}],229:[function(t,e,i){function n(t){this.hostNode=t,this._elementNodeMap={}}var o,s,a=t("@maps/js-utils");window.document&&(o=t("@maps/render-tree"),(s=function(t){o.Node.call(this,t)}).prototype=a.inheritPrototype(o.Node,s,{toString:function(){return this.stringInfo()+" â"}})),n.prototype={constructor:n,appendAssignedElement:function(t,e){var i=t.slot,n=new s(t);this._elementNodeMap[i]=n,this.hostNode.addChild(n),e||this.hostNode.element.appendChild(t)},removeAssignedElement:function(t,e){var i=t.name,n=this._elementNodeMap[i];delete this._elementNodeMap[i],this.hostNode.removeChild(n),e||this.hostNode.element.removeChild(n.element)},getAssignedElement:function(t){return this._elementNodeMap[t.name]?this._elementNodeMap[t.name].element:null}},e.exports=n},{"@maps/js-utils":82,"@maps/render-tree":98}],230:[function(t,e,i){window.mapkit=t("./index")},{"./index":180}],231:[function(t,e,i){function n(t,e,i){if(l.supportsShadowDOM){if("slot"===t.localName)e.push(t),i.push(t.name);else{var n=t.getElementsByTagName("slot");0!==n.length&&Array.prototype.forEach.call(n,function(t){e.push(t),i.push(t.name)})}e.forEach(function(t){t.name=c})}}function o(t,e){l.supportsShadowDOM&&t.forEach(function(t,i){t.name=e[i]})}function s(t){this._element=l.htmlElement("div",{class:h}),this.delegate=t}function a(t){if(!t||t.nodeType!==window.Node.ELEMENT_NODE)return new r;var e=window.getComputedStyle(t),i=parseFloat(e.marginLeft),n=parseFloat(e.marginTop),o=parseFloat(e.marginRight),s=parseFloat(e.marginBottom);return r.rectFromClientRect(t.getBoundingClientRect()).inset(-i,-n,-o,-s)}var r=t("@maps/geometry/rect"),l=t("./utils"),h="mk-style-helper",c="mk-slot-disabled";s.prototype={constructor:s,delegate:null,get element(){return this._element},sizeForElement:function(t){var e=t.cloneNode(!0),i=[],s=[];n(t,i,s),this._element.appendChild(e),this.delegate&&this.delegate.styleHelperNodeDidMoveToParent&&this.delegate.styleHelperNodeDidMoveToParent(e);var r=e;l.supportsShadowDOM&&"slot"===t.localName&&(r=e.assignedNodes()[0]);var h=a(r);return this._element.removeChild(e),o(i,s),h.size},backgroundColorForElement:function(t,e){this._element.appendChild(t),this.delegate&&this.delegate.styleHelperNodeDidMoveToParent&&this.delegate.styleHelperNodeDidMoveToParent(t);var i=t;if(l.supportsShadowDOM&&"slot"===t.localName&&!(i=t.assignedNodes()[0]))return this._element.removeChild(t),null;var n=window.getComputedStyle(i).backgroundColor;return e&&(i.style.backgroundColor="transparent"),this._element.removeChild(t),/^transparent|initial|rgba\(.*, 0\)$/.test(n)?null:n},setAnimationForElement:function(t,e,i){var n=t;if(!l.supportsShadowDOM||"slot"!==t.localName||(n=t.assignedNodes()[0])){n.style.animation=n.style.webkitAnimation=e;var o=function(t){t.animationName===i&&(n.style.animation=n.style.webkitAnimation="",n.removeEventListener("animationend",o),n.removeEventListener("webkitAnimationEnd",o))};n.addEventListener("animationend",o),n.addEventListener("webkitAnimationEnd",o)}}},e.exports=s},{"./utils":237,"@maps/geometry/rect":72}],232:[function(t,e,i){var n=t("../../lib/geo"),o=t("@maps/js-utils"),s=n.Coordinate,a=n.CoordinateRegion,r=n.CoordinateSpan,l=n.MapRect;e.exports={enclosingRegionForCoordinates:function(t){var e=0,i=180,l=-180,h=0,c=90,d=-90;t.forEach(function(t){var s=o.clamp(t.latitude,-90,90);c=Math.min(c,s),d=Math.max(d,s);var a=n.wrapLongitude(t.longitude);a<0?(e=Math.min(e,a),l=Math.max(l,a)):(i=Math.min(i,a),h=Math.max(h,a))});var u,p,m=d-c,g=c+m/2;if(e>l)p=i+(u=h-i)/2;else if(i>h)p=e+(u=l-e)/2;else{var _=h-e,f=360-(i-l);p=_<f?e+(u=_)/2:i+(u=f)/2}return new a(new s(g,p),new r(m,u))},padMapRect:function(t,e){o.checkType(e,"object","[MapKit] MapRect.pad expects a padding object with top, left, bottom, right but got `"+e+"` instead");var i=e.left||0,n=e.top||0;return new l(t.origin.x-i,t.origin.y-n,t.size.width+i+(e.right||0),t.size.height+n+(e.bottom||0))},mapRectContains:function(t,e){var i=e.origin.x,n=e.origin.y,o=t.maxX(),s=t.maxY();return i>=t.origin.x&&i<=o&&n>=t.origin.y&&n<=s&&e.maxX()<=o&&e.maxY()<=s},boundingRectForSortedRects:function(t){if(0===t.length)return new l;if(1===t.length){var e=t[0].minX();return e>=0&&e<1?t[0]:new l(o.mod(e,1),t[0].minY(),t[0].size.width,t[0].size.height)}for(var i=[[t[0].minX(),t[0].maxX()]],n=t[0].minY(),s=t[0].maxY(),a=1,r=t.length,h=0;a<r;++a){var c=i[h],d=t[a];n=Math.min(n,d.minY()),s=Math.max(s,d.maxY()),d.minX()<=c[1]?i[h]=[c[0],Math.max(c[1],d.maxX())]:(i.push([d.minX(),d.maxX()]),++h)}var u=i.length;if(1===u)return new l(i[0][0],n,Math.min(i[0][1]-i[0][0],1),s-n);for(var p=1+i[0][0]-i[u-1][1],m=i[0][0],g=1;g<u;++g){var _=i[g][0]-i[g-1][1];_>p&&(p=_,m=i[g][0])}return new l(o.mod(m,1),n,1-p,s-n)}}},{"../../lib/geo":4,"@maps/js-utils":82}],233:[function(t,e,i){var n=t("@maps/dom-events"),o={EventTarget:n.EventTarget,Event:n.Event};e.exports=o},{"@maps/dom-events":64}],234:[function(t,e,i){"use strict";var n=t("../build.json"),o=t("@maps/js-utils");e.exports={_basePath:"",_syrupBasePath:"",createBaseUrl:function(e,i){if(i=i||window.location,!this._basePath){var s=t("./configuration");if(s.state===s.States.UNINITIALIZED)throw new Error("Cannot create URLs before calling mapkit.init().");if(this._basePath=n.useLocalResources||n.useInPlacecardJS?this.getMapKitScriptParts().prefix:n.cdnBase,n.useInPlacecardJS&&n.mapkitPath&&(this._basePath=[this._basePath,n.mapkitPath].join("/")),s.proxyPrefixes&&(this._basePath=s.proxyPrefixes[0]+this._basePath),this._basePath===n.cdnBase){var a=o.isIE10()?i.protocol:"https:";this._basePath=a+this._basePath}}return e=e&&e.replace(/^\//,"")||"",[this._basePath,e].join("/")},createBaseSyrupUrl:function(e,i){if(i=i||window.location,!this._syrupBasePath){var s=t("./configuration");if(s.state===s.States.UNINITIALIZED)throw new Error("Cannot create URLs before calling mapkit.init().");if(this._syrupBasePath=n.useLocalResources?this.getMapKitScriptParts().prefix:n.cdnBase,s.proxyPrefixes&&(this._syrupBasePath=s.proxyPrefixes[0]+this._syrupBasePath),this._syrupBasePath===n.cdnBase){var a=o.isIE10()?i.protocol:"https:";this._syrupBasePath=a+this._syrupBasePath}}return e=e&&e.replace(/^\//,"")||"",[this._syrupBasePath,e].join("/")},createUrl:function(t){return n.useLocalResources||n.useInPlacecardJS?this.createBaseUrl(t):this.createBaseUrl(["mk",n.cdnVersion,t].join("/"))},createImageUrl:function(t){return this.createUrl("images/"+t)},getMapKitScriptParts:function(){for(var t=/(.*)(?=\/mapkit\.js)/,e=/(.*)(?=\/placecard\.js)/,i=document.scripts,n=0,s=i.length;n<s;++n){var a=t.exec(i[n].src)||e.exec(i[n].src);if(a){var r=o.parseURL(i[n].src);return r.prefix=a[0],r}}return{}}}},{"../build.json":102,"./configuration":165,"@maps/js-utils":82}],235:[function(t,e,i){function n(t){this._delegate=t,this._showsUserLocation=!1,this._tracksUserLocation=!1}var o=t("./user-location");n.prototype={constructor:n,get showsUserLocation(){return this._showsUserLocation},set showsUserLocation(t){!t||o.isAvailable?(this._showsUserLocation=t,t?(o.addEventListener(o.Events.Change,this),o.addEventListener(o.Events.Error,this),o.watch()):(o.removeEventListener(o.Events.Change,this),o.removeEventListener(o.Events.Error,this))):console.warn("[MapKit] User location is unavailable.")},get tracksUserLocation(){return this._tracksUserLocation},set tracksUserLocation(t){!t||o.isAvailable?(this._tracksUserLocation=t,t?(o.addEventListener(o.Events.Change,this),o.addEventListener(o.Events.Error,this),o.watch()):(o.removeEventListener(o.Events.Change,this),o.removeEventListener(o.Events.Error,this))):console.warn("[MapKit] User location is unavailable.")},get userLocation(){return o},handleEvent:function(t){switch(t.type){case o.Events.Change:this._handleUserLocationChange(t);break;case o.Events.Error:this._handleUserLocationError(t)}},mapWasDestroyed:function(){delete this._delegate,o.removeEventListener(o.Events.Change,this),o.removeEventListener(o.Events.Error,this)},_handleUserLocationChange:function(t){o.errorCode=0,this._delegate.userLocationDidChange(t)},_handleUserLocationError:function(t){o.errorCode=t.code,this._delegate.userLocationDidError(t)}},e.exports=n},{"./user-location":236}],236:[function(t,e,i){function n(){this._location=null,this._coordinate=null,this._stale=!1,this._watchers=0,m.addEventListener(m.Events.Changed,this)}function o(){clearTimeout(f),f=null}function s(t,e,i){if("AutoNavi"===m.tileProvider){var n=new d(t.coords.latitude,t.coords.longitude);g.shift(n,m.locationShiftUrl,function(n,o){if(n)i&&i(n);else{var s={coords:{latitude:o.latitude,longitude:o.longitude}};"accuracy"in t.coords&&(s.coords.accuracy=t.coords.accuracy),e&&e(s)}})}else e&&e(t)}function a(t){o(),y=t,m.ready?!v._stale&&v._coordinate&&t.coords.latitude===v._coordinate.latitude&&t.coords.longitude===v._coordinate.longitude||s(t,r,l):l({code:4,message:"MapKit not initialized."})}function r(t){v._stale=!1,v._location=t.coords,v._coordinate=new d(t.coords.latitude,t.coords.longitude),v.dispatchEvent(new h(v._coordinate,t.coords.floorLevel))}function l(t){y=null,v._stale=!0,v.dispatchEvent(new c(t))}function h(t,e){u.Event.call(this,_.Change),this.coordinate=t,this.floorLevel=e,this.timestamp=new Date}function c(t){u.Event.call(this,_.Error),this.code=t.code,this.message=t.message}var d=t("../../../lib/geo").Coordinate,u=t("../unsafe-dom"),p=t("@maps/js-utils"),m=t("../configuration"),g=t("../coordinate-shifter"),_={Change:"user-location-change",Error:"user-location-error"},f=null;n.prototype=p.inheritPrototype(u.EventTarget,n,{Events:_,get location(){return this._location},get coordinate(){return this._coordinate},get stale(){return this._stale},get isAvailable(){return window.navigator.geolocation&&"function"==typeof window.navigator.geolocation.watchPosition&&"function"==typeof window.navigator.geolocation.getCurrentPosition},watch:function(){this._watchId||(window.navigator.geolocation.watchPosition?(o(),this._watchId=window.navigator.geolocation.watchPosition(a,l),f=setTimeout(function(){o(),l({code:3,message:"Timeout expired"})},15e3)):console.warn("[MapKit] User location is unavailable."))},locate:function(t,e,i){window.navigator.geolocation.getCurrentPosition?y&&this._watchId?s(y,t,e):window.navigator.geolocation.getCurrentPosition(function(i){s(i,t,e)},e,i):console.warn("[MapKit] User location is unavailable.")},addEventListener:function(){u.EventTarget.prototype.addEventListener.apply(this,arguments)&&++this._watchers},removeEventListener:function(){u.EventTarget.prototype.removeEventListener.apply(this,arguments)&&0===--this._watchers&&this._watchId&&(window.navigator.geolocation.clearWatch(this._watchId),this._watchId=null)},handleEvent:function(t){switch(t.type){case m.Events.Changed:if(!y)return;a(y)}},reset:function(){o(),this._watchers=0,this._watchId=null,y=null}});var y,v=new n;h.prototype=p.inheritPrototype(u.Event,h,{}),c.prototype=p.inheritPrototype(u.Event,c,{}),e.exports=v},{"../../../lib/geo":4,"../configuration":165,"../coordinate-shifter":177,"../unsafe-dom":233,"@maps/js-utils":82}],237:[function(t,e,i){function n(t){for(var e,i="";e=t.match(/:host\(/);){i+=t.substr(0,e.index),t=t.substr(e.index+e[0].length);for(var n=1;e=t.match(/^([^()]*)([()])?/);){if(t=t.substr(e[0].length),"("===e[2])n+=1;else if(")"===e[2]&&0==(n-=1)){i+=e[1];break}if(i+=e[0],!e[2])break}}return i+t}function o(t,e){var i=window.document.createElementNS(this,t),n=1;if("object"==typeof e&&null!=e&&!(e instanceof window.Node)){++n;for(var o in e)i.setAttribute(o,e[o])}for(var s=n,a=arguments.length;s<a;++s){var r=arguments[s];r instanceof window.Node?i.appendChild(r):"string"==typeof r&&i.appendChild(document.createTextNode(r))}return i}var s=t("@maps/device-pixel-ratio"),a=t("../../lib/map-node/src/constants").Tints,r=window.document&&t("@maps/gesture-recognizers").SupportsTouches,l=window.document&&t("@maps/gesture-recognizers").SupportsPointerEvents,h=window.document&&"ShadowRoot"in window;if(h&&window.navigator&&window.navigator.appVersion){var c=parseInt((navigator.appVersion.match(/AppleWebKit\/(\d+)/)||[])[1],10);c>=602&&c<605&&(h=!1)}e.exports={focusColor:"rgb(0, 122, 255)",get devicePixelRatio(){return s()},supportsTouches:r,supportsPointerEvents:l,supportsGestureEvents:!!window.GestureEvent,startEventType:l?"pointerdown":r?"touchstart":"mousedown",moveEventType:l?"pointermove":r?"touchmove":"mousemove",endEventType:l?"pointerup":r?"touchend":"mouseup",cancelEventType:l?"pointercancel":r?"touchcancel":void 0,supportsForceTouch:!r&&window.document&&"webkitForce"in MouseEvent.prototype,transitionend:window.document&&document.createElement("div").style.WebkitTransition?"webkitTransitionEnd":"transitionend",htmlElement:o.bind("http://www.w3.org/1999/xhtml"),svgElement:o.bind("http://www.w3.org/2000/svg"),supportsShadowDOM:h,insideIframe:window.top!==window,getShadowDOMTargetFromEvent:function(t,e){var i=this.containingDocumentOrShadowRoot(t);if(i===document)return e.target;var n=e.changedTouches?e.changedTouches[0]:e,o=i.elementFromPoint(n.clientX,n.clientY);return o||document.body},containingDocumentOrShadowRoot:function(t){return this.supportsShadowDOM?t.getRootNode():document},addShadowRootChild:function(e,i){var o,s=t("@maps/render-tree").Node;return this.supportsShadowDOM?o=e.createAndAddShadowRootChild():(o=e.addChild(new s),i=n(i)),o.addChild(new s(this.htmlElement("style",i))),o},parentNodeForSvgTarget:function(t){return t.tagName&&"div"!==t.tagName.toLowerCase()?this.parentNodeForSvgTarget(t.parentNode):t},imagePathForDevice:function(t,e,i){var n=Math.floor(this.devicePixelRatio),o=(t||[]).indexOf(n)>=0?n:1;return i=i||".png",e+(o>1?"_"+o+"x":"")+i},parseQueryString:function(t){var e,i={},n=/\+/g,o=/([^&=]+)=?([^&]*)/g,s=function(t){return decodeURIComponent(t.replace(n," "))};if("string"==typeof t)for(;null!==(e=o.exec(t));)i[s(e[1])]=s(e[2]);return i},createSVGIcon:function(t,e){var i=this.svgElement("svg",e);return i.setAttribute("class","mk-icon"),i.setAttribute("focusable",!1),i.appendChild(this.svgElement("g")).appendChild(t),i},convertColorToRGB:function(t){var e=document.createElement("div");return e.style.setProperty("color",t),e.style.color},isValidCSSColor:function(t){return""!==this.convertColorToRGB(t)},updateLabel:function(t,e){t.setAttribute("title",e),t.setAttribute("aria-label",e)},easeInOut:function(t){var e=Math.pow(t,2);return e/(e+Math.pow(1-t,2))},darkColorScheme:function(t){return t===a.Dark}}},{"../../lib/map-node/src/constants":15,"@maps/device-pixel-ratio":63,"@maps/gesture-recognizers":74,"@maps/render-tree":98}],238:[function(t,e,i){e.exports={"Annotation.Clustering.AccessibilityLabel":"{{n}} locations, {{title}}, {{subtitle}}","Annotation.Clustering.More":"+{{n}} more","Annotation.Clustering.More.Plural":"+{{n}} more","Annotation.Clustering.NoTitle.AccessibilityLabel":"{{n}} locations, {{subtitle}}","Annotation.Generic.AccessibilityLabel":"{{title}}, {{subtitle}}","Annotation.Marker.AccessibilityLabel":"Marker","Annotation.Pin.AccessibilityLabel":"Pin","Annotation.Pin.Green.AccessibilityLabel":"Green Pin","Annotation.Pin.Purple.AccessibilityLabel":"Purple Pin","Annotation.Pin.Red.AccessibilityLabel":"Red Pin","Compass.Degrees.Plural":"{{n}} degrees","Compass.Degrees.Single":"{{n}} degree","Compass.NorthIndicator":"N","Compass.Tooltip":"Rotate the map","Legal.Apple.URL":"https://www.apple.com/legal/internet-services/maps/legal-en.html","Legal.Label":"Legal","Location.Error.Instructions":"To allow this page to show your current location, connect to Wi-Fi and enable location services in your browser.","Location.Error.Message":"Your location can only be shown when location services are enabled and you are connected to the Internet.","Location.Error.Support.HTML":"For more information, visit {{link}}.","Location.Error.Support.Label":"Learn more","Location.Error.Support.URL":"https://support.apple.com/en-us/HT204690","Location.Error.Title":"Your current location cannot be shown.","Location.Subtitle":"Unknown Address","Location.Title":"Current Location","Logo.Apple.Tooltip":"Apple","Logo.AutoNavi.Tooltip":"AutoNavi","MapType.Tooltip":"Change the map type","Mode.Hybrid":"Hybrid","Mode.Satellite":"Satellite","Mode.Standard":"Standard","Scale.Feet.Short":"ft","Scale.Kilometer.Short":"km","Scale.Meter.Short":"m","Scale.Mile.Short":"mi","Track.User.Location.Tooltip":"Show your current location","Zoom.In.Tooltip":"Zoom In","Zoom.Out.Tooltip":"Zoom Out"}},{}],239:[function(t,e,i){e.exports={"en-AU":"en-GB","en-IE":"en-GB","en-IN":"en-GB","en-NZ":"en-GB","en-SG":"en-GB","en-ZA":"en-GB","es-LA":"es-MX","es-XL":"es-MX","nn-NO":"nb-NO","no-NO":"nb-NO"}},{}],240:[function(t,e,i){e.exports=["en-US","fr-FR","pt-BR","zh-CN"]},{}],241:[function(t,e,i){e.exports={zh:{CN:"Hans",HK:"Hant",TW:"Hant"}}},{}],242:[function(t,e,i){e.exports=["ar-SA","iw-IL"]},{}],243:[function(t,e,i){e.exports=["ar-SA","ca-ES","cs-CZ","da-DK","de-DE","el-GR","en-GB","en-US","es-ES","es-MX","fi-FI","fr-CA","fr-FR","hi-IN","hr-HR","hu-HU","id-ID","it-IT","iw-IL","ja-JP","ko-KR","ms-MY","nl-NL","nb-NO","pl-PL","pt-BR","pt-PT","ro-RO","ru-RU","sk-SK","sv-SE","th-TH","tr-TR","uk-UA","vi-VN","zh-CN","zh-HK","zh-TW"]},{}],244:[function(t,e,i){e.exports=["ar","ca","cs","da","de","el","en","en-AU","en-GB","es","es-MX","fi","fr","fr-CA","he","hi","hr","hu","id","it","ja","ko","ms","nb","nl","pl","pt","pt-PT","ro","ru","sk","sv","th","tr","uk","vi","zh-Hans","zh-Hant"]},{}]},{},[230]);